<h1 mat-dialog-title> {{ 'RequestMsgsPage.Details' | translate }} </h1>

<div mat-dialog-content>


    <div class="kb-details-form-container">

        <div class="input-container">
            <span class="input-label" *ngIf="kb.type !== 'faq'">{{ 'Name' | translate }}</span>
            <span class="input-label" *ngIf="kb.type === 'faq'">{{ 'FaqPage.Question' | translate }}</span>
            <input [(ngModel)]="name" type="text" name="name" class="custom-input">

            <!-- ------------------------------------ -->
            <!-- Use cese URL -->
            <!-- ------------------------------------ -->
            <div *ngIf="kb.type === 'url' ">
                <span *ngIf="!kb.sitemap_origin" class="input-label">{{ 'KbPage.Url' | translate }}</span>
                <span *ngIf="kb.sitemap_origin" class="input-label">Sitemap</span>
                <a *ngIf="!kb.sitemap_origin" class="input-label link-page" [href]="source" target="_blank">
                    <span class="material-icons-outlined">
                        open_in_new
                    </span>
                </a>
                <a *ngIf="kb.sitemap_origin" class="input-label link-page" [href]="kb.sitemap_origin" target="_blank">
                    <span class="material-icons-outlined">
                        open_in_new
                    </span>   
                </a>

                 <!-- <span *ngIf="kb.sitemap_origin" class="material-icons-outlined" style="font-size: 14px;vertical-align: middle;cursor: pointer;">
                    mode_edit
                 </span> -->


                <input *ngIf="!kb.sitemap_origin" [(ngModel)]="source" type="url" name="url" class="custom-input">
                
                <input disabled *ngIf="kb.sitemap_origin" [(ngModel)]="kb.sitemap_origin" type="url" name="url" class="custom-input">

            </div>

            <div *ngIf="kb.type === 'sitemap' ">
                <span class="input-label">{{ 'KbPage.Url' | translate }}</span>
                <!-- <span *ngIf="kb.sitemap_origin" class="input-label">Sitemap</span> -->
                <a class="input-label link-page" [href]="source" target="_blank">
                    <span class="material-icons-outlined">
                        open_in_new
                    </span>
                </a>

                <input disabled [(ngModel)]="source" type="url" name="url" class="custom-input">

            </div>
            <!-- ------------------------------------ -->
            <!-- Use case text -->
            <!-- ------------------------------------ -->
            <div *ngIf="kb.type === 'text'">
                <span class="input-label">{{ 'KbPage.FileText' | translate }}</span>
                <textarea [(ngModel)]="content" type="text" name="content" class="custom-textarea" rows="4"></textarea>
            </div>

            <!-- ------------------------------------ -->
            <!-- Use case text -->
            <!-- ------------------------------------ -->
            <div *ngIf="kb.type === 'faq'">
                <span class="input-label">{{ 'FaqPage.Answer' | translate }}</span>
                <textarea [(ngModel)]="content" type="text" name="content" class="custom-textarea" rows="4"></textarea>
            </div>

            <!-- style="max-height: calc(100vh - 223.5px); overflow-y: scroll;" -->
        </div>

    </div>
    <loading-spinner *ngIf="showSpinner"></loading-spinner>
   
    <ng-container *ngIf="kb.type !== 'sitemap'"> 
        <div *ngIf="!showSpinner && kb._id" class="content-chunks-wpr">
            <div class="chunk-title-and-count">
                <div class="chunk-title">
                    Chunks
                </div>
                <div class="chunk-count">
                    {{chunksCount}}
                </div>
            </div>

            <div class="chunk-error" *ngIf="getChunksError"> 
                <span class="material-icons-outlined">
                    error
                </span>
                {{ 'AnErrorHasOccurred' | translate }}
            </div>
            
            <div class="content-chunks" style="display: flex; flex-wrap: nowrap; flex-direction: column; gap: 12px">
                
                <div class="chunk-wpr" *ngFor="let chunk of chunks">
                    <div class="chunk-id"> chunk-id: {{chunk.id}} </div>
                    <article class="chunk" >
                        {{ chunk.text}}
                    </article>
                </div>

            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="kb.type === 'sitemap'">
  
        <hr style="margin-top: 0px;margin-bottom: 12px;">

        <div class="sitemap-refresh-wpr"> 
            <div class="sitemap-refresh-rate-label" style="font-weight: 400;">
                {{'KbPage.RefreshRate' | translate}}:
            </div>
            
            <div class="sitemap-refresh-rate-value">
                <!-- {{kb.refresh_rate}} -->

                <span *ngIf="kb.refresh_rate === 'never' ">
                    {{'Never' | translate}}
                </span>
                <span *ngIf="kb.refresh_rate === 'daily' ">
                    {{'Daily' | translate}}
                </span>

                <span *ngIf="kb.refresh_rate === 'weekly' ">
                    {{'Weekly' | translate}}
                </span>

                <span *ngIf="kb.refresh_rate === 'monthly' ">
                    {{'Monthly' | translate}}
                </span>
            </div>
        </div>

    </ng-container>


</div>

<div mat-dialog-actions style="justify-content: center;">
    <button class="mat-dialog-close-btn" mat-button (click)="onCloseBaseModal()">
        {{ "Cancel" | translate }}
    </button>

    <button *ngIf="kb._id && (kb.type === 'text' || kb.type === 'faq')" class="mat-dialog-ok-btn" [disabled]="name.length < 3 || content.length === 0"
        mat-button (click)="onUpdateKnowledgeBase()">
        {{ "Update" | translate }}
    </button>

    <button *ngIf="kb._id && kb.type === 'url' || kb._id && kb.type === 'sitemap'" class="mat-dialog-ok-btn" [disabled]="name.length < 3 || source.length === 0"
        mat-button (click)="onUpdateKnowledgeBase()">
        {{ "Update" | translate }}
    </button>

     <button *ngIf="kb._id && kb.type === 'sitemap'" class="btn btn-red btn-red-custom"
        mat-button (click)="onDeleteKnowledgeBase()" style="height: 36px; line-height: 20px;">
        {{ "Delete" | translate }}
    </button>

    <button *ngIf="kb._id && (kb.type === 'pdf' || kb.type === 'txt' ||  kb.type === 'docx')" class="mat-dialog-ok-btn"
        [disabled]="name.length < 3" mat-button (click)="onUpdateKnowledgeBase()">
        {{ "Update" | translate }}
    </button>

    <!-- Pulsante SALVA per nuova KB -->
    <button *ngIf="!kb._id && kb.type === 'faq'" class="mat-dialog-ok-btn" [disabled]="name.length < 3 || content.length === 0"
        mat-button (click)="onUpdateKnowledgeBase()">
        {{ "Save" | translate }}
    </button>
    <button *ngIf="!kb._id && kb.type !== 'faq'" class="mat-dialog-ok-btn" [disabled]="name.length < 3 || (!content && !source)"
        mat-button (click)="onUpdateKnowledgeBase()">
        {{ "Save" | translate }}
    </button>
</div>