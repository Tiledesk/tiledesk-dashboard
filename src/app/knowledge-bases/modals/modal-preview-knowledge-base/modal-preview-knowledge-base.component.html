<div class="m-header" (click)="handleClickInside($event)">
  <h1 mat-dialog-title> {{ 'Preview' | translate }} </h1>
  <div class="m-top-right-icon">

    <span *ngIf="!isopenasetting" id="settings" class="material-icons-outlined"
      (click)="presentDialogAiSettings(isopenasetting = !isopenasetting)">
      settings
    </span>
    <span *ngIf="isopenasetting" id="settings" class="material-icons-outlined close-ai-settings"
      (click)="closeDialogAiSettings(isopenasetting = !isopenasetting)">
      remove
    </span>

    <!-- <span id="settings" class="material-icons-outlined"  (click)="closePreviewKBAndOpenSettingsModal()">
      settings
    </span> -->

    <span id="close" class="material-icons-outlined" (click)="onCloseBaseModal()">
      close
    </span>
  </div>

</div>
<div mat-dialog-content (click)="handleClickInside($event)">

  <div class="form--container">
    <p class="answer-title">{{ 'FaqPage.Question' | translate }}</p>
   <!--  <div class="fake-input">
      <div class="fake-input-inner">
        <input type="text" placeholder="{{ 'KbPage.AskQuestionPlaceholder' | translate }}" [(ngModel)]="question"
          (input)="onInputPreviewChange()" (keyup.enter)="submitQuestion()">
        <div id="enter-button" class="enter-button" (click)="submitQuestion()">Enter</div>
      </div>
    </div>-->
    <textarea #questionTextarea class="question-textarea" placeholder="{{ 'KbPage.AskQuestionPlaceholder' | translate }}" [(ngModel)]="question"
        (input)="onTextareaInput(questionTextarea)" (keydown.enter)="onEnterKeyDown($event)" rows="1"></textarea>
  </div>

    <!-- KB Tags -->
  <input id="kb-tags" class="adds-kb-input" name="kb-tags" 
          [placeholder]="('Tags.AddTags' | translate) + '...'" type="text"
          [(ngModel)]="kbTag"  autocomplete="off" (keyup.enter)="addsKbTag(kbTag)"
          style="margin-top: 6px;">

  <div class="kb-tags-container" #kbTagsContainer [ngStyle]="{'height':tagContainerElementHeight }">

      <span *ngFor="let kbtag of kbTagsArray" aria-label="tag" class="tags-btn-wpr">
      <p weight="400" class="kb-tag">{{kbtag}}</p>
      <button aria-label="Delete {{kbtag}} tag" type="button" class="delete-tag-btn" (click)="removeKbTag(kbtag)">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
          class="remove-tag-icon" style="min-width: 12px; min-height: 12px;margin-right: 0px;">
          <path
              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z">
          </path>
          <path d="M0 0h24v24H0z" fill="none"></path>
          </svg>
      </button>
      </span>

  </div>

  <div *ngIf="searching" class="search-placeholder">
    <div class="fake-input">
      <loading-spinner class="custom-spinner"></loading-spinner>
      <span style="margin-left: 8px;">{{ 'KbPage.SearchingAnswer' | translate }}</span>
    </div>
  </div>

  <div *ngIf="show_answer" class="form--container" style="margin-bottom: 0px;">
    <p *ngIf="answer" class="answer-title">
      {{ 'KbPage.Answer' | translate }}

   
      <span *ngIf="qa?.ai_model"> ({{ 'KbPage.GeneratedByModel' | translate: {ai_model_name: qa?.ai_model } }}) </span>
    </p>
    <div id="answer" class="answer">

      <!-- <span *ngIf="!aiQuotaExceeded">  -->
      {{ answer }}
      <!-- </span>  -->
      <!-- <span *ngIf="aiQuotaExceeded">
       -> {{ answer }}
       </span> -->
      <span *ngIf="qa && (!qa.answer || qa.answer == '')">
        {{ 'KbPage.NoAnswerFound' | translate }}
      </span>
      <!-- <hr *ngIf="qa && qa.source">
      
      <span *ngIf="qa && qa.source">{{ 'KbPage.Source' | translate }}:
        <a *ngIf="source_url" href="{{source_url}}" target="_blank">{{ source_url }}</a>
        <span *ngIf="!source_url">{{ qa.source }}</span>
      </span> -->

    </div>
    <!-- ----------------------------- -->
    <!-- Chunks Accordion -->
    <!-- ----------------------------- -->
  <div class="mat-accordion--wpr" style="margin-top: 3px;">
    <mat-accordion>
      <mat-expansion-panel  class="custom-expansion-panel" (opened)="panelOpenState = true" (closed)="panelOpenState = false">
        <mat-expansion-panel-header>
          <mat-panel-title>
           {{ 'KbPage.ChunksUsedForTheAnswer' | translate }} ({{contentChunks?.length}})
          </mat-panel-title>
          <!-- <mat-panel-description>
        Currently I am {{panelOpenState ? 'open' : 'closed'}}
      </mat-panel-description> -->
        </mat-expansion-panel-header>
        <div class="chunk--wpr" *ngFor="let chunk of contentChunks">
        
          <article class="chunk">
            {{ chunk}}
          </article>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    </div>

    <hr class="horizontal-line" *ngIf="qa && qa.source">

    <p *ngIf="qa && qa.source" class="answer-title">{{ 'KbPage.Source' | translate }}</p>
    <div *ngIf="qa && qa.source" id="answer" class="answer">
      <span *ngIf="qa && qa.source">{{ 'KbPage.Source' | translate }}:
        <a *ngIf="source_url" href="{{source_url}}" target="_blank">{{ source_url }}</a>
        <span *ngIf="!source_url">{{ qa.source }}</span>
      </span>

    </div>
    <label *ngIf="!aiQuotaExceeded" class="control-label response-time-label">
      <!-- {{ 'KbPage.LabelResponseTime' | translate: translateparam }} -->
      <span *ngIf="responseTime">
        {{ 'Analytics.Metrics.ResponseTime' | translate }}: <span> {{ 'KbPage.AIResponseTime' | translate:
          translateparam }} </span>
      </span>
    </label>
    <label *ngIf="!aiQuotaExceeded" class="control-label prompt-size-label">
      <!-- {{ 'KbPage.TotalTokensUsage' | translate: {prompt_token_size: prompt_token_size } }} -->
      <span *ngIf="prompt_token_size">
        {{ 'KbPage.PromptSize' | translate }}: <span> {{ 'KbPage.PromptSizeUsage' | translate: {prompt_token_size:
          prompt_token_size } }} </span>
      </span>
    </label>
  </div>


</div>

<div mat-dialog-actions style="justify-content: center;" (click)="handleClickInside($event)">


  <button class="mat-dialog-reuse-last-question-btn" mat-button (click)="reuseLastQuestion()"
    [disabled]="!hasStoredQuestion">
    <!-- Re-use last question -->
    {{"KbPage.ReUseLastQuestion" | translate }}

  </button>

  <button class="mat-dialog-ok-btn" mat-button  (click)="submitQuestion()">
     {{ "Send" | translate }}
  </button>

</div>
<!-- <div>
 selectedModel > {{ selectedModel}} 
</div>
<div>
  maxTokens > {{ maxTokens}} 
 </div>
 <div>
  temperature > {{ temperature}} 
 </div>
 <div>
  topK > {{ topK}} 
 </div>
 <div>
  context > {{ context}} 
 </div> -->

<!-- style="justify-content: center;" -->
<!-- <div mat-dialog-actions style="justify-content: center;">
  <button class="mat-dialog-close-btn" mat-button (click)="onCloseBaseModal()">
    {{ "Cancel" | translate }}
  </button>
</div> -->