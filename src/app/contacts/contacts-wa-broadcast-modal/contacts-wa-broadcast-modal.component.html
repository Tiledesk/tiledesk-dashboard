<div class="contacts-wa-broadcast-modal-container">
  
  <div class="b-flex-container">
    
    <div class="b-left-columns-container">
      
      <div class="b-left--columns">
        
        <div class="choose-wa-tmplt-label-and-select-wpr">
          <div class="template-select-label">{{ 'ChooseTemplate' | translate }}</div>
          
          <div class="select-and-btn-wpr">
            <ng-select id="template-select" 
              [clearable]="false" 
              [searchable]="false"
              [(ngModel)]="templateName" 
              [items]="templates_list" 
              bindLabel="name"
              bindValue="name" 
              placeholder="{{ 'ChooseTemplate' | translate }}" 
              style="width: 250px;"
              (change)="onSelectTemplate()">
            </ng-select>
          </div>
        </div>

        <!-- All Parameters in one section -->
        <div class="template-params-input-wpr">
          
          <!-- Phone Number - Always visible -->
          <div class="params-section-title">Phone number</div>
          <div class="params-container">
            <div class="param-input-wpr">
              <div class="param-label-container">
                <i class="material-icons-outlined param-phone-icon">phone</i>
              </div>
              <div class="param-input-container">
                <input 
                  type="text" 
                  class="form-control input-md param-input"
                  [(ngModel)]="phoneNumber"
                  placeholder="+1555123456"
                  style="width: 100%;">
                <div class="param-input-icons">
                  <i class="material-icons-outlined param-icon">info_outline</i>
                  <i class="material-icons-outlined param-icon">code</i>
                </div>
              </div>
            </div>
          </div>

          <!-- Header Parameters -->
          <div *ngIf="selected_template && headerParamsValues.length > 0">
            <div class="params-section-title">Header parameters</div>
            <div class="params-section-description" *ngIf="header_component?.format === 'IMAGE' || header_component?.format === 'DOCUMENT'">
              The header contains a Media to customize
            </div>
            <div class="params-container">
              <div class="param-input-wpr" *ngFor="let param of headerParamsValues; let i = index; trackBy: trackByIndex">
                <div class="param-label-container">
                  <span class="param-number-badge">{{ i + 1 }}</span>
                </div>
                <div class="param-input-container">
                  <input 
                    type="text" 
                    class="form-control input-md param-input"
                    [ngModel]="headerParamsValues[i]" 
                    (ngModelChange)="headerParamsValues[i] = $event; onHeaderParamChange()"
                    [placeholder]="header_component?.format === 'IMAGE' || header_component?.format === 'DOCUMENT' ? 'Insert a valid URL or update a file' : '{{' + (i + 1) + '}}'"
                    style="width: 100%;">
                  <div class="param-input-icons">
                    <i class="material-icons-outlined param-icon" *ngIf="header_component?.format === 'IMAGE' || header_component?.format === 'DOCUMENT'">cloud_upload</i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Body Parameters -->
          <div *ngIf="selected_template && bodyParamsValues.length > 0">
            <div class="params-section-title">Body parameters</div>
            <div class="params-container">
              <div class="param-input-wpr" *ngFor="let param of bodyParamsValues; let i = index; trackBy: trackByIndex">
                <div class="param-label-container">
                  <span class="param-number-badge">{{ i + 1 }}</span>
                </div>
                <div class="param-input-container">
                  <input 
                    type="text" 
                    class="form-control input-md param-input"
                    [ngModel]="bodyParamsValues[i]" 
                    (ngModelChange)="bodyParamsValues[i] = $event; onBodyParamChange()"
                    [placeholder]="'{{' + (i + 1) + '}}'"
                    style="width: 100%;">
                </div>
              </div>
            </div>
          </div>

          <!-- Button Parameters -->
          <div *ngIf="selected_template && buttonParamsValues.length > 0">
            <div class="params-section-title">Buttons parameters</div>
            <div class="params-container">
              <div class="param-input-wpr" *ngFor="let param of buttonParamsValues; let i = index; trackBy: trackByIndex">
                <div class="param-label-container">
                  <span class="param-number-badge">{{ i + 1 }}</span>
                </div>
                <div class="param-input-container">
                  <input 
                    type="text" 
                    class="form-control input-md param-input"
                    [ngModel]="buttonParamsValues[i]" 
                    (ngModelChange)="buttonParamsValues[i] = $event; onButtonParamChange()"
                    placeholder="Insert a valid URL"
                    style="width: 100%;">
                </div>
              </div>
            </div>
          </div>

        </div>
        
      </div>
    </div>
    
    <!-- -------------------------------------------------- -->
    <!-- Template Preview -->
    <!-- -------------------------------------------------- -->
    <div class="b-right-column">
      <div class="preview-template-header">
        {{ 'TemplatePreview' | translate }}
      </div>
      
      <div class="no-template-selected-container" *ngIf="!selected_template">
        <div class="no-template-selected">
          {{ 'NoTemplateSelected' | translate }}
        </div>
      </div>
      
      <div id="preview-container" class="preview-container" *ngIf="selected_template">
        <div class="inner-preview-container">
          <div class="message-cloud">
            
            <!-- // Header -->
            <div class="header-preview">
              <span *ngIf="header_component?.format === 'TEXT'"
                [innerHTML]="header_component?.text | htmlEntitiesEncode | waToMarkdown | marked">
              </span>
              
              <span *ngIf="header_component?.format === 'IMAGE'">
                <img [src]="headerParamsValues[0] || header_params[0]?.image?.link"
                  (error)="onHeaderImageError($event)" />
              </span>
              
              <span *ngIf="header_component?.format === 'DOCUMENT'">
                <div class="pdf-preview">
                  <p>PDF</p>
                </div>
              </span>
              
              <span *ngIf="header_component?.format === 'LOCATION'">
                <div class="location-preview">
                  {{ 'Location' | translate }}
                </div>
              </span>
            </div>
            
            <!-- Body -->
            <div class="body-preview">
              <span [innerHTML]="body_component?.text | waToMarkdown | marked"></span>
            </div>
            
            <!-- // Footer -->
            <div class="footer-preview">
              <span [innerHTML]="footer_component?.text | htmlEntitiesEncode | waToMarkdown | marked"></span>
            </div>
            
            <!-- // Call to action preview -->
            <div *ngIf="buttons_component && (buttons_component.buttons[0].type === 'URL' || buttons_component.buttons[0].type === 'PHONE_NUMBER')"
              class="call-to-action-preview">
              
              <button *ngFor="let btn of buttons_component.buttons"
                class="btn whatsapp-call-to-action">
                <span *ngIf="btn.type === 'URL'"
                  class="material-icons-outlined call-to-action-icon">open_in_new</span>
                <span *ngIf="btn.type === 'PHONE_NUMBER'"
                  class="material-icons-round call-to-action-icon">phone</span>
                {{ btn.text }}
              </button>
            </div>
            
          </div>
          
          <div class="message-cloud-buttons-container"
            *ngIf="buttons_component && buttons_component.buttons[0].type === 'QUICK_REPLY'">
            <div class="message-cloud-buttons">
              <button *ngFor="let btn of buttons_component.buttons" fill="clear"
                class="message-cloud-button">
                <span class="_2VWlB">{{btn.text}}</span>
              </button>
            </div>
          </div>
          
        </div>
      </div>
      <!-- ./ preview -->
    </div>
  </div>
</div>
