
<!-- MOMGO DB REQUEST (ALIAS VISITORS) LIST -->
<p style="margin-top:10px; padding-left:30px" class="navbar-brand">
  <!-- Visitatori -->
  {{ 'SupportRequests' | translate }}
</p> 

<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header" data-background-color="" style="background-color: #fff; padding-top: 12px;padding-bottom: 10px;">
            <h4 class="title" style="margin-bottom:2px; font-size:1.1em; color: #566787">
              <!-- Richieste non servite -->
              {{ 'VisitorsPage.UnservedRequests' | translate }}
            </h4>
            <!-- <p class="category">Here is a subtitle for this table</p> -->
          </div>

          <loading-spinner *ngIf="showSpinner"></loading-spinner>

          <div  *ngIf="!showSpinner" class="card-content table-responsive">
            <!-- style="overflow-x:auto;" -->
            <table class="table table-hover">
              <thead class="text">
                <tr>
                    <!-- <th></th> -->
                    <th></th>
                    <th>
                      <span style="color: #566787">
                        <strong>Id</strong>
                      </span>  
                    </th>
                    <th>
                      <span style="color: #566787">
                        <strong>{{ 'VisitorsPage.Department' | translate }}</strong>
                      </span>  
                    </th>
                    <th>
                      <span style="color: #566787">
                        <strong> 
                          <!-- Richiedente  -->
                          {{ 'VisitorsPage.Requester' | translate }}
                        </strong>
                      </span>
                    </th>
                    <th>
                      <span style="color: #566787">
                        <strong>
                          <!-- Messagio  -->
                          {{ 'VisitorsPage.Message' | translate }}
                        </strong>
                      </span>
                    </th>
                    <!-- REQUESTER ID * FOR DEBUG -->
                    <!-- <th>
                      <span style="color: #566787">
                        <strong> Requester Id </strong>
                      </span>
                    </th> -->

                    <!-- SERVED BY OF UNSERVED REQUEST -->
                    <!-- <th>
                      <span style="color: #566787">
                        <strong> 
                       
                        {{ 'VisitorsPage.ServedBy' | translate }}
                        </strong>
                      </span>
                    </th> -->
                    <!-- <th>
                      <span style="color: #566787">          
                        <strong> Membri </strong>
                      </span>
                    </th> -->
                    <th>
                      <span style="color: #566787">
                        <!-- <strong> Data creazione </strong> -->
                        <strong> 
                          <!-- Pubblicata  -->
                          {{ 'VisitorsPage.Published' | translate }}
                        </strong>
                      </span>
                    </th>
                    <!-- <th>TEST</th> -->

                    <!-- ARCHIVE Action -->
                    <th>
                      <strong>
                        <span style="color: #566787">
                          {{ 'VisitorsPage.Actions' | translate }}
                        </span>
                      </strong>
                    </th>
                </tr>
              </thead>

              <!-- UNSERVED FOR -->
              <tbody>

                <!-- IF THERE ISN'T REQUEST (SERVED OR UNSERVED) -->
                <tr *ngIf="requestListServed.length === 0 && requestListUnserved.length === 0"> 
                  <td colspan="7" style="text-align: center; padding-top: 16px; cursor: pointer" (click)="testWidgetPage()">
                    <!-- color: #ff5252   -->
                    <p style="font-size:1em; color:#999999; font-weight: 400">
                        <!-- Nessun Visitatore! Clicca qui per simulare un visitatore. -->
                        {{ 'VisitorsPage.NoVisitor' | translate }}
                        <button class="btn btn-default" style="padding-left: 8px; padding-right: 8px;"> 
                            {{ 'VisitorsPage.ClickHereToSimulate' | translate }}
                        </button>
                      </p>
                  </td>
                </tr>

                <tr *ngFor="let request of requestListUnserved">
                  <!-- FOR DEBUG: SHOW 'J' IF THE CURRENT USER UID IS BETWEEN 
                  THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has joined to the request) -->
                  <!-- <td>
                    <span *ngIf="request?.currentUserIsJoined === true"> 
                      J
                    </span>
                  </td> -->
                  <td style="text-align:center">
                    <!-- <span *ngIf="request?.membersCount == 0"> 
                      <i style="color:red;" class="material-icons">priority_high</i>
                    </span> -->

                    <!-- IF THE REQUEST SUPPORT STATUS IS 0 (??? REQUEST) -->
                    <span *ngIf="request?.support_status == 0"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                        <button class="btn btn-default" style=""> 
                          <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>
                    
                    <!-- IF THE REQUEST SUPPORT STATUS IS 100 (UNSERVED REQUEST) -->
                    <span *ngIf="request?.support_status == 100"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                          <!-- padding:4px 6px; -->
                        <button class="btn btn-danger" style=""> 
                          <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>

                    <!-- IF THE REQUEST SUPPORT STATUS IS 200 (SERVED REQUEST) AND THE CURRENT USER UID IS BETWEEN 
                    THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has joined to the request) -->
                    <span *ngIf="request?.support_status == 200 && request?.currentUserIsJoined === true"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                        <button class="btn btn-success" style="" rel="tooltip" title=""> 
                          <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>

                    <!-- IF THE REQUEST SUPPORT STATUS IS 200 (SERVED REQUEST) BUT THE CURRENT USER UID IS NOT BETWEEN 
                    THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has not joined to the request) -->
                    <span *ngIf="request?.support_status == 200 && !request?.currentUserIsJoined"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                        <button class="btn btn-info" style="" rel="tooltip" title=""> 
                          <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>
                  </td>
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer">
                    <p style="font-size:0.8em;" >
                      <!-- {{ request?.recipient }} -->
                      {{ replace_recipient(request?.recipient) }}
                    </p>
                  </td>

                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer" rel="tooltip" title="department id:{{ request?.attributes?.departmentId }}">
                    <p style="font-size:0.8em;">
                      {{ request?.attributes?.departmentName }}
                    </p>
                  </td>

                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer" rel="tooltip" title="requester id:{{ request?.requester_id }}">
                    <!-- <p style="font-size:0.9em">{{ request.sender_fullname }}</p> -->
                    <p style="font-size:0.9em">
                      {{ request.requester_fullname }}
                    </p>
                    <!-- <p style="font-size:0.8em">
                        {{ request?.requester_id }}
                    </p> -->
                  </td>
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer">
                      <!-- max-width: 400px -->
                    <p style="font-size:0.9em;" [innerHTML]="getRequestText(request?.first_text)">
                      <!-- {{ request?.text }} -->
                      <!-- {{ request?.first_text }} -->
                    </p>
                  </td>
                  <!-- REQUESTER ID * FOR DEBUG-->
                  <!-- <td (click)='openViewMsgsModal(request?.recipient)' style="cursor:pointer">
                    <p style="font-size:0.9em">
                      {{ request?.requester_id }}
                    </p>
                  </td> -->
                  <!-- SERVED BY -->
                  <!-- <td (click)='openViewMsgsModal(request?.recipient, request?.currentUserIsJoined, request?.requester_id)' style="cursor:pointer" >
                    <p style="font-size:0.8em; min-width: 220px;" [innerHTML]="request?.members_as_string">
                    </p>
                  </td> -->

                  <!--    NEW SERVED BY  OF UNSERVED REQUEST  -->
                  <!-- <span *ngFor="let m of request?.members_array"  style="font-size:0.8em; cursor: pointer;">
                    <span *ngIf="m !== request?.requester_id && m !== 'system' && m !== currentUserID"> 
                      <p (click)="goToMemberProfile( m )" [innerHTML]="members_replace( m )" style="padding-top:1px; padding-bottom:1px;">  </p>
                    </span> 
                    <p *ngIf="m === currentUserID" style="padding-top:1px; padding-bottom:1px;"> 
                      - <strong> 'ME' </strong>
                    </p>
                  </span> -->

                  <!-- LIST  OF MEMBERS -->
                  <!-- <td (click)='openViewMsgsModal(request?.recipient, request?.currentUserIsJoined)' style="cursor:pointer">
                    <p style="font-size:0.8em; min-width: 220px;"  [innerHTML]="request?.members_as_string"></p>
                  </td> -->
                  
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer">
                    <p style="font-size:0.9em">
                      <!-- {{ request?.timestamp | date: 'd/M/y HH:mm:ss'}} -->
                      <!-- {{ request?.request_date_fromnow }} -->
                      <!-- {{ getTimestampAsMoment(request?.timestamp) }} -->

                      <!-- {{ request?.timestamp | amTimeAgo }} -->
                      <!-- {{ request?.created_on | date: 'd/M/y HH:mm:ss' }} -->
                      {{ request?.created_on | amTimeAgo }}
                      
                    </p>
                  </td>

                  
                  <!-- <td (click)='openViewMsgsModal(request?.recipient, request?.currentUserIsJoined, request?.requester_id)' style="cursor:pointer"> 
                    Test Modal 
                  </td> -->
                  
                  <!-- <td>
                    <span class="" (click)='openViewMsgsModal(request?.recipient, hasClickedUpdateModal=true)'>
                      <button class="btn btn-info pull-right" style="padding:4px 6px;"> 
                          <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                      </button>
                    </span>
                  </td> -->

                  <!-- ARCHIVE Action -->
                  <!-- class="td-actions text-right" -->
                  <td>                 
                    <button type="button" rel="tooltip" title="{{ 'VisitorsPage.tootipArchiveRequest' | translate }}" class="btn btn-danger btn-simple btn-xs"
                      (click)='openDeleteRequestModal((request?.recipient))'>
                      <i class="material-icons">clear</i>
                    </button>
                  </td>

                </tr>
                <!-- /. END UNSERVED REQUESTS -->
                          
              </tbody>
            </table>
          </div> <!-- ./ card-content table-responsive -->
        </div> <!-- ./ card -->
        <!-- / .END UNSERVED REQUESTS  -->

        <!-- SERVED REQUESTS -->
        <div class="card">
          <div class="card-header" data-background-color="" style="background-color: #fff; padding-top: 12px;padding-bottom: 10px;">
            <h4 class="title" style="margin-bottom:2px; font-size:1.1em; color: #566787">
              <!-- Richieste servite  -->
              {{ 'VisitorsPage.ServedRequests' | translate }}
            
            </h4>
            <!-- <p class="category">Here is a subtitle for this table</p> -->
          </div>
          
          <loading-spinner *ngIf="showSpinner"></loading-spinner>

          <div  *ngIf="!showSpinner" class="card-content table-responsive">
            <!-- style="overflow-x:auto;" -->
            <table class="table table-hover">
              <thead class="text">
                <tr>
                  <!-- <th></th> -->
                  <th></th>
                  <th>
                    <span style="color: #566787">
                      <strong>Id</strong>
                    </span>  
                  </th>

                  <th>
                    <span style="color: #566787">
                      <strong>{{ 'VisitorsPage.Department' | translate }}</strong>
                    </span>  
                  </th>

                  <th>
                    <span style="color: #566787">
                      <strong> 
                        <!-- Richiedente  -->
                        {{ 'VisitorsPage.Requester' | translate }}
                      </strong>
                    </span>
                  </th>
                  <th>
                    <span style="color: #566787">
                        <!-- Message -->
                      <strong> 
                        <!-- Messagio -->
                        {{ 'VisitorsPage.Message' | translate }}
                      </strong>
                    </span>
                  </th>
                  
                  <!-- REQUESTER ID * FOR DEBUG -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong> Requester Id </strong>
                    </span>
                  </th> -->

                  <th>
                    <span style="color: #566787">
                      <!-- <strong> Served by </strong> -->
                      <strong> 
                        <!-- Servita da -->
                        {{ 'VisitorsPage.ServedBy' | translate }}
                      
                      </strong>
                    </span>
                  </th>
                  <!-- <th>
                    <span style="color: #566787">          
                      <strong> Membri </strong>
                    </span>
                  </th> -->
                  <th>
                    <span style="color: #566787">
                      <!-- <strong> Data creazione </strong> -->
                      <strong> 
                        <!-- Pubblicata  -->
                        {{ 'VisitorsPage.Published' | translate }}
                      </strong>
                    </span>
                  </th>
                  
                  <!-- <th>TEST</th> -->

                  <!-- ARCHIVE Action -->
                  <th>
                    <span style="color: #566787">
                      <strong> 
                        {{ 'VisitorsPage.Actions' | translate }}
                      </strong>         
                    </span>
                  </th>

                </tr>
              </thead>
              <tbody>
              
                 <!-- IF THERE ISN'T REQUEST (SERVED OR UNSERVED) -->
                <tr *ngIf="requestListServed.length === 0 && requestListUnserved.length === 0"> 
                  <td colspan="8" style="text-align: center; padding-top: 16px; cursor: pointer" (click)="testWidgetPage()">
                    <!-- color: #ff5252   -->
                    <p style="font-size:1em; color:#999999; font-weight: 400">
                        <!-- Nessun Visitatore! Clicca qui per simulare un visitatore. -->
                        {{ 'VisitorsPage.NoVisitor' | translate }}
                        <button class="btn btn-default" style="padding-left: 8px; padding-right: 8px;"> 
                          {{ 'VisitorsPage.ClickHereToSimulate' | translate }}
                        </button>
                      </p>
                  </td>
                </tr>

                <tr *ngFor="let request of requestListServed">
                            
                  <!-- FOR DEBUG: SHOW 'J' IF THE CURRENT USER UID IS BETWEEN 
                  THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has joined to the request) -->
                  <!-- <td>
                    <span *ngIf="request?.currentUserIsJoined === true"> 
                      J
                    </span>
                  </td> -->
                  
                  <td style="text-align:center">
                    <!-- IF THE REQUEST SUPPORT STATUS IS 0 (??? REQUEST) -->
                    <span *ngIf="request?.support_status == 0"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                        <button class="btn btn-default" style=""> 
                            <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>
                
                    <!-- IF THE REQUEST SUPPORT STATUS IS 100 (UNSERVED REQUEST) -->
                    <span *ngIf="request?.support_status == 100"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                        <button class="btn btn-danger" style=""> 
                            <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>

                    <!-- IF THE REQUEST SUPPORT STATUS IS 200 (SERVED REQUEST) AND THE CURRENT USER UID IS BETWEEN 
                    THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has joined to the request) -->
                    <span *ngIf="request?.support_status == 200 && request?.currentUserIsJoined === true"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                          <!-- padding:4px 6px; -->
                        <button class="btn btn-success" style="" rel="tooltip" title=""> 
                            <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>

                    <!-- IF THE REQUEST SUPPORT STATUS IS 200 (SERVED REQUEST) BUT THE CURRENT USER UID IS NOT BETWEEN 
                    THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has not joined to the request) -->
                    <span *ngIf="request?.support_status == 200 && !request?.currentUserIsJoined"> 
                      <span class="" (click)='goToRequestMsgs(request?.recipient)'>
                        <button class="btn btn-info" style="" rel="tooltip" title=""> 
                          <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                        </button>
                      </span>
                    </span>

                  </td>
                  <!-- openViewMsgsModal(request?.recipient, request?.currentUserIsJoined, request?.requester_id) -->
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer">
                      <!-- max-width: 150px; -->
                    <p style="font-size:0.8em;" >
                      <!-- {{ request?.recipient }} -->
                      {{ replace_recipient(request?.recipient) }}
                    </p>
                  </td>

                  <!-- openViewMsgsModal(request?.recipient, request?.currentUserIsJoined, request?.requester_id) -->
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer" rel="tooltip" title="{{ request?.requester_id }}">
                    <p style="font-size:0.9em">
                      {{ request?.attributes?.departmentName }}
                    </p>
                  </td>

                  
                  <!-- openViewMsgsModal(request?.recipient, request?.currentUserIsJoined, request?.requester_id) -->
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer" rel="tooltip" title="{{ request?.requester_id }}">
                    <!-- <p style="font-size:0.9em">{{ request.sender_fullname }}</p> -->
                    <p style="font-size:0.9em">
                      {{ request.requester_fullname }}
                    </p>
                    <!-- <p style="font-size:0.8em">
                      {{ request?.requester_id }}
                    </p> -->
                  </td>
                  
                  <!-- openViewMsgsModal(request?.recipient, request?.currentUserIsJoined, request?.requester_id) -->
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer">
                      <!-- max-width: 400px -->
                    <p style="font-size:0.9em;" [innerHTML]="getRequestText(request?.first_text)">
                      <!-- {{ request?.text }} -->
                      <!-- {{ request?.first_text }} -->
                    </p>
                  </td>
                  <!-- REQUESTER ID * FOR DEBUG-->
                    <!-- <td (click)='openViewMsgsModal(request?.recipient)' style="cursor:pointer">
                      <p style="font-size:0.9em">
                        {{ request?.requester_id }}
                      </p>
                    </td> -->

                  <!-- SERVED BY -->
                  <td>
                    <!-- [innerHTML]="request?.members_as_string" -->
                    <span *ngFor="let m of request?.members_array"  style="font-size:0.8em;">
                      <span *ngIf="m !== request?.requester_id && m !== 'system' && m !== currentUserID"> 
                        <p class="member" (click)="goToMemberProfile( m )" [innerHTML]="members_replace( m )" style="padding-top:1px; padding-bottom:1px; cursor: pointer;">  </p>
                      </span> 
                      <p *ngIf="m === currentUserID" style="padding-top:1px; padding-bottom:1px;"> 
                        - <strong> 'ME' </strong>
                      </p>
                    </span>
                      <!-- {{ request?.members }} -->
                  </td>

                  <!-- LIST  OF MEMBERS -->
                  <!-- <td (click)='openViewMsgsModal(request?.recipient, request?.currentUserIsJoined)' style="cursor:pointer">
                    <p style="font-size:0.8em; min-width: 220px;"  [innerHTML]="request?.members_as_string"></p>
                  </td> -->
                  
                  <td (click)='goToRequestMsgs(request?.recipient)' style="cursor:pointer">
                    <p style="font-size:0.9em">
                      <!-- {{ request?.timestamp | date: 'd/M/y HH:mm:ss'}} -->
                      <!-- {{ request?.request_date_fromnow }} -->
                      <!-- {{ getTimestampAsMoment(request?.timestamp) }} -->

                      <!-- {{ request?.timestamp | amTimeAgo }} -->
                      <!-- {{ request?.created_on | date: 'd/M/y HH:mm:ss' }} -->
                      {{ request?.created_on | amTimeAgo }}
                    </p>
                  </td>

                  <!-- <td (click)='openViewMsgsModal(request?.recipient, request?.currentUserIsJoined, request?.requester_id)' style="cursor:pointer"> 
                    Test modal
                  </td> -->
                  <!-- <td>
                    <span class="" (click)='openViewMsgsModal(request?.recipient, hasClickedUpdateModal=true)'>
                      <button class="btn btn-info pull-right" style="padding:4px 6px;"> 
                          <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                      </button>
                    </span>
                  </td> -->

                  <!-- ARCHIVE Action -->
                  <!-- class="td-actions text-right" -->
                  <td>                 
                    <button type="button" rel="tooltip" title="{{ 'VisitorsPage.tootipArchiveRequest' | translate }}" class="btn btn-danger btn-simple btn-xs"
                      (click)='openDeleteRequestModal(request?.recipient)'>
                      <i class="material-icons">clear</i>
                    </button>
                  </td>

                </tr>
              </tbody>
            </table>
          </div> <!-- ./ card-content table-responsive -->
        </div> <!-- ./ card -->

      </div> <!-- ./ col-md-12 -->
    </div> <!-- ./ row -->
  </div> <!-- ./ container-fluid -->
</div> <!-- ./ main-content -->

  <!-- ============= ARCHIVIVE REQUEST MODAL ============= -->
  <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayArchiveRequestModal}" style="background-color: rgba(90,90,90,0.5);">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
            <!-- background-color:#ff5252; -->
          <div class="modal-header" style="padding-bottom:15px">
            <button type="button" class="close" aria-label="Close" (click)="onCloseArchiveRequestModal()">
                <!-- color: #fff -->
              <span aria-hidden="true" style="">&times;</span>
            </button>
            <h4 class="modal-title" style="color: #f44336">
                <i class="material-icons" style="vertical-align: middle">info</i>
                <span style="vertical-align: middle; padding-left:8px">
                  <!-- Elimina richiesta -->
                  {{ "VisitorsPage.ArchiveRequest" | translate }}
                </span>
            </h4>
            <!-- padding-left: 36px  -->
            <h4 class="modal-title" 
            style="color: #566787; padding-top:10px; font-size: 1.1em; font-weight: 500">
              <!-- La richiesta con ID: <code>{{ id_request_to_delete }}</code> verrÃ  eliminata -->
              {{ "VisitorsPage.TheRequestWithId" | translate }} 
              <code style="color: #566787">
                {{ id_request_to_archive }}
              </code> 
              {{ "VisitorsPage.WillBeArchived" | translate }} 
            </h4>
          </div>
          <div class="modal-body">
              <p style="font-weight:500; text-align: left; margin-top: 10px; color: #566787; font-weight: 500">
                <!-- Sei sicuro di voler rimuovere la richiesta selezionata? -->
                {{ "VisitorsPage.AreYouSure" | translate }} <br>
                <span style="font-weight:100; color: #999; font-size:12px"> 
                  <em>
                    {{ "VisitorsPage.Note" | translate }}
                  </em>
                </span> 
              </p>

          </div>
          <div class="modal-footer" style="margin-top: 0px;">
            <button class="btn btn-white" (click)="onCloseArchiveRequestModal()" style="padding:12px 16px;">
              <!-- Annulla -->
              {{ "VisitorsPage.Cancel" | translate }}
            </button>
            <button style="margin-top:0px" class="btn btn-danger" (click)="archiveTheRequestHandler()" style="padding:12px 16px;">
              <!-- Archivia Richiesta -->
              {{ "VisitorsPage.ArchiveRequest" | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ============ INFO MODAL: ARCHIVING REQUEST IN PROGRESS ============ -->
    <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayArchivingInfoModal}" style="background-color: rgba(90,90,90,0.5);">
        <div class="modal-dialog modal-sm" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" aria-label="Close" (click)="onCloseArchivingInfoModal()">
                <span aria-hidden="true">&times;</span>
              </button>
  
              <h4 class="modal-title">
                  {{ "VisitorsPage.ArchiveRequest" | translate }}
                <!-- <code>{{id_toDelete}}</code> -->
              </h4>
            </div>
  
            <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px">
            
              <span *ngIf="SHOW_CIRCULAR_SPINNER">
                <div  class="loader" style="top:25%;">
                  <svg class="circular" viewBox="25 25 50 50">
                    <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10"/>
                  </svg>
  
                </div>
                <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
                    {{ "VisitorsPage.Processing" | translate }}
                </p>
              </span>
  
              <span *ngIf="!SHOW_CIRCULAR_SPINNER && !ARCHIVE_REQUEST_ERROR ">
                  
                <div style="text-align: center">
                  <i class="material-icons" style="color:#70b665">done</i>
                  <p style="color:#70b665; font-weight: 500">
                      {{ "VisitorsPage.Completed" | translate }}
                  </p> 
  
                </div>
                <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
                    {{ "VisitorsPage.RequestArchived" | translate }}
                </p>
              </span>
  
              <!-- IF THERE IS AN ERROR -->
              <span *ngIf="!SHOW_CIRCULAR_SPINNER && ARCHIVE_REQUEST_ERROR ">
                
                <div style="text-align: center ">
                  <i class="material-icons" style="color:#ff5252">report_problem</i>
                  <p style="color:#ff5252; font-weight: 500">
                      {{ "VisitorsPage.Error" | translate }}
                  </p> 
  
                </div>
                <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
                    {{ "VisitorsPage.AnErrorHasOccurred" | translate }}
                </p>
              </span>
            </div>
  
            <div class="modal-footer" style="text-align: center;">
              <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="onCloseArchivingInfoModal()" style="padding:12px 16px;">
                  {{ "VisitorsPage.Continue" | translate }}
              </button>
            </div>
  
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

    <!-- ============ !!! NO MORE USED - MODAL MSGS OF THE REQUEST ============ -->
    <div class="backdrop" [ngStyle]="{'display':display}"></div>
    <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':display}" aria-hidden="true" style="">
        <div class="modal-dialog .modal-lg" role="document" style="overflow-y: initial !important;">
          <div class="modal-content">

            <div class="modal-header">
              <button type="button" class="close" aria-label="Close" (click)="onCloseModal()">
                <span aria-hidden="true">&times;</span>
              </button>
              <h4 class="modal-title" style="font-size:1.1em">
                <!-- Id richiesta: -->
                {{ 'VisitorsPage.RequestId' | translate }}
                <code>{{requestRecipient}}</code>
              </h4>
              <h4 class="modal-title" style="font-size:1.1em">
                <!-- Id richiedente: -->
                {{ 'VisitorsPage.RequesterId' | translate }}
                  <code>{{requester_id}}</code>
                </h4>
            </div>
            <!-- id="scrollable" -->
            <!-- #scrollMe style="overflow: scroll; height: 250px;" -->
            <div class="modal-body" >
                <div  #scrollMe style="height: 250px; overflow-y: auto;" (scroll)="onScroll($event)">
                  <div *ngFor="let message of messagesList" style="vertical-align:baseline">
                      
                    <div class="msg_sender">
                      <p style="font-size: 0.9em">
                        <strong> {{ message.sender_fullname }} </strong> 
                      </p>
                    </div>

                    <div class="msgcontainer">        
                      <!-- <p><code>{{ message.recipient}}</code></p> -->
                      <!-- <p><strong>  {{ message.sender_fullname }} </strong></p> -->
                      <p style="font-size: 0.9em; margin-bottom:0px">{{ message.text }}</p>
                      <span class="time-right" style="font-size: 0.8em;">
                        {{ message.timestamp | date: 'd/M/y HH:mm:ss'}}
                      </span>
                    </div>
                  
                  </div>

                </div> 

                <a id="fixed-button"  class="button" (click)="scrollToBottom()" [ngStyle]="{'display':displayBtnScrollToBottom }">
                  <span class="icon is-small" style="">
                    <i class="fa fa-chevron-down" ></i>
                  </span>
                </a>
            </div>
            <!-- ./ modal body -->
         
            <div class="modal-footer">
              <button class="btn btn-white" (click)="onCloseModal()" style="padding:12px 16px;">
                <!-- Chiudi -->
                {{ 'VisitorsPage.Close' | translate }}

              </button>
              <span style="padding-right:25px"></span>

               <!-- =======================================================================================================================
                !!!! NO MORE USED THE REASON - SINCE NOW IF THE CURRENT USER IS JOINED TO THE CONVERSATION IS CALCULATE ALSO FOR DETERMINE
                    THE COLOR OF THE VISIBILITY BUTTONS PRESENT IN THE ROW OF THE TABLE AND THEN SET IN THE REQUEST JSON currentUserIsJoined
                    - I DO NOT CALCULATE IT A SECOND TIME WHEN THE MODAL IS OPENEDED BUT I TAKE THE VALUE FROM THE JSON KEY currentUserIsJoined
                    THEN ASSIGN IT TO IS_CURRENT_USER_JOINED (replacing CURRENT_USER_IS_ALREADY_MEMBER and NO LONGER NEEDING TO DETERMINE 
                    SEARCH_FOR_SAME_UID_FINISHED )
                  ======================================================================================================================== -->
              
              <!-- !!!! NO MORE USED THE REASON 
                SHOWS A SPINNER BUTTON IF THE 'FOR LOOP' OF COMPARISON OF THE MEMBERS UID KEY TO THE CURRENT USER UID IS NOT FINISHED  -->
              <!-- <span *ngIf="!SEARCH_FOR_SAME_UID_FINISHED">
                <button class="btn btn-default">
                  <i class="fa fa-spinner fa-spin"></i> Elaborazione
                </button>
              </span> -->

             
              
              <!-- !!!! NO MORE USED (see THE REASON above) 
                   - SHOWS THE FOLLOWING BUTTONS ONLY IF THE 'FOR LOOP' OF COMPARISON OF THE MEMBERS UID KEY TO THE CURRENT USER UID IS FINISHED  -->
              <!-- <span *ngIf="SEARCH_FOR_SAME_UID_FINISHED"> -->

                <!-- !!!! NO MORE USED (see THE REASON above) 
                    - HAS BEEN OPENED THE MODAL WINDOW: BY DEFAULT SHOW THE BUTTON 'JOIN' 
                    * FALSE IS THE INITIAL VALUE OF: HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST
                    * FALSE IS THE INITIAL VALUE OF: SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING
                    * FALSE IS THE INITIAL VALUE OF: JOIN_TO_GROUP_HAS_ERROR 
                    * IF IS FALSE THE VALUE OF: CURRENT_USER_IS_ALREADY_MEMBER   -->
                <!-- <span *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false && JOIN_TO_GROUP_HAS_ERROR === false && CURRENT_USER_IS_ALREADY_MEMBER === false">
                  <button class="btn btn-default" (click)="onJoinHandled()">
                    Join
                  </button>
                </span> -->

                <!-- NEW LOGIC -->
                <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === false 
                          && IS_CURRENT_USER_JOINED === false 
                          && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false 
                          && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">
                  <button class="btn btn-default" (click)="onJoinHandled()" style="padding:12px 16px !important;">
                    Join
                  </button>
                </span>
                
                <!-- NEW LOGIC -->
                <span *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                  <!-- <button class="btn btn-info"> -->
                    <!-- <a class="btn btn-info" role="button" style="color: white;" 
                       target="_blank" href="http://support.chat21.org/web/?recipient={{requestRecipient}}" 
                       style="padding:12px 16px !important;"> -->

                       <!-- href="http://support.tiledesk.com/chat/?recipient={{requestRecipient}}" -->
                    <a class="btn btn-info" role="button" style="color: white;" 
                        target="_blank" href="{{ CHAT_BASE_URL }}?recipient={{requestRecipient}}" 
                        style="padding:12px 16px !important;">   
                      <!-- Entra -->
                      {{ 'VisitorsPage.Enter' | translate }}
                    </a>
                  <!-- </button> -->
                </span>

                <!-- 
                    - THE USER CLICK ON JOIN: SHOWS THE BTN 'PROCESSING'
                    * FALSE IS THE CURRENT VALUE OF: HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST 
                    * TRUE IS THE CURRENT VALUE OF: SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING
                    * FALSE IS THE CURRENT VALUE OF: JOIN_TO_GROUP_HAS_ERROR  -->
                  
                <span *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  && JOIN_TO_GROUP_HAS_ERROR === false">
                  <button class="btn btn-default" style="padding:12px 16px !important;">
                    <i class="fa fa-spinner fa-spin"></i> 
                    <!-- Elaborazione -->
                    {{ 'VisitorsPage.Loading' | translate }}
                  </button>
                </span>

                <!-- IF THE CALLBALL JOIN-TO-GROUP HAS ERROR SHOWS THE BTN ERROR (DISABLED)  -->
                <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">
                  <button class="btn btn-danger" disabled style="padding:12px 16px !important;">
                    <!-- Errore -->
                    {{ 'VisitorsPage.Error' | translate }}
                  </button>
                </span>

                <!-- !!!! NO MORE USED (see THE REASON above)
                    - WHEN THE JOIN TO GROUP POST REQUEST IS COMPLETE 
                    * OR THE CURRENT USER IS ALREADY A MENBER OF THE CONVERSATION SHOW THE BTN 'ENTER' -->
                <!-- <span *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || CURRENT_USER_IS_ALREADY_MEMBER === true">
                  <button class="btn btn-info">
                    <a style="color: white;" target="_blank" href="http://support.chat21.org/web/?recipient={{requestRecipient}}" > Entra </a>
                  </button>
                </span> -->


              <!-- </span> -->


              <span style="padding-right:25px"></span>

            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
      <!-- /.modal !-->




