<div class="navbar-brand" style="z-index: 1050;position: relative;margin-top:6px; padding-left:30px">
  <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;"
    (click)="goBack()">keyboard_arrow_left</i>

  {{ "Requests" | translate }}

</div>

<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card" style="margin-bottom: 0px;margin-top: 15px;">
          <div class="card-content" style="padding-top: 25px;padding-bottom: 15px;padding-left: 40px;
          padding-right: 40px;">

            <form #myForm="ngForm" novalidate class="advancedOptionForm">

              <!-- *ngIf="showAdvancedSearchOption" -->
              <div>
                <div>
                  <!-- -------====== SELECT OPTIONS: DEPARTMENTS & DATE RANGE ======------ -->
                  <div class="row">
                    <!-- // SELECT OPTIONS: DEPARTMENTS -->
                    <div class="col-sm-6">
                      <div class="section-select-dept">

                        <label class="col-sm-12" style="text-align: left; color:#7695a5;">
                          {{ "Status" | translate }}
                        </label>
                        <div class="col-sm-12" style="margin-bottom: 20px;">

                          <!-- <ng-select class="custom" name="request_status" (change)="requestsStatusSelect(request_status)"
                           [(ngModel)]="requests_status" [clearable]="false">

                            <ng-option [value]="1000">{{"AllRequests" | translate}}</ng-option>
                            <ng-option [value]="100">  {{ "Unserved" | translate }} </ng-option>
                            <ng-option [value]="200"> {{ "Served" | translate }} </ng-option>

                          </ng-select> -->

                          <ng-select name="requeststatus" [(ngModel)]="requests_status"
                            (change)="requestsStatusSelect(requests_status)" [items]="status" bindLabel="name"
                            bindValue="id" placeholder="Select status">
                          </ng-select>


                        </div>
                      </div>
                    </div>

                    <!-- // SELECT OPTIONS: DATE RANGE -->
                    <div class="col-sm-6">
                      <label for="contain" class="col-sm-12" style="text-align: left; color:#7695a5;">
                        {{ 'HistoryPage.DateRange' | translate }}
                      </label>
                      <div class="col-sm-6">
                        <my-date-picker placeholder="{{ 'HoursPage.From' | translate }}" name="mydate"
                          [options]="myDatePickerOptions" [(ngModel)]="startDate" [disabled]="date_picker_is_disabled">
                        </my-date-picker>
                      </div>
                      <div class="col-sm-6">
                        <my-date-picker placeholder="{{ 'HoursPage.To' | translate }}" name="mydate"
                          [options]="myDatePickerOptions" [(ngModel)]="endDate" [disabled]="date_picker_is_disabled">
                        </my-date-picker>
                      </div>
                    </div>

                  </div>

                  <div class="row">
                    <div class="col-sm-6">
                      <div class="section-select-dept">

                        <label class="col-sm-12" style="text-align: left; color:#7695a5;">
                          {{ 'HistoryPage.FilterByDepartment' | translate }}
                        </label>
                        <div class="col-sm-12" style="margin-bottom: 20px;">
                          <ng-select class="custom" name="dept" [(ngModel)]="selectedDeptId" [clearable]="false">

                            <ng-option [value]="''"> {{ "AllDepts" | translate }}</ng-option>

                            <ng-option *ngFor="let dept of departments" [value]="dept._id">
                              {{dept.name}}
                            </ng-option>

                          </ng-select>
                        </div>
                      </div>
                    </div>

                    <div class="col-sm-6">
                      <div class="section-select-agent">
                        <label class="col-sm-12" style="text-align: left; color: #7695a5 !important;">
                          {{ 'HistoryPage.Agent' | translate }}
                        </label>
                        <ng-select name="agent" [(ngModel)]="selectedAgentId" [clearable]="false">
                          <ng-option [value]="''">{{ 'HistoryPage.AllAgents' | translate }}</ng-option>
                          <ng-option *ngFor="let agent of user_and_bot_array" [value]="agent._id">
                            {{ agent.firstname }} {{ agent.lastname }}

                          </ng-option>
                        </ng-select>
                      </div>
                    </div>
                  </div>

                  <!-- -------====== BTNS SEARCH  & CLEAR SEARCH & EXPORT TO CSV ======------ -->
                  <div class="row">
                    <div class="col-sm-12">
                      <button #searchbtnbottom type="submit" class="btn btn-white" (click)="search()"
                        style="padding:9px 30px;">
                        <span class="glyphicon glyphicon-search" aria-hidden="true" style="color:#7695a5"></span>
                      </button>

                      <button type="submit" class="btn btn-white clearsearchbtn" (click)="clearSearch()"
                        style="padding:9px 30px;color:#7695a5">
                        {{ 'HistoryPage.ClearSearch' | translate }}
                      </button>

                      <button class="btn btn-white pull-right export-to-csv-btn" (click)="exportRequestsToCSV()"
                        style="padding:9px 30px;color:#7695a5">
                        {{ 'ExportToCSV' | translate }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="card" style="margin-top: 0px;">

          <loading-spinner *ngIf="showSpinner"></loading-spinner>
          <div *ngIf="!showSpinner" class="card-content table-responsive">

            <table class="table table-hover">
              <thead class="text">
                <tr>

                  <th></th>

                  <!-- ===== REQUEST ID ===== -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong>
                        Id
                      </strong>
                    </span>  
                  </th> -->
                  <!-- ===== REQUEST FIRST TEXT ===== -->
                  <th>
                    <span class="column-th-span">
                      {{ 'HistoryPage.Message' | translate }}
                    </span>
                  </th>

                  <!-- ===== REQUESTER ===== -->
                  <th>
                    <span class="column-th-span">
                      {{ 'HistoryPage.Requester' | translate }}
                    </span>
                  </th>

                  <!-- ====== USER AGENT BROWSER & OPERATING SYSTEM ====== -->
                  <th></th>


                  <!-- ===== DEPARTMENT NAME ===== -->
                  <th>
                    <span class="column-th-span">
                      {{ 'VisitorsPage.Department' | translate }}
                    </span>
                  </th>

                  <!-- ===== SERVED BY ===== -->
                  <th>
                    <span class="column-th-span">
                      {{ 'HistoryPage.ServedBy' | translate }}
                    </span>
                  </th>

                  <!-- ===== RATING ===== -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong> 
                        {{ 'HistoryPage.Rating' | translate }}
                      </strong>
                    </span>
                  </th> -->

                  <!-- ===== MEMBERS ===== -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong> Membri </strong>
                      </span>
                  </th> -->

                  <!-- ===== PUBLISHED ===== -->
                  <th>
                    <span class="column-th-span">
                      {{ 'HistoryPage.Published' | translate }}
                    </span>
                  </th>

                  <!-- ===== ACTION ===== -->
                  <!-- <th></th> -->

                </tr>
              </thead>
              <tbody>

                <!-- ===== IF THERE ISN'T HISTORY REQUEST ===== -->
                <tr *ngIf="requestList && requestList?.length === 0">
                  <td colspan="7" style="text-align: center; padding-top: 16px; cursor: pointer">

                    <p style="font-size:1em; color:#7695a5; font-weight: 400">

                      {{ 'HistoryPage.NoRequests' | translate }}
                    </p>
                  </td>
                </tr>

                <tr *ngFor="let request of requestList">
                  <td style="text-align:center; white-space: nowrap; width: 1%;">
                    <!-- IF THE REQUEST SUPPORT STATUS IS 0 (??? REQUEST) -->
                    <span *ngIf="request?.status == 0">
                      <span (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" rel="tooltip"
                        title="{{ 'VisitorsPage.ViewRequestDetails' | translate}}: {{request?.request_id}}">

                        <span *ngIf="!request?.subject">
                          <svg viewBox="0 0 58.1 53.9" style="width: 25px; position: relative; top: 3px;"
                            xml:space="preserve">
                            <style type="text/css">
                              .st0 {
                                fill: none;
                                stroke: #999999;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }
                            </style>
                            <path class="st0" d="M30.1,2.7c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                          c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.9,2.7,30.1,2.7z" />
                          </svg>
                        </span>

                        <!-- 
                        // ------------------------------------------------------------------------------------------------------
                        // If is internal request
                        // ------------------------------------------------------------------------------------------------------ -->
                        <span *ngIf="request?.subject">

                          <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 25px; position: relative; top: 3px;" xml:space="preserve">
                            <style type="text/css">
                              .status0_Internal_st0 {
                                fill: none;
                                stroke: #999999;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .status0_Internal_st1 {
                                fill: #999999;
                              }
                            </style>
                            <path class="status0_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                       C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="status0_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                       c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                       C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                       c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>

                        </span>
                      </span>
                    </span>


                    <!-- 
                    IF THE REQUEST SUPPORT STATUS IS 200 (SERVED REQUEST) AND THE CURRENT USER UID IS BETWEEN 
                    THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has joined to the request) -->
                    <span *ngIf="request?.status == 200 && request?.currentUserIsJoined === true">
                      <span (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" rel="tooltip"
                        title="{{ 'VisitorsPage.ViewRequestDetails' | translate}}: {{request?.request_id}}">

                        <span *ngIf="!request?.subject">
                          <svg viewBox="0 0 58.1 53.9" style="width: 25px; position: relative; top: 3px;"
                            xml:space="preserve">
                            <style type="text/css">
                              .st0-served-by-cu {
                                fill: none;
                                stroke: #4DAF4F;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .st1-served-by-cu {
                                fill: #4DAF4F;
                              }
                            </style>
                            <path class="st0-served-by-cu" d="M29.8,3.7c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                            c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.6,3.7,29.8,3.7z" />
                            <g id="XMLID_146_">
                              <path id="XMLID_158_" class="st1-served-by-cu" d="M25.8,36.5l-8.4-7.4c-1.1-0.9-1.1-2.4,0-3.3c1.1-0.9,2.8-0.9,3.8,0l4.6,4.1l12.6-10.9
                              c1.1-0.9,2.8-0.9,3.8,0c1,0.9,1,2.4,0,3.3L25.8,36.5z" />
                            </g>
                          </svg>
                        </span>

                        <!-- 
                        // ------------------------------------------------------------------------------------------------------
                        // If is internal request
                        // ------------------------------------------------------------------------------------------------------ -->
                        <span *ngIf="request?.subject">
                          <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 25px; position: relative; top: 3px;" xml:space="preserve">
                            <style type="text/css">
                              .servedbyCurrentUser_Internal_st0 {
                                fill: none;
                                stroke: #4DAF4F;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .servedbyCurrentUser_Internal_st1 {
                                fill: #4DAF4F;
                              }
                            </style>
                            <path class="servedbyCurrentUser_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                         C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="servedbyCurrentUser_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                         c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                         C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                         c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>

                        </span>


                      </span>
                    </span>

                    <!-- 
                  IF THE REQUEST SUPPORT STATUS IS 200 (SERVED REQUEST) BUT THE CURRENT USER UID IS NOT BETWEEN 
                  THE UID KEYS OF THE OBJECT MEMBER (i.e. the current user has not joined to the request) -->
                    <span *ngIf="request?.status == 200 && !request?.currentUserIsJoined">
                      <span (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" rel="tooltip"
                        title="{{ 'VisitorsPage.ViewRequestDetails' | translate}}: {{request?.request_id}}">

                        <span *ngIf="!request?.subject">
                          <svg viewBox="0 0 58.1 53.9" style="width: 25px; position: relative; top: 3px;"
                            xml:space="preserve">
                            <style type="text/css">
                              .st0-served {
                                fill: none;
                                stroke: #05BDD4;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .st1-served {
                                fill: #05BDD4;
                              }
                            </style>
                            <g>
                              <path class="st0-served" d="M30.5,3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                            c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3,30.5,3z" />
                              <g>
                                <circle class="st1-served" cx="17.5" cy="26.7" r="3" />
                                <circle class="st1-served" cx="30.5" cy="26.7" r="3" />
                                <circle class="st1-served" cx="43.5" cy="26.7" r="3" />
                              </g>
                            </g>
                          </svg>
                        </span>

                        <!-- 
                        // ------------------------------------------------------------------------------------------------------
                        // If is internal request
                        // ------------------------------------------------------------------------------------------------------ -->
                        <span *ngIf="request?.subject">

                          <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 25px; position: relative; top: 3px;" xml:space="preserve">
                            <style type="text/css">
                              .served_Internal_st0 {
                                fill: none;
                                stroke: #05BDD4;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .served_Internal_st1 {
                                fill: #05BDD4;
                              }
                            </style>
                            <path class="served_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                       C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="served_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                       c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                       C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                       c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>
                        </span>
                      </span>
                    </span>

                    <span *ngIf="request?.status === 100">

                      <span (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                        <!-- {{ request?.subject }}  -->
                        <span *ngIf="!request?.subject">
                          <svg viewBox="0 0 58.1 53.9" style="width: 25px; position: relative; top: 3px;"
                            xml:space="preserve">
                            <style type="text/css">
                              .st0-unserved {
                                fill: none;
                                stroke: #ED4537;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .st1-unserved {
                                fill: #ED4537;
                              }
                            </style>
                            <path class="st0-unserved" d="M30.5,3.3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                              c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3.3,30.5,3.3z" />
                            <g>
                              <path class="st1-unserved"
                                d="M30.6,38.9c-1.7,0-3.1-1.4-3.1-3c0-1.7,1.4-3,3.1-3c1.7,0,3.1,1.4,3.1,3C33.6,37.6,32.3,38.9,30.6,38.9z" />
                              <path class="st1-unserved" d="M34.8,18l-1.5,10c-0.2,1.5-1.6,2.5-3.1,2.3c-1.2-0.2-2.1-1.1-2.3-2.2l-1.6-10c-0.4-2.3,1.2-4.5,3.6-4.9
                                c2.4-0.4,4.6,1.2,5,3.5C34.9,17.1,34.9,17.6,34.8,18z" />
                            </g>
                          </svg>
                        </span>
                      </span>


                      <span (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                        <span *ngIf="request?.subject">
                          <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 25px; position: relative; top: 3px;" xml:space="preserve">
                            <style type="text/css">
                              .unserved_Internal_st0 {
                                fill: none;
                                stroke: #ED4537;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .unserved_Internal_st1 {
                                fill: #ED4537;
                              }
                            </style>
                            <path class="unserved_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                     C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="unserved_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                     c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                     C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                     c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>
                        </span>
                      </span>

                    </span>






                  </td>

                  <!-- ===== REQUEST ID ===== -->
                  <!-- <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                     <p style="font-size:0.8em;" >
                       {{ request?.recipient }}
                     </p>
                  </td> -->

                  <!-- ===== REQUEST FIRST TEXT ===== -->
                  <td [ngClass]="{'padding_5' : request?.tags?.length > 0}"
                    (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                    <p class="column-td" [innerHTML]="getRequestText(request?.first_text)"> </p>
                    <!-- 
                    // ---------------------------------------
                    // Request Tag
                    // --------------------------------------- -->
                    <section style="max-width: 210px;" *ngIf="request?.tags?.length > 0">

                      <div style="display: inline-block;" *ngFor="let tag of request?.tags;  let i=index">
                        <div *ngIf="i<2">
                          <div class="icon-container" style="display: inline-block;">
                            <svg style="width: 10px; height: auto;" aria-hidden="true" focusable="false"
                              data-prefix="fas" data-icon="tag" class="svg-inline--fa-tag-icon fa-tag fa-w-16"
                              role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">

                              <path [ngStyle]="{'fill':tag.color}" class="tag_icon_in_ws_msgs"
                                d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z">
                              </path>
                            </svg>

                            <span style="font-size: 11px; color: #7695a5; position: relative; top: -2px; left: -2px;">
                              {{ tag.tag}}
                            </span>
                          </div>
                        </div>
                      </div>

                      <!-- 
                      // --------------------------------------------------------------------
                      // Display more tags
                      // -------------------------------------------------------------------- -->
                      <div [id]="'more_tags_btn_for_request_' + request?.request_id" style="display: inline-block;"
                        *ngIf="request?.tags?.length > 2">
                        <a (click)="$event.stopPropagation(); displayMoreTags(request?.request_id)" style="font-size: 11px;
               color: rgba(0, 0, 0, 0.54) !important;
               position: relative;
               top: -2px;">... {{request?.tags?.length - 2}} {{'more' | translate}}
                        </a>
                      </div>

                      <!-- 
                      // --------------------------------------------------------------------
                      // Tag from 3 to ... 
                      // -------------------------------------------------------------------- -->
                      <div (click)="$event.stopPropagation(); displayLessTag(request?.request_id)"
                        [id]="'more_tags_for_request_' + request?.request_id" style="display: none"
                        *ngIf="request?.tags?.length > 2">
                        <div style="display: inline-block;" *ngFor="let tag of request?.tags;  let i=index">
                          <div *ngIf="i >= 2">
                            <div class="icon-container" style="display: inline-block;">
                              <svg style="width: 10px; height: auto;" aria-hidden="true" focusable="false"
                                data-prefix="fas" data-icon="tag" class="svg-inline--fa-tag-icon fa-tag fa-w-16"
                                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">

                                <path [ngStyle]="{'fill':tag.color}" class="tag_icon_in_ws_msgs"
                                  d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z">
                                </path>
                              </svg>

                              <span style="font-size: 11px; color: #7695a5; position: relative; top: -2px; left: -2px;">
                                {{ tag.tag}}
                              </span>

                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- 
                      // --------------------------------------------------------------------
                      // Display more tags
                      // -------------------------------------------------------------------- -->
                      <!-- <div  [id]="'less_tags_btn_for_request_' + request?.request_id" style="display: none" *ngIf="request?.tags?.length > 2">
                      <a  (click)="$event.stopPropagation(); displayLessTag(request?.request_id)" style="font-size: 11px;
                      color: rgba(0, 0, 0, 0.54) !important;
                      position: relative;
                      top: -2px;"> display less
                      </a>
                    </div> -->
                    </section>



                  </td>

                  <!-- ===== REQUESTER FULL NAME ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer;white-space: nowrap;
                  width: 1%;" rel="tooltip" title="{{ request?.requester_id }}">

                    <span class="requester-avatar-wrapper">
                      <span class="requester-avatar"
                        [ngStyle]="{'background-color': request?.requester_fullname_fillColour }"
                        [ngClass]="{'requester_fullname_undefined' : !request?.lead?.fullname}">
                        <span style="color: #ffffff"> {{ request?.requester_fullname_initial }} </span>
                      </span>
                      <span *ngIf="request?.requester_is_verified === true" class="tooltipx">
                        <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 26.6 26.6" width="17"
                          height="17" style="position: relative;left: -41px;top: 1px;" xml:space="preserve">
                          <style type="text/css">
                            .st0 {
                              fill: none;
                            }

                            .st1 {
                              fill: #FFFFFF;
                            }

                            .st2 {
                              fill: #18BDF7;
                            }
                          </style>
                          <path class="st0" d="M1.3,1.3h24v24h-24V1.3z" />
                          <path class="st1"
                            d="M13.3,0L2.4,4.9v7.3c0,6.7,4.6,13,10.9,14.5c6.2-1.5,10.9-7.8,10.9-14.5V4.9L13.3,0z" />
                          <path class="st2" d="M13.3,2.3l-9,4v6c0,5.5,3.8,10.7,9,12c5.2-1.3,9-6.5,9-12v-6L13.3,2.3z M11.3,18.3l-4-4l1.4-1.4l2.6,2.6
                                l6.6-6.6l1.4,1.4L11.3,18.3z" />
                        </svg>

                        <span class="tooltiptext"> {{ "VisitorsPage.AuthenticatedUser" | translate }} </span>
                      </span>
                    </span>


                    <span class="column-td" style="white-space: nowrap;"
                      [ngClass]="{'requester-verified' : request?.requester_is_verified === true}">

                      <span class="lead_data">
                        {{ request?.lead?.fullname }}
                        <span *ngIf="!request?.lead?.fullname">
                          n.a.
                        </span>

                        <span class="requester-email"
                          [ngClass]="{'requester-verified-email' : request?.requester_is_verified === true}">
                          {{ request?.lead?.email }}
                        </span>
                        <span class="requester-email" *ngIf="!request?.lead?.email"
                          [ngClass]="{'requester-verified-email' : request?.requester_is_verified === true}">
                          n.a.
                        </span>
                      </span>

                    </span>
                  </td>

                  <!-- ------ ====== USER AGENT BROWSER & OPERATING SYSTEM (in served requests)====== ------ -->
                  <td>
                    <span *ngIf="request?.userAgent" class="tooltipx">
                      <!-- 
                      // ----------------------------------------------------------------
                      // @ OS - if not is
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="(request?.ua_os?.indexOf('Android') === -1) && 
                                    (request?.ua_os?.indexOf('Mac OS') === -1) && 
                                    (request?.ua_os?.indexOf('iOS') === -1) &&
                                    (request?.ua_os?.indexOf('Windows') === -1) &&
                                    (request?.ua_os?.indexOf('Ubuntu') === -1)">

                        <img style="width: 13px;margin-top: 2px;" class="" src="assets/img/user_agent/laptop.svg" />
                      </span>


                      <!-- 
                      // ----------------------------------------------------------------
                      // if is Android
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_os.indexOf('Android') !== -1">
                        <img style="width: 13px;" class="" src="assets/img/user_agent/android.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // if is Mac OS or iOS
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_os.indexOf('Mac OS') !== -1 || request?.ua_os.indexOf('iOS') !== -1">
                        <img style="width: 13px;margin-bottom: 2px;" class="" src="assets/img/user_agent/apple.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // if is Windows
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_os.indexOf('Windows') !== -1">
                        <img style="width: 12px; margin-top: 2px;" class="" src="assets/img/user_agent/windows.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // if is Ubuntu
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_os.indexOf('Ubuntu') !== -1">
                        <img style="width: 13px;" class="" src="assets/img/user_agent/ubuntu.svg" />
                      </span>

                      <span class="tooltiptext" style="font-size: 10px !important; padding: 3px;">
                        <span *ngIf="request?.ua_os !== 'undefined undefined'"> {{ request?.ua_os }} </span>
                        <span *ngIf="request?.ua_os === 'undefined undefined'"> not defined </span>
                      </span>
                    </span>

                    <span *ngIf="request?.userAgent" class="tooltipx">
                      <!-- 
                      // ----------------------------------------------------------------
                      // @ Browser - if not is
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="(request?.ua_browser.indexOf('Chrome') === -1) && 
                                  (request?.ua_browser.indexOf('Chromium') === -1) &&
                                  (request?.ua_browser.indexOf('Firefox') === -1) &&
                                  (request?.ua_browser.indexOf('Edge') === -1) &&
                                  (request?.ua_browser.indexOf('Opera') === -1) &&
                                  (request?.ua_browser.indexOf('Safari') === -1) &&
                                  (request?.ua_browser.indexOf('IE') === -1)">

                        <img class="ua_browser_icon" src="assets/img/user_agent/globe.svg" />

                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // Chrome or Chromium
                      // ---------------------------------------------------------------- -->
                      <span
                        *ngIf="request?.ua_browser.indexOf('Chrome') !== -1 || request?.ua_browser.indexOf('Chromium') !== -1">
                        <img class="ua_browser_icon" src="assets/img/user_agent/chrome.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // Firefox
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_browser.indexOf('Firefox') !== -1">
                        <img class="ua_browser_icon" src="assets/img/user_agent/firefox.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // Edge
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_browser.indexOf('Edge') !== -1">
                        <img class="ua_browser_icon" src="assets/img/user_agent/edge.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // Opera
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_browser.indexOf('Opera') !== -1">
                        <img class="ua_browser_icon" src="assets/img/user_agent/opera.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // Safari
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_browser.indexOf('Safari') !== -1">
                        <img class="ua_browser_icon" src="assets/img/user_agent/safari.svg" />
                      </span>

                      <!-- 
                      // ----------------------------------------------------------------
                      // Explorer
                      // ---------------------------------------------------------------- -->
                      <span *ngIf="request?.ua_browser.indexOf('IE') !== -1">
                        <img class="ua_browser_icon" src="assets/img/user_agent/explorer.svg" />
                      </span>



                      <span class="tooltiptext" style="font-size: 10px !important; padding: 3px;">
                        <span *ngIf="request?.ua_browser !== 'undefined undefined'"> {{ request?.ua_browser }} </span>
                        <span *ngIf="request?.ua_browser === 'undefined undefined'"> not defined </span>
                      </span>
                    </span>
                  </td>

                  <!-- ===== DEPARTMENT NAME ===== -->
                  <td>
                    <p class="column-td">
                      {{ request?.department?.name }}
                    </p>
                  </td>

                  <!-- ===== NEW SERVED BY ===== -->
                  <td>
                    <div *ngFor="let participant of request?.participants" style="font-size:0.8em;">
                      <span
                        *ngIf="participant !== request?.requester_id && participant !== 'system' && participant !== currentUserID"
                        class="tooltipx">
                        <span (click)="goToMemberProfile( participant )" style="cursor:pointer; display: block">

                          <!-- IF IS A BOT bot_image.png -->
                          <img *ngIf="participant.indexOf('bot_') !== -1" class="user_profile_in_history"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{participant | slice:4}}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />

                          <!-- IF IS A HUMAN -->
                          <img *ngIf="participant.indexOf('bot_') === -1" class="user_profile_in_history"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{participant}}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/no_image_user.png'" />

                          <span class="member" [innerHTML]="members_replace( participant )"></span>

                        </span>

                        <span class="tooltiptext"> {{ "ViewProfile" | translate }} </span>
                      </span>


                      <span style="cursor:pointer;" (click)="goToMemberProfile( participant )"
                        *ngIf="participant === currentUserID">
                        <!-- IF IS THE LOGGED USER -->
                        <img class="user_profile_in_history"
                          src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{participant}}%2Fphoto.jpg?alt=media"
                          onerror="this.src='assets/img/no_image_user.png'" />
                        <span class="current-user-member" [innerHTML]="members_replace(participant)"></span>
                      </span>

                    </div>
                  </td>


                  <!-- ===== RATING ===== -->
                  <!-- <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" >
                    <p *ngIf="request?.rating" style="font-size:0.8em;">
                        {{ request?.rating }} / 5
                    </p>
                    <p *ngIf="!request?.rating" style="font-size:0.8em;">
                        - / 5
                    </p>
                  </td> -->

                  <!-- ===== LIST OF MEMBERS ===== -->
                  <!-- <td (click)='openViewMsgsModal(request?.recipient)' style="cursor:pointer">
                    <p style="font-size:0.8em; min-width: 220px;"  [innerHTML]="request?.members_as_string"></p>
                  </td> -->

                  <!-- ===== PUBLISHED ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                    <p class="column-td">
                      <!-- {{ request?.timestamp | date: 'd/M/y HH:mm:ss'}} -->
                      <!-- {{ request?.request_date_fromnow }} -->
                      <!-- {{ request?.created_on | date: 'd/M/y HH:mm:ss' }} -->
                      <span> {{ request?.createdAt | amTimeAgo }} </span> <br>
                      <span style="font-size: 11px;color: #7695a5;">
                        {{ request?.fulldate }}
                      </span>
                    </p>
                  </td>

                  <!-- <td>
                    <button type="button" rel="tooltip" title="{{ 'VisitorsPage.tootipArchiveRequest' | translate }}"
                      class="btn btn-danger btn-simple btn-xs" (click)='openDeleteRequestModal(request?.request_id)'>
                      <i class="material-icons">clear</i>
                    </button>
                  </td> -->

                </tr>
              </tbody>
            </table>
          </div> <!-- ./ card-content table-responsive -->

          <div *ngIf="displaysFooterPagination === true" class="card-footer" style="text-align:right">
            <div class="stats">

              <div style="width: 120px; margin: 0 auto; margin-top: 10px ">
                <div class="input-group">

                  <!-- -------====== BTN DECREASE PAGE  ======------ -->
                  <span class="input-group-btn" style="padding-right:0px;  padding-left: 0px;">
                    <button [disabled]="pageNo + 1 === 1" class="btn btn-info" type="button"
                      (click)="decreasePageNumber()" style="padding: 6px 8px">
                      <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    </button>
                  </span>

                  <!-- -------====== DISPLAY No PAGE / No TOTAL PAGES   ======------ -->
                  <span class="input-group-btn" style="padding-right:0px;">
                    <button class="btn btn-info" type="button" style="padding: 6px 8px">
                      {{ pageNo + 1 }} / {{ totalPagesNo_roundToUp }}
                    </button>
                  </span>

                  <!-- -------====== BTN INCREASE PAGE  ======------ -->
                  <span class="input-group-btn" style="padding-right:0px">
                    <button [disabled]="pageNo + 1 === totalPagesNo_roundToUp || totalPagesNo_roundToUp === 0"
                      class="btn btn-info" type="button" (click)="increasePageNumber()" style="padding: 6px 8px">
                      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    </button>
                  </span>

                </div>
              </div>

            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<appdashboard-close-request-modal *ngIf="displayArchiveRequestModal === 'block'"
  [id_request_to_archive]="id_request_to_archive" [displayArchiveRequestModal]="displayArchiveRequestModal"
  (closeModal)='onCloseArchiveRequestModal()'>
</appdashboard-close-request-modal>