<!-- margin-top:6px; -->
<div #navbarBrand *ngIf="CHAT_PANEL_MODE === false" class="navbar-brand"
  style="z-index: 1050;position: relative; padding-left:30px"
  [ngStyle]="{'margin-top':isChromeVerGreaterThan100 === true ? '-64px' : '6px' }">
  <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;"
    (click)="goBack()">keyboard_arrow_left</i>
  <!-- Request  -->
  {{ "RequestMsgsPage.RequestDetails" | translate }}
  <!-- <code style="color:#3f87a6; border: 1px solid #cee9f9; font-size:0.8em"> {{cut_support_group_from_request_id(id_request)}} </code> -->
</div>

<div id="conversation-detail-main-content" class="main-content" style="padding-top:0px"
  [ngClass]="{'main-content-chat-panel-mode' : CHAT_PANEL_MODE === true, 'main-content-normal-mode': CHAT_PANEL_MODE === false}">
  <div class="container-fluid" [ngClass]="{'container-fluid-no-padding' : CHAT_PANEL_MODE === true}">

    <!-- <loading-spinner *ngIf="showSpinner"></loading-spinner>
    *ngIf="!showSpinner" -->

    <div>
      <div class="row">
        <div class="col-sm-7 chat-col"
          [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true, 'chat-col-normal-mode': CHAT_PANEL_MODE === false }">
          <div class="card chat-card" [ngClass]="{'chat-card-normal-mode': CHAT_PANEL_MODE === false}"
            style="padding-top:0px; padding-bottom:0px;">
            <div class="row" style="padding-left:25px; padding-right:25px">
              <div class="col-sm-12" style="border-bottom: 1px solid #e5effe; height: 59px;">
                <div class="two-div-wrapper">
                  <div style="float: left; width: 50%; height: 59px;">
                    <span *ngIf="!showSpinner">

                      <!-- -----new REQUESTER -->
                      <!-- [ngStyle]="{'background-color': fillColour }" -->
                      <span style="cursor: pointer;" (click)='goToContactDetails()' class="requester-avatar-wrapper"
                        matTooltipClass="conv-dtls-custom-mat-tooltip"
                        matTooltip="{{ 'ClickToViewTheDetailsOfTheContact' | translate }}" 
                        #tooltip="matTooltip"
                        matTooltipPosition='right' 
                        matTooltipHideDelay="100">
                        <span class="_requester-avatar_as_title"
                          [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + fillColour + ')'}"
                          [ngClass]="{'requester_fullname-undefined' : !request?.lead?.fullname}">
                          <span style="color: #ffffff"> {{ requester_fullname_initial }} </span>
                        </span>

                        <span *ngIf="REQUESTER_IS_VERIFIED === true" class="tooltipx">
                          <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 26.6 26.6"
                            width="17" height="17" style="position: relative;left: -58px;top: -7px;"
                            xml:space="preserve">
                            <style type="text/css">
                              .st0 {
                                fill: none;
                              }

                              .st1 {
                                fill: #FFFFFF;
                              }

                              .st2 {
                                fill: #18BDF7;
                              }
                            </style>
                            <path class="st0" d="M1.3,1.3h24v24h-24V1.3z" />
                            <path class="st1"
                              d="M13.3,0L2.4,4.9v7.3c0,6.7,4.6,13,10.9,14.5c6.2-1.5,10.9-7.8,10.9-14.5V4.9L13.3,0z" />
                            <path class="st2" d="M13.3,2.3l-9,4v6c0,5.5,3.8,10.7,9,12c5.2-1.3,9-6.5,9-12v-6L13.3,2.3z M11.3,18.3l-4-4l1.4-1.4l2.6,2.6
                                l6.6-6.6l1.4,1.4L11.3,18.3z" />
                          </svg>
                          <span class="tooltiptext"> {{ "VisitorsPage.AuthenticatedUser" | translate }} </span>
                        </span>
                        <div class="requester-status-icon-avatar_as_title"
                          [ngClass]="{'requester_is_online' : REQUESTER_IS_ONLINE}">
                        </div>
                      </span>

                      <!-- <span style="color:#394f5a;"> {{ "RequestMsgsPage.RequesterName" | translate }}: </span>  -->
                      <div class="contact_info">
                        <span [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}">
                          <!-- {{ requester_fullname }} -->
                          {{request?.lead?.fullname}}
                        </span>
                        <span *ngIf="!request?.lead?.fullname"
                          [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}"
                          style="cursor:pointer; margin-left: 2px;">
                          n.a.
                        </span>
                      </div>
                      <!-- -----new REQUESTER -->

                    </span>
                  </div>

                  <div style="float: right; width: 50%; height: 59px;">

                    <!-- ---------------------------------------- -->
                    <!-- Open the chat -->
                    <!-- ---------------------------------------- -->
                    <!-- w-100 -->
                    <div class="row chat-header-wpr-open-chat-btn"
                      *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                      <!-- [ngClass]="{'disable_open_the_chat_btn' : request?.status == 1000}" -->
                      <div class="col-xs-12 chat-header-wpr-btn">
                        <button #openChatBtn (click)="openChatAtSelectedConversation()"
                          class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right" role="button"
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'ThisConversationIsAssignedToYou' | translate }}" 
                          #tooltip="matTooltip"
                          matTooltipPosition='below' 
                          matTooltipHideDelay="100">
                          <i class="material-icons"
                            style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">open_in_new</i>
                          <span style="vertical-align: middle"> {{ 'OpenChat' | translate }}</span>
                        </button>
                      </div>
                    </div>

                    <!-- ---------------------------------------- -->
                    <!-- Join to chat -->
                    <!-- ---------------------------------------- -->
                    <!-- w-100 -->
                    <div class="row  chat-header-wpr-join-chat-btn"
                      *ngIf="JOIN_TO_GROUP_HAS_ERROR === false && IS_CURRENT_USER_JOINED === false  && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">
                      <div class="col-xs-12">
                        <button class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right" (click)="onJoinHandled()"
                          [disabled]="request?.status == 1000" role="button" 
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'ThisConversationIsNotAssignedToYou' | translate }}" #tooltip="matTooltip"
                          matTooltipPosition='below' matTooltipHideDelay="100">
                          <i class="material-icons"
                            style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">login</i>
                          <span style="vertical-align: middle"> {{ 'RequestMsgsPage.Enter' | translate }} </span>
                        </button>
                      </div>
                    </div>

                    <!-- ---------------------------------------- -->
                    <!-- Loading w-100-->
                    <!-- ---------------------------------------- -->
                    <div class="row chat-header-wpr-loadin-chat-btn" style="height: 62px;" *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true 
                    && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  
                    && JOIN_TO_GROUP_HAS_ERROR === false">
                      <!-- <div class="col-xs-8 h-100 chat-header-btn plr-8 ptb-8 pull-right">
                        <div class="chat-footer-text-wpr">
                          {{ 'PleaseWaitWhileWeAreProcessingYourRequest' | translate }}
                        </div>
                      </div> -->
                      <div class="col-xs-12">
                        <button class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right">
                          <i class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i>
                          {{ 'RequestMsgsPage.Loading' | translate }}
                        </button>
                      </div>
                    </div>

                    <!-- ---------------------------------------- -->
                    <!-- Error w-100 -->
                    <!-- ---------------------------------------- -->
                    <div class="row chat-header-wpr-error-chat-btn" style="height: 62px;"
                      *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">
                      <!-- <div class="col-xs-8 h-100 plr-0">
                        <div class="chat-footer-text-wpr">
                          {{ 'ThereHasBeenAnErrorProcessing' | translate }}
                        </div>
                      </div> -->
                      <div class="col-xs-12">
                        <button class="btn btn-danger chat-header-btn plr-8 ptb-8 pull-right" disabled>
                          {{ 'Error' | translate }}
                        </button>
                      </div>
                    </div>






                    <!-- ------------------------------------------------------------ -->
                    <!-- CONTACT INFO DROPDOWN MENU  -->
                    <!-- ------------------------------------------------------------  -->
          

                  </div>
                </div>
              </div>
            </div>
            <!-- <loading-spinner *ngIf="showSpinner"></loading-spinner> -->

            <div *ngIf="showSpinner" class="stretchspinner">
              <div class="rect1"></div>
              <div class="rect2"></div>
              <div class="rect3"></div>
              <div class="rect4"></div>
              <div class="rect5"></div>
            </div>



            <div #scrollMe id="chat-wpr" class="card-content" (scroll)="onScrollMsgs($event)">
              <div *ngIf="!showSpinner" class="chat-body" style="vertical-align:baseline;">

                <!-- style="padding-bottom: 3px;" class="answer left" -->
                <div *ngFor="let message of messagesList">

                  <!-- ////// INFO MSG -->
                  <!-- requester_id: {{requester_id}} message_sender {{message.sender}} type
                      {{message?.attributes?.subtype}} rext {{ message?.text }} -->
                  <div
                    *ngIf="message?.attributes?.subtype === 'info' || message?.attributes?.subtype === 'info/support'"
                    style="padding:12px 55px; text-align:center">
                    <div>
                      <div class="txt">
                        <!-- -------------------------------------------------------------- -->
                        <!-- first combination: | marked | sanitizeHtml -->
                        <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                        <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                        <!-- -------------------------------------------------------------- -->
                        <!-- <p *ngIf="message?.type === 'text'" class="type-info-msg-text"
                          [innerHTML]="message?.text | htmlEntitiesEncode | marked">
                          {{ message?.createdAt | amDateFormat: 'LL'}} 
                        </p> -->

                        <p *ngIf="message?.type === 'text'" class="type-info-msg-text">
                          {{ message?.text }}
                          <span style=" color: rgba(43 ,43,43, .8);font-size: 11px;">
                            ({{ message?.createdAt | amDateFormat: 'LLL'}})
                          </span>
                        </p>

                      </div>

                    </div>
                  </div>


                  <div class="parent"
                    *ngIf="message?.attributes?.subtype !== 'info' && message?.attributes?.subtype !== 'info/support'">
                    <div [ngClass]="{'child' : requester_id !== message.sender}">
                      <div class="speech-wrapper">
                        <!-- ////// REQUESTER -->
                        <!-- requester_id: {{requester_id}} message_sender {{message.sender}} type
                      {{message?.attributes?.subtype}} -->
                        <!-- [ngStyle]="{'background-color': fillColour }" -->
                        <div *ngIf="requester_id === message.sender && message?.attributes?.subtype !== 'info'"
                          class="bubble">
                          <div class="avatar"
                            style="  width: 35px; height: 35px; position: absolute; left: -50px; bottom: 36px;">
                            <div class="requester-avatar-wrapper"
                              style="display: block;border-radius: 50%; height: 100%; margin-top: 35px;"
                              [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + fillColour + ')'}">
                              <span class="_requester-avatar-inchat">
                                {{ requester_fullname_initial }}
                              </span>
                            </div>
                          </div>

                          <div class="txt">

                            <p class="name" [ngStyle]="{'color': fillColour }">
                              {{ message.senderFullname }}
                              <!-- <span *ngIf="message?.type === 'text' && !message?.metadata"
                                style="float:right; cursor:pointer; color: #00bcf8; text-decoration: underline;"
                                (click)="openRightSideBar(message?.text)">
                                {{ 'Train' | translate }}
                              </span> -->
                            </p>

                            <ng-container *ngIf="resolutionBotCount > 0">
                              <p class="train-btn-wpr" *ngIf="message?.type === 'text' && !message?.metadata">
                                <span class="train-btn" (click)="openRightSideBar(message?.text)">
                                  {{ 'Train' | translate }}
                                </span>
                              </p>
                            </ng-container>
                            <!-- -------------------------------------------------------------- -->
                            <!-- first combination: | marked | sanitizeHtml -->
                            <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                            <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                            <!-- -------------------------------------------------------------- -->
                            <p *ngIf="message?.type === 'text'" class="message ow"
                              [innerHTML]="message?.text | htmlEntitiesEncode | marked ">
                            </p>
                            <div *ngIf="message?.type === 'image'" class="message ow">
                              <!-- style="height:200px; width:200px;" -->
                              <div class="image-container" style="cursor:pointer"
                                (click)="openImageViewerModal(message?.metadata)">
                                <img src={{message.metadata.src}} class="message-img" />
                                <!-- message >   {{message | json}} -->
                                <p *ngIf="message?.text" [innerHTML]="message?.text | htmlEntitiesEncode | marked ">
                                </p>
                              </div>
                            </div>
                            <span class="timestamp">
                              {{ message?.createdAt | amDateFormat: 'LLL'}}
                              <!-- {{browserLang === 'en' ? (message?.createdAt | amDateFormat:'MMM DD YYYY (HH:mm:ss)') : (
                              message?.createdAt | amDateFormat:'DD MMM YYYY (HH:mm:ss)')}} -->
                            </span>
                          </div>
                          <div class="bubble-arrow"></div>
                        </div>

                        <!-- ------------------------------------------------------ -->
                        <!-- The sender is the agent - Speech Bubble alternative -->
                        <!-- ------------------------------------------------------ -->
                        <div *ngIf="requester_id !== message.sender && message?.attributes?.subtype !== 'info'"
                          class="bubble alt" [ngClass]="{'internal-note': message?.attributes?.subtype === 'private'}">
                          <!-- left: 254px; -->
                          <div class="avatar"
                            style="width: 35px; height: 35px; position: absolute; left: 365px; bottom: 36px;">
                            <div
                              style="display: block;border-radius: 50%; height: 100%; margin-top: 35px; background-color: #fff; border:1px solid #ebebeb;">
                              <!-- ------------------------------------------------ -->
                              <!-- USE CASE: human -->
                              <!-- ------------------------------------------------ -->
                              <!-- <span *ngIf="message?.sender !== 'system' && message?.senderFullname !== 'Bot'" style="position: absolute; top:43px; margin-left:13px;"> -->
                              <span
                                *ngIf="message?.sender !== 'system' && message?.sender.indexOf('bot_') === -1 && message?.attributes?.subtype !== 'info'"
                                style="position: absolute; top:43px; margin-left:13px;">
                                <!-- {{ messageSenderInitialLetter( message?.senderFullname )}} -->
                                <!-- {{ message?.sender }}{{  message?.senderFullname }} -->

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Firebase -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="user-img-in-msg-list"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{message?.sender}}%2Fphoto.jpg?alt=media"
                                  onerror="this.src='assets/img/no_image_user.png'" />

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Native  -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="user-img-in-msg-list"
                                  src="{{baseUrl}}images?path=uploads%2Fusers%2F{{message?.sender}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                  onerror="this.src='assets/img/no_image_user.png'" />
                              </span>

                              <!-- ------------------------------------------------ -->
                              <!-- USE CASE: bot -->
                              <!-- ------------------------------------------------ -->
                              <!-- <span *ngIf="message?.senderFullname === 'Bot'" style="position: absolute; top:43px; margin-left:13px;"> -->
                              <span
                                *ngIf="message?.sender.indexOf('bot_') !== -1 && message?.attributes?.subtype !== 'info'"
                                style="position: absolute; top:43px; margin-left:13px;">

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Firebase (bot) -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="bot-img-in-msg-list"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{message?.sender | slice:4 }}%2Fphoto.jpg?alt=media"
                                  onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Native (bot) -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="bot-img-in-msg-list"
                                  src="{{baseUrl}}images?path=uploads%2Fusers%2F{{message?.sender | slice:4}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                  onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />
                              </span>
                            </div>
                          </div>
                          <div class="txt">
                            <p class="name alt"
                              [ngClass]="{'internal-note-': message?.attributes?.subtype === 'private'}">
                              {{ message?.senderFullname }}
                            </p>
                            <!-- -------------------------------------------------------------- -->
                            <!-- first combination: | marked | sanitizeHtml -->
                            <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                            <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                            <!-- -------------------------------------------------------------- -->
                            <p *ngIf="message?.type === 'text' || message?.type === 'file'" class="message ow alt"
                              [ngClass]="{'internal-note-text-color': message?.attributes?.subtype === 'private'}"
                              [innerHTML]="message?.text | htmlEntitiesEncode | marked">

                            <div *ngIf="message?.type === 'image'" class="message ow alt">
                              <!-- style="height:200px; width:200px;" -->
                              <div class="image-container" style="cursor:pointer"
                                (click)="openImageViewerModal(message?.metadata)">
                                <img src={{message.metadata.src}} class="message-img" />

                                <p *ngIf="message?.text" [innerHTML]="message?.text | htmlEntitiesEncode | marked"></p>

                                <div *ngIf="message?.metadata?.type && !message?.metadata?.type?.startsWith('image')">
                                  <!-- -------------------------------------------------------------- -->
                                  <!-- first combination: | marked | sanitizeHtml -->
                                  <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                                  <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                                  <!-- -------------------------------------------------------------- -->
                                  <p [innerHTML]="message?.text | htmlEntitiesEncode | marked"></p>
                                </div>

                              </div>
                            </div>

                            <!-- // iframe -->
                            <div *ngIf="message?.type === 'frame'" class="message ow alt">
                              <!-- style="height:200px; width:200px;" -->
                              <div class="image-container">
                                <iframe allowfullscreen width="80%" height="80%" style="border:none;"
                                  [src]="message.metadata.src | sanitizeHtml" class="message-img"></iframe>


                                <!-- -------------------------------------------------------------- -->
                                <!-- first combination: | marked | sanitizeHtml -->
                                <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                                <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                                <!-- -------------------------------------------------------------- -->
                                <p [innerHTML]="message?.text | htmlEntitiesEncode | marked"></p>


                              </div>
                            </div>

                            <span class="timestamp">
                              {{ message?.createdAt | amDateFormat: 'LLL'}}
                              <!-- {{ message?.createdAt | date: 'd/M/y HH:mm:ss'}}
                              {{browserLang === 'en' ? (message?.createdAt | amDateFormat:'MMM DD YYYY (HH:mm:ss)') : (
                              message?.createdAt | amDateFormat:'DD MMM YYYY (HH:mm:ss)')}}-->
                            </span>
                          </div>
                          <div class="bubble-arrow alt"
                            [ngClass]="{'internal-note': message?.attributes?.subtype === 'private'}"></div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>

              <!-- <a id="fixed-button" class="button" [ngStyle]="{'display':displayBtnScrollToBottom }"
                (click)="scrollToBottom()">
                <span class="icon is-small">
                  <i class="fa fa-chevron-down"></i>
                </span>
              </a> -->

            </div>

            <div class="card---footer">
              <div class=" chat-btns-and-text-row-wpr" style="width: 100%; min-height: 69px;">

                <!-- nk new -->
                <div class="row chat-btns-and-text-row h-100 w-100">

                  <div class="col-xs-12 plr-0">
                    <!-- ---------------------------------------- -->
                    <!-- Open the chat -->
                    <!-- ---------------------------------------- -->
                    <!-- <div class="row w-100" style="height: 62px;"
                      *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                      <div class="col-xs-8 h-100 plr-0">
                        <div class="chat-footer-text-wpr">
                          {{ 'ThisConversationIsAssignedToYou' | translate }}
                        </div>
                      </div>
                      <div class="col-xs-4">
                        <button #openChatBtn (click)="openChatAtSelectedConversation()"
                          class="btn btn-primary btn-block open_the_chat_btn plr-0" style="min-width: 110px;"
                          role="button" [ngClass]="{'disable_open_the_chat_btn' : request?.status == 1000}">
                          <i class="material-icons"
                            style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">open_in_new</i>
                          <span style="vertical-align: middle"> {{ 'OpenChat' | translate }}</span>
                        </button>
                      </div>
                    </div> -->

                    <!-- ---------------------------------------- -->
                    <!-- Join to chat -->
                    <!-- ---------------------------------------- -->
                    <!-- <div class="col-xs-12">
                      <div class="row w-100" style="height: 62px;"
                        *ngIf="JOIN_TO_GROUP_HAS_ERROR === false && IS_CURRENT_USER_JOINED === false  && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">

                        <div class="col-xs-8 h-100 plr-0">
                          <div class="chat-footer-text-wpr">
                            {{ 'ThisConversationIsNotAssignedToYou' | translate }}
                          </div>
                        </div>
                        <div class="col-xs-4">
                          <button class="btn btn-primary btn-block plr-0" style="min-width: 110px;"
                            (click)="onJoinHandled()" [disabled]="request?.status == 1000" role="button">
                            <i class="material-icons"
                              style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">login</i>
                            <span style="vertical-align: middle"> {{ 'RequestMsgsPage.Enter' | translate }} </span>
                          </button>
                        </div>
                      </div>
                    </div> -->

                    <!-- <div class="col-xs-12">
                      <div class="row w-100" style="height: 62px;" *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true 
                                  && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  
                                  && JOIN_TO_GROUP_HAS_ERROR === false">
                        <div class="col-xs-8 h-100 plr-0">
                          <div class="chat-footer-text-wpr">
                            {{ 'PleaseWaitWhileWeAreProcessingYourRequest' | translate }}
                          </div>
                        </div>
                        <div class="col-xs-4">
                          <button class="btn btn-primary btn-block plr-0 pull-right" style="min-width: 110px;">
                            <i class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i>
                            {{ 'RequestMsgsPage.Loading' | translate }}
                          </button>
                        </div>
                      </div>
                    </div> -->

                    <!-- <div class="col-xs-12">
                      <div class="row w-100" style="height: 62px;" *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">
                        <div class="col-xs-8 h-100 plr-0">
                          <div class="chat-footer-text-wpr">
                            {{ 'ThereHasBeenAnErrorProcessing' | translate }}
                          </div>
                        </div>
                        <div class="col-xs-4">
                          <button class="btn btn-danger btn-block" disabled
                            style="padding-left: 0px;padding-right: 0px;">
                            {{ 'Error' | translate }}
                          </button>
                        </div>
                      </div>
                    </div> -->
                    <div class="row w-100">
                      <div class="col-xs-12 h-100 plr-0">
                        <ng-select class="select-response-type" [clearable]="false" [searchable]="false"
                          [items]="responseType" bindLabel="name" bindValue="id" [(ngModel)]="selectedResponseTypeID"
                          (change)="onChangeReplyType(selectedResponseTypeID)">
                          <ng-template ng-label-tmp let-item="item">
                            <img height="15" width="15" style="width: 15px; height: auto; margin-right:3px "
                              [src]="item.icon" />
                            {{item.name}}
                          </ng-template>
                          <ng-template ng-option-tmp let-item="item" let-index="index">
                            <img height="15" width="15" style="width: 15px; height: auto;  margin-right:3px "
                              [src]="item.icon" />
                            {{item.name}}
                          </ng-template>
                        </ng-select>
                      </div>
                    </div>


                    <!-- ------------------------------------------------ -->
                    <!-- texarea send message  -->
                    <!-- ------------------------------------------------ -->
                    <div class="col-xs-12  w-100 plr-0">
                      <div class="row w-100">
                        <!-- margin-top: -4px; border-top: 2px solid #3ea9f5; -->
                        <div class="col-xs-12 h-100 plr-0" style="  margin-bottom: 8px;"
                          [ngStyle]="{'background-color': selectedResponseTypeID === 2 ? 'rgb(255, 247, 237)' : '#fff' }">
                          <textarea #sendMessageTexarea class="send-message-texarea" [(ngModel)]="chat_message" rows="1"
                            placeholder="Write your message" (keydown.enter)="onKeydownEnter($event)"
                            (paste)="onPasteInSendMsg($event)"
                            (ngModelChange)="onChangeTextInSendMsg($event)">  </textarea>


                          <div class="chat-msg-attachement" *ngIf="uploadedFiles">
                            <span *ngIf="showSpinnerAttachmentUplolad === true">
                              <i class="fa fa-spinner fa-spin"></i>
                            </span>
                            <span *ngIf="uploadedFiles?.type.startsWith('image')">
                              <i class="fa fa-file-image-o" aria-hidden="true"></i>
                            </span>
                            <span *ngIf="!uploadedFiles?.type.startsWith('image')">
                              <i class="fa fa-file-o" aria-hidden="true"></i>
                            </span>
                            {{uploadedFiles?.name }} ({{uploadedFiles?.formattedBytes }})
                            <span *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="remove-attachment"
                              (click)="removeAttachment(uploadedFiles?.downloadURL, uploadedFiles?.name)">
                              <span class="material-icons">
                                clear
                              </span>
                            </span>
                          </div>

                        </div>
                      </div>
                    </div>

                    <div class="col-xs-12  w-100 plr-0">
                      <div class="row w-100">

                        <div class="col-xs-12 h-100 plr-0" style="margin-top: -4px;position: relative;left: 15px;">
                          <!-- <button class="btn pull-right send-chat-msg-btn" (click)="sendChatMessage()"
                            [disabled]="(!chat_message || chat_message?.length === 0) && (existAnAttacment === false)">
                            <span class="material-icons">
                              send
                            </span>
                          </button>  -->

                          <div class="btn-group dropup pull-right" style="margin: 5px 1px;">

                            <button type="button" class="btn btn-primary send-msg" style="border-right: 1px solid #fff;"
                              (click)="sendChatMessage()"
                              [disabled]="(!chat_message || chat_message?.length === 0) && (existAnAttacment === false)">
                              <span style="font-weight:300;"> {{'SendAs' | translate }} </span>
                              <span
                                *ngIf="HAS_SELECTED_SEND_AS_OPENED === true && HAS_SELECTED_SEND_AS_PENDING === false && HAS_SELECTED_SEND_AS_SOLVED === false"
                                style="font-weight:500;">
                                {{'Open' | translate }}
                              </span>
                              <span
                                *ngIf="HAS_SELECTED_SEND_AS_OPENED === false && HAS_SELECTED_SEND_AS_PENDING === true && HAS_SELECTED_SEND_AS_SOLVED === false"
                                style="font-weight:500;">
                                {{'Pending' | translate }}
                              </span>
                              <span
                                *ngIf="HAS_SELECTED_SEND_AS_OPENED === false && HAS_SELECTED_SEND_AS_PENDING === false && HAS_SELECTED_SEND_AS_SOLVED === true"
                                style="font-weight:500;"> {{'Resolved' | translate }} </span>
                            </button>


                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                              (click)="isOpenDropdown(isOpen = !isOpen)">
                              <span class="caret"
                                [ngClass]="{'caret-rotate-0': is0penDropDown === true, 'caret-rotate-180': is0penDropDown === false}"></span>
                              <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                              <li>

                                <a (click)="hasSelectedSendAsOpen()" style="padding-left: 15px; padding-right: 15px;">
                                  <i class="material-icons" style="padding-right: 5px;color: rgb(197, 44, 36);">stop</i>
                                  <span style="position: relative; top: 1px; cursor:pointer">

                                    {{'SendAs' | translate }}
                                    <span style="font-weight:500; "> {{'Open' | translate }} </span>
                                  </span>
                                </a>
                              </li>
                              <li>

                                <a (click)="hasSelectedSendAsPending()"
                                  style="padding-left: 15px; padding-right: 15px;">
                                  <i class="material-icons" style="padding-right: 5px;color: rgb(55,147,233);">stop</i>
                                  <span style="position: relative; top: 1px; cursor:pointer">

                                    {{'SendAs' | translate }}
                                    <span style="font-weight:500; "> {{'Pending' | translate }}</span>
                                  </span>
                                </a>
                              </li>
                              <li>

                                <a (click)="hasSelectedSendAsSolved()" style="padding-left: 15px; padding-right: 15px;">
                                  <i class="material-icons"
                                    style="padding-right: 5px; color: rgb(136, 146,156);">stop</i>
                                  <span style="position: relative; top: 1px; cursor:pointer">

                                    {{'SendAs' | translate }}
                                    <span style="font-weight:500;"> {{'Resolved' | translate }} </span>
                                  </span>
                                </a>
                              </li>

                            </ul>
                          </div>




                          <!-- File upload -->
                          <input type="file" class="file-input" (change)="onFileSelected($event)" #fileUpload
                            style="display: none;">

                          <div class="file-upload">
                            <button class="btn  pull-left upload-btn" (click)="fileUpload.click()">
                              <span class="material-icons">
                                attach_file
                              </span>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- </div> -->
                    <!-- ./ texarea send message  -->

                  </div>
                </div>

                <!-- *ngIf="request?.channel?.name === 'email' || request?.channel?.name === 'form'" -->
                <!-- <div class="row" style="width: 100%;">
                  <div class="col-xs-12">

                    <textarea class="send-message-texarea" [(ngModel)]="chat_message" style="width: 100%;"
                      placeholder="Enter a message" rows="3"></textarea>
                    <button class="btn btn-primary pull-right" (click)="sendChatMessage()" [disabled]="!chat_message">
                      Send
                    </button>
                  </div>

                </div> -->

                <!-- nk new end -->

              </div>

            </div>
          </div> <!-- ./ card   -->
        </div> <!-- ./ col-md-7 -->


        <!-- ----------------------------------------------------------------------------- -->
        <!-- @ RIGHT SIDEBAR -->
        <!-- ----------------------------------------------------------------------------- -->
        <div id="right-col" class="right-col"
          [ngClass]="{'col-sm-5' : CHAT_PANEL_MODE === false, 'col-sm-12 no-padding' : CHAT_PANEL_MODE === true, 'chat-panel-mode-on-desktop' :CHAT_PANEL_MODE === true && !isMobile}">

          <div class="card right-card" style="padding-top:0px; padding-bottom:5px;margin-bottom: 10px;"
            [ngClass]="{'right-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'right-card-normal-mode' : CHAT_PANEL_MODE === false}">
            <!---->

            <div *ngIf="showSpinner && !isMobile" class="stretchspinner">
              <div class="rect1"></div>
              <div class="rect2"></div>
              <div class="rect3"></div>
              <div class="rect4"></div>
              <div class="rect5"></div>
            </div>

            <div *ngIf="showSpinner && isMobile && CHAT_PANEL_MODE === true" class="spinner-for-mobile">
              <div class="sk-fading-circle">
                <div class="sk-circle1 sk-circle"></div>
                <div class="sk-circle2 sk-circle"></div>
                <div class="sk-circle3 sk-circle"></div>
                <div class="sk-circle4 sk-circle"></div>
                <div class="sk-circle5 sk-circle"></div>
                <div class="sk-circle6 sk-circle"></div>
                <div class="sk-circle7 sk-circle"></div>
                <div class="sk-circle8 sk-circle"></div>
                <div class="sk-circle9 sk-circle"></div>
                <div class="sk-circle10 sk-circle"></div>
                <div class="sk-circle11 sk-circle"></div>
                <div class="sk-circle12 sk-circle"></div>
              </div>
            </div>


            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;min-height: 510px;">
              <div *ngIf="!showSpinner" class="content-wrap">


                <!-- ----------------------------------------------------------------------------- -->
                <!-- @ RIGHT SIDEBAR - CONTACT IF CHAT PANEL MODE IS TRUE -->
                <!-- ----------------------------------------------------------------------------- -->
                <div class="row" [ngClass]="{'row-height-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                  <div class="col-sm-12" style="height: 65px">
                    <div class="right-sidebar-header" [ngClass]="{
                    'right-sidebar-header-with-contact' : CHAT_PANEL_MODE === true,
                  'right-sidebar-header-with-request': CHAT_PANEL_MODE === false, 
                  'right-sidebar-header-no-border-bottom': request?.attributes?.decoded_jwt && REQUESTER_IS_VERIFIED}">

                      <div class="contact-in-right-sidebar"
                        [ngClass]="{'visible-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                        <!-- [ngStyle]="{'background-color': fillColour }" -->
                        <span class="requester-avatar-wrapper-in-right-sidebar">
                          <span class="_requester-avatar_as_title-in-right-sidebar"
                            [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + fillColour + ')'}"
                            [ngClass]="{'requester_fullname-undefined' : !request?.lead?.fullname, '_requester-avatar_as_title-in-chat': CHAT_PANEL_MODE === true && REQUESTER_IS_VERIFIED === false, '_requester-verified-avatar_as_title-in-chat' : CHAT_PANEL_MODE === true && REQUESTER_IS_VERIFIED === true}">
                            <span style="color: #ffffff"> {{ requester_fullname_initial }} </span>
                            <div class="requester-status-icon-avatar_as_title-in-right-sidebar"
                              [ngClass]="{'requester_is_online' : REQUESTER_IS_ONLINE}">
                            </div>
                          </span>
                          <span *ngIf="REQUESTER_IS_VERIFIED === true" class="tooltipx">
                            <svg [ngClass]="{'chat-panel-mode-requester-verified' : CHAT_PANEL_MODE === true }"
                              version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                              xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 26.6 26.6"
                              width="17" height="17" style="position: relative;left: -61px;top: -7px;"
                              xml:space="preserve">
                              <style type="text/css">
                                .st0 {
                                  fill: none;
                                }

                                .st1 {
                                  fill: #FFFFFF;
                                }

                                .st2 {
                                  fill: #18BDF7;
                                }
                              </style>
                              <path class="st0" d="M1.3,1.3h24v24h-24V1.3z" />
                              <path class="st1"
                                d="M13.3,0L2.4,4.9v7.3c0,6.7,4.6,13,10.9,14.5c6.2-1.5,10.9-7.8,10.9-14.5V4.9L13.3,0z" />
                              <path class="st2" d="M13.3,2.3l-9,4v6c0,5.5,3.8,10.7,9,12c5.2-1.3,9-6.5,9-12v-6L13.3,2.3z M11.3,18.3l-4-4l1.4-1.4l2.6,2.6
                          l6.6-6.6l1.4,1.4L11.3,18.3z" />
                            </svg>
                            <span class="tooltiptext"> {{ "VisitorsPage.AuthenticatedUser" | translate }} </span>
                          </span>
                          <!-- <div style="display: none;" class="requester-status-icon-avatar_as_title-in-right-sidebar"
                        [ngClass]="{'requester_is_online' : REQUESTER_IS_ONLINE}">
                      </div> -->
                        </span>


                        <div class="contact_info_in_right-sidebar" (click)="openDropDown()"
                          [ngClass]="{'contact_info_in_right-sidebar-verified':REQUESTER_IS_VERIFIED === true }">
                          <div class="contact-fullname-in-right-sidebar">
                            <span *ngIf="request?.lead?.fullname">
                              {{request?.lead?.fullname}}
                            </span>
                            <span *ngIf="!request?.lead?.fullname">
                              N/A
                            </span>
                          </div>
                        </div>

                        <div class="edit-icon-wpr" (click)="openDropDown()" style="float: right;margin-top: -19px;">
                          <i class="material-icons" style="font-size: 16px;color: rgb(139,153,174);margin-right: 3px;">
                            edit
                          </i>
                        </div>

                        <div class="dropdown__menu">
                          <div class="dropdown__content" style="box-shadow: 0 8px 24px 0 rgb(60 72 91 / 32%);">
                            <form class="dropdown__content_form">
                              <div class="input-wrapper">
                                <label for="first-name-input" style="margin-bottom: 4px;">
                                  {{'FirstName' | translate}}
                                </label>
                                <input id="first-name-input" type="text" class="dropdown--input"
                                  name="contact_new_first_name" autocomplete="off" [(ngModel)]="contactNewFirstName">
                                <label for="last-name-input" style="margin-bottom: 4px;">
                                  {{'LastName' | translate}}
                                </label>
                                <input id="last-name-input" type="text" class="dropdown--input"
                                  name="contact_new_last_name" autocomplete="off" [(ngModel)]="contactNewLastName">
                              </div>
                              <div class="drpdown-btn-wpr"
                                style=" border-top: 1px solid rgb(211, 219, 229);text-align: center;">
                                <button class="btn btn-secondary dropdown-action--btn dropdown-action-cancel--btn"
                                  (click)="closeDropdown()">
                                  {{'Cancel' | translate}}
                                </button>

                                <button type="submit"
                                  class="btn btn-secondary  dropdown-action--btn dropdown-done-action--btn"
                                  (click)="updateContactFullName()"
                                  [disabled]="!contactNewFirstName || contactNewFirstName.length < 2">

                                  {{'Update' | translate}}
                                </button>

                              </div>
                              <div class="view-all-lead-properties" (click)="goToEditContact()">
                                <span> {{'ViewAll' | translate}} </span>
                                <span class="material-icons-outlined" style="font-size: 13px;
                               vertical-align: middle;">
                                  open_in_new
                                </span>
                              </div>
                            </form>
                          </div>
                        </div>

                        <!-- href="mailto:{{request?.lead?.email}}" -->
                        <div class="chat-panel-mode-contact-email" (click)="openDropDownEditEmail()">
                          <a class="lead-email-anchor" target="_blank" *ngIf="request?.lead?.email">
                            {{request?.lead?.email}}
                          </a>
                          <a *ngIf="!request?.lead?.email"
                            style="color: #7695a5; margin-top: 8px;font-size:14px; font-weight: 400;">
                            {{'EmailNotAvailable' | translate}}
                          </a>
                        </div>

                        <div class="edit-email-icon-wpr" (click)="openDropDownEditEmail()"
                          style="margin-top: -19px; width: 16px;position:relative; right: -233px;">
                          <i class="material-icons" style="font-size: 16px;color: rgb(139,153,174);margin-right: 3px;">
                            edit
                          </i>
                        </div>

                        <div class="dropdown__menu_edit_email">
                          <div class="dropdown__content" style="box-shadow: 0 8px 24px 0 rgb(60 72 91 / 32%);">
                            <form class="dropdown__content_form">
                              <div class="input-wrapper">
                                <label for="email-input" style="margin-bottom: 4px;">
                                  {{'ContactEmail' | translate}}
                                </label>

                                <input id="email-input" type="email" class="dropdown--input" name="contact_new_email"
                                  autocomplete="off" [(ngModel)]="contactNewEmail"
                                  (ngModelChange)="emailChange($event)">
                                <span *ngIf="!EMAIL_IS_VALID"
                                  style="color: #f44336; position: relative;  top: -8px; font-size: 12px;font-weight: 400;">
                                  {{ "EnterValidEmail" | translate }}
                                </span>
                              </div>

                              <div class="drpdown-btn-wpr"
                                style=" border-top: 1px solid rgb(211, 219, 229);text-align: center;">
                                <button class="btn btn-secondary dropdown-action--btn dropdown-action-cancel--btn"
                                  (click)="closeDropdownEditEmail()">
                                  {{'Cancel' | translate}}
                                </button>

                                <button type="submit"
                                  class="btn btn-secondary  dropdown-action--btn dropdown-done-action--btn"
                                  (click)="updateContactEmail()" [disabled]="!contactNewEmail">

                                  {{'Update' | translate}}
                                </button>
                              </div>
                              <div class="view-all-lead-properties" (click)="goToEditContact()">
                                <span> {{'ViewAll' | translate}} </span>
                                <span class="material-icons-outlined" style="font-size: 13px;
                                vertical-align: middle;">
                                  open_in_new
                                </span>
                              </div>
                            </form>
                          </div>
                        </div>

                      </div> <!-- contact in right sidebar -->

                      <div class="request-icons-in-right-sidebar"
                        [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                        <!-- ------------------------------------- -->
                        <!-- IF IS A CLOSED REQUEST -->
                        <!-- ------------------------------------- -->
                        <span *ngIf="request?.status == 1000 && !request?.subject">
                          <svg class="conv-svg-icon" viewBox="0 0 58.1 53.9" style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .st0-chat-closed {
                                fill: none;
                                stroke: #999999;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .st1-chat-closed {
                                fill: #999999;
                              }
                            </style>
                            <path class="st0-chat-closed" d="M30.1,2.6c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C8.9,41.4,7.9,47.2,5.1,50c0,0,8.6-1.2,14.4-4.7
                      c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.9,2.6,30.1,2.6z" />
                            <path class="st1-chat-closed" d="M30.4,13.8c-6.3,0-11.4,5-11.4,11.2h-3.8l4.9,4.9l0.1,0.2l5.1-5h-3.8c0-4.8,4-8.7,8.9-8.7s8.9,3.9,8.9,8.7
                      s-4,8.7-8.9,8.7c-2.5,0-4.7-1-6.3-2.6L22.3,33c2.1,2,4.9,3.3,8.1,3.3c6.3,0,11.4-5,11.4-11.2S36.7,13.8,30.4,13.8z M29.1,20v6.2
                      l5.4,3.2l0.9-1.5L31,25.3V20H29.1z" />
                          </svg>
                          <span class="request-category" style="color: #999999" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.RequestResolved' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='below' matTooltipHideDelay="100">
                            {{ "RequestMsgsPage.Resolved_F" | translate }}
                            <span *ngIf="request?.closed_by"
                              style="font-size: 12px; font-weight: 400;">({{request?.closed_by_label}})</span>
                          </span>
                        </span>


                        <!-- ------------------------------------- -->
                        <!-- IF IS AN INTERNAL CLOSED REQUEST -->
                        <!-- ------------------------------------- -->
                        <span *ngIf="request?.status == 1000 && request?.subject">
                          <svg class="conv-svg-icon" version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .closed_Internal_st0 {
                                fill: none;
                                stroke: #999999;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .closed_Internal_st1 {
                                fill: #999999;
                              }
                            </style>
                            <path class="closed_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                          C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="closed_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                          c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                          C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                          c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>
                          <span class="request-category" style="color: #999999" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.InternalRequestResolved' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='below' 
                            matTooltipHideDelay="100">
                            {{ "RequestMsgsPage.Resolved_M" | translate }}
                            <span *ngIf="request?.closed_by"
                              style="font-size: 12px; font-weight: 400;">({{request?.closed_by_label}})</span>
                          </span>
                        </span>


                        <!-- ------------------------------------- -->
                        <!-- IF IS AN UNSERVED REQUEST -->
                        <!-- ------------------------------------- -->
                        <span *ngIf="request?.status === 100 && !request?.subject">
                          <svg class="conv-svg-icon" viewBox="0 0 58.1 53.9" style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .st0-unserved {
                                fill: none;
                                stroke: #ED4537;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .st1-unserved {
                                fill: #ED4537;
                              }
                            </style>
                            <path class="st0-unserved" d="M30.5,3.3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                        c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3.3,30.5,3.3z" />
                            <g>
                              <path class="st1-unserved"
                                d="M30.6,38.9c-1.7,0-3.1-1.4-3.1-3c0-1.7,1.4-3,3.1-3c1.7,0,3.1,1.4,3.1,3C33.6,37.6,32.3,38.9,30.6,38.9z" />
                              <path class="st1-unserved" d="M34.8,18l-1.5,10c-0.2,1.5-1.6,2.5-3.1,2.3c-1.2-0.2-2.1-1.1-2.3-2.2l-1.6-10c-0.4-2.3,1.2-4.5,3.6-4.9
                          c2.4-0.4,4.6,1.2,5,3.5C34.9,17.1,34.9,17.6,34.8,18z" />
                            </g>
                          </svg>
                          <span class="request-category" style="color: #f44336" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.RequestUnserved' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='below' matTooltipHideDelay="100">
                            {{ "NotAssigned_F" | translate }}
                          </span>
                        </span>


                        <!-- ------------------------------------- -->
                        <!-- IF IS AN INTERNAL UNSERVED REQUEST  -->
                        <!-- ------------------------------------- -->
                        <span *ngIf="request?.status === 100 && request?.subject">
                          <svg class="conv-svg-icon" version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .unserved_Internal_st0 {
                                fill: none;
                                stroke: #ED4537;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .unserved_Internal_st1 {
                                fill: #ED4537;
                              }
                            </style>
                            <path class="unserved_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                            C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="unserved_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                          c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                          C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                          c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>

                          <span class="request-category" style="color: #999999" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.InternalRequestUnserved' | translate }}"
                            #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100">
                            <!-- {{ "RequestMsgsPage.InternalRequestUnserved" | translate }} -->
                            {{ "NotAssigned_M" | translate }}
                          </span>
                        </span>

                        <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                        <!-- <span *ngIf="request?.status == 200 && request?.currentUserIsJoined === true"> -->
                        <span *ngIf="request?.status == 200 && IS_CURRENT_USER_JOINED === true && !request?.subject">
                          <svg class="conv-svg-icon" viewBox="0 0 58.1 53.9" style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .st0-served-by-cu {
                                fill: none;
                                stroke: #4DAF4F;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .st1-served-by-cu {
                                fill: #4DAF4F;
                              }
                            </style>
                            <path class="st0-served-by-cu" d="M29.8,3.7c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                      c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.6,3.7,29.8,3.7z" />
                            <g id="XMLID_146_">
                              <path id="XMLID_158_" class="st1-served-by-cu" d="M25.8,36.5l-8.4-7.4c-1.1-0.9-1.1-2.4,0-3.3c1.1-0.9,2.8-0.9,3.8,0l4.6,4.1l12.6-10.9
                        c1.1-0.9,2.8-0.9,3.8,0c1,0.9,1,2.4,0,3.3L25.8,36.5z" />
                            </g>
                          </svg>

                          <span class="request-category" style="color: #4CAF50" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.ConversationAssignedToYou' | translate }}"
                            #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100">
                            
                            {{ "Assigned_F" | translate }}

                          </span>
                        </span>

                        <!-- IF IS A INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                        <span *ngIf="request?.status == 200 && IS_CURRENT_USER_JOINED === true && request?.subject">
                          <svg class="conv-svg-icon" version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .served_bycu_Internal_st0 {
                                fill: none;
                                stroke: #4DAF4F;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .served_bycu_Internal_st1 {
                                fill: #4DAF4F;
                              }
                            </style>
                            <path class="served_bycu_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                          C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="served_bycu_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                          c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                          C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                          c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>

                          <span class="request-category" style="color: #4CAF50" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.TicketAssignedToYou' | translate }}" 
                            #tooltip="matTooltip"
                            matTooltipPosition='below' 
                            matTooltipHideDelay="100">
                            {{ "Assigned_M" | translate }}
                          </span>
                        </span>


                        <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                        <!-- <span *ngIf="request?.status == 200 && !request?.currentUserIsJoined"> -->
                        <span *ngIf="request?.status == 200 && !IS_CURRENT_USER_JOINED && !request?.subject">
                          <svg class="conv-svg-icon" viewBox="0 0 58.1 53.9" style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .st0-served {
                                fill: none;
                                stroke: #05BDD4;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .st1-served {
                                fill: #05BDD4;
                              }
                            </style>
                            <g>
                              <path class="st0-served" d="M30.5,3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                        c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3,30.5,3z" />
                              <g>
                                <circle class="st1-served" cx="17.5" cy="26.7" r="3" />
                                <circle class="st1-served" cx="30.5" cy="26.7" r="3" />
                                <circle class="st1-served" cx="43.5" cy="26.7" r="3" />
                              </g>
                            </g>
                          </svg>

                          <span class="request-category" style="color: #00bcd4;" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.RequestServedBy' | translate }}" 
                            #tooltip="matTooltip"
                            matTooltipPosition='below' 
                            matTooltipHideDelay="100">
                            {{ "Served" | translate }}
                          </span>
                        </span>

                        <!-- IF IS AN INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                        <!-- <span *ngIf="request?.status == 200 && !request?.currentUserIsJoined"> -->
                        <span *ngIf="request?.status == 200 && !IS_CURRENT_USER_JOINED && request?.subject">

                          <svg class="conv-svg-icon" version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                            style="width: 30px" xml:space="preserve">
                            <style type="text/css">
                              .served__Internal_st0 {
                                fill: none;
                                stroke: #05BDD4;
                                stroke-width: 2;
                                stroke-miterlimit: 10;
                              }

                              .served__Internal_st1 {
                                fill: #05BDD4;
                              }
                            </style>
                            <path class="served__Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                          C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                            <path class="served__Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                          c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                          C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                          c0.5,0,0.9-0.5,0.9-1.1V22z" />
                          </svg>

                          <span class="request-category" style="color: #00bcd4;" 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.InternalRequestServedBy' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='below' 
                            matTooltipHideDelay="100">
                            {{ "Served" | translate }}
                          </span>
                        </span>
                      </div>

                      <div class="right-sidebar-actions"
                        [ngClass]="{'right-sidebar-actions-with-contact' : CHAT_PANEL_MODE === true,'right-sidebar-actions-with-request': CHAT_PANEL_MODE === false}">
                        <!-- btn btn-primary  -->
                        <!-- style="padding:6px 15px; margin-top: 15px" -->
                        <div class="dropdown pull-right">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">


                            <span class="material-icons" *ngIf="CHAT_PANEL_MODE === true"
                              style="color:rgba(0, 0, 0, 0.87);position: relative; right: 6px;top: 6px;">
                              more_horiz
                            </span>
                            <span class="material-icons" *ngIf="CHAT_PANEL_MODE === false"
                              style="color:rgba(0, 0, 0, 0.87);margin-top: 10px;">
                              more_vert
                            </span>
                          </a>
                          <ul class="dropdown-menu">
                            <li *ngIf="CHAT_PANEL_MODE === true"
                              [ngClass]="{'disable-dropdown-menu-btn' : request?.status == 1000 || DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true}">
                              <!-- <a (click)='archiveRequest(request?.request_id)'
                              style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">archive</i>
                              <span style="position: relative; top: 1px; cursor:pointer">
                                {{ 'VisitorsPage.Resolve' | translate }}
                              </span>
                            </a> -->
                            </li>
                            <!-- <li class="divider"></li> -->
                            <!-- [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_AGENT === true}" -->

                            <li *ngIf="CHAT_PANEL_MODE === true">

                              <a (click)='openContactDetailsInNewWindow()'
                                style="padding-left: 15px; padding-right: 15px;">
                                <i class="material-icons" style="padding-right: 5px;">open_in_new</i>
                                <span style="position: relative; top: 1px; cursor:pointer">
                                  <!-- {{ 'VisitorsPage.LeaveChat' | translate }} -->
                                  {{ 'ViewContact' | translate }}
                                </span>
                              </a>
                            </li>

                            <li
                              [ngClass]="{'disable-dropdown-menu-btn' : DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true}">
                              <a (click)='openSelectUsersModal(action = "reassign")'
                                style="padding-left: 15px; padding-right: 15px;">
                                <i class="material-icons" style="padding-right: 5px;">swap_horiz</i>
                                <span style="position: relative; top: 1px; cursor:pointer">
                                  <!-- {{ 'VisitorsPage.ReassignRequest' | translate }} -->
                                  {{ 'VisitorsPage.Reassign' | translate }}
                                </span>
                              </a>
                            </li>
                            <!-- [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_AGENT === true}" -->
                            <li
                              [ngClass]="{'disable-dropdown-menu-btn' : DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true}">
                              <a (click)='openSelectUsersModal(action = "invite")'
                                style="padding-left: 15px; padding-right: 15px;">
                                <i class="material-icons" style="padding-right: 5px;">person_add</i>
                                <span style="position: relative; top: 1px; cursor:pointer">
                                  {{ 'VisitorsPage.AddAgent' | translate }}
                                </span>
                              </a>
                            </li>

                            <li class="divider"></li>

                            <li [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_JOINED === false }">

                              <a (click)='openleaveChatModal()' style="padding-left: 15px; padding-right: 15px;">
                                <i class="material-icons" style="padding-right: 5px;">exit_to_app</i>
                                <span style="position: relative; top: 1px; cursor:pointer">
                                  <!-- {{ 'VisitorsPage.LeaveChat' | translate }} -->
                                  {{ 'VisitorsPage.Leave' | translate }}
                                </span>
                              </a>
                            </li>

                            <li class="divider"></li>
                            <li>
                              <a (click)='displayModalDownloadTranscript()'
                                style="padding-left: 15px; padding-right: 15px;">
                                <i class="material-icons" style="padding-right: 5px;">speaker_notes</i>
                                <span style="position: relative; top: 1px; cursor:pointer">

                                  <!-- {{ 'VisitorsPage.Open' | translate }} -->
                                  Transcript
                                </span>
                              </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                              <a (click)='displayModalBanVisitor(request?.lead?.lead_id, request?.lead?.attributes?.ipAddress)'
                                style="padding-left: 15px; padding-right: 15px;">
                                <i class="material-icons" style="padding-right: 5px;">not_interested</i>
                                <span style="position: relative; top: 1px; cursor:pointer">

                                  {{ 'BanVisitor' | translate }}

                                </span>
                              </a>
                            </li>
                            <!-- <li class="divider"></li>
                            <li>
                              <a (click)='exportTranscriptToCSV()' style="padding-left: 15px; padding-right: 15px;">
                                <i class="material-icons" style="padding-right: 5px;">save_alt</i>
                                <span style="position: relative; top: 1px; cursor:pointer">
                                  {{ 'ExporTranscriptToCSV' | translate }}
                                </span>
                              </a>
                            </li> -->
                          </ul>
                        </div>

                        <button *ngIf="CHAT_PANEL_MODE === false && request?.status !== 1000"
                          class="btn btn-white btn-as-link pull-right" (click)='archiveRequest(request?.request_id)'
                          [disabled]="request?.status == 1000 || DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true">
                          <i class="material-icons">archive</i>
                          <span> {{ 'VisitorsPage.Resolve' | translate }} </span>
                        </button>


                        <button *ngIf="CHAT_PANEL_MODE === false && request?.status === 1000"
                          class="btn btn-white btn-as-link pull-right"
                          (click)='reopenArchivedRequest(request, request?.request_id)'
                          [disabled]="DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true">
                          <i class="material-icons" style=" transform: rotate(180deg);">archive</i>
                          <span> {{ 'Reopen' | translate }} </span>
                        </button>


                      </div>
                    </div>
                  </div>
                </div>

                <!-- ------------------------------------------------------ -->
                <!-- @ Attributes decoded JWT accordion -->
                <!-- ------------------------------------------------------ -->
                <div *ngIf="request?.attributes?.decoded_jwt && REQUESTER_IS_VERIFIED" class="row">
                  <div class="col-sm-12 attributes-jwt-decoded-accordion-wpr">
                    <p class="row-header  attributes-decoded-jwt-accordion"
                      [ngClass]="{'attributes-decoded-jwt-accordion-in-chat': CHAT_PANEL_MODE === true}"
                      (click)="openAttributesDecodedJWTAccordion()"
                      style="padding-left: 11px; padding-right: 15px;font-size: 14px;">
                      <i class="material-icons" style="vertical-align: middle; color: #2C3E48"> gpp_good </i>
                      <span style="vertical-align: middle">
                        {{ "decodedJWT" | translate }}
                      </span>
                    </p>
                    <!-- ------------------------------------------------------ -->
                    <!-- @ Attributes decoded JWT panel -->
                    <!-- ------------------------------------------------------ -->
                    <!-- attributesDecodedJWTArray -->
                    <div class="attributes-decoded-jwt-panel">
                      <div *ngFor="let attribute of  attributesDecodedJWTArrayMerged; let i = index">
                        <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                          <div class="row">
                            <div class="col-xs-10" style="padding-right: 1px;padding-bottom: 5px;">
                              <div *ngIf="attribute?.decodedJWTType && attribute?.index === '0'"
                                class="ws_requets_msgs__attribute" style="text-transform: uppercase;font-weight: 600;
                              font-size: 11px;"> Attributes </div>
                              <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes"
                                [ngClass]="{'decoded-jwt-attributes': attribute?.decodedJWTType}">
                                {{attribute?.attributeName }}:
                              </div>

                              <div aria-expanded="false" [id]="attribute?.attributeName +'_value'" class="attribute"
                                [ngClass]="{'attribute_cutted_text': !attribute?.decodedJWTType}">
                                {{attribute?.attributeValue }}
                              </div>

                            </div>
                            <!-- [id]="attribute?.attributeName +'_arrow_icon'" -->
                            <!-- [ngClass]="{'down' : attributeFullText === true}" -->
                            <!-- white-space: nowrap;width: 1%; -->
                            <div *ngIf="attribute?.attributeValueL + 180 > rightSidebarWidth" class="col-xs-2"
                              style="text-align: right;">
                              <i [id]="attribute?.attributeName +'_arrow_icon'" class="material-icons rotate"
                                style="cursor: pointer; color: #039be5; font-size:18px;"
                                (click)="toggleShowAllString(attribute?.attributeName +'_value', attribute?.attributeName +'_arrow_icon', 'isActive_' + i)">
                                keyboard_arrow_down
                              </i>

                            </div>
                          </div>


                          <!--   <div class="debug_div">
                                L : {{attribute?.attributeValueL}} <br>
                                L + 180 : {{attribute?.attributeValueL + 180}} <br>
                                SB WIDTH : {{rightSidebarWidth}} 
                              </div> -->

                        </div>
                      </div>
                    </div>
                  </div>
                </div> <!-- ./ end attributes decoded JWT accordion-->

                <div class="conv-info-wpr">
                  <!-- --------------------------------------------------------------------- -->
                  <!-- Project name -->
                  <!-- --------------------------------------------------------------------- -->
                  <div *ngIf="CHAT_PANEL_MODE === true" class="row" style="margin-top:8px">
                   
                    <div class="col-sm-12">
                      
                      <p class="chat-panel-mode-project-name" style="margin-top: 0px;">
                        <span class="project-icon-wpr" style="vertical-align: middle; position: relative; top: 3px;" 
                        matTooltipClass="conv-dtls-custom-mat-tooltip"
                        matTooltip="{{ 'Project' | translate }}"
                        #tooltip="matTooltip" 
                        matTooltipPosition='right'
                        matTooltipHideDelay="100">
                          <svg class="project-icon" fill="none" height="22"
                            viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M22.002 12C22.002 6.477 17.524 2 12 2 6.476 1.999 2 6.477 2 12.001c0 5.186 3.947 9.45 9.001 9.952V20.11c-.778-.612-1.478-1.905-1.939-3.61h1.94V15H8.737a18.969 18.969 0 0 1-.135-5h6.794c.068.64.105 1.31.105 2h1.5c0-.684-.033-1.353-.095-2h3.358c.154.64.237 1.31.237 2h1.5ZM4.786 16.5h2.722l.102.396c.317 1.17.748 2.195 1.27 3.015a8.532 8.532 0 0 1-4.094-3.41ZM3.736 10h3.358a20.847 20.847 0 0 0-.095 2c0 1.043.075 2.051.217 3H4.043a8.483 8.483 0 0 1-.544-3c0-.682.08-1.347.232-1.983L3.736 10Zm5.122-5.902.023-.008C8.16 5.222 7.611 6.748 7.298 8.5H4.25c.905-2 2.56-3.587 4.608-4.402Zm3.026-.594L12 3.5l.126.006c1.262.126 2.48 2.125 3.045 4.995H8.83c.568-2.878 1.79-4.88 3.055-4.996Zm3.343.76-.107-.174.291.121a8.533 8.533 0 0 1 4.339 4.29h-3.048c-.298-1.665-.806-3.125-1.475-4.237Z M12 19a1 1 0 0 0 1 1h3v2h-.5a.5.5 0 1 0 0 1h4a.5.5 0 0 0 0-1H19v-2h3a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1v5Z"
                              fill="#394f5a"></path>
                          </svg>
                        </span>
                        <span style="position: relative;top: 1px;">
                          <span class="conv-details-sidebar-text">
                            {{ project_name }}
                          </span>
                        </span>
                      </p>
                      <!-- </div> -->

                      <!-- <div class="col-xs-2" style="text-align: right;">
                            <i id="request_id_arrow_down" class="material-icons rotate"
                              style="cursor: pointer; color: #039be5; font-size:18px;position:relative; top:2px"
                              (click)="goToProjectHomeInNewTab()">
                              open_in_new
                            </i>
                          </div> -->
                      <!-- </div> -->
                      <!-- </span> -->
                    </div>
                  </div>

                  <!-- --------------------------------------------------------------------- -->
                  <!-- Ticket id -->
                  <!-- --------------------------------------------------------------------- -->
                  <div class="row" *ngIf="request?.ticket_id" style="margin-top:5px">
                    <div class="col-sm-12">
                      <p class="" style="margin-bottom: 0px">
                        <i class="material-icons conv-details-sidebar-icon" 
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'TicketId' | translate }}" 
                          #tooltip="matTooltip" 
                          matTooltipPosition='right'
                          matTooltipHideDelay="100">
                          info
                        </i>
                        <span style="position: relative;top: -1px;">
                          <span class="conv-details-sidebar-text">
                            #{{ request?.ticket_id}}
                          </span>
                        </span>
                      </p>
                    </div>
                  </div>

                  <!-- --------------------------------------------------------------------- -->
                  <!-- Subject -->
                  <!-- --------------------------------------------------------------------- -->
                  <div *ngIf="request?.subject" class="row" style="margin-top:5px">
                    <div class="col-sm-12">
                      <p class="" style="margin-bottom: 0px">
                        <i class="material-icons conv-details-sidebar-icon" 
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'RequestMsgsPage.Subject' | translate }}" 
                          #tooltip="matTooltip"
                          matTooltipPosition='right' 
                          matTooltipHideDelay="100" 
                          style="margin-bottom: 0px;">
                          subject
                        </i>
                        <span style="position: relative;top: -1px;">
                          <span *ngIf='!ticketSubjectEditMode' class="conv-details-sidebar-text">
                            {{ticketSubject}}
                          </span>
                          <span *ngIf='!ticketSubjectEditMode' class="material-icons edit-in-place"
                            (click)='ticketSubjectEditMode=true' 
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{ 'ClickToEdit' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">
                            mode_edit
                          </span>
                        </span>
                        <input *ngIf='ticketSubjectEditMode' (blur)="editTicketSubjectFocusOut()"
                          (keydown.enter)='saveEditInPlaceSubject()' [(ngModel)]='ticketSubject' class='cellInput'
                          appdashboardAutofocus>
                      </p>
                    </div>
                  </div>

                  <!-- --------------------------------------------------------------------- -->
                  <!-- Contact email -->
                  <!-- --------------------------------------------------------------------- -->
                  <div class="row" style="margin-top:5px" *ngIf="CHAT_PANEL_MODE === false">
                    <div class="col-xs-10">
                      <p [ngClass]="{'no-top-margin' : request?.subject}" style="margin-bottom: 0px;">
                        <i class="material-icons conv-details-sidebar-icon" 
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'ContactEmail' | translate }}" 
                          #tooltip="matTooltip" 
                          matTooltipPosition='right'
                          matTooltipHideDelay="100">
                          email
                        </i>
                        <span style="position: relative;top: -2px;">
                          <a class="custom-link" style="font-size: 13px;font-weight: 400; text-transform: lowercase;"
                            target="_blank" *ngIf="request?.lead?.email" href="mailto:{{request?.lead?.email}}">
                            {{request?.lead?.email}}
                          </a>
                          <a *ngIf="!request?.lead?.email"
                            style="color: #7695a5; font-weight: 400; font-size: 12px;">n.a.</a>
                        </span>
                      </p>
                    </div>
                    <div class="col-xs-2 copy-icon-wpr" style="padding-right: 18px; position:relative; top:-2px"
                      (click)="copyToClipboardContactEmail(request?.lead?.email)">
                      <div id="contact-email" class="has-copied-tooltip">
                        {{ 'Copied' | translate }}
                      </div>
                      <span class="material-icons-outlined copy-icon">
                        content_copy
                      </span>
                    </div>
                  </div>


                  <!-- --------------------------------------------------------------------- -->
                  <!-- Created At -->
                  <!-- --------------------------------------------------------------------- -->
                  <div class="row" style="margin-top:5px">
                    <div class="col-sm-12">
                      <p [ngClass]="{'no-top-margin' : request?.subject}" style="margin-bottom: 0px;">
                        <i class="material-icons conv-details-sidebar-icon" 
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'Created' | translate }}" 
                          #tooltip="matTooltip" 
                          matTooltipPosition='right'
                          matTooltipHideDelay="100">
                          calendar_today
                        </i>
                        <span style="position: relative;top: -2px;">
                          <span class="conv-details-sidebar-text">
                            {{ request?.createdAt | amTimeAgo }}
                            <span>
                              ({{ request?.createdAt | date: 'd/M/y HH:mm:ss' }})
                            </span>
                          </span>
                        </span>
                      </p>
                    </div>
                  </div>


                  <!-- --------------------------------------------------------------------- -->
                  <!-- Language -->
                  <!-- --------------------------------------------------------------------- -->
                  <div class="row" style="margin-top:5px">
                    <div class="col-sm-12">
                      <p class="" style="margin-bottom: 0px;">
                        <i class="material-icons conv-details-sidebar-icon" 
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'Language' | translate }}" 
                          #tooltip="matTooltip" 
                          matTooltipPosition='right'
                          matTooltipHideDelay="100">
                          language
                        </i>
                        <span style="position: relative;top: -2px;">
                          <span *ngIf="request?.language" class="conv-details-sidebar-text"
                            style="text-transform: uppercase;">
                            {{ request?.language }}
                          </span>
                          <span *ngIf="!request?.language" class="conv-details-sidebar-text"
                            style="text-transform: uppercase;">
                            n.a.
                          </span>
                        </span>
                      </p>
                    </div>
                  </div>

                  <!-- --------------------------------------------------------------------- -->
                  <!-- Country and city -->
                  <!-- --------------------------------------------------------------------- -->
                  <div *ngIf="request?.location" class="row" style="margin-top:5px">
                    <div class="col-sm-12">
                      <p class="" style="margin-bottom: 0px; cursor: pointer;">
                        <i class="material-icons conv-details-sidebar-icon location-icon"
                          matTooltipClass="conv-dtls-custom-mat-tooltip" 
                          matTooltip="{{ 'Location' | translate }}"
                          #tooltip="matTooltip" 
                          matTooltipPosition='right' 
                          matTooltipHideDelay="100"
                          style="margin-right: 3px;">
                          location_on
                        </i>
                        <span style="position: relative;top: -1px;" (click)="openMapRightSideBar()">

                          <span class="conv-details-sidebar-text custom-link">
                            <span *ngIf="locationCity">{{ locationCity }}</span>
                            <span *ngIf="locationCountry"> {{ locationCountry }} </span>
                          </span>

                        </span>
                      </p>
                    </div>
                  </div>

                  <!-- ------------------------------------------------------ -->
                  <!-- Request ID - DISPLAY NONE !!! -->
                  <!-- ------------------------------------------------------ -->
                  <div class="row" style="margin-top:5px; display: none;">
                    <div class="col-sm-12">
                      <span style="position: relative;top: 1px;">
                        <div class="row">
                          <div class="col-xs-10" style="padding-right:10px">
                            <div [ngClass]="{'id_request-wrap': !showAllIdRequest}">
                              <i class="material-icons conv-details-sidebar-icon" 
                                matTooltipClass="conv-dtls-custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.RequestId' | translate }}" 
                                #tooltip="matTooltip"
                                matTooltipPosition='right' matTooltipHideDelay="100">
                                info
                              </i>
                              <span class="conv-details-sidebar-text">
                                <span *ngIf="showAllIdRequest">
                                  {{id_request}}
                                </span>
                                <span *ngIf="!showAllIdRequest">
                                  <!-- {{requestidCutted}} -->
                                  {{id_request}}
                                </span>
                              </span>
                            </div>
                          </div>

                          <div class="col-xs-2" style="text-align: right;">
                            <i id="request_id_arrow_down" class="material-icons rotate"
                              style="cursor: pointer; color: #039be5; font-size:18px;position:relative; top:2px"
                              (click)="toggleShowAllRequestId()">
                              keyboard_arrow_down
                            </i>
                          </div>
                        </div>
                      </span>
                    </div>
                  </div>

                  <!-- ------------------------------------------------------ -->
                  <!-- Department -->
                  <!-- ------------------------------------------------------ -->
                  <div class="row" style="margin-top:5px">
                    <div class="col-sm-12">
                      <p [ngClass]="{'yes-margin' : !request?.sourcePage && CHAT_PANEL_MODE === false, 'no-margin': request?.channel?.name !== 'chat21'}"
                        style="margin-bottom: 0px;">
                        <i class="material-icons conv-details-sidebar-icon" 
                          matTooltipClass="conv-dtls-custom-mat-tooltip"
                          matTooltip="{{ 'Department' | translate }}" 
                          #tooltip="matTooltip" 
                          matTooltipPosition='right'
                          matTooltipHideDelay="100">
                          account_balance
                        </i>
                        <span style="position: relative;top: -2px;">
            
                          <span class="conv-details-sidebar-text">
                            <span *ngIf="request?.department">
                              {{request?.department?.name}}
                            </span>
                            <span *ngIf="!request?.department" style="text-transform: lowercase;">
                              {{'DepartmentsPage.NoDept' | translate}}
                            </span>
                          </span>
                        </span>
                      </p>
                    </div>
                  </div>

                  <!-- --------------------------------------------------------------------- -->
                  <!-- Source page - note when a requets is internal source page there isn't -->
                  <!-- --------------------------------------------------------------------- -->
                  <div *ngIf="request?.sourcePage" class="row" style="margin-top:5px">
                    <div class="col-sm-12">
                      <p style="margin-bottom:0px">
                        <span style="position: relative;top: 1px;">
                          <div class="row">
                            <div class="col-xs-10" style="padding-right:10px">

                              <div [ngClass]="{'source-page-wrap': !showAllSourcePageString}">
                                <img class="request_details___ua_browser_icon"
                                  src="assets/img/user_agent/source_page.svg" 
                                  matTooltipClass="conv-dtls-custom-mat-tooltip"
                                  matTooltip="{{ 'RequestMsgsPage.SourcePage' | translate }}" 
                                  #tooltip="matTooltip"
                                  matTooltipPosition='right' 
                                  matTooltipHideDelay="100" />
                      
                                <span style="font-weight: 400; font-size: 13px;">
                                  <span *ngIf="showAllSourcePageString" style="word-wrap: break-word;">
                                    <a class="custom-link" href="{{request?.sourcePage}}"
                                      target="_blank">{{request?.sourcePage}}</a>
                                  </span>
                                  <span *ngIf="!showAllSourcePageString">
                                    <!-- {{sourcePageCutted}} -->
                                    <a class="custom-link" href="{{request?.sourcePage}}"
                                      target="_blank">{{request?.sourcePage}}</a>
                                  </span>
                                </span>
                              </div>

                            </div>

                            <div class="col-xs-2" style="text-align: right;">
                              <i id="source_page_arrow_down" class="material-icons rotate"
                                style="cursor: pointer; color: #039be5; font-size:18px;position:relative; top:2px"
                                (click)="toggleShowAllSourcePageString()">
                                keyboard_arrow_down
                              </i>
                            </div>
                          </div>
                        </span>
                      </p>
                    </div>
                  </div>


                  <!--  --------------------------------------------------------------------- -->
                  <!--  User Agent browser -->
                  <!--  --------------------------------------------------------------------- -->
                  <div *ngIf="request?.userAgent" class="row" style="margin-top:5px">
                    <!-- border-top: 1px solid #e1eef4;" -->
                    <div class="col-sm-12">
                      <p style="margin-bottom: 0px;">

                        <span *ngIf="(request?.ua_browser.indexOf('Chrome') === -1) && 
                          (request?.ua_browser.indexOf('Chromium') === -1) &&
                          (request?.ua_browser.indexOf('Firefox') === -1) &&
                          (request?.ua_browser.indexOf('Edge') === -1) &&
                          (request?.ua_browser.indexOf('Opera') === -1) &&
                          (request?.ua_browser.indexOf('Safari') === -1) &&
                          (request?.ua_browser.indexOf('IE') === -1)">

                          <img class="request_details___ua_browser_icon" src="assets/img/user_agent/globe.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'Browser' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />

                        </span>


                        <!-- ---------------------------------------------------------------- -->
                        <!--  Chrome or Chromium  -->
                        <!--  ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_browser.indexOf('Chrome') !== -1 || request?.ua_browser.indexOf('Chromium') !== -1">
                          <img class="request_details___ua_browser_icon" src="assets/img/user_agent/chrome.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'Browser' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!--  ---------------------------------------------------------------- -->
                        <!--  Firefox  -->
                        <!--  ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_browser.indexOf('Firefox') !== -1">
                          <img class="request_details___ua_browser_icon" src="assets/img/user_agent/firefox.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'Browser' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!-- ---------------------------------------------------------------- -->
                        <!-- Edge  -->
                        <!-- ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_browser.indexOf('Edge') !== -1">
                          <img class="request_details___ua_browser_icon" 
                            src="assets/img/user_agent/edge.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'Browser' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!-- ---------------------------------------------------------------- -->
                        <!-- Opera  -->
                        <!-- ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_browser.indexOf('Opera') !== -1">
                          <img class="request_details___ua_browser_icon" 
                            src="assets/img/user_agent/opera.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'Browser' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!--  ---------------------------------------------------------------- -->
                        <!--  Safari  -->
                        <!--  ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_browser.indexOf('Safari') !== -1">
                          <img class="request_details___ua_browser_icon" 
                            src="assets/img/user_agent/safari.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'Browser' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!--  ---------------------------------------------------------------- -->
                        <!--  Explorer  -->
                        <!--  ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_browser.indexOf('IE') !== -1">
                          <img class="request_details___ua_browser_icon" 
                            src="assets/img/user_agent/explorer.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'Browser' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!-- ------------------------------------------------------ -->

                        <span style="position: relative;top: -1px;">
                          <span class="conv-details-sidebar-text">
                            <!-- <span *ngIf="request?.ua_browser !== 'undefined undefined'"> {{ request?.ua_browser }} </span> -->
                            <!-- <span *ngIf="request?.ua_browser === 'undefined undefined'"> N/A </span> -->
                            <span>{{ request?.ua_browser }}</span>
                          </span>
                        </span>
                      </p>
                    </div>
                  </div>


                  <!--  --------------------------------------------------------------------- -->
                  <!--  User Agent Operating system -->
                  <!--  --------------------------------------------------------------------- -->
                  <div *ngIf="request?.userAgent" class="row" style="margin-top:5px">
                    <!-- border-top: 1px solid #e1eef4;" -->
                    <div class="col-sm-12">
                      <!-- [ngClass]="{'no-bottom-margin': request?.channel?.name !== 'chat21'}" -->
                      <p style="margin-bottom: 0px;">
                        <!-- ---------------------------------------------------------------- -->
                        <!-- @ OS - if not is -->
                        <!-- ---------------------------------------------------------------- -->
                        <span *ngIf="(request?.ua_os?.indexOf('Android') === -1) && 
                                   (request?.ua_os?.indexOf('Mac OS') === -1) && 
                                   (request?.ua_os?.indexOf('iOS') === -1) &&
                                   (request?.ua_os?.indexOf('Windows') === -1) &&
                                   (request?.ua_os?.indexOf('Ubuntu') === -1)">

                          <img class="request_details___os_icon" 
                            src="assets/img/user_agent/laptop.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'OperatingSystem' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!-- ---------------------------------------------------------------- -->
                        <!-- if is Android   -->
                        <!-- ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_os.indexOf('Android') !== -1" class="os-wpr">
                          <img class="request_details___os_icon" src="assets/img/user_agent/android.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'OperatingSystem' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!-- ---------------------------------------------------------------- -->
                        <!-- if is Mac OS or iOS  -->
                        <!-- ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_os.indexOf('Mac OS') !== -1 || request?.ua_os.indexOf('iOS') !== -1" class="os-wpr">
                          <img class="request_details___os_icon" src="assets/img/user_agent/apple.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'OperatingSystem' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!--  ---------------------------------------------------------------- -->
                        <!--  if is Windows  -->
                        <!--  ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_os.indexOf('Windows') !== -1" class="os-wpr">
                          <img class="request_details___os_icon" src="assets/img/user_agent/windows.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'OperatingSystem' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>


                        <!--  ---------------------------------------------------------------- -->
                        <!--  if is Ubuntu  -->
                        <!--  ---------------------------------------------------------------- -->
                        <span *ngIf="request?.ua_os.indexOf('Ubuntu') !== -1" class="os-wpr">
                          <img class="request_details___os_icon" src="assets/img/user_agent/ubuntu.svg"
                            matTooltipClass="conv-dtls-custom-mat-tooltip" 
                            matTooltip="{{ 'OperatingSystem' | translate }}"
                            #tooltip="matTooltip" 
                            matTooltipPosition='right' 
                            matTooltipHideDelay="100" />
                        </span>

                        <span style="position: relative;top: 1px;">
                          <span class="conv-details-sidebar-text">
                            <span>{{ request?.ua_os }}</span>
                          </span>
                        </span>
                      </p>
                    </div>
                  </div>

                  <!-- ---------------------------------------- -->
                  <!-- Message Channel  -->
                  <!-- ---------------------------------------- -->

                  <div *ngIf="request?.channel?.name !== 'chat21'" class="row" style="margin-top:5px">
                    <div class="col-sm-12">
                      <!-- [ngClass]="{'no-bottom-margin' : CHAT_PANEL_MODE === true}" -->
                      <p style="margin-bottom: 3px;">
                        <!-- ---------------------------------------- -->
                        <!-- Channel - Telegram -->
                        <!-- ---------------------------------------- -->
                        <span *ngIf="request?.channel?.name === 'telegram'" class="channel-wpr">
                          <span>
                            <img class="channel-icon" src="assets/img/channel_icons/telegram-logo.svg"
                              matTooltipClass="conv-dtls-custom-mat-tooltip" 
                              matTooltip="{{ 'MessageChannel' | translate }}"
                              #tooltip="matTooltip" 
                              matTooltipPosition='right' 
                              matTooltipHideDelay="100" />
                          </span>

                          <span style="position: relative;top: 0px;">
                            <span class="conv-details-sidebar-text">
                              <span>Telegram</span>
                            </span>
                          </span>
                        </span>


                        <!-- ---------------------------------------- -->
                        <!-- Channel - WhatsApp  -->
                        <!-- ---------------------------------------- -->
                        <span  *ngIf="request?.channel?.name === 'whatsapp'" class="channel-wpr">
                          <span>
                            <img class="channel-icon" src="assets/img/channel_icons/whatsapp-logo.svg"
                              matTooltipClass="conv-dtls-custom-mat-tooltip" 
                              matTooltip="{{ 'MessageChannel' | translate }}"
                              #tooltip="matTooltip" 
                              matTooltipPosition='right' 
                              matTooltipHideDelay="100" />
                          </span>

                          <span style="position: relative;top: 0px;">
                            <span class="conv-details-sidebar-text">
                              <span>WhatsApp</span>
                            </span>
                          </span>
                        </span>

                        <!-- ---------------------------------------- -->
                        <!-- Channel - Messenger  -->
                        <!-- ---------------------------------------- -->
                        <span *ngIf="request?.channel?.name === 'messenger'" class="channel-wpr">
                          <span>
                            <img class="channel-icon" src="assets/img/channel_icons/messenger-logo.svg"
                              matTooltipClass="conv-dtls-custom-mat-tooltip" 
                              matTooltip="{{ 'MessageChannel' | translate }}"
                              #tooltip="matTooltip" 
                              matTooltipPosition='right' 
                              matTooltipHideDelay="100" />
                          </span>

                          <span style="position: relative;top: 0px;">
                            <span class="conv-details-sidebar-text">
                              <span>Facebook Messenger</span>
                            </span>
                          </span>
                        </span>

                        <!-- ---------------------------------------- -->
                        <!-- Channel - Email  -->
                        <!-- ---------------------------------------- -->
                        <span *ngIf="request?.channel?.name === 'email'" class="channel-wpr">
                          <span>
                            <img class="channel-icon" src="assets/img/channel_icons/email-logo.svg"
                              style="width: 17px; margin-left: 2px;" 
                              matTooltipClass="conv-dtls-custom-mat-tooltip"
                              matTooltip="{{ 'MessageChannel' | translate }}" 
                              #tooltip="matTooltip"
                              matTooltipPosition='right' 
                              matTooltipHideDelay="100" />
                          </span>

                          <span style="position: relative;top: 0px;">
                            <span class="conv-details-sidebar-text">
                              <span>Email</span>
                            </span>
                          </span>
                        </span>

                        <!-- ---------------------------------------- -->
                        <!-- Channel - Form  -->
                        <!-- ---------------------------------------- -->
                        <span *ngIf="request?.channel?.name === 'form'" class="channel-wpr">
                          <span style="margin-left: 1px;">
                            <img class="channel-icon" src="assets/img/channel_icons/form-logo_v2.svg"
                              matTooltipClass="conv-dtls-custom-mat-tooltip" 
                              matTooltip="{{ 'MessageChannel' | translate }}"
                              #tooltip="matTooltip" 
                              matTooltipPosition='right' 
                              matTooltipHideDelay="100"
                              style="width: 17px; margin-left:1px;" />
                          </span>

                          <span style="position: relative;top: 0px;">
                            <span class="conv-details-sidebar-text">
                              <span>Form</span>
                            </span>
                          </span>
                        </span>

                      </p>
                    </div>
                  </div>

                </div>
                <!-- ------------------------------------------------------- -->
                <!-- NEW - EVENTS -->
                <!-- ------------------------------------------------------- -->
                <!-- <div class="row" style="margin-top:5px; cursor: pointer;" (click)='goToEvents()' >
                  <div class="col-sm-12">
                    <p style="color: crimson;">
                      <i class="material-icons"
                        style="vertical-align: middle; color: crimson;font-size:16px">perm_contact_calendar</i>
                      <span style="position: relative;top: 1px;">
                        <span
                          style="font-size: 12px; color: crimson; font-weight: 500;font-family: 'Poppins', sans-serif !important;">
                         EVENTS TEST
                        </span>
           
                      </span>
                    </p>
                  </div>
                </div> -->

                <!--  ---------------------------------------------------------------- -->
                <!--  @ Apps row -->
                <!--  ---------------------------------------------------------------- -->
                <div class="row" *ngIf="isVisibleAPP === true">
                  <div class="col-sm-12 app-row-wpr">
                    <p class="row-header  app-row" (click)="openAppsSidebar()"
                      style="padding-left: 13px; padding-right: 15px;font-size: 14px;">

                      <span style="position: relative; top: 4px;">
                        <span class="material-icons">
                          apps
                        </span>

                        <span style="position: relative;top: -6px;">
                          {{ "Apps" | translate }}
                        </span>
                      </span>
                    </p>
                  </div>
                </div>

                <!--  ---------------------------------------------------------------- -->
                <!--  @ Pre-chat form accordion -->
                <!--  ---------------------------------------------------------------- -->
                <div *ngIf="request?.attributes?.preChatForm" class="row">
                  <!-- margin-top:10px -->
                  <div class="col-sm-12 attributes-pre-chat-form-accordion-wpr"
                    style="padding-left: 0px; padding-right: 0px;">
                    <p class="row-header  attributes-pre-chat-form-accordion"
                      (click)="openAttributesPrechatFormAccordion()">
                      <span>
                        <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 18"
                          style="enable-background:new 0 0 18 18;width: 24px; height: 24px;" xml:space="preserve">
                          <style type="text/css">
                            .st0_prechat-form {

                              fill: #2C3E48;
                            }
                          </style>
                          <path class="st0_prechat-form"
                            d="M14.3,3h-3.2c-0.2-0.8-1-1.5-2-1.5S7.3,2.2,7,3H3.9C3.1,3,2.3,3.7,2.3,4.5V15c0,0.8,0.7,1.5,1.5,1.5h10.5
                       c0.8,0,1.5-0.7,1.5-1.5V4.5C15.9,3.7,15.1,3,14.3,3z M9.1,2.8c0.3,0,0.6,0.3,0.6,0.6S9.3,4,9.1,4S8.5,3.7,8.5,3.3
                       C8.5,3,8.8,2.8,9.1,2.8z M5,6.2h8c0.5,0,0.9,0.4,0.9,0.9c0,0.5-0.4,0.9-0.9,0.9H5c-0.5,0-0.9-0.4-0.9-0.9C4.1,6.6,4.5,6.2,5,6.2z
                        M13,13.9H5c-0.5,0-0.9-0.4-0.9-0.9c0-0.5,0.4-0.9,0.9-0.9h8c0.5,0,0.9,0.4,0.9,0.9C13.9,13.5,13.5,13.9,13,13.9z M13,10.9H5
                       c-0.5,0-0.9-0.4-0.9-0.9c0-0.5,0.4-0.9,0.9-0.9h8c0.5,0,0.9,0.4,0.9,0.9C13.9,10.5,13.5,10.9,13,10.9z" />
                        </svg>
                      </span>
                      <span style="position: relative;top: -6px;">
                        {{ "PreChatFormData" | translate }}
                      </span>
                    </p>

                    <div class="attributes-pre-chat-form-accordion-panel">
                      <div *ngFor="let attribute of preChatFormArray; let i = index">
                        <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                          <div class="row">
                            <div class="col-xs-10" style="padding-right: 1px;padding-bottom: 5px;">
                              <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes">
                                {{attribute?.attributeName }}:
                              </div>
                              <!-- attribute_cutted_text -->
                              <div aria-expanded="false" [id]="attribute?.attributeName +'_value'"
                                class="attribute  position: relative">
                                {{attribute?.attributeValue }}
                              </div>
                            </div>

                            <div class="col-xs-2 copy-icon-wpr"
                              (click)="copyToClipboardPreChatFormValue(attribute?.attributeValue, attribute?.attributeName +'_tooltip')">
                              <div [id]="attribute?.attributeName +'_tooltip'" class="has-copied-tooltip">
                                {{ 'Copied' | translate }}
                              </div>
                              <span class="material-icons-outlined copy-icon">
                                content_copy
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div> <!-- ./ end pre-chat form accordion -->


                <!--  ---------------------------------------------------------------- -->
                <!--  @ Contact coversation accordion -->
                <!--  ---------------------------------------------------------------- -->
                <div class="row">
                  <div class="col-sm-12 contact-conversation-accordion-wpr">
                    <p class="row-header  contact-conversation-accordion" (click)="openContactConversationAccordion()">

                      <!-- padding-right: 2px; -->
                      <span class="material-icons" style="vertical-align: middle;
                        color: #394f5a;
                        font-size: 21px;
                        cursor: default;">
                        forum
                      </span>

                      <span style="vertical-align: middle">
                        {{ "ContactConversations" | translate }}
                      </span>
                    </p>

                    <div class="contact-conversation-accordion-panel">
                      <div class="card card--no-border" style="margin-top: 0px;margin-top: 0px;margin-bottom: 0px;">
                        <div class="card-content table-responsive" style="padding:0px !important">
                          <table class="table table-hover">

                            <tbody>
                              <!-- ===== IF THERE ISN'T CONTACT REQUEST ===== -->
                              <tr *ngIf="contact_requests && contact_requests?.length === 0">
                                <td colspan="2" style="text-align: center; padding-top: 16px;">
                                  <p style="font-size:1em; color:#7695a5; font-weight: 400">
                                    {{ 'HistoryPage.NoRequests' | translate }}
                                  </p>
                                </td>
                              </tr>

                              <tr *ngFor="let request of contact_requests">
                                <!-- [ngStyle]="{'cursor': CHAT_PANEL_MODE === false ? 'pointer' : null}" -->
                                <td style="text-align:center; width: 1%; white-space: nowrap;"
                                  (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">

                                  <!-- ------------------------------------- -->
                                  <!-- IF IS A CLOSED REQUEST -->
                                  <!-- ------------------------------------- -->
                                  <span *ngIf="request?.status === 1000 && !request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.RequestResolved' | translate }}"
                                    #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .st0-chat-closed {
                                          fill: none;
                                          stroke: #999999;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .st1-chat-closed {
                                          fill: #999999;
                                        }
                                      </style>
                                      <path class="st0-chat-closed" d="M30.1,2.6c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C8.9,41.4,7.9,47.2,5.1,50c0,0,8.6-1.2,14.4-4.7
                                          c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.9,2.6,30.1,2.6z" />
                                      <path class="st1-chat-closed" d="M30.4,13.8c-6.3,0-11.4,5-11.4,11.2h-3.8l4.9,4.9l0.1,0.2l5.1-5h-3.8c0-4.8,4-8.7,8.9-8.7s8.9,3.9,8.9,8.7
                                          s-4,8.7-8.9,8.7c-2.5,0-4.7-1-6.3-2.6L22.3,33c2.1,2,4.9,3.3,8.1,3.3c6.3,0,11.4-5,11.4-11.2S36.7,13.8,30.4,13.8z M29.1,20v6.2
                                          l5.4,3.2l0.9-1.5L31,25.3V20H29.1z" />
                                    </svg>
                                  </span>

                                  <!-- ------------------------------------- -->
                                  <!-- IF IS AN INTERNAL CLOSED REQUEST -->
                                  <!-- ------------------------------------- -->
                                  <span *ngIf="request?.status === 1000 && request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.InternalRequestResolved' | translate }}"
                                    #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .closed_Internal_st0 {
                                          fill: none;
                                          stroke: #999999;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .closed_Internal_st1 {
                                          fill: #999999;
                                        }
                                      </style>
                                      <path class="closed_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                      C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                      <path class="closed_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                      c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                      C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                      c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                    </svg>
                                  </span>

                                  <!-- ------------------------------------- -->
                                  <!-- IF IS AN UNSERVED REQUEST -->
                                  <!-- ------------------------------------- -->
                                  <span *ngIf="request?.status === 100 && !request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.RequestUnserved' | translate }}"
                                    #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .st0-unserved {
                                          fill: none;
                                          stroke: #ED4537;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .st1-unserved {
                                          fill: #ED4537;
                                        }
                                      </style>
                                      <path class="st0-unserved" d="M30.5,3.3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                          c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3.3,30.5,3.3z" />
                                      <g>
                                        <path class="st1-unserved"
                                          d="M30.6,38.9c-1.7,0-3.1-1.4-3.1-3c0-1.7,1.4-3,3.1-3c1.7,0,3.1,1.4,3.1,3C33.6,37.6,32.3,38.9,30.6,38.9z" />
                                        <path class="st1-unserved" d="M34.8,18l-1.5,10c-0.2,1.5-1.6,2.5-3.1,2.3c-1.2-0.2-2.1-1.1-2.3-2.2l-1.6-10c-0.4-2.3,1.2-4.5,3.6-4.9
                                            c2.4-0.4,4.6,1.2,5,3.5C34.9,17.1,34.9,17.6,34.8,18z" />
                                      </g>
                                    </svg>
                                  </span>

                                  <!-- ------------------------------------- -->
                                  <!-- IF IS AN INTERNAL UNSERVED REQUEST  -->
                                  <!-- ------------------------------------- -->
                                  <span *ngIf="request?.status === 100 && request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.InternalRequestUnserved' | translate }}"
                                    #tooltip="matTooltip" 
                                    matTooltipPosition='below' 
                                    matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .unserved_Internal_st0 {
                                          fill: none;
                                          stroke: #ED4537;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .unserved_Internal_st1 {
                                          fill: #ED4537;
                                        }
                                      </style>
                                      <path class="unserved_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                        C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                      <path class="unserved_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                        c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                        C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                        c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                    </svg>
                                  </span>

                                  <!-- // SERVED REQUESTS AND CURRENT USER IS A PARTICIPANT -->
                                  <span
                                    *ngIf="request?.status === 200 && request?.currentUserIsJoined  && !request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.ConversationAssignedToYou' | translate }}"
                                    #tooltip="matTooltip" 
                                    matTooltipPosition='below' 
                                    matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .st0-served-by-cu {
                                          fill: none;
                                          stroke: #4DAF4F;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .st1-served-by-cu {
                                          fill: #4DAF4F;
                                        }
                                      </style>
                                      <path class="st0-served-by-cu" d="M29.8,3.7c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                          c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.6,3.7,29.8,3.7z" />
                                      <g id="XMLID_146_">
                                        <path id="XMLID_158_" class="st1-served-by-cu" d="M25.8,36.5l-8.4-7.4c-1.1-0.9-1.1-2.4,0-3.3c1.1-0.9,2.8-0.9,3.8,0l4.6,4.1l12.6-10.9
                                            c1.1-0.9,2.8-0.9,3.8,0c1,0.9,1,2.4,0,3.3L25.8,36.5z" />
                                      </g>
                                    </svg>
                                  </span>

                                  <!-- IF IS A INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                                  <span
                                    *ngIf="request?.status === 200 && request?.currentUserIsJoined  && request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.TicketAssignedToYou' | translate }}"
                                    #tooltip="matTooltip" 
                                    matTooltipPosition='below' 
                                    matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .served_bycu_Internal_st0 {
                                          fill: none;
                                          stroke: #4DAF4F;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .served_bycu_Internal_st1 {
                                          fill: #4DAF4F;
                                        }
                                      </style>
                                      <path class="served_bycu_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                  C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                      <path class="served_bycu_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                  c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                  C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                  c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                    </svg>
                                  </span>

                                  <!-- // SERVED REQUESTS AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER-->
                                  <span
                                    *ngIf="request?.status === 200 && !request?.currentUserIsJoined && !request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.RequestServedBy' | translate }}"
                                    #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .st0-served {
                                          fill: none;
                                          stroke: #05BDD4;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .st1-served {
                                          fill: #05BDD4;
                                        }
                                      </style>
                                      <g>
                                        <path class="st0-served" d="M30.5,3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                            c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3,30.5,3z" />
                                        <g>
                                          <circle class="st1-served" cx="17.5" cy="26.7" r="3" />
                                          <circle class="st1-served" cx="30.5" cy="26.7" r="3" />
                                          <circle class="st1-served" cx="43.5" cy="26.7" r="3" />
                                        </g>
                                      </g>
                                    </svg>
                                  </span>

                                  <!-- IF IS AN INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                                  <span
                                    *ngIf="request?.status === 200 && !request?.currentUserIsJoined && request?.subject"
                                    matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'RequestMsgsPage.InternalRequestServedBy' | translate }}"
                                    #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                    [matTooltipDisabled]="CHAT_PANEL_MODE">

                                    <svg viewBox="0 0 58.1 53.9" style="width: 32px" xml:space="preserve">
                                      <style type="text/css">
                                        .served__Internal_st0 {
                                          fill: none;
                                          stroke: #05BDD4;
                                          stroke-width: 2;
                                          stroke-miterlimit: 10;
                                        }

                                        .served__Internal_st1 {
                                          fill: #05BDD4;
                                        }
                                      </style>
                                      <path class="served__Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                  C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                      <path class="served__Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                  c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                  C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                  c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                    </svg>
                                  </span>
                                </td>


                                <!-- ===== REQUEST FIRST TEXT style="cursor:pointer"  ===== -->
                                <!-- [ngStyle]="{'cursor': CHAT_PANEL_MODE === false ? 'pointer' : null}" -->
                                <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                                  <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;"
                                    [innerHTML]="getRequestText(request?.first_text)"> </p>

                                  <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                                    {{ 'SentThe' | translate}} {{ request?.createdAt | date: 'dd/MM/yyyy' }}
                                    <span *ngIf="request?.department?.name && CHAT_PANEL_MODE === false">
                                      <span>{{ 'ToTheDepartment' | translate}} </span>
                                      <span style="text-transform: uppercase"> {{ request?.department?.name }} </span>
                                    </span>
                                  </span>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div> <!-- ./ card-content table-responsive -->

                        <div *ngIf="displaysFooterPagination === true" class="card-footer" style="text-align:center">
                          <div class="stats">

                            <div style="width: 120px; margin: 0 auto; margin-top: 10px ">
                              <div class="input-group">

                                <!-- -------====== BTN DECREASE PAGE  ======------ -->
                                <span class="input-group-btn" style="padding-right:0px;  padding-left: 0px;">
                                  <button [disabled]="pageNo + 1 === 1" class="btn btn-primary" type="button"
                                    (click)="decreasePageNumber()" style="padding: 6px 8px">
                                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                  </button>
                                </span>

                                <!-- -------====== DISPLAY No PAGE / No TOTAL PAGES   ======------ -->
                                <span class="input-group-btn" style="padding-right:0px;">
                                  <button class="btn btn-primary" type="button" style="padding: 6px 8px">
                                    {{ pageNo + 1 }} / {{ totalPagesNo_roundToUp }}
                                  </button>
                                </span>

                                <!-- -------====== BTN INCREASE PAGE  ======------ -->
                                <span class="input-group-btn" style="padding-right:0px">
                                  <button
                                    [disabled]="pageNo + 1 === totalPagesNo_roundToUp || totalPagesNo_roundToUp === 0"
                                    class="btn btn-primary" type="button" (click)="increasePageNumber()"
                                    style="padding: 6px 8px">
                                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                  </button>
                                </span>

                              </div>
                            </div>

                          </div>
                        </div>


                      </div>
                    </div>
                  </div>
                </div> <!-- ./ end contact convs accordion -->


                <!--  ---------------------------------------------------------------- -->
                <!--  @ Ticket accordion -->
                <!--  ---------------------------------------------------------------- -->
                <div class="row">
                  <div class="col-sm-12" style="padding-left: 0px; padding-right: 0px; border-top: 1px solid #eeeeee;">
                    <p class="row-header ticket-accordion" (click)="openTicketAccordion()"
                      style="padding-left:13px; padding-right:15px; font-size: 14px;">
                      <i class="fa fa-ticket" aria-hidden="true" style="vertical-align: middle; color: #2C3E48; font-size: 21px;
                      margin-left: 2px;"></i>

                      <span style="vertical-align: middle">
                        {{ "ticket" | translate }}
                      </span>
                    </p>
                    <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">


                      <div class="ticket-container">
                        <div class="ticket-panel" (scroll)="onScrollx($event)">

                          <!-- ----------------------------------------------------------------------------- -->
                          <!-- Priority -->
                          <!-- ----------------------------------------------------------------------------- -->
                          <div class="row">
                            <div class="col-sm-12" style="border-top: 1px solid #eeeeee;">
                              <p class="row-header">

                                <span style="vertical-align: middle">
                                  {{ 'Priority' | translate }}
                                </span>
                              </p>
                            </div>


                            <div class="col-sm-12" style="margin-bottom: 8px;">

                              <ng-select [items]="priority" bindLabel="name" bindValue="name" [clearable]="false"
                                [hideSelected]="true" [(ngModel)]="selectedPriority"
                                (change)="onChangeSelectedPriority(selectedPriority)">
                                <ng-template ng-label-tmp let-item="item">
                                  <img style="width: 15px;height: 15px;" height="15" width="15" [src]="item.avatar" />
                                  {{item.name | translate}}
                                </ng-template>
                                <ng-template ng-option-tmp let-item="item" let-index="index">
                                  <img style="width: 15px;height: 15px;" height="15" width="15" [src]="item.avatar" />
                                  {{item.name | translate }}
                                </ng-template>
                              </ng-select>
                            </div>
                          </div>


                          <!-- ----------------------------------------------------------------------------- -->
                          <!-- Followers -->
                          <!-- ----------------------------------------------------------------------------- -->
                          <div class="row">
                            <div class="col-sm-12">
                              <p class="row-header">
                                <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                                <span style="vertical-align: middle">
                                  <span class="followers-label"> Followers </span>
                                  <span matTooltipClass="conv-dtls-custom-mat-tooltip"
                                    matTooltip="{{ 'AddTeammatesAsFollowers' | translate }}" 
                                    #tooltip="matTooltip"
                                    matTooltipPosition='right' 
                                    matTooltipHideDelay="100">
                                    <i class="material-icons"
                                      style="position: relative;top: 6px; font-size:16px; color:#7695a5;vertical-align: middle; cursor:pointer">
                                      help_outline
                                    </i>
                                  </span>
                                  <span *ngIf="!CURRENT_USER_IS_A_FOLLOWER" (click)="follow()"
                                    class="follow-btn">follow</span>
                                  <span *ngIf="CURRENT_USER_IS_A_FOLLOWER" (click)="unfollow()"
                                    class="follow-btn">unfollow</span>
                                </span>
                              </p>
                            </div>

                            <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">
                              <div class="followers-container" style="padding-left: 15px;
                              padding-right: 15px;margin-bottom: 6px;">

                                <div class="followers">

                                  <ng-select [items]="projectTeammates" bindLabel="label" [multiple]="true"
                                    placeholder="Search teammate" [(ngModel)]="selectedFollowers"
                                    (change)="getValues($event)" (add)="addFollower($event)"
                                    (remove)="removeFollower($event)" [hideSelected]="true"
                                    (clear)="removeAllFollowers($event)">
                                  </ng-select>

                                  <div *ngIf="request?.channel?.name === 'chat21'" class="convert-to-offline-btn-wpr"
                                    style="margin-top:8px">

                                    <span *ngIf="request?.smartAssignment === true" class="convert-to-offline-btn"
                                      (click)="smartAssignmentOff()">
                                      Convert to offline
                                      <span matTooltipClass="conv-dtls-custom-mat-tooltip"
                                        matTooltip="Select this option to disable automatic reassignment for this conversation. It will be treated like a ticket that will allow you to take his time to reply"
                                        #tooltip="matTooltip" 
                                        matTooltipPosition='right' 
                                        matTooltipHideDelay="100">
                                        <i class="material-icons"
                                          style=" font-size:16px; color:#7695a5;vertical-align: middle; cursor:pointer;position: relative;top: -2px;">
                                          help_outline
                                        </i>
                                      </span>
                                    </span>

                                    <span *ngIf="request?.smartAssignment === false" class="convert-to-offline-btn"
                                      (click)="smartAssignmentOn()">
                                      Convert to online
                                      <span matTooltipClass="conv-dtls-custom-mat-tooltip"
                                        matTooltip="Select this option to enable automatic reassignment for this conversation"
                                        #tooltip="matTooltip" 
                                        matTooltipPosition='right' 
                                        matTooltipHideDelay="100">
                                        <i class="material-icons"
                                          style=" font-size:16px; color:#7695a5;vertical-align: middle; cursor:pointer;position: relative;top: -2px;">
                                          help_outline
                                        </i>
                                      </span>
                                    </span>

                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div> <!-- ./ Ticket accordion -->
                

                <!-- ----------------------------------------------------------------------------- -->
                <!-- Agents -->
                <!-- ----------------------------------------------------------------------------- -->
                <div class="row">
                  <div class="col-sm-12" style="border-bottom: 1px solid #eeeeee; border-top: 1px solid #eeeeee;">
                    <p class="row-header">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        {{ "RequestMsgsPage.Agents" | translate }}
                      </span>
                    </p>

                    <div class="served_by">
                      <!-- ------------------------------------------------------ -->
                      <!-- No Agent -->
                      <!-- ------------------------------------------------------ -->
                      <div *ngIf="agents_array?.length === 0" class="row-body" style="margin-bottom: 10px;">
                        <!-- <div  *ngIf="request?.participants?.length === 0" class="row-body" style="margin-bottom: 10px;"> -->
                        <div class="ws_request_msgs___served_by">
                          <img style="height: auto; width: 22px;margin-left: 5px;margin-top: 5px;"
                            src="assets/img/user-alt-slash-solid.svg" />
                        </div>
                        <span class="ws_request_msgs___served_by_no_agent" style="position: relative;top: 5px;">
                          {{ "RequestMsgsPage.NoAgent" | translate }}
                        </span>
                      </div>

                      <!--  ------------------------------------------------------ -->
                      <!--  Agent array for -->
                      <!--  ------------------------------------------------------ -->
                      <div *ngFor="let agent of agents_array" class="row-body">
                        <span class="agent-wrp"
                          [ngClass]="{'disable-link-if-is-agent' : CURRENT_USER_ROLE === 'agent'}">

                          <!-- --------------------------------------- -->
                          <!-- Usecase  Firebase -->
                          <!-- --------------------------------------- -->
                          <!-- <img *ngIf="agent.isBot === false && agent.hasImage && UPLOAD_ENGINE_IS_FIREBASE"
                            class="teammate-img-conv-detail"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id}}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/no_image_user.png'" /> -->

                          <!-- ------------------------------------- -->
                          <!-- thumb_photo -->
                          <!-- ------------------------------------- -->
                          <img *ngIf="agent.isBot === false && agent.hasImage && UPLOAD_ENGINE_IS_FIREBASE"
                            class="teammate-img-conv-detail"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id}}%2Fthumb_photo.jpg?alt=media"
                            onerror="this.src='assets/img/no_image_user.png'"
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{'ViewProfile' | translate }}" #tooltip="matTooltip" matTooltipPosition='above'
                            matTooltipHideDelay="100" (click)="goToMemberProfile( agent?._id )" />

                          <!-- --------------------------------------- -->
                          <!-- Usecase  Native -->
                          <!-- --------------------------------------- -->
                          <img *ngIf="agent.isBot === false && agent.hasImage && !UPLOAD_ENGINE_IS_FIREBASE"
                            class="teammate-img-conv-detail"
                            src="{{baseUrl}}images?path=uploads%2Fusers%2F{{agent?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                            onerror="this.src='assets/img/no_image_user.png'"
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{'ViewProfile' | translate }}" 
                            #tooltip="matTooltip" 
                            matTooltipPosition='above'
                            matTooltipHideDelay="100" 
                            (click)="goToMemberProfile( agent?._id )" />



                          <!-- --------------------------------------- -->
                          <!-- Usecase  Firebase (bot) -->
                          <!-- --------------------------------------- -->
                          <!-- <img *ngIf="agent.isBot === true && UPLOAD_ENGINE_IS_FIREBASE"
                            class="teammate-img-conv-detail"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id | slice:4}}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" /> -->

                          <!-- ------------------------------------- -->
                          <!-- thumb_photo -->
                          <!-- ------------------------------------- -->
                          <img *ngIf="agent.isBot === true && UPLOAD_ENGINE_IS_FIREBASE"
                            class="teammate-img-conv-detail"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id | slice:4}}%2Fthumb_photo.jpg?alt=media"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'"
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{'ViewProfile' | translate }}" 
                            #tooltip="matTooltip" 
                            matTooltipPosition='above'
                            matTooltipHideDelay="100" 
                            (click)="goToMemberProfile( agent?._id )" />

                          <!-- --------------------------------------- -->
                          <!-- Usecase  Native (bot) -->
                          <!-- --------------------------------------- -->
                          <img *ngIf="agent.isBot === true && !UPLOAD_ENGINE_IS_FIREBASE"
                            class="teammate-img-conv-detail"
                            src="{{baseUrl}}images?path=uploads%2Fusers%2F{{agent?._id | slice:4}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'"
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{'ViewProfile' | translate }}" 
                            #tooltip="matTooltip" 
                            matTooltipPosition='above'
                            matTooltipHideDelay="100" 
                            (click)="goToMemberProfile( agent?._id )" />

                          <!-- --------------------------------------- -->
                          <!-- Name of the bot -->
                          <!-- --------------------------------------- -->
                          <span *ngIf="agent.isBot === true" class="agent-fullname-has-image-and-chat-with"
                            style="font-size:12px; font-weight: 400"
                            matTooltipClass="conv-dtls-custom-mat-tooltip"
                            matTooltip="{{'ViewProfile' | translate }}" #tooltip="matTooltip" matTooltipPosition='above'
                            matTooltipHideDelay="100" (click)="goToMemberProfile( agent?._id )">
                            {{agent?.firstname}} {{agent?.lastname}} (bot)
                            <!-- <span *ngIf="agent.isBot === true" >(bot) </span> -->
                          </span>

                          <!-- --------------------------------------- -->
                          <!--  Chat with when agent has image -->
                          <!-- --------------------------------------- -->
                          <span *ngIf="agent.hasImage" class="agent-fullname-has-image-and-chat-with"
                            [ngClass]="{'current_user_is_agent' : agent?._id === currentUserID}"
                            style="font-size:12px; font-weight: 400">
                            <span matTooltipClass="conv-dtls-custom-mat-tooltip"
                              matTooltip="{{'ViewProfile' | translate }}" #tooltip="matTooltip"
                              matTooltipPosition='above' matTooltipHideDelay="100"
                              (click)="goToMemberProfile( agent?._id )">
                              {{agent?.firstname}} {{agent?.lastname}}
                            </span>

                            <i class="material-icons chat-with-agent-ws-request-detail"
                              *ngIf="agent.isBot === false && CHAT_PANEL_MODE === false"
                              (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)"
                              matTooltipClass="conv-dtls-custom-mat-tooltip"
                              matTooltip="{{'ChatWith' | translate }}  {{agent?.firstname}} {{agent?.lastname}}"
                              #tooltip="matTooltip" matTooltipPosition='above' matTooltipHideDelay="100">
                              chat
                            </i>

                            <span *ngIf="agent.isBot === true">(bot) </span>
                          </span>
                        </span>

                        <!-- --------------------------------------- -->
                        <!-- Usecase No Profile image & Chat with -->
                        <!-- --------------------------------------- -->
                        <div *ngIf="agent.isBot === false && !agent.hasImage" class="altenative-avatar-conv-detail-wpr"
                          [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + agent?.userfillColour + ')'}">
                          <div matTooltipClass="conv-dtls-custom-mat-tooltipr"
                            matTooltip="{{'ViewProfile' | translate }}" 
                            #tooltip="matTooltip" 
                            matTooltipPosition='above'
                            matTooltipHideDelay="100" 
                            class="altenative-avatar-conv-detail"
                            (click)="goToMemberProfile( agent?._id )" style="cursor:pointer">
                            {{ agent?.userFullname }}
                          </div>
                          <span class="agent-fullname-not-has-image-and-chat-with"
                            [ngClass]="{'current_user_is_agent' : agent?._id === currentUserID}"
                            style="font-size:12px; font-weight: 400">
                            <span matTooltipClass="conv-dtls-custom-mat-tooltip"
                              matTooltip="{{'ViewProfile' | translate }}" 
                              #tooltip="matTooltip"
                              matTooltipPosition='above'
                              matTooltipHideDelay="100" style="cursor:pointer"
                              (click)="goToMemberProfile( agent?._id )">
                              {{agent?.firstname}} {{agent?.lastname}}
                            </span>
                            <i class="material-icons chat-with-agent-ws-request-detail"
                              *ngIf="agent.isBot === false && CHAT_PANEL_MODE === false && !agent.hasImage"
                              (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)"
                              matTooltipClass="conv-dtls-custom-mat-tooltip"
                              matTooltip="{{'ChatWith' | translate }}  {{agent?.firstname}} {{agent?.lastname}}"
                              #tooltip="matTooltip" 
                              matTooltipPosition='above'
                              matTooltipHideDelay="100">
                              chat
                            </i>
                          </span>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>



                <!--  ----------------------------------------------------------------------------- -->
                <!--  Tags -->
                <!--  ----------------------------------------------------------------------------- -->
                <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
                  <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;"> -->
                <div *ngIf="isVisibleLBS === true" class="row">
                  <div class="col-sm-12" style="border-bottom: 1px solid #eeeeee;  border-top: 1px solid #eeeeee;">
                    <p class="row-header" style="margin-bottom: 0px">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        {{ "Tags.Tags" | translate }}
                      </span>
                    </p>
                    <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">
                      <div class="tags-container">
                        <div class="tag" *ngFor="let tag of request?.tags" role="button">


                          <!-- --------------------------------------------------------------------------------------------------------------------------------------- -->
                          <!-- Revove tag (note: the request to remove tag in is not called if the current user has agent role and is not among the participants) -->
                          <!-- --------------------------------------------------------------------------------------------------------------------------------------- -->
                          <div (click)="removeTag(tag)">
                            <div class="icon-container" style="display: inline-block;">
                              <svg style="width: 13px; height: auto;position:absolute;margin-top: 6px;"
                                aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag"
                                class="svg-inline--fa-tag-icon fa-tag fa-w-16" role="img"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">

                                <path [ngStyle]="{'fill':tag.color}" class="tag_icon_in_ws_msgs"
                                  d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z">
                                </path>
                              </svg>
                              <span class="tag-delete">
                                <i class="material-icons delete_note_icon" style="font-size: 16px;"> close </i>
                              </span>
                            </div>
                            {{ tag.tag}}
                          </div>

                        </div>
                      </div>


                      <!--  ------------------------------------------------------------------------------------------------------------ -->
                      <!--  Btn Add Labels (note: is disabled if the current user has agent role and is not among the participants) -->
                      <!--  ------------------------------------------------------------------------------------------------------------ -->
                      <button class="btn btn-xs btn-primary ws_msgs_small_btn add_tag_btn"
                        style="margin-top: 4px;  margin-bottom: 6px;" (click)="toggleAddTagInputAndGetTags()"
                        [disabled]="DISABLE_ADD_NOTE_AND_TAGS === true">

                        <i *ngIf="diplayAddTagInput === false" class="material-icons"
                          style="font-size: 15px;">add_circle</i>
                        <i *ngIf="diplayAddTagInput === true" class="material-icons"
                          style="font-size: 15px;">remove_circle</i>

                        {{ 'Tags.AddTags' | translate}}

                      </button>
                      <!-- btn-white-no-border -->
                      <!-- <button class="btn btn-xs btn-white-custom-round" style="margin-left:8px;margin-top: 4px;"
                        (click)="goToTags()">
                        <i class="material-icons">edit</i>
                        {{ 'Tags.ManageTags' | translate}}
                      </button> -->

                      <div *ngIf="CURRENT_USER_ROLE !== 'agent' && CHAT_PANEL_MODE === false" (click)="goToTags()"
                        class="manage_tags">
                        {{ 'Tags.ManageTags' | translate}}
                      </div>
                    </div>

                    <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">
                      <div *ngIf="diplayAddTagInput === true" class="tag-input-wrap" style="margin-bottom: 6px;">

                        <!-- // ------------------------------------------------------ -->
                        <ng-select #Selecter (change)="addTag()" [items]="tagsList" bindLabel="tag" bindValue="_id"
                          [clearable]="false" [clearSearchOnAdd]="true" placeholder="{{ typeALabelAndPressEnter}}"
                          [(ngModel)]="tag" [loading]=loadingTags loadingText='Loading...'>

                          <ng-template ng-label-tmp let-item="item">
                            <!-- <img height="15" width="15" [src]="item.avatar"/> -->
                            <i [style.color]="item.color" class="fa fa-tag"
                              style="font-size: 18px;position: relative;top: 2px;margin-right: 5px;"></i>

                            {{item.tag}}
                          </ng-template>
                          <ng-template ng-option-tmp let-item="item" let-index="index">
                            <i [style.color]="item.color" class="fa fa-tag"
                              style="font-size: 18px;position: relative;top: 2px;margin-right: 5px;"></i>
                            {{item.tag}}
                          </ng-template>
                          <!-- (ngModelChange)="onChangeTagnameInConvDetail($event)" -->
                          <ng-template ng-footer-tmp>
                            <!-- position:relative -->
                            <div class="input-group create-new-tag">
                              <input id="tag_name_in_conv_detail" (keyup.enter)="onPressEnterInIputTypeNewTag()"
                                (focus)="onFocusInIputTypeNewTag()" (blur)="onBlurIputTypeNewTag()"
                                class="tag-name-in-conv-detail" name="tag_name_in_conv_detail" [(ngModel)]="tag_name"
                                type="text" placeholder="{{ 'TypeNewTagHere' | translate }}"
                                style="padding-left: 27px;">
                              <i class="fa fa-circle" style="font-size: 18px; position: absolute;
                                  left: 7px;
                                  top: 13px;" [ngStyle]="{'color':tag_selected_color}"></i>
                              <span class="input-group-btn">
                                <button class="btn btn-xs btn-primary add-tag-btn-cov-detail" (click)="createTag()"
                                  [disabled]="tag_name?.length === 0 || !tag_name">
                                  {{'Add' | translate}}
                                </button>
                              </span>
                            </div>
                            <div class="tag--colors" style="padding-top:4px; padding-left: 7px;">
                              <i class="fa fa-circle" style="font-size: 18px; color:#43B1F2; cursor: pointer;"
                                (click)="tagSelectedColor('#43B1F2')">
                              </i>
                              <i class="fa fa-circle" style="font-size: 18px; color:#CB80DD; cursor: pointer;"
                                (click)="tagSelectedColor('#CB80DD')">
                              </i>
                              <i class="fa fa-circle" style="font-size: 18px; color:#66C549; cursor: pointer;"
                                (click)="tagSelectedColor('#66C549')">
                              </i>
                              <i class="fa fa-circle" style="font-size: 18px; color:#F3C835; cursor: pointer;"
                                (click)="tagSelectedColor('#F3C835')">
                              </i>
                              <i class="fa fa-circle" style="font-size: 18px; color:#F89D34; cursor: pointer;"
                                (click)="tagSelectedColor('#F89D34')">
                              </i>
                              <i class="fa fa-circle" style="font-size: 18px; color:#FF5C55; cursor: pointer;"
                                (click)="tagSelectedColor('#FF5C55')">
                              </i>
                            </div>
                            <!-- tag_name: string;
                            tag_selected_color = '#43B1F2';
                            tag_new_selected_color: string; -->
                          </ng-template>

                        </ng-select>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ----------------------------------------------------------------------------- -->
                <!-- @ Notes accordion -->
                <!-- ----------------------------------------------------------------------------- -->
                <div class="row">
                  <div class="col-sm-12"
                    style="padding-left: 0px; padding-right: 0px; border-bottom: 1px solid #eeeeee;">
                    <p class="row-header accordion" (click)="openNotesAccordion()"
                      style="padding-left:13px; padding-right:15px; font-size: 14px;">
                      <i class="material-icons" style="vertical-align: middle; color: #2C3E48"> note_alt </i>
                      <span style="vertical-align: middle">
                        {{ "Notes.Notes" | translate }} ({{ notesArray?.length }})
                      </span>
                    </p>
                    <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">


                      <div class="note-container">
                        <div class="note-panel" (scroll)="onScrollx($event)">
                          <div class="ws_msgs_note__textarea">
                            <textarea [(ngModel)]="new_note" placeholder="{{ 'Notes.AddANote' | translate  }}" rows="2"
                              style="width: 100%;
                                display: block;
                                border: 1px solid #dee2e7;
                                padding: 12px;
                                border-radius: 3px;
                                resize: none;
                                margin-bottom: 8px;"> </textarea>



                            <!--  ------------------------------------------------------------------------------------------------------------ -->
                            <!--  Btn Add Notes (note: is disabled if if the current user has agent role and is not among the participants) -->
                            <!--  ------------------------------------------------------------------------------------------------------------ -->
                            <button type="button" class="btn btn-xs btn-primary ws_msgs_small_btn" #cont
                              (click)="addNote()"
                              [disabled]="!new_note || new_note?.length === 0 || DISABLE_ADD_NOTE_AND_TAGS === true">


                              <span *ngIf="showSpinnerInAddNoteBtn !== true">
                                <i class="material-icons" style="font-size: 15px;">add_circle</i>
                              </span>

                              <span *ngIf="showSpinnerInAddNoteBtn === true">
                                <i class="fa fa-spinner fa-spin" style="font-size: 15px;"></i>
                              </span>

                              {{ 'Notes.AddNote' | translate }}
                            </button>
                          </div>

                          <div *ngIf="notesArray?.length > 0" class="ws_request_notes__container">


                            <!--  ------------------------------------------------------ -->
                            <!--  @ Notes' cards -->
                            <!--  ------------------------------------------------------ -->
                            <div *ngFor="let note of notesArray;" class="ws_request_note">
                              <div class="ws_request_note__content">
                                {{ note?.text }}
                              </div>
                              <!-- HH:mm:ss -->
                              <div class="ws_request_note__footer">
                                {{ 'Created' | translate}} {{ note.createdAt| date: 'd/M/y'}} {{ 'By' | translate}}
                                {{ note?.createdBy_user?.firstname}} {{ note?.createdBy_user?.lastname}}
                              </div>



                              <!-- ------------------------------------------------------------ -->
                              <!-- @ Remove note btn (click)="presentModalDeleteNote(note._id)" -->
                              <!-- ------------------------------------------------------------ -->
                              <button *ngIf="currentUserID === note.createdBy " (click)="deleteNote(note._id)"
                                type="button" class="note__delete">
                                <i class="material-icons delete_note_icon" style="font-size:16px">close</i>
                              </button>
                            </div>

                          </div>

                          <!-- <div class="ws_msgs_note__textarea">
                            <textarea [(ngModel)]="new_note" placeholder="{{ 'Notes.AddANote' | translate  }}" rows="2"
                              style="width: 100%;
                                display: block;
                                border: 1px solid #dee2e7;
                                padding: 12px;
                                border-radius: 3px;
                                resize: none;
                                margin-bottom: 8px;">

                            </textarea>
                            <button type="button" class="btn btn-primary ws_msgs_small_btn" #cont (click)="addNote()"
                              [disabled]="!new_note || new_note?.length === 0">
                              {{ 'Notes.AddNote' | translate }}
                            </button>
                          </div> -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ------------------------------------------------------ -->
                <!-- Rating  -->
                <!-- ------------------------------------------------------ -->
                <div id="rating" class="row">
                  <div class="col-sm-12" style="border-bottom: 1px solid #eeeeee;">
                    <p class="row-header">
                      <span style="vertical-align: middle">
                        {{ "RequestMsgsPage.Rating" | translate }}
                      </span>
                    </p>
                    <p class="row-body" style="margin-bottom:0px">

                      <!-- display: block; -->
                      <span style="color: #7695a5; font-weight: 400;"> {{ rating }} - </span>
                      <span class="ws_requets_msgs__attributes">
                        {{ "RequestMsgsPage.RatingMessage" | translate }}:
                      </span>
                      <span style="font-weight: 400;"> {{ rating_message }}</span>
                    </p>
                  </div>
                </div>


                <!--  ---------------------------------------------------------------- -->
                <!--  @ Create Jira issue -->
                <!--  ---------------------------------------------------------------- -->
                <div *ngIf="DISPLAY_BTN_CREATE_JIRA_ISSUE" class="row">
                  <div class="col-sm-12" style="border-bottom: 1px solid #eeeeee; min-height: 148px;">
                    <p class="row-header">

                      <span style="vertical-align: middle">
                        {{'CreateTicketOnJira' | translate }}
                      </span>

                    </p>

                    <p class="row-body" style="margin-bottom:0px">

                      <label class="col-sm-12"
                        style="text-align: left;color: #222222; padding-left: 0px;font-size: 12px; font-weight: 400;margin-top: 8px;margin-bottom: 1px;">
                        {{ 'TicketType' | translate }} <span style="color:rgb(195,46,42)"> *</span>
                      </label>
                      <ng-select style="max-width: 180px;" [items]="jira_issue_types" bindLabel="name" bindValue="id"
                        placeholder="{{'SelectTicketType' | translate}}" [(ngModel)]="selectedJiraType"
                        (change)="selectJiraType()">
                        <ng-template ng-label-tmp let-item="item">
                          <img style="width: 15px;height: 15px;" height="15" width="15" [src]="item.avatar" />
                          <b>{{item.name}}</b>
                        </ng-template>
                        <ng-template ng-option-tmp let-item="item" let-index="index">
                          <img style="width: 15px;height: 15px;" height="15" width="15" [src]="item.avatar" />
                          <b>{{item.name}}</b>
                        </ng-template>
                      </ng-select>

                      <button class="btn btn-tdblu-no-boxshadow pull-left" (click)="createJiraTicket()"
                        style="padding:9px 30px;" [disabled]="!selectedJiraType">
                        {{'CreateJiraTicket' | translate}}
                      </button>

                    </p>
                  </div>
                </div>

                <!--  ---------------------------------------------------------------- -->
                <!--  @ Attributes accordion -->
                <!--  ---------------------------------------------------------------- -->
                <div id="attributes-accordion" *ngIf="request?.attributes" class="row">
                  <div class="col-sm-12 attributes-accordion-wpr">
                    <p class="row-header  attributes-accordion" (click)="openAttributesAccordion()"
                      style="padding-left: 13px; padding-right: 15px;font-size: 14px;">

                      <span>
                        <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 18"
                          style="enable-background:new 0 0 18 18; width: 24px; height: 24px;" xml:space="preserve">
                          <style type="text/css">
                            .st0_attributes_icon {
                              fill: none;
                            }

                            .st1_attributes_icon {
                              fill: #2C3E48;
                            }
                          </style>
                          <g>
                            <path class="st0_attributes_icon" d="M0,0h18v18H0V0z" />
                          </g>
                          <polygon points="31.3,2.1 29.7,2.1 29.7,0.5 34.2,-4 35.8,-2.4 " />
                          <path
                            d="M28.6-3.9l-0.8,0.8l-1.6-1.6L27-5.5c0.2-0.2,0.4-0.2,0.5,0l1.1,1.1C28.8-4.3,28.8-4.1,28.6-3.9z" />
                          <g>
                            <path class="st1_attributes_icon" d="M14.2,3H11C10.8,2.2,10,1.5,9,1.5S7.2,2.2,6.9,3H3.8C3,3,2.2,3.7,2.2,4.5V15c0,0.8,0.7,1.5,1.5,1.5h10.5
                            c0.8,0,1.5-0.7,1.5-1.5V4.5C15.8,3.7,15,3,14.2,3z M9,2.8c0.3,0,0.6,0.3,0.6,0.6S9.2,4,9,4S8.4,3.7,8.4,3.3C8.4,3,8.7,2.8,9,2.8z
                            M12,9.8c0,0.1,0,0.1,0,0.2l0.9,0.7l-1.2,2.1l-1.1-0.5c-0.1,0.1-0.2,0.1-0.3,0.2l-0.1,1.2H7.8l-0.1-1.2c-0.1-0.1-0.2-0.1-0.3-0.2
                            l-1.1,0.5l-1.2-2.1L6,10C6,10,6,9.9,6,9.8c0-0.1,0-0.1,0-0.2L5.1,9l1.2-2.1l1.1,0.5c0.1-0.1,0.2-0.1,0.3-0.2L7.8,6h2.4l0.1,1.2
                            c0.1,0.1,0.2,0.1,0.3,0.2l1.1-0.5L12.9,9L12,9.7C12,9.7,12,9.8,12,9.8z" />
                            <circle class="st1_attributes_icon" cx="9" cy="9.8" r="1.6" />
                          </g>
                        </svg>
                      </span>
                      <span style="position: relative;top: -6px;">
                        {{ "Attributes" | translate }}
                      </span>
                    </p>
                    <!-- ------------------------------------------------------ -->
                    <!-- new attributes panel -->
                    <!-- ------------------------------------------------------ -->
                    <div class="attributes-panel">
                      <div *ngFor="let attribute of attributesArray; let i = index">
                        <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                          <div class="row">
                            <div class="col-xs-10" style="padding-right: 1px;padding-bottom: 5px;">
                              <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes">
                                {{attribute?.attributeName }}:
                              </div>

                              <div aria-expanded="false" [id]="attribute?.attributeName +'_value'"
                                class="attribute attribute_cutted_text">
                                {{attribute?.attributeValue }}
                              </div>

                            </div>

                            <div *ngIf="attribute?.attributeValueL + 180 > rightSidebarWidth" class="col-xs-2"
                              style="text-align: right;">
                              <i [id]="attribute?.attributeName +'_arrow_icon'" class="material-icons rotate"
                                style="cursor: pointer; color: #039be5; font-size:18px;"
                                (click)="toggleShowAllString(attribute?.attributeName +'_value', attribute?.attributeName +'_arrow_icon', 'isActive_' + i)">
                                keyboard_arrow_down
                              </i>

                            </div>
                          </div>


                        </div>
                      </div>
                    </div>
                  </div>
                </div> <!-- ./ end new attributes accordion -->

              </div>
            </div>
          </div>
        </div>

      </div>
    </div>




    <!-- ---------------------------------------------------------------------------------------- -->
    <!--  USERS - BOTS - DEPTS LIST MODAL - FULL WIDTH MODAL -->
    <!-- ---------------------------------------------------------------------------------------- -->
    <div class="modal" tabindex="-1" role="dialog"
      [ngClass]="{'users-list-modal-margin-left-on-desktop': CHAT_PANEL_MODE === false}"
      [ngStyle]="{'display': displayUsersListModal , 'height': users_list_modal_height}"
      style="background-color: rgba(90,90,90,0.5);">
      <div class="modal-dialog modal-lg users-list-modal"
        [ngClass]="{'users-list-modal-dashboard-mode' : CHAT_PANEL_MODE === false, 'users-list-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
        role="document" style="width: 100%; height: 100vh; margin:0; padding: 0;">
        <div class="modal-content" style="height: auto; min-height: 100%; border-radius: 0; border:none;">

          <div class="modal-header" [ngClass]="{'modal-header-chat-panel-mode' : CHAT_PANEL_MODE === true}">
            <!-- class="close" -->
            <button type="button" class="close-modal-btn"
              style="border: none !important; float: right !important; border-radius: 50%; color: rgb(235,234,235);  height: 36px; width: 36px;background-color: rgb(221,223,230)"
              aria-label="Close" (click)="closeSelectUsersModal()">
              <span aria-hidden="true" style="font-size:31px; color: rgb(60, 72, 88) !important;">&times;</span>
            </button>

            <h4 class="modal-title">
              <div class="title-wpr">
                <span *ngIf="actionInModal === 'reassign'"> {{ "VisitorsPage.ReassignRequest" | translate }} </span>
                <span *ngIf="actionInModal === 'invite'"> {{ "VisitorsPage.AddAgent" | translate }} </span>
              </div>
            </h4>
          </div>

          <div class="modal-body" [ngClass]="{'modal-body-chat-panel-mode' : CHAT_PANEL_MODE === true}"
            style="padding-right: 15px; padding-top:15px; padding-bottom:15px; max-width: 936px; margin:auto ">

            <div class="row">


              <!-- --------------------------------------------------------------------------------------------- -->
              <!-- modal subtitle -->
              <!-- --------------------------------------------------------------------------------------------- -->
              <div class="col-md-12" *ngIf="CHAT_PANEL_MODE === false">
                <span *ngIf="actionInModal === 'reassign'">
                  <h4 style="font-weight:400" [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                    {{ "VisitorsPage.SelectTheUserToWhom" | translate }}
                  </h4>
                </span>

                <span *ngIf="actionInModal === 'invite'">
                  <h4 style="font-weight:400" [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                    {{ "VisitorsPage.InviteAnotherUserToServe" | translate }}
                  </h4>
                </span>
              </div>

              <div class="col-md-12" [ngClass]="{'no-padding' : CHAT_PANEL_MODE === true}">

                <div class="card" style="margin-top:5px; margin-bottom:5px"
                  [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'card--no-border' : CHAT_PANEL_MODE === true}">

                  <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

                  <!-- table-responsive -->
                  <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive"
                    [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th colspan="2" [ngClass]="{'grey-background' : CHAT_PANEL_MODE === true}">
                            <span style="color: #566787"
                              [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                              {{ "UsersPage.User" | translate }}

                            </span>



                            <!-- --------------------------------------------------------------------------------------------------- -->
                            <!-- the table header if CHAT_PANEL_MODE === true (replace the label User abd the above modal subtitle) -->
                            <!-- --------------------------------------------------------------------------------------------------- -->
                            <span *ngIf="CHAT_PANEL_MODE === true" style="color: #566787">
                              <span *ngIf="actionInModal === 'reassign'">
                                <h4 style="font-weight:400"
                                  [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                  {{ "VisitorsPage.SelectTheUserToWhom" | translate }}
                                </h4>
                              </span>

                              <span *ngIf="actionInModal === 'invite'">
                                <h4 style="font-weight:400"
                                  [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                  {{ "VisitorsPage.InviteAnotherUserToServe" | translate }}
                                </h4>
                              </span>
                            </span>

                          </th>

                          <th *ngIf="CHAT_PANEL_MODE === false">
                            <span style="color: #566787">

                              {{ "Assignee" | translate }}

                            </span>
                          </th>

                          <th *ngIf="CHAT_PANEL_MODE === false">
                            <span style="color: #566787; white-space: nowrap;">
                              {{ "UserRole" | translate }}
                            </span>
                          </th>


                          <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                        </tr>
                      </thead>
                      <tbody>


                        <!-- ----------------------------------------------------------------------------- -->
                        <!-- Project users for -->
                        <!-- ----------------------------------------------------------------------------- -->
                        <tr *ngFor="let projectUser of projectUsersList;" class="table-row">

                          <td style="width: 25px; cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">

                            <!-- --------------------------------------- -->
                            <!-- Usecase  Firebase -->
                            <!-- --------------------------------------- -->
                            <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                              [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{projectUser?.id_user?._id}}%2Fphoto.jpg?alt=media"
                              onerror="this.src='assets/img/no_image_user.png'" />

                            <!-- --------------------------------------- -->
                            <!-- Usecase  Native -->
                            <!-- --------------------------------------- -->
                            <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                              [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="{{baseUrl}}images?path=uploads%2Fusers%2F{{projectUser?.id_user?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                              onerror="this.src='assets/img/no_image_user.png'" />


                            <div class="ws_request_msgs__status-icon" [ngClass]="{
                                      'is-user-online' : projectUser?.user_available === true && (projectUser?.profileStatus === '' || !projectUser?.profileStatus), 
                                      'is-user-offline' : projectUser?.user_available === false && (projectUser?.profileStatus === '' || !projectUser?.profileStatus),
                                      'is-user-inactive': projectUser?.user_available === false && projectUser?.profileStatus === 'inactive',
                                      'ws_request_msgs__status-icon-chat-panel-mode' : CHAT_PANEL_MODE === true
                                     }">
                            </div>
                          </td>

                          <td style="cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                            <p style="font-size:14px; font-weight: 500; margin-bottom: 0px;">
                              {{ projectUser?.id_user?.firstname }}
                              <span style="text-transform: uppercase">
                                {{ projectUser?.id_user?.lastname }}
                              </span>

                              <!-- --------------------------------------------------- -->
                              <!-- user role in CHAT_PANEL_MODE x Project Users -->
                              <!-- --------------------------------------------------- -->
                              <span *ngIf="CHAT_PANEL_MODE === true"
                                style="color: #7695a5; line-height:18px; font-size:12px;">
                                <span style="font-weight: 200;"> ({{ projectUser?.role | translate}}) </span>
                              </span>
                            </p>
                            <span style="color: #7695a5; line-height:18px; font-size:12px; text-transform: lowercase;">
                              <span style="font-weight: 400;"> {{ projectUser?.id_user?.email }} </span>
                            </span>

                            <!-- --------------------------------------------------- -->
                            <!-- icon 'done' in CHAT_PANEL_MODE x Project Users -->
                            <!-- --------------------------------------------------- -->
                            <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                              <div style="position: absolute; top: -33px; right: 0;"
                                *ngIf="projectUser?.is_joined_to_request === true">
                                <i class="material-icons" style="color: #73AF55;">
                                  done
                                </i>
                              </div>
                            </div>
                          </td>

                          <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                            <div *ngIf="projectUser?.is_joined_to_request === true">
                              <i class="material-icons" style="margin-left: 14px;color: #73AF55;">
                                done
                              </i>
                            </div>

                          </td>

                          <!-- *ngIf="projectUser?.id_user._id !== currentUserID" -->
                          <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                            {{ projectUser?.role | translate}}
                          </td>


                          <!-- ------------------------------------------------------ -->
                          <!-- column displayed on the over -->
                          <!-- ------------------------------------------------------ -->
                          <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer;"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                            <!-- <span class="tooltipx"> -->
                            <div class="assign-request">
                              <!-- <i class="material-icons" style="cursor: pointer">
                            swap_horiz
                          </i> -->
                              <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                <span *ngIf="actionInModal === 'reassign'">
                                  {{ 'VisitorsPage.ReassignTo' | translate}}
                                </span>
                                <span *ngIf="actionInModal === 'invite'">
                                  {{ 'VisitorsPage.AssignTo' | translate}}
                                </span>
                              </p>
                              <span
                                style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px; text-transform: lowercase;">
                                {{ projectUser?.id_user?.email }}
                              </span>
                            </div>

                          </td>
                        </tr>


                        <!-- ----------------------------------------------------------------------------- -->
                        <!-- Bots for -->
                        <!-- ----------------------------------------------------------------------------- -->
                        <ng-container *ngIf="actionInModal === 'reassign'">
                          <tr *ngFor="let bot of bots;" class="table-row">

                            <td style="width: 25px; cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">

                              <!-- --------------------------------------- -->
                              <!-- Usecase Firebase (bot) -->
                              <!-- --------------------------------------- -->
                              <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                                [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{bot?._id}}%2Fphoto.jpg?alt=media"
                                onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />

                              <!-- --------------------------------------- -->
                              <!-- Usecase Native (bot) -->
                              <!-- --------------------------------------- -->
                              <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                                [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                src="{{baseUrl}}images?path=uploads%2Fusers%2F{{bot?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />


                              <span *ngIf="bot.type === 'internal'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/tiledesk_logo_no_text.png" />
                              </span>

                              <span *ngIf="bot.type === 'external'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/external_bot_logo.png" />
                              </span>

                              <span *ngIf="bot.type === 'dialogflow'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/Dialogflow_logo_no_text.png" />
                              </span>

                              <span *ngIf="bot.type === 'rasa'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/rasa_bot_logo.png" />
                              </span>


                              <span *ngIf="bot.type === 'tilebot'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/tilebot_logo_small.png" />
                              </span>
                              <!-- <span *ngIf="bot.type === 'tiledesk-ai'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/tiledesk-ai-logo.png" />
                              </span> -->
                            </td>
                            <!-- line-height:10px; -->
                            <td style="cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">
                              <p style="font-size:14px; font-weight: 500; margin-bottom: 0px;">
                                {{ bot?.name }}

                                <!-- --------------------------------------------------- -->
                                <!-- string in CHAT_PANEL_MODE x Project Users -->
                                <!-- --------------------------------------------------- -->
                                <span *ngIf="CHAT_PANEL_MODE === true"
                                  style="color: #7695a5; line-height:18px; font-size:12px;">
                                  <span style="font-weight: 200;"> (Bot) </span>
                                </span>

                              </p>
                              <span style="color: #7695a5; line-height:18px; font-size:12px">
                                {{ 'Type' | translate }}:
                                <span style="text-transform: capitalize;font-weight: 400; ">
                                  <span *ngIf="bot.type !== 'internal'">
                                    {{ bot?.type }}
                                  </span>
                                  <span *ngIf="bot.type === 'internal'">
                                    Resolution
                                  </span>
                                </span>
                              </span>

                              <!-- --------------------------------------------------- -->
                              <!-- icon 'done' in CHAT_PANEL_MODE x Bot -->
                              <!-- --------------------------------------------------- -->
                              <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                                <div style="position: absolute; top: -33px; right: 0;"
                                  *ngIf="bot?._id === bot_participant_id">
                                  <i class="material-icons" style="color: #73AF55;">
                                    done
                                  </i>
                                </div>
                              </div>

                            </td>

                            <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                              (click)="selectBot(bot?._id, bot?.name)">
                              <div *ngIf="bot?._id === bot_participant_id">
                                <i class="material-icons" style="margin-left: 14px;color: #73AF55;">
                                  done
                                </i>
                              </div>
                            </td>

                            <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                              (click)="selectBot(bot?._id, bot?.name)">
                              Bot
                            </td>


                            <!-- ------------------------------------------------------ -->
                            <!-- column displayed on the over -->
                            <!-- ------------------------------------------------------ -->
                            <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer"
                              (click)="selectBot(bot?._id, bot?.name)">
                              <div class="assign-request">
                                <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                  <span *ngIf="actionInModal === 'reassign'">
                                    {{ 'VisitorsPage.ReassignTo' | translate}}
                                  </span>
                                  <span *ngIf="actionInModal === 'invite'">
                                    {{ 'VisitorsPage.AssignTo' | translate}}
                                  </span>
                                </p>
                                <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                                  {{ bot?.name }} (bot)
                                </span>
                              </div>
                            </td>
                          </tr>
                        </ng-container>

                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <!-- ------------------------------------------------------------------------------ -->
              <!-- Reassign to a dept -->
              <!-- ------------------------------------------------------------------------------ -->
              <section *ngIf="actionInModal === 'reassign' && departments?.length > 1">

                <!-- -------------------------------------- -->
                <!-- modal subtitle -->
                <!-- -------------------------------------- -->
                <div class="col-md-12" *ngIf="CHAT_PANEL_MODE === false">
                  <span>
                    <h4 style="font-weight:400">
                      {{ "VisitorsPage.SelectTheDeptsToWhom" | translate }}
                    </h4>
                  </span>
                </div>
                <div class="col-md-12" [ngClass]="{'no-padding' : CHAT_PANEL_MODE === true}">

                  <div class="card" style="margin-top:5px; margin-bottom:5px"
                    [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                    <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>
                    <!-- table-responsive -->
                    <div *ngIf="!showSpinner_inModalUserList" class="card-content"
                      [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th colspan="2" [ngClass]="{'grey-background' : CHAT_PANEL_MODE === true}">
                              <span style="color: #566787"
                                [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                                {{ "Department" | translate }}

                              </span>


                              <!-- ------------------------------------------------------------------------------------------------ -->
                              <!-- the table header if CHAT_PANEL_MODE === true (replace Department abd the above modal subtitle) -->
                              <!-- ------------------------------------------------------------------------------------------------ -->
                              <span *ngIf="CHAT_PANEL_MODE === true">
                                <h4 style="font-weight:400"
                                  [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                  {{ "VisitorsPage.SelectTheDeptsToWhom" | translate }}
                                </h4>
                              </span>
                            </th>

                            <th *ngIf="CHAT_PANEL_MODE === false">
                              <span style="color: #566787">

                                {{ "Assignee" | translate }}

                              </span>
                            </th>

                            <th *ngIf="CHAT_PANEL_MODE === false">
                              <span style="color: #566787">

                                {{ "Agents" | translate }}

                              </span>
                            </th>

                            <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                          </tr>
                        </thead>
                        <tbody>

                          <tr *ngFor="let dept of departments;" class="table-row">
                            <!-- *ngIf="dept.default === false" -->
                            <ng-container>
                              <!-- *ngIf="CHAT_PANEL_MODE === false" -->
                              <td style="cursor:pointer; width:1%;"
                                [ngClass]="{'top-alignment' : CHAT_PANEL_MODE === true}"
                                (click)="selectDept(dept?.name, dept?._id)">
                                <div class="dept---avatar-in-modal"
                                  [ngStyle]="{'background-color': dept?.dept_name_fillcolour, 'margin-top':  (CHAT_PANEL_MODE === true ) ? '5px' : '' }">
                                  {{ dept?.dept_name_initial }}


                                  <span class="default-dept-disabled-badge-in-modal"
                                    *ngIf="dept?.default === true && COUNT_OF_VISIBLE_DEPT > 0">
                                    <span class="tool_tip">
                                      <span class="material-icons">
                                        unpublished
                                      </span>
                                      <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                        <h4 style="font-weight:400"> Default Department {{ 'Disabled' | translate }}
                                        </h4>
                                        <!-- {{'TheDefaulDeptIsDisabledBecause' | translate}} -->
                                        {{'TheDefaulDeptIsDisabledBecause_2' | translate}}
                                        <i></i>
                                      </span>
                                    </span>
                                  </span>


                                  <span class="default-dept-active-badge-in-modal"
                                    *ngIf="dept?.default === true && COUNT_OF_VISIBLE_DEPT === 0">
                                    <span class="tool_tip">
                                      <span class="material-icons">
                                        check_circle
                                      </span>
                                      <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                        <h4 style="font-weight:400"> Default Department {{ 'Enabled' | translate }}
                                        </h4>
                                        <!-- {{'TheDefaulDeptIsEnabledBecause' | translate}} -->
                                        {{'TheDefaulDeptIsEnabledBecause_2' | translate}}
                                        <i></i>
                                      </span>
                                    </span>
                                  </span>

                                  <!-- // visible / not visible -->
                                  <span class="dept-not-visible-badge-in-modal"
                                    *ngIf="dept?.default !== true  && dept?.status === 0">
                                    <span class="tool_tip">
                                      <span class="material-icons" style="height: 13px;width: 15px;">
                                        visibility_off

                                      </span>
                                      <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                        <h4 style="font-weight:400">
                                          {{dept?.name}} {{ 'IsSetToNotVisible' | translate}}
                                        </h4>

                                        <i></i>
                                      </span>
                                    </span>
                                  </span>


                                  <span class="dept-visible-badge-in-modal"
                                    *ngIf="dept?.default !== true && dept?.status === 1">
                                    <span class="tool_tip">
                                      <span class="material-icons" style="height: 13px;width: 15px;">
                                        visibility
                                      </span>
                                      <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                        <h4 style="font-weight:400"> {{dept?.name}} {{ 'IsSetToVisible' | translate }}
                                        </h4>

                                        <i></i>
                                      </span>
                                    </span>
                                  </span>
                                </div>
                              </td>

                              <td style="cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">
                                <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;"
                                  [ngStyle]="{'line-height':  (CHAT_PANEL_MODE === true ) ? '14px' : '' }">

                                  <span class="dept---name" style="display: block;"
                                    [ngClass]="{'dept---name-in-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                    {{ dept?.name }}
                                  </span>

                                  <span class="dept---routing-wpr"
                                    style="color: #7695a5; font-size: 12px; display: block;">
                                    <span style="font-weight:100;">
                                      Routing:
                                    </span>
                                    {{ dept?.routing }}
                                  </span>


                                  <span *ngIf="CHAT_PANEL_MODE === true">
                                    <span *ngIf="dept?.hasGroupName && !dept?.groupHasBeenTrashed">
                                      <span style="color: #7695a5; font-size: 12px; font-weight:100">
                                        {{ 'DepartmentsPage.Group' | translate }}
                                      </span>
                                      <span [ngClass]="{'group-name' : CHAT_PANEL_MODE === true}" class="">
                                        {{ dept?.hasGroupName}}
                                      </span>
                                    </span>
                                    <span *ngIf="dept?.hasGroupName && dept?.groupHasBeenTrashed === true">
                                      <span style="vertical-align: middle;"> {{ dept?.hasGroupName }} </span>
                                      <i class="material-icons"
                                        style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                      <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                        {{ 'DepartmentsPage.TheGroupHasBeenTrashed' | translate }}
                                      </span>
                                    </span>

                                    <span *ngIf="!dept?.hasGroupName" style="font-size:12px; color: #7695a5">
                                      {{ 'DepartmentsPage.AllUsers' | translate }}
                                    </span>

                                    <span *ngIf="dept?.id_bot" style="display: block;">
                                      <span style="color: #7695a5; font-size: 12px; font-weight:100">
                                        Bot:
                                        <!-- {{ 'DepartmentsPage.ActivatedBot' | translate }} -->
                                      </span>

                                      <span *ngIf="dept?.hasBot === true"
                                        style="font-size:12px; font-weight:400; color: #7695a5">
                                        {{ dept?.hasBotName }}
                                      </span>
                                      <span *ngIf="dept?.hasBot === false"
                                        style="font-size:12px; font-weight:400; color: #bdbdbd;  font-style: italic;">
                                        no bot
                                      </span>
                                      <span *ngIf="dept.bot_only == true"
                                        style="font-size: 12px; color: #7695a5; font-weight: 400">
                                        {{ 'DepartmentsPage.OnlyBot' | translate }}
                                      </span>
                                      <span *ngIf="dept.botHasBeenTrashed == true">
                                        <i class="material-icons"
                                          style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                        <span style="color: #ff5252; vertical-align: middle; font-size:12px;">{{
                                          'BotsPage.TheBotHasBeenTrashed' | translate }}
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </p>
                                <!-- --------------------------------------------------- -->
                                <!-- icon 'done' in CHAT_PANEL_MODE x DEPTS -->
                                <!-- --------------------------------------------------- -->
                                <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                                  <div style="position: absolute; top: -43px; right: 0;"
                                    *ngIf="request?.department?._id === dept?._id">
                                    <i class="material-icons" style="color: #73AF55;">
                                      done
                                    </i>
                                  </div>
                                </div>
                              </td>

                              <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                                (click)="selectDept(dept?.name, dept?._id)">
                                <div *ngIf="request?.department?._id === dept?._id">
                                  <i class="material-icons" style="margin-left: 14px; color: #73AF55;">
                                    done
                                  </i>
                                </div>
                              </td>


                              <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                                (click)="selectDept(dept?.name, dept?._id)">
                                <span *ngIf="dept?.hasGroupName && !dept?.groupHasBeenTrashed">
                                  <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                    {{ 'DepartmentsPage.Group' | translate }}
                                  </span>
                                  {{ dept?.hasGroupName}}
                                </span>
                                <span *ngIf="dept?.hasGroupName && dept?.groupHasBeenTrashed === true">

                                  <span style="vertical-align: middle;"> {{ dept?.hasGroupName }} </span>
                                  <i class="material-icons"
                                    style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                  <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                    {{ 'DepartmentsPage.TheGroupHasBeenTrashed' | translate }}
                                  </span>
                                </span>

                                <span *ngIf="!dept?.hasGroupName" style="font-size:13px">
                                  {{ 'DepartmentsPage.AllUsers' | translate }}
                                </span>

                                <span *ngIf="dept?.id_bot" style="display: block;">
                                  <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                    Bot:
                                    <!-- {{ 'DepartmentsPage.ActivatedBot' | translate }} -->
                                  </span>

                                  <span *ngIf="dept?.hasBot === true" style="font-size:13px; font-weight:400">
                                    {{ dept?.hasBotName }}
                                  </span>
                                  <span *ngIf="dept?.hasBot === false"
                                    style="font-size:13px; font-weight:400;color: #bdbdbd;font-style: italic;">
                                    {{ 'DepartmentsPage.NoBotActivated' | translate }}
                                  </span>
                                  <span *ngIf="dept.bot_only == true"
                                    style="font-size: 12px; color: #7695a5; font-weight: 400">
                                    {{ 'DepartmentsPage.OnlyBot' | translate }}
                                  </span>
                                  <span *ngIf="dept.botHasBeenTrashed == true">
                                    <i class="material-icons"
                                      style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                    <span style="color: #ff5252; vertical-align: middle; font-size:12px;">{{
                                      'BotsPage.TheBotHasBeenTrashed' | translate }}
                                    </span>
                                  </span>
                                </span>

                              </td>

                              <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer"
                                (click)="selectDept(dept?.name, dept?._id)">
                                <div class="assign-request">
                                  <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                    {{ 'ReassignToDept' | translate}}
                                  </p>
                                  <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                                    {{ dept?.name }}
                                  </span>
                                </div>
                              </td>
                            </ng-container>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </section>

              <!-- ----------------------------- depts ------------------------------------------------- -->
            </div>

          </div> <!-- /. modal-body -->

          <!-- <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="onCloseUsersListModalHandler()" style="padding:12px 16px;">
            {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div> -->
        </div> <!-- /.modal-content -->
      </div> <!-- /.modal-dialog -->
    </div>
    <!-- ./ USERS - BOTS - DEPTS LIST MODAL - FULL WIDTH MODAL -->

    <!-- ---------------------------------- -->
    <!-- LEAVE CHAT MODAL  -->
    <!-- ---------------------------------- -->
    <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayLeaveChatModal}"
      style="background-color: rgba(90,90,90,0.5);">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <!-- background-color:#ff5252; -->
          <div class="modal-header" style="padding-bottom:15px">
            <button type="button" class="close" aria-label="Close" (click)="closeLeaveChatModal()">
              <!-- color: #fff -->
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" style="color: #f44336">
              <i class="material-icons" style="vertical-align: middle">info</i>
              <span style="vertical-align: middle; padding-left:8px">
                {{ "VisitorsPage.LeaveChat" | translate }}
              </span>
            </h4>
          </div>
          <div class="modal-body">
            <p style="font-weight:400; text-align: left; margin-top: 10px; color: #566787">

              {{ "VisitorsPage.AreYouSureLeftTheChat" | translate }} <br>
            </p>

          </div>
          <div class="modal-footer" style="margin-top: 0px;">
            <button class="btn btn-white" (click)="closeLeaveChatModal()" style="padding:12px 16px;">

              <!-- {{ "VisitorsPage.Cancel" | translate }} -->
              {{ "Cancel" | translate }}
            </button>
            <button style="margin-top:0px" class="btn btn-danger" (click)="leaveChat()" style="padding:12px 16px;">
              <!-- Archivia Richiesta -->
              {{ "VisitorsPage.LeaveChat" | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- -------------------------------------------------- -->
    <!--  INFO MODAL: LEAVING CHAT IN PROGRESS  -->
    <!-- -------------------------------------------------- -->
    <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayLeavingChatInfoModal}"
      style="background-color: rgba(90,90,90,0.5);">
      <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" aria-label="Close" (click)="closeLeavingChatInfoModal()">
              <span aria-hidden="true">&times;</span>
            </button>

            <h4 class="modal-title">
              {{ "VisitorsPage.LeaveChat" | translate }}

            </h4>
          </div>

          <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px">

            <span *ngIf="SHOW_CIRCULAR_SPINNER">
              <div class="loader" style="top:25%;">
                <svg class="circular" viewBox="25 25 50 50">
                  <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10" />
                </svg>

              </div>
              <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
                {{ "Processing" | translate }}
              </p>
            </span>

            <span *ngIf="!SHOW_CIRCULAR_SPINNER && !LEAVE_CHAT_ERROR ">

              <div style="text-align: center">
                <i class="material-icons" style="color:#70b665">done</i>
                <p style="color:#70b665; font-weight: 500">
                  {{ "VisitorsPage.Completed" | translate }}
                </p>

              </div>
              <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
                {{ "VisitorsPage.ChatLeft" | translate }}
              </p>
            </span>

            <!-- IF THERE IS AN ERROR -->
            <span *ngIf="!SHOW_CIRCULAR_SPINNER && LEAVE_CHAT_ERROR">

              <div style="text-align: center ">
                <i class="material-icons" style="color:#ff5252">report_problem</i>
                <p style="color:#ff5252; font-weight: 500">
                  <!-- {{ "VisitorsPage.Error" | translate }} -->
                  {{ "Error" | translate }}
                </p>

              </div>
              <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
                {{ "VisitorsPage.AnErrorHasOccurredLeavingTheChat" | translate }}
              </p>
            </span>
          </div>

          <div class="modal-footer" style="text-align: center;">
            <button class="btn btn-primary" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="closeLeavingChatInfoModal()"
              style="padding:12px 16px;">
              {{ "VisitorsPage.Continue" | translate }}
            </button>
          </div>

        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>

    <!-- ----------------------------------------------------------------------------- -->
    <!-- @ Trancript modal  -->
    <!-- ----------------------------------------------------------------------------- -->
    <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayModalTranscript}"
      style="background-color: rgba(90,90,90,0.9);">
      <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-top-left-radius:6px; border-top-right-radius:6px">
          <div class="modal-header" style=" border-bottom:none!important;">

            <button type="button" class="close" aria-label="Close" (click)="closeModalTranscript()"
              style="position: absolute; right: 14px;top: 16px;">
              <span aria-hidden="true">
                <!-- &times; -->
                <svg class="tide-icon" width="24" height="24" viewBox="0 0 24 24">
                  <path
                    d="M13.357 11.993l10.256 10.295c0.39 0.391 0.39 1.024 0 1.415-0.194 0.195-0.449 0.292-0.704 0.292s-0.51-0.097-0.705-0.292l-10.257-10.295-10.256 10.295c-0.194 0.195-0.449 0.292-0.704 0.292s-0.51-0.097-0.705-0.292c-0.39-0.391-0.39-1.024 0-1.415l10.256-10.295-10.256-10.294c-0.39-0.391-0.39-1.024 0-1.415s1.020-0.391 1.409 0l10.256 10.294 10.256-10.294c0.39-0.391 1.020-0.391 1.41 0 0.389 0.391 0.389 1.024 0 1.415l-10.256 10.294z">
                  </path>
                </svg>
              </span>
            </button>

            <h2 class="modal-title custom__modal__title">
              <span style="vertical-align: middle;">
                Transcript
              </span>
            </h2>

          </div>
          <hr class="custom-hr" style="margin-top:0px; margin-bottom:3px">
          <div class="modal-body"
            style="padding-top: 0px; padding-bottom: 0px; padding-right: 34px; padding-left: 34px; line-height: 1;text-align: center;">

            <h4><span class="custom-link" (click)="openTranscriptAsHtml()">View the chat transcript in a new tab
              </span> or download it as a:</h4>
            <div class="radio">
              <label style="color: #222;">
                <input type="radio" name="downloadType" value="PDF"
                  (change)="onChangeTranscriptDownloadPreference($event.target.value)">
                PDF
              </label>
            </div>

            <div class="radio">
              <label style="color: #222;">
                <input type="radio" name="downloadType" value="CSV"
                  (change)="onChangeTranscriptDownloadPreference($event.target.value)">
                CSV
              </label>
            </div>

            <!-- <div class="radio" style="margin-left: 7px;" >
              <label style="color: #222;">
                <input type="radio" name="downloadType" value="TEXT"
                (change)="onChangeTranscriptDownloadPreference($event.target.value)">
                TEXT
              </label>
            </div> -->
          </div>

          <div class="modal-footer transcript__modal__footer">
            <div style="text-align: center; margin-bottom: 15px;">

              <button style="padding-left: 24px; padding-right: 24px;" type="button" class="btn btn-white"
                (click)="closeModalTranscript()">
                {{ "Cancel" | translate }}
              </button>

              <button style="padding-left: 24px; padding-right: 24px;" type="button" class="btn btn-primary"
                (click)="downloadTranscript()" [disabled]="!transcriptDwnldPreference">
                {{ "download" | translate }}
              </button>

            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- ----- -->


    <div *ngIf="OPEN_RIGHT_SIDEBAR === true" class="view-side">
      <appdashboard-ws-train-bot [ngStyle]="{'height':train_bot_sidebar_height }" [selectedQuestion]="selectedQuestion"
        (valueChange)='handleCloseRightSidebar($event)'>
      </appdashboard-ws-train-bot>
    </div>

    <!-- [ngStyle]="{'height':apps_sidebar_height }" -->
    <div *ngIf="OPEN_APPS_RIGHT_SIDEBAR === true" class="view-side">
      <appdashboard-ws-sidebar-apps [ngClass]="{'min-height-in-panel-mode': CHAT_PANEL_MODE === true}"
        (valueChange)='handleCloseAppsRightSidebar($event)' [request]="request"
        [apps_sidebar_height]="apps_sidebar_height">
      </appdashboard-ws-sidebar-apps>
    </div>

    <div *ngIf="OPEN_MAP_RIGHT_SIDEBAR === true" class="view-side">
      <appdashboard-map-request [ngStyle]="{'height': conv_detail_map_sidebar_height }"
        [wsRequestsServed]="wsRequestsServed" [wsRequestsUnserved]="wsRequestsUnserved" [calling_page]="calling_page"
        (closeMapsView)='handleCloseMapRightSidebar($event)'>
      </appdashboard-map-request>
    </div>