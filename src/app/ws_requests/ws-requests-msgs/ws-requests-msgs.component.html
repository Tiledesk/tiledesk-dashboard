<!-- Navbar brand for Chrome, Firefox ... -->
<div #navbarBrand *ngIf="CHAT_PANEL_MODE === false && !isSafari" class="navbar-brand"
  style="z-index: 1050;position: relative; padding-left:30px"
  [ngStyle]="{'margin-top':isChromeVerGreaterThan100 === true ? '-64px' : '6px' }">
  <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;"
    (click)="goBack()">keyboard_arrow_left</i>
  {{ "RequestMsgsPage.RequestDetails" | translate }}
</div>

<!-- Navbar brand for Safari -->
<div #navbarBrand *ngIf="CHAT_PANEL_MODE === false && isSafari" class="navbar-brand"
  style="z-index: 1050;position: absolute; padding-left:30px; top:6px">
  <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;"
    (click)="goBack()">keyboard_arrow_left</i>
  {{ "RequestMsgsPage.RequestDetails" | translate }}
</div>

<div id="conversation-detail-main-content" class="main-content" style="padding-top:0px"
  [ngClass]="{'main-content-chat-panel-mode' : CHAT_PANEL_MODE === true, 'main-content-normal-mode': CHAT_PANEL_MODE === false}">
  <div class="container-fluid" [ngClass]="{'container-fluid-no-padding' : CHAT_PANEL_MODE === true}">

    <!-- <loading-spinner *ngIf="showSpinner"></loading-spinner>
    *ngIf="!showSpinner" -->

    <div>
      <div class="row">
        <div class="col-sm-7 chat-col"
          [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true, 'chat-col-normal-mode': CHAT_PANEL_MODE === false }">
          <div class="card chat-card" [ngClass]="{'chat-card-normal-mode': CHAT_PANEL_MODE === false}"
            style="padding-top:0px; padding-bottom:0px;">
            <div class="row" style="padding-left:25px; padding-right:25px" *ngIf="CURRENT_USER_ROLE !== 'agent'">
              <div class="col-sm-12" style="border-bottom: 1px solid #e5effe; height: 59px; padding-right: 0px;">
                <div class="two-div-wrapper">
                  <div style="float: left; width: 30%; height: 59px;">

                  </div>

                  <div style="float: right; width: 70%; height: 59px;">



                    <!-- ---------------------------------------- -->
                    <!-- Open the chat -->
                    <!-- ---------------------------------------- -->
                    <div class="chat-header-wpr-open-chat-btn"
                      *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                      <!-- [ngClass]="{'disable_open_the_chat_btn' : request?.status == 1000}" -->
                      <div class="chat-header-wpr-btn">
                        <button #openChatBtn (click)="openChatAtSelectedConversation()"
                          class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right" role="button"
                          matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'ThisConversationIsAssignedToYou' | translate }}" #tooltip="matTooltip"
                          matTooltipPosition='below' matTooltipHideDelay="100">
                          <i class="material-icons"
                            style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">open_in_new</i>
                          <span style="vertical-align: middle"> {{ 'OpenChat' | translate }}</span>
                        </button>
                      </div>
                    </div>

                    <!-- ---------------------------------------- -->
                    <!-- Join to chat -->
                    <!-- ---------------------------------------- -->
                    <div class=" chat-header-wpr-join-chat-btn"
                      *ngIf="JOIN_TO_GROUP_HAS_ERROR === false && IS_CURRENT_USER_JOINED === false  && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">
                      <div class="chat-header-wpr-btn">
                        <button class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right" (click)="onJoinHandled()"
                          [disabled]="request?.status == 1000" role="button" matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'ThisConversationIsNotAssignedToYou' | translate }}" #tooltip="matTooltip"
                          matTooltipPosition='below' matTooltipHideDelay="100">
                          <i class="material-icons"
                            style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">login</i>
                          <span style="vertical-align: middle"> {{ 'RequestMsgsPage.Enter' | translate }} </span>
                        </button>
                      </div>
                    </div>

                    <!-- ---------------------------------------- -->
                    <!-- Loading w-100-->
                    <!-- ---------------------------------------- -->
                    <div class="chat-header-wpr-loadin-chat-btn" style="height: 62px;" *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true 
                    && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  
                    && JOIN_TO_GROUP_HAS_ERROR === false">
                      <div class="chat-header-wpr-btn">
                        <button class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right">
                          <i class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i>
                          {{ 'RequestMsgsPage.Loading' | translate }}
                        </button>
                      </div>
                    </div>

                    <!-- ---------------------------------------- -->
                    <!-- Error w-100 -->
                    <!-- ---------------------------------------- -->
                    <div class="chat-header-wpr-error-chat-btn" style="height: 62px;"
                      *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">

                      <div class="chat-header-wpr-btn">
                        <button class="btn btn-danger chat-header-btn plr-8 ptb-8 pull-right" disabled>
                          {{ 'Error' | translate }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- <loading-spinner *ngIf="showSpinner"></loading-spinner> -->

            <div *ngIf="showSpinner" class="stretchspinner">
              <div class="rect1"></div>
              <div class="rect2"></div>
              <div class="rect3"></div>
              <div class="rect4"></div>
              <div class="rect5"></div>
            </div>



            <div #scrollMe id="chat-wpr" class="card-content" (scroll)="onScrollMsgs($event)">
              <div *ngIf="!showSpinner" class="chat-body" style="vertical-align:baseline;">

                <!-- style="padding-bottom: 3px;" class="answer left" -->
                <div *ngFor="let message of messagesList">

                  <!-- ////// INFO MSG -->
                  <!-- requester_id: {{requester_id}} message_sender {{message.sender}} type
                      {{message?.attributes?.subtype}} rext {{ message?.text }} -->
                  <div
                    *ngIf="message?.attributes?.subtype === 'info' || message?.attributes?.subtype === 'info/support'"
                    style="padding:12px 55px; text-align:center">
                    <div>
                      <div class="txt">
                        <!-- -------------------------------------------------------------- -->
                        <!-- first combination: | marked | sanitizeHtml -->
                        <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                        <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                        <!-- -------------------------------------------------------------- -->
                        <!-- <p *ngIf="message?.type === 'text'" class="type-info-msg-text"
                          [innerHTML]="message?.text | htmlEntitiesEncode | marked">
                          {{ message?.createdAt | amDateFormat: 'LL'}} 
                        </p> -->

                        <p *ngIf="message?.type === 'text'" class="type-info-msg-text">
                          {{ message?.text }}
                          <span style=" color: rgba(43 ,43,43, .8);font-size: 11px;">
                            ({{ message?.createdAt | amDateFormat: 'LLL'}})
                          </span>
                        </p>

                      </div>

                    </div>
                  </div>


                  <div class="parent"
                    *ngIf="message?.attributes?.subtype !== 'info' && message?.attributes?.subtype !== 'info/support'">
                    <div [ngClass]="{'child' : requester_id !== message.sender}">
                      <div class="speech-wrapper">
                        <!-- ////// REQUESTER -->
                        <!-- requester_id: {{requester_id}} message_sender {{message.sender}} type
                      {{message?.attributes?.subtype}} -->
                        <!-- [ngStyle]="{'background-color': fillColour }" -->
                        <div *ngIf="requester_id === message.sender && message?.attributes?.subtype !== 'info'"
                          class="bubble">
                          <div class="avatar"
                            style="  width: 35px; height: 35px; position: absolute; left: -50px; bottom: 36px;">
                            <div class="requester-avatar-wrapper"
                              style="display: block;border-radius: 50%; height: 100%; margin-top: 35px;"
                              [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + fillColour + ')'}">
                              <span class="_requester-avatar-inchat">
                                {{ requester_fullname_initial }}
                              </span>
                            </div>
                          </div>

                          <div class="txt">

                            <p class="name" [ngStyle]="{'color': fillColour }">
                              {{ message.senderFullname }}
                            </p>

                            <ng-container *ngIf="resolutionBotCount > 0">
                              <!-- <p class="train-btn-wpr" *ngIf="message?.type === 'text' && !message?.metadata">
                                <span class="train-btn" (click)="openRightSideBar(message?.text)">
                                  {{ 'Train' | translate }}
                                </span>
                              </p> -->
                            </ng-container>
                            <!-- -------------------------------------------------------------- -->
                            <!-- first combination: | marked | sanitizeHtml -->
                            <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                            <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                            <!-- -------------------------------------------------------------- -->
                            <!-- && (!message.metadata && !message.metadata.type.includes('audio'))" -->
                            <p *ngIf="(message?.type === 'text' || message?.type === 'file')" class="message ow"
                              [innerHTML]="message?.text | htmlEntitiesEncode | marked ">
                            </p>
                            <!-- <ng-container *ngIf="message?.type === 'file' && message.metadata && message.metadata.type.includes('audio')">
                              <audio aria-label="audio-track" #audio_msg controls controlsList="nodownload"
                                id="audio_msg">
                                <source [src]="message.metadata?.src" [type]="message.metadata?.type">
                              </audio>
                            </ng-container> -->
                            <div *ngIf="message?.type === 'image'" class="message ow">
                              <!-- style="height:200px; width:200px;" -->
                              <div class="image-container" style="cursor:pointer"
                                (click)="openImageViewerModal(message?.metadata)">
                                <img src={{message.metadata.src}} class="message-img" />
                                <!-- message >   {{message | json}} -->
                                <p *ngIf="message?.text" [innerHTML]="message?.text | htmlEntitiesEncode | marked ">
                                </p>
                              </div>
                            </div>
                            <span class="timestamp">
                              {{ message?.createdAt | amDateFormat: 'LLL'}}
                              <!-- {{browserLang === 'en' ? (message?.createdAt | amDateFormat:'MMM DD YYYY (HH:mm:ss)') : (
                              message?.createdAt | amDateFormat:'DD MMM YYYY (HH:mm:ss)')}} -->
                            </span>
                          </div>
                          <div class="bubble-arrow"></div>
                        </div>

                        <!-- ------------------------------------------------------ -->
                        <!-- The sender is the agent - Speech Bubble alternative -->
                        <!-- ------------------------------------------------------ -->
                        <div *ngIf="requester_id !== message.sender && message?.attributes?.subtype !== 'info'"
                          class="bubble alt" [ngClass]="{'internal-note': message?.attributes?.subtype === 'private'}">
                          <!-- left: 254px; -->
                          <div class="avatar"
                            style="width: 35px; height: 35px; position: absolute; left: 365px; bottom: 36px;">
                            <div
                              style="display: block;border-radius: 50%; height: 100%; margin-top: 35px; background-color: #fff; border:1px solid #ebebeb;">
                              <!-- ------------------------------------------------ -->
                              <!-- USE CASE: human -->
                              <!-- ------------------------------------------------ -->
                              <!-- <span *ngIf="message?.sender !== 'system' && message?.senderFullname !== 'Bot'" style="position: absolute; top:43px; margin-left:13px;"> -->
                              <span
                                *ngIf="message?.sender !== 'system' && message?.sender.indexOf('bot_') === -1 && message?.attributes?.subtype !== 'info'"
                                style="position: absolute; top:43px; margin-left:13px;">
                                <!-- {{ messageSenderInitialLetter( message?.senderFullname )}} -->
                                <!-- {{ message?.sender }}{{  message?.senderFullname }} -->

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Firebase -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="user-img-in-msg-list"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{message?.sender}}%2Fphoto.jpg?alt=media"
                                  onerror="this.src='assets/img/no_image_user.png'" />

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Native  -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="user-img-in-msg-list"
                                  src="{{baseUrl}}images?path=uploads%2Fusers%2F{{message?.sender}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                  onerror="this.src='assets/img/no_image_user.png'" />
                              </span>

                              <!-- ------------------------------------------------ -->
                              <!-- USE CASE: bot -->
                              <!-- ------------------------------------------------ -->
                              <!-- <span *ngIf="message?.senderFullname === 'Bot'" style="position: absolute; top:43px; margin-left:13px;"> -->
                              <span
                                *ngIf="message?.sender.indexOf('bot_') !== -1 && message?.attributes?.subtype !== 'info'"
                                style="position: absolute; top:43px; margin-left:13px;">

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Firebase (bot) -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="bot-img-in-msg-list"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{message?.sender | slice:4 }}%2Fphoto.jpg?alt=media"
                                  onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />

                                <!-- --------------------------------------- -->
                                <!-- Usecase  Native (bot) -->
                                <!-- --------------------------------------- -->
                                <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="bot-img-in-msg-list"
                                  src="{{baseUrl}}images?path=uploads%2Fusers%2F{{message?.sender | slice:4}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                  onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />
                              </span>
                            </div>
                          </div>
                          <div class="txt">
                            <p class="name alt"
                              [ngClass]="{'internal-note-': message?.attributes?.subtype === 'private'}">
                              {{ message?.senderFullname }}
                            </p>
                            <!-- -------------------------------------------------------------- -->
                            <!-- first combination: | marked | sanitizeHtml -->
                            <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                            <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                            <!-- -------------------------------------------------------------- -->
                            <p *ngIf="message?.type === 'text' || message?.type === 'file'" class="message ow alt"
                              [ngClass]="{'internal-note-text-color': message?.attributes?.subtype === 'private'}"
                              [innerHTML]="message?.text | htmlEntitiesEncode | marked">

                            <div *ngIf="message?.type === 'image'" class="message ow alt">
                              <!-- style="height:200px; width:200px;" -->
                              <div class="image-container" style="cursor:pointer"
                                (click)="openImageViewerModal(message?.metadata)">
                                <img src={{message.metadata.src}} class="message-img" />

                                <p *ngIf="message?.text" [innerHTML]="message?.text | htmlEntitiesEncode | marked"></p>

                                <div *ngIf="message?.metadata?.type && !message?.metadata?.type?.startsWith('image')">
                                  <!-- -------------------------------------------------------------- -->
                                  <!-- first combination: | marked | sanitizeHtml -->
                                  <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                                  <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                                  <!-- -------------------------------------------------------------- -->
                                  <p [innerHTML]="message?.text | htmlEntitiesEncode | marked"></p>
                                </div>

                              </div>
                            </div>

                            <!-- // iframe -->
                            <div *ngIf="message?.type === 'frame'" class="message ow alt">
                              <!-- style="height:200px; width:200px;" -->
                              <div class="image-container">
                                <iframe allowfullscreen width="80%" height="80%" style="border:none;"
                                  [src]="message.metadata.src | sanitizeHtml" class="message-img"></iframe>


                                <!-- -------------------------------------------------------------- -->
                                <!-- first combination: | marked | sanitizeHtml -->
                                <!-- 2nd combination: | htmlEntitiesEncode | autolinker -->
                                <!-- 3rd combination (as in chat): | htmlEntitiesEncode  | marked -->
                                <!-- -------------------------------------------------------------- -->
                                <p [innerHTML]="message?.text | htmlEntitiesEncode | marked"></p>


                              </div>
                            </div>

                            <span class="timestamp">
                              {{ message?.createdAt | amDateFormat: 'LLL'}}
                              <!-- {{ message?.createdAt | date: 'd/M/y HH:mm:ss'}}
                              {{browserLang === 'en' ? (message?.createdAt | amDateFormat:'MMM DD YYYY (HH:mm:ss)') : (
                              message?.createdAt | amDateFormat:'DD MMM YYYY (HH:mm:ss)')}}-->
                            </span>
                          </div>
                          <div class="bubble-arrow alt"
                            [ngClass]="{'internal-note': message?.attributes?.subtype === 'private'}"></div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="card---footer" *ngIf="CURRENT_USER_ROLE !== 'agent'">
              <div class=" chat-btns-and-text-row-wpr" style="width: 100%; min-height: 69px;">

                <!-- nk new -->
                <div class="row chat-btns-and-text-row h-100 w-100">
                  <div class="col-xs-12 plr-0">
                    <div class="row w-100">
                      <div class="col-xs-12 h-100 plr-0">
                        <ng-select class="select-response-type" [clearable]="false" [searchable]="false"
                          [items]="responseType" bindLabel="name" bindValue="id" [(ngModel)]="selectedResponseTypeID"
                          (change)="onChangeReplyType(selectedResponseTypeID)">
                          <ng-template ng-label-tmp let-item="item">
                            <img height="15" width="15" style="width: 15px; height: auto; margin-right:3px "
                              [src]="item.icon" />
                            {{item.name}}
                          </ng-template>
                          <ng-template ng-option-tmp let-item="item" let-index="index">
                            <img height="15" width="15" style="width: 15px; height: auto;  margin-right:3px "
                              [src]="item.icon" />
                            {{item.name}}
                          </ng-template>
                        </ng-select>
                      </div>
                    </div>


                    <!-- ------------------------------------------------ -->
                    <!-- texarea send message  -->
                    <!-- ------------------------------------------------ -->
                    <div class="col-xs-12  w-100 plr-0">
                      <div class="row w-100">
                        <!-- margin-top: -4px; border-top: 2px solid #3ea9f5; -->
                        <div class="chat-msg-attachement" *ngIf="uploadedFiles">
                          <span *ngIf="showSpinnerAttachmentUplolad === true">
                            <i class="fa fa-spinner fa-spin"></i>
                          </span>
                          <span *ngIf="uploadedFiles?.type.startsWith('image')">
                            <i class="fa fa-file-image-o" aria-hidden="true"></i>
                          </span>
                          <span *ngIf="!uploadedFiles?.type.startsWith('image')">
                            <i class="fa fa-file-o" aria-hidden="true"></i>
                          </span>
                          {{uploadedFiles?.name }} ({{uploadedFiles?.formattedBytes }})
                          <span *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="remove-attachment"
                            (click)="removeAttachment(uploadedFiles?.downloadURL, uploadedFiles?.name)">
                            <span class="material-icons">
                              clear
                            </span>
                          </span>
                        </div>
                        <div class="col-xs-12 h-100 plr-0" style="  margin-bottom: 8px;height:46px"
                          [ngStyle]="{'background-color': selectedResponseTypeID === 2 ? 'rgb(255, 247, 237)' : '#fff' }">
                          <textarea #sendMessageTexarea class="send-message-texarea" [(ngModel)]="chat_message" rows="1"
                            placeholder="Write your message" (keydown.enter)="onKeydownEnter($event)"
                            (paste)="onPasteInSendMsg($event)"
                            (ngModelChange)="onChangeTextInSendMsg($event)">  </textarea>


                          <!-- <div class="chat-msg-attachement" *ngIf="uploadedFiles">
                            <span *ngIf="showSpinnerAttachmentUplolad === true">
                              <i class="fa fa-spinner fa-spin"></i>
                            </span>
                            <span *ngIf="uploadedFiles?.type.startsWith('image')">
                              <i class="fa fa-file-image-o" aria-hidden="true"></i>
                            </span>
                            <span *ngIf="!uploadedFiles?.type.startsWith('image')">
                              <i class="fa fa-file-o" aria-hidden="true"></i>
                            </span>
                            {{uploadedFiles?.name }} ({{uploadedFiles?.formattedBytes }})
                            <span *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="remove-attachment"
                              (click)="removeAttachment(uploadedFiles?.downloadURL, uploadedFiles?.name)">
                              <span class="material-icons">
                                clear
                              </span>
                            </span>
                          </div> -->

                        </div>
                      </div>
                    </div>

                    <div class="col-xs-12  w-100 plr-0">
                      <div class="row w-100">

                        <div class="col-xs-12 h-100 plr-0" style="margin-top: -4px;position: relative;left: 15px;">
                          <!-- <button class="btn pull-right send-chat-msg-btn" (click)="sendChatMessage()"
                            [disabled]="(!chat_message || chat_message?.length === 0) && (existAnAttacment === false)">
                            <span class="material-icons">
                              send
                            </span>
                          </button>  -->

                          <div class="btn-group dropup pull-right" style="margin: 5px 1px;">

                            <button type="button" class="btn btn-primary send-msg" style="border-right: 1px solid #fff;"
                              (click)="sendChatMessage()"
                              [disabled]="(!chat_message || chat_message?.length === 0) && (existAnAttacment === false)">
                              <span style="font-weight:300;"> {{'SendAs' | translate }} </span>
                              <span
                                *ngIf="HAS_SELECTED_SEND_AS_OPENED === true && HAS_SELECTED_SEND_AS_PENDING === false && HAS_SELECTED_SEND_AS_SOLVED === false"
                                style="font-weight:500;">
                                {{'Open' | translate }}
                              </span>
                              <span
                                *ngIf="HAS_SELECTED_SEND_AS_OPENED === false && HAS_SELECTED_SEND_AS_PENDING === true && HAS_SELECTED_SEND_AS_SOLVED === false"
                                style="font-weight:500;">
                                {{'Pending' | translate }}
                              </span>
                              <span
                                *ngIf="HAS_SELECTED_SEND_AS_OPENED === false && HAS_SELECTED_SEND_AS_PENDING === false && HAS_SELECTED_SEND_AS_SOLVED === true"
                                style="font-weight:500;"> {{'Resolved' | translate }} </span>
                            </button>


                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                              (click)="isOpenDropdown(isOpen = !isOpen)">
                              <span class="caret"
                                [ngClass]="{'caret-rotate-0': is0penDropDown === true, 'caret-rotate-180': is0penDropDown === false}"></span>
                              <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                              <li>

                                <a (click)="hasSelectedOpen('sendMessageAs', request)"
                                  style="padding-left: 15px; padding-right: 15px;">
                                  <i class="material-icons" style="padding-right: 5px;color: rgb(197, 44, 36);">stop</i>
                                  <span style="position: relative; top: 1px; cursor:pointer">

                                    {{'SendAs' | translate }}
                                    <span style="font-weight:500; "> {{'Open' | translate }} </span>
                                  </span>
                                </a>
                              </li>
                              <li>

                                <a (click)="hasSelectedPending('sendMessageAs',request)"
                                  style="padding-left: 15px; padding-right: 15px;">
                                  <i class="material-icons" style="padding-right: 5px;color:  rgb(55,147,233);">stop</i>
                                  <span style="position: relative; top: 1px; cursor:pointer">

                                    {{'SendAs' | translate }}
                                    <span style="font-weight:500; "> {{'Pending' | translate }}</span>
                                  </span>
                                </a>
                              </li>
                              <li>

                                <a (click)="hasSelectedSolved('sendMessageAs')"
                                  style="padding-left: 15px; padding-right: 15px;">
                                  <i class="material-icons" style="padding-right: 5px; color:#999;">stop</i>
                                  <span style="position: relative; top: 1px; cursor:pointer">

                                    {{'SendAs' | translate }}
                                    <span style="font-weight:500;"> {{'Resolved' | translate }} </span>
                                  </span>
                                </a>
                              </li>

                            </ul>
                          </div>




                          <!-- File upload -->
                          <input type="file" class="file-input" (change)="onFileSelected($event)" #fileUpload
                            style="display: none;" [accept]="fileUploadAccept">

                          <div class="file-upload">
                            <button class="btn  pull-left upload-btn" (click)="fileUpload.click()">
                              <span class="material-icons">
                                attach_file
                              </span>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- </div> -->
                    <!-- ./ texarea send message  -->

                  </div>
                </div>
                <!-- nk new end -->

              </div>

            </div>
            <div class="card---footer" *ngIf="CURRENT_USER_ROLE === 'agent'">

              <!-- ---------------------------------------- -->
              <!-- Open the chat -->
              <!-- ---------------------------------------- -->
              <div class="chat-header-wpr-open-chat-btn"
                *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                <!-- [ngClass]="{'disable_open_the_chat_btn' : request?.status == 1000}" -->
                <div class="chat-header-footer-wpr-btn">
                  <button #openChatBtn (click)="openChatAtSelectedConversation()"
                    class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right" role="button"
                    matTooltipClass="custom-mat-tooltip"
                    matTooltip="{{ 'ThisConversationIsAssignedToYou' | translate }}" #tooltip="matTooltip"
                    matTooltipPosition='below' matTooltipHideDelay="100">
                    <i class="material-icons"
                      style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">open_in_new</i>
                    <span style="vertical-align: middle"> {{ 'OpenChat' | translate }}</span>
                  </button>
                </div>
              </div>
              <!-- ---------------------------------------- -->
              <!-- Join to chat -->
              <!-- ---------------------------------------- -->
              <div class="chat-header-wpr-join-chat-btn"
                *ngIf="JOIN_TO_GROUP_HAS_ERROR === false && IS_CURRENT_USER_JOINED === false  && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">
                <div class="chat-header-footer-wpr-btn">
                  <button class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right" (click)="onJoinHandled()"
                    [disabled]="request?.status == 1000" role="button" matTooltipClass="custom-mat-tooltip"
                    matTooltip="{{ 'ThisConversationIsNotAssignedToYou' | translate }}" 
                    #tooltip="matTooltip"
                    [matTooltipDisabled]="request?.status == 1000"
                    matTooltipPosition='below' matTooltipHideDelay="100">
                    <i class="material-icons"
                      style="vertical-align: middle; top:0px !important; padding-bottom: 2px;">login</i>
                    <span style="vertical-align: middle">
                       {{ 'RequestMsgsPage.Enter' | translate }} 
                    </span>
                  </button>
                </div>
              </div>

              <!-- ---------------------------------------- -->
              <!-- Loading w-100-->
              <!-- ---------------------------------------- -->
              <div class="chat-header-wpr-loadin-chat-btn" style="height: 62px;" *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true 
              && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  
              && JOIN_TO_GROUP_HAS_ERROR === false">
                <div class="chat-header-footer-wpr-btn">
                  <button class="btn btn-primary chat-header-btn plr-8 ptb-8 pull-right">
                    <i class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i>
                    {{ 'RequestMsgsPage.Loading' | translate }}
                  </button>
                </div>
              </div>

              <!-- ---------------------------------------- -->
              <!-- Error w-100 -->
              <!-- ---------------------------------------- -->
              <div class="chat-header-wpr-error-chat-btn" style="height: 62px;"
                *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">

                <div class="chat-header-footer-wpr-btn">
                  <button class="btn btn-danger chat-header-btn plr-8 ptb-8 pull-right" disabled>
                    {{ 'Error' | translate }}
                  </button>
                </div>
              </div>

            </div>

          </div> <!-- ./ card   -->
        </div> <!-- ./ col-md-7 -->


        <!-- ----------------------------------------------------------------------------- -->
        <!-- @ RIGHT SIDEBAR -->
        <!-- ----------------------------------------------------------------------------- -->
        <div id="right-col" class="right-col" *ngIf="REQUEST_EXIST"
          [ngClass]="{'col-sm-5' : CHAT_PANEL_MODE === false, 'col-sm-12 no-padding' : CHAT_PANEL_MODE === true, 'chat-panel-mode-on-desktop' :CHAT_PANEL_MODE === true && !isMobile, 'chat-right-col': CHAT_PANEL_MODE === true}">
          <!-- card  -->
          <div class="right-card" style="padding-top:0px; padding-bottom:5px;margin-bottom: 10px;"
            [ngClass]="{'right-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'right-card-normal-mode' : CHAT_PANEL_MODE === false}">

            <div style="min-height: 510px;">

              <div class="content-wrap">
                <!-- --- new ---- -->
                <div class="conv-info-sidebar-wpr"
                  [ngClass]="{'conv-info-sidebar-wpr-sidebar-open': OPEN_RIGHT_SIDEBAR === true }">
                  <div class="conv-info-sidebar-header-wpr"
                    [ngClass]="{'conv-info-sidebar-header-wpr-chat': CHAT_PANEL_MODE === true}">

                    <div class="right-sidebar-actions">
                      <div class="dropdown pull-right">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                          <span class="material-icons">
                            more_vert
                          </span>
                        </a>
                        <ul class="dropdown-menu" [ngClass]="{'dropdown-menu-chat': CHAT_PANEL_MODE === true}">

                          <li *ngIf="CHAT_PANEL_MODE === true">

                            <a (click)='openContactDetailsInNewWindow()'
                              style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">open_in_new</i>
                              <span style="position: relative; top: 1px; cursor:pointer">

                                {{ 'ViewContact' | translate }}
                              </span>
                            </a>
                          </li>

                          <li [ngClass]="{'disable-dropdown-menu-btn' : DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true}">
                            <a (click)='openSelectUsersModal(action = "reassign")'
                              style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">swap_horiz</i>
                              <span style="position: relative; top: 1px; cursor:pointer">

                                {{ 'VisitorsPage.Reassign' | translate }}
                              </span>
                            </a>
                          </li>
                          <!-- [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_AGENT === true}" -->
                          <li [ngClass]="{'disable-dropdown-menu-btn' : DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true}">
                            <a (click)='openSelectUsersModal(action = "invite")'
                              style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">person_add</i>
                              <span style="position: relative; top: 1px; cursor:pointer">
                                {{ 'VisitorsPage.AddAgent' | translate }}
                              </span>
                            </a>
                          </li>

                          <li class="divider"></li>

                          <li [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_JOINED === false }">

                            <a (click)='openleaveChatModal()' style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">exit_to_app</i>
                              <span style="position: relative; top: 1px; cursor:pointer">
                                <!-- {{ 'VisitorsPage.LeaveChat' | translate }} -->
                                {{ 'VisitorsPage.Leave' | translate }}
                              </span>
                            </a>
                          </li>

                          <li class="divider"></li>
                          <li>
                            <a (click)='displayModalDownloadTranscript()'
                              style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">speaker_notes</i>
                              <span style="position: relative; top: 1px; cursor:pointer">
                                Transcript
                              </span>
                            </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                            <a (click)='displayModalBanVisitor(request?.lead?.lead_id, request?.lead?.attributes?.ipAddress)'
                              style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">not_interested</i>
                              <span style="position: relative; top: 1px; cursor:pointer">

                                {{ 'BanVisitor' | translate }}

                              </span>
                            </a>
                          </li>

                        </ul>
                      </div>

                    </div>

                    <!-- <div class="conv-info-sidebar-header-contact-info-wpr-sk">
                      <div role="button" tabindex="-1" class="avatar"
                        [ngClass]="{'chat-avatar': CHAT_PANEL_MODE === true}">
                        <ngx-skeleton-loader count="1" appearance="circle" [theme]="{ 
                          'width': '44px',
                          'height': '44px'
                         
                        }"></ngx-skeleton-loader>

                        <div class="contact--name-sk"> 
                        <ngx-skeleton-loader count="1" ></ngx-skeleton-loader> 
                      </div>
                        <div class="conv-info-sidebar-header-contact-info-sk">
                          <div id="edit-fullname-contact-info-wpr-sk" class="contact-info-wpr-sk">

                            <!- - <ngx-skeleton-loader count="1" [theme]="{ 
                              'width': '200px',
                              'height': '44px'
                             
                            }"></ngx-skeleton-loader> - ->

                          </div>

                        </div>
                      </div>
                    </div> -->


                    <!-- *ngIf="!showSpinner" -->
                    <div class="conv-info-sidebar-header-contact-info-wpr">
                      <div role="button" tabindex="-1" class="avatar"
                        [ngClass]="{'chat-avatar': CHAT_PANEL_MODE === true}"
                        [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + fillColour + ')'}"
                        (click)="goToContactDetails()">
                        <span *ngIf="request?.channel?.name !== CHANNELS_NAME.VOICE_VXML && request?.channel?.name !== CHANNELS_NAME.VOICE_TWILIO">
                          {{ requester_fullname_initial }}
                        </span>
                        <span *ngIf="(request?.channel?.name === CHANNELS_NAME.VOICE_VXML || request?.channel?.name === CHANNELS_NAME.VOICE_TWILIO) && (request?.lead?.fullname === request?.lead?.phone)" class="material-icons-outlined">
                          call
                        </span>
                        <span *ngIf="(request?.channel?.name === CHANNELS_NAME.VOICE_VXML || request?.channel?.name === CHANNELS_NAME.VOICE_TWILIO) && !request?.lead?.phone" class="material-icons-outlined">
                          call
                        </span>
                        <span *ngIf="(request?.channel?.name === CHANNELS_NAME.VOICE_VXML || request?.channel?.name === CHANNELS_NAME.VOICE_TWILIO) && request?.lead?.phone && (request?.lead?.fullname !== request?.lead?.phone)">
                          {{ requester_fullname_initial }}
                        </span>
                      </div>
                      <!-- ----------------------------------- -->
                      <!-- Contact verified icon   -->
                      <!-- ----------------------------------- -->
                      <div class="contact-verified-icon-wpr"
                        [ngClass]="{'contact-verified-icon-wpr-chat': CHAT_PANEL_MODE === true}"
                        matTooltipClass="custom-mat-tooltip"
                        matTooltip="{{ 'VisitorsPage.AuthenticatedUser' | translate }}" #tooltip="matTooltip"
                        matTooltipPosition='right' matTooltipHideDelay="100" *ngIf="REQUESTER_IS_VERIFIED === true">
                        <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 26.6 26.6" width="17"
                          height="17" xml:space="preserve">
                          <style type="text/css">
                            .contact-verified-icon-st0 {
                              fill: none;
                            }

                            .contact-verified-icon-st1 {
                              fill: #FFFFFF;
                            }

                            .contact-verified-icon-st2 {
                              fill: #18BDF7;
                            }
                          </style>
                          <path class="contact-verified-icon-st0" d="M1.3,1.3h24v24h-24V1.3z" />
                          <path class="contact-verified-icon-st1"
                            d="M13.3,0L2.4,4.9v7.3c0,6.7,4.6,13,10.9,14.5c6.2-1.5,10.9-7.8,10.9-14.5V4.9L13.3,0z" />
                          <path class="contact-verified-icon-st2" d="M13.3,2.3l-9,4v6c0,5.5,3.8,10.7,9,12c5.2-1.3,9-6.5,9-12v-6L13.3,2.3z M11.3,18.3l-4-4l1.4-1.4l2.6,2.6
                                      l6.6-6.6l1.4,1.4L11.3,18.3z" />
                        </svg>

                      </div>
                      <!-- ----------------------------------- -->
                      <!-- contact status icon  -->
                      <!-- ----------------------------------- -->
                      <div class="contact--offline-status"
                        [ngClass]="{'contact--online-status' : REQUESTER_IS_ONLINE, 'contact--offline-status-chat': CHAT_PANEL_MODE === true}">
                      </div>


                      <div class="conv-info-sidebar-header-contact-info">
                        <div class="td-dropdown">
                          <div role="button" class="td-dropdown__trigger" tabindex="0"
                            (click)="openAddContactNameForm($event)">
                            <div id="edit-fullname-contact-info-wpr" class="contact-info-wpr">
                              <h3 id="edit-fullname-contact-info--name" *ngIf="request?.lead?.fullname"
                                class="contact-info--name">
                                {{request?.lead?.fullname}}
                              </h3>
                              <!-- -->
                              <svg id="edit-fullname-open-edit-fullname-icon" xmlns="http://www.w3.org/2000/svg"
                                width="24" height="24" viewBox="0 0 24 24" class="edit--icon">
                                <path
                                  d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z">
                                </path>
                                <path d="M0 0h24v24H0z" fill="none"></path>
                              </svg>
                            </div>
                          </div>
                          <!-- style="left: -48px;"  [ngStyle]="{'left':CHAT_PANEL_MODE === false ? '0px' : '-32px;' }"-->
                          <div class="dropdown__menu-form"
                            [ngClass]="{'dropdown__menu-form-chat-mode': CHAT_PANEL_MODE === true}">
                            <div id="edit-fullname-content-form" class="dropdown__content-form">
                              <form id="edit-fullname-form" class="contact-form">
                                <div #editFullnameDropdown id="edit-fullname-input-wrapper" class="input-wrapper">
                                  <label id="edit-fullname-firstname-label" for="edit-fullname-firstname-input">
                                    {{'FirstName' | translate}}
                                  </label>
                                  <input id="edit-fullname-firstname-input" type="text" class="form-input"
                                    autocomplete="off" [(ngModel)]="contactNewFirstName">

                                  <label id="edit-fullname-lastname-label" for="edit-fullname-lastname-input">
                                    {{'LastName' | translate}}
                                  </label>
                                  <input id="edit-fullname-lastname-input" type="text" class="form-input"
                                    autocomplete="off" [(ngModel)]="contactNewLastName">
                                </div>
                                <div id="edit-fullname-submit-btn-wpr">
                                  <button id="edit-fullname-submit-btn" class="done--btn" type="submit"
                                    (click)="updateContactFullName()"
                                    [disabled]="!contactNewFirstName || contactNewFirstName.length < 2">
                                    {{'Done' | translate}}
                                  </button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                        <div class="contact-location-and-served-by-wpr">
                          <a rel="noopener noreferrer" class="contact-location"
                            [ngClass]="{
                          'contact-location-chat-one-agent': CHAT_PANEL_MODE === true && agents_array?.length === 1, 
                          'contact-location-chat-two-agent': CHAT_PANEL_MODE === true && agents_array?.length === 2,
                          'contact-location-chat-three-agent': CHAT_PANEL_MODE === true && agents_array?.length === 3}">
                            <!-- (click)="openMapRightSideBar()" -->
                            <span (click)="viewInGooleMaps()" *ngIf="locationCity || locationCountry"
                              class="location-wpr" matTooltipClass="custom-mat-tooltip"
                              matTooltip="{{ 'Location' | translate }}" #tooltip="matTooltip" matTooltipPosition='right'
                              matTooltipHideDelay="100">
                              <span *ngIf="locationCity && locationCountry">{{ locationCity }},</span>
                              <span *ngIf="locationCity && !locationCountry">{{ locationCity }}</span>
                              <span *ngIf="locationCountry" style="text-transform: capitalize;"> {{ locationCountry }}
                              </span>
                            </span>
                          </a>
                          <!-- ----------------------------------- -->
                          <!-- @ Served by (new) -->
                          <!-- ----------------------------------- -->
                          <div class="served-by-wpr">

                            <!-- ------------------------------------------------------ -->
                            <!-- No Agent Unserved conversation / ticket -->
                            <!-- ------------------------------------------------------ -->
                            <div *ngIf="agents_array?.length === 0" class="unserved--wpr">

                              <!-- ------------------------------------- -->
                              <!-- IF IS AN UNSERVED REQUEST -->
                              <!-- ------------------------------------- -->

                              <svg *ngIf="request?.status === 100 && !request?.subject" class="header-conv-svg-icon"
                                height="24" width="24" viewBox="0 0 58.1 53.9" xml:space="preserve"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.RequestUnserved' | translate }}" #tooltip="matTooltip"
                                matTooltipPosition='above' matTooltipHideDelay="100" style="vertical-align: middle;">
                                <style type="text/css">
                                  .st0-unserved {
                                    fill: none;
                                    stroke: #ED4537;
                                    stroke-width: 2;
                                    stroke-miterlimit: 10;
                                  }

                                  .st1-unserved {
                                    fill: #ED4537;
                                  }
                                </style>
                                <path class="st0-unserved" d="M30.5,3.3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                        c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3.3,30.5,3.3z" />
                                <g>
                                  <path class="st1-unserved"
                                    d="M30.6,38.9c-1.7,0-3.1-1.4-3.1-3c0-1.7,1.4-3,3.1-3c1.7,0,3.1,1.4,3.1,3C33.6,37.6,32.3,38.9,30.6,38.9z" />
                                  <path class="st1-unserved" d="M34.8,18l-1.5,10c-0.2,1.5-1.6,2.5-3.1,2.3c-1.2-0.2-2.1-1.1-2.3-2.2l-1.6-10c-0.4-2.3,1.2-4.5,3.6-4.9
                                      c2.4-0.4,4.6,1.2,5,3.5C34.9,17.1,34.9,17.6,34.8,18z" />
                                </g>
                              </svg>


                              <!-- ------------------------------------- -->
                              <!-- IF IS AN INTERNAL ABANDONED REQUEST  -->
                              <!-- ------------------------------------- -->
                              <img *ngIf="request?.status === 150" class="header-conv-svg-icon" 
                                src="assets/img/request_icons/status150_abandoned.svg"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.RequestAbandoned' | translate }}"
                                #tooltip="matTooltip" matTooltipPosition='above' matTooltipHideDelay="100"
                                style="width: 24px;">

                           


                              <!-- ------------------------------------- -->
                              <!-- IF IS AN INTERNAL UNSERVED REQUEST  -->
                              <!-- ------------------------------------- -->
                              <img *ngIf="request?.status === 100 && request?.subject"
                                src="assets/img/request_icons/status100_internal.svg"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.InternalRequestUnserved' | translate }}"
                                #tooltip="matTooltip" matTooltipPosition='above' matTooltipHideDelay="100"
                                style="width: 24px;">

                              <!-- <svg *ngIf="request?.status === 100 && request?.subject" class="header-conv-svg-icon" height="24" width="24" version="1.1" id="Livello_1"
                                  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                                  y="0px" viewBox="0 0 58.1 53.9" xml:space="preserve"
                                  matTooltipClass="custom-mat-tooltip"
                                  matTooltip="{{ 'RequestMsgsPage.InternalRequestUnserved' | translate }}"
                                  #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                  style="vertical-align: middle;">
                                  <style type="text/css">
                                    .unserved_Internal_st0 {
                                      fill: none;
                                      stroke: #ED4537;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .unserved_Internal_st1 {
                                      fill: #ED4537;
                                    }
                                  </style>
                                  <path class="unserved_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                        C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                  <path class="unserved_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                        c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                        C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                        c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                </svg> -->


                            </div>
                            <ul class="served-by"
                              [ngClass]="{'served-by-with-other-agent-button': agents_array?.length > 2}">

                              <li class="served-by-avatar eyj5dak2"
                                *ngFor="let agent of agents_array | slice:0:2; let i=index">

                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- @ Human Agent photo - USE CASE: AGENT HAS IMAGE & UPLOAD ENGINE IS FIREBASE -->
                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- (mouseenter)="agentfbimg.open()"  -->
                                <img *ngIf="agent.isBot === false && agent.hasImage && UPLOAD_ENGINE_IS_FIREBASE"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id}}%2Fthumb_photo.jpg?alt=media"
                                  alt="human-agent-profile-photo" class="served-by-avatar--img eyj5dak1"
                                  onerror="this.src='assets/img/no_image_user.png'" [satPopoverAnchor]="agentfbimg"
                                  (click)="agentfbimg.toggle()" (click)="$event.stopPropagation()"
                                  (document:click)="agentfbimg.close()" matTooltipClass="custom-mat-tooltip"
                                  matTooltip="{{'VisitorsPage.AssignedTo' | translate }} {{agent?.firstname}} {{agent?.lastname}} {{'ClickToDisplayActions' | translate}}"
                                  #tooltip="matTooltip" matTooltipPosition='left' matTooltipHideDelay="100" />
                                <sat-popover #agentfbimg horizontalAlign="before">
                                  <div class="popover-wrapper">
                                    <div class="sat-popover-agent-fullname">
                                      {{agent?.firstname}} {{agent?.lastname}}
                                    </div>
                                    <button class="sat-popover-view-profile"
                                      (click)="goToMemberProfile(agent, agent?._id )">
                                      {{'ViewProfile' | translate }}
                                    </button>
                                    <button class="sat-popover-chat-with"
                                      (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)">

                                      {{'Message' | translate }}
                                    </button>
                                  </div>
                                </sat-popover>

                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- @ Human agent photo - USE CASE: AGENT HAS IMAGE & UPLOAD ENGINE IS NATIVE -->
                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- (mouseenter)="agentntimg.open()" -->
                                <img *ngIf="agent.isBot === false && agent.hasImage && !UPLOAD_ENGINE_IS_FIREBASE"
                                  src="{{baseUrl}}images?path=uploads%2Fusers%2F{{agent?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                  class="served-by-avatar--img" [satPopoverAnchor]="agentntimg"
                                  (click)="agentntimg.toggle()" (click)="$event.stopPropagation()"
                                  (document:click)="agentntimg.close()" matTooltipClass="custom-mat-tooltip" matTooltip="{{'VisitorsPage.AssignedTo' | translate }} {{agent?.firstname}} {{agent?.lastname}}
                                  {{'ClickToDisplayActions' | translate}}" #tooltip="matTooltip"
                                  matTooltipPosition='left' matTooltipHideDelay="100" />

                                <sat-popover #agentntimg horizontalAlign="before">
                                  <div class="popover-wrapper">
                                    <div class="sat-popover-agent-fullname">
                                      {{agent?.firstname}} {{agent?.lastname}}
                                    </div>
                                    <button class="sat-popover-view-profile"
                                      (click)="goToMemberProfile(agent, agent?._id )">
                                      {{'ViewProfile' | translate }}
                                    </button>
                                    <button class="sat-popover-chat-with"
                                      (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)">

                                      {{'Message' | translate }}
                                    </button>
                                  </div>
                                </sat-popover>

                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- @ Human agent avatar with name initials - USE CASE: AGENT NOT HAS IMAGE  -->
                                <!-- ---------------------------------------------------------------------------- -->

                                <!-- (mouseenter)="agentnoimg.open()" -->
                                <div *ngIf="agent.isBot === false && !agent.hasImage" class="served-by-avatar--no-img"
                                  [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + agent?.userfillColour + ')'}"
                                  style="cursor:pointer" [satPopoverAnchor]="agentnoimg"
                                  (click)="$event.stopPropagation()" (click)="agentnoimg.toggle()"
                                  (document:click)="agentnoimg.close()" matTooltipClass="custom-mat-tooltip" matTooltip="{{'VisitorsPage.AssignedTo' | translate }} {{agent?.firstname}}
                                   {{'ClickToDisplayActions' | translate}}" #tooltip="matTooltip"
                                  matTooltipPosition='left' matTooltipHideDelay="100">
                                  {{ agent?.userFullname }}
                                </div>

                                <sat-popover #agentnoimg horizontalAlign="before">
                                  <div class="popover-wrapper">
                                    <div class="sat-popover-agent-fullname">
                                      {{agent?.firstname}} {{agent?.lastname}}
                                    </div>
                                    <button class="sat-popover-view-profile"
                                      (click)="goToMemberProfile(agent, agent?._id )">
                                      {{'ViewProfile' | translate }}
                                    </button>
                                    <button class="sat-popover-chat-with"
                                      (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)">

                                      {{'Message' | translate }}
                                    </button>
                                  </div>
                                </sat-popover>

                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- @ Bot agent photo - USE CASE: BOT HAS IMAGE & UPLOAD ENGINE IS FIREBASE -->
                                <!-- ---------------------------------------------------------------------------- -->

                                <img *ngIf="agent.isBot === true && UPLOAD_ENGINE_IS_FIREBASE"
                                  class="served-by-avatar--img"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id | slice:4}}%2Fthumb_photo.jpg?alt=media"
                                  onerror="this.src='assets/img/avatar_bot_tiledesk.svg'"
                                  [satPopoverAnchor]="botfbengine" (click)="botfbengine.toggle()"
                                  (click)="$event.stopPropagation()" (document:click)="botfbengine.close()"
                                  matTooltipClass="custom-mat-tooltip" matTooltip="{{'VisitorsPage.AssignedTo' | translate }} {{agent?.firstname}} {{agent?.lastname}} (bot)
                                  {{'ClickToDisplayActions' | translate}}" #tooltip="matTooltip"
                                  matTooltipPosition='left' matTooltipHideDelay="100" />

                                <sat-popover #botfbengine horizontalAlign="before">
                                  <div class="popover-wrapper">
                                    <div class="sat-popover-agent-fullname">
                                      {{agent?.firstname}} {{agent?.lastname}} (bot)
                                    </div>
                                    <button class="sat-popover-view-profile"
                                      (click)="goToMemberProfile(agent, agent?._id )">
                                      {{'ViewProfile' | translate }}
                                    </button>
                                  </div>
                                </sat-popover>

                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- @ Bot agent photo - USE CASE: BOT HAS IMAGE & UPLOAD ENGINE IS NATIVE -->
                                <!-- ---------------------------------------------------------------------------- -->
                                <!-- satPopoverAnchor]="botntengine" (click)="botntengine.toggle()" (document:click)="botntengine.close()" {{'ClickToDisplayActions' | translate}}-->
                                <img *ngIf="agent.isBot === true && !UPLOAD_ENGINE_IS_FIREBASE"
                                  class="served-by-avatar--img"
                                  src="{{baseUrl}}images?path=uploads%2Fusers%2F{{agent?._id | slice:4}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                  onerror="this.src='assets/img/avatar_bot_tiledesk.svg'"
                                  (click)="goToMemberProfile(agent, agent?._id )" matTooltipClass="custom-mat-tooltip"
                                  matTooltip="{{'VisitorsPage.AssignedTo' | translate }} {{agent?.firstname}} {{agent?.lastname}} (bot)"
                                  #tooltip="matTooltip" matTooltipPosition='left' matTooltipHideDelay="100" />

                                <!-- <sat-popover #botntengine horizontalAlign="before">
                                  <div class="popover-wrapper">
                                    <div class="sat-popover-agent-fullname">
                                      {{agent?.firstname}} {{agent?.lastname}} (bot)
                                    </div>
                                    <button class="sat-popover-view-profile" (click)="goToMemberProfile(agent, agent?._id )">
                                      {{'ViewProfile' | translate }}
                                    </button>
                                  </div>
                                </sat-popover> -->

                              </li>
                              <!-- ------------------------------------- -->
                              <!-- @ Served by other Agents  -->
                              <!-- ------------------------------------- -->
                              <li *ngIf="agents_array?.length > 2">
                                <div class="other-agents-dropdown-wpr"
                                  style="position: absolute; top: 40px; right: 26px;">
                                  <div class="dropdown pull-right">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                      <div role="button" class="served-by-avatar--others-agents"
                                        style="position: absolute;z-index: 2;top: 0px;left:-6px">
                                        +{{agents_array?.length - 2 }}
                                      </div>
                                    </a>
                                    <ul class="dropdown-menu agents-dropdown"
                                      style="padding:8px; top: 30px;min-width: 180px;">
                                      <li *ngFor="let agent of agents_array | slice:2; let i=index">
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <!-- @ Human Agent photo FB Engine -->
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <div class="dropdown-served-by"
                                          *ngIf="agent.isBot === false && agent.hasImage && UPLOAD_ENGINE_IS_FIREBASE">
                                          <img
                                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id}}%2Fthumb_photo.jpg?alt=media"
                                            alt="human-agent-profile-photo" class="served-by-avatar--img eyj5dak1"
                                            onerror="this.src='assets/img/no_image_user.png'" />
                                          <span style="margin-left: 8px; font-size: 12px; font-weight: 400;">
                                            {{agent?.firstname}} {{agent?.lastname}}
                                          </span>
                                          <div class="dropdown-btn-wpr">
                                            <button class="dropdown-btn-view-profile"
                                              (click)="goToMemberProfile(agent, agent?._id )">
                                              {{'ViewProfile' | translate }}
                                            </button>
                                            <button class="dropdown-btn-chat-with"
                                              (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)">
                                              {{'Message' | translate }}
                                            </button>
                                          </div>
                                        </div>
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <!-- @ Human agent photo - USE CASE: AGENT HAS IMAGE & UPLOAD ENGINE IS NATIVE -->
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <div class="dropdown-served-by"
                                          *ngIf="agent.isBot === false && agent.hasImage && !UPLOAD_ENGINE_IS_FIREBASE">
                                          <img
                                            src="{{baseUrl}}images?path=uploads%2Fusers%2F{{agent?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                            class="served-by-avatar--img"
                                            (click)="goToMemberProfile(agent, agent?._id )" />
                                          <span style="margin-left: 8px;font-size: 12px; font-weight: 400;">
                                            {{agent?.firstname}} {{agent?.lastname}}
                                          </span>
                                          <div class="dropdown-btn-wpr">
                                            <button class="dropdown-btn-view-profile"
                                              (click)="goToMemberProfile(agent, agent?._id )">
                                              {{'ViewProfile' | translate }}
                                            </button>
                                            <button class="dropdown-btn-chat-with"
                                              (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)">

                                              {{'Message' | translate }}
                                            </button>
                                          </div>
                                        </div>

                                        <!-- ---------------------------------------------------------------------------- -->
                                        <!-- @ Human agent no photo  -->
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <div class="dropdown-served-by"
                                          *ngIf="agent.isBot === false && !agent.hasImage">
                                          <div class="served-by-avatar--no-img"
                                            [ngStyle]="{'background':  'linear-gradient(rgb(255,255,255) -125%,' + agent?.userfillColour + ')'}"
                                            style="display: inline-block;">
                                            {{ agent?.userFullname }}
                                          </div>
                                          <div style="display: inline-block;">
                                            <span style="margin-left: 8px; font-size: 12px; font-weight: 400;">
                                              {{agent?.firstname}} {{agent?.lastname}}
                                            </span>
                                          </div>
                                          <div class="dropdown-btn-wpr">
                                            <button class="dropdown-btn-view-profile"
                                              (click)="goToMemberProfile(agent, agent?._id )">
                                              {{'ViewProfile' | translate }}
                                            </button>
                                            <button class="dropdown-btn-chat-with"
                                              (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)">

                                              {{'Message' | translate }}
                                            </button>
                                          </div>
                                        </div>
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <!-- @ Bot agent photo FB Engine -->
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <div class="dropdown-served-by"
                                          *ngIf="agent.isBot === true && UPLOAD_ENGINE_IS_FIREBASE">
                                          <img class="served-by-avatar--img"
                                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id | slice:4}}%2Fthumb_photo.jpg?alt=media"
                                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />
                                          <span style="margin-left: 8px;font-size: 12px; font-weight: 400;">
                                            {{agent?.firstname}} {{agent?.lastname}} (bot)
                                          </span>
                                          <div class="dropdown-btn-wpr">
                                            <button class="dropdown-btn-view-profile"
                                              (click)="goToMemberProfile(agent, agent?._id )">
                                              {{'ViewProfile' | translate }}
                                            </button>

                                          </div>
                                        </div>

                                        <!-- ---------------------------------------------------------------------------- -->
                                        <!-- @ Bot agent photo Native Engine -->
                                        <!-- ---------------------------------------------------------------------------- -->
                                        <div class="dropdown-served-by"
                                          *ngIf="agent.isBot === true && !UPLOAD_ENGINE_IS_FIREBASE">
                                          <img class="served-by-avatar--img"
                                            src="{{baseUrl}}images?path=uploads%2Fusers%2F{{agent?._id | slice:4}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />
                                          <span style="margin-left: 8px;font-size: 12px; font-weight: 400;"
                                            *ngIf="agent.isBot === true && !UPLOAD_ENGINE_IS_FIREBASE">
                                            {{agent?.firstname}} {{agent?.lastname}} (bot)
                                          </span>
                                          <div class="dropdown-btn-wpr">
                                            <button class="dropdown-btn-view-profile"
                                              (click)="goToMemberProfile(agent, agent?._id )">
                                              {{'ViewProfile' | translate }}
                                            </button>
                                          </div>
                                        </div>
                                      </li>
                                    </ul> <!-- agents-dropdown -->
                                  </div>
                                </div>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="header-badge-wpr">

                      <!-- ----------------------------------------------------------  -->
                      <!-- Working status dropdow -->
                      <!-- ----------------------------------------------------------  -->
                      <div class="dropdown">
                        <a class="btn working-status-dropdown-btn dropdown-toggle" style="min-width: 65px;"
                          data-toggle="dropdown"
                          [ngClass]="{
                          'working-status-dropdown-btn-chat': CHAT_PANEL_MODE === true,
                          'open' : (request?.workingStatus === 'open' || !request?.workingStatus || request?.workingStatus === 'new' ) && request?.status !== 1000,
                          'pending' : request?.workingStatus === 'pending' && request?.status !== 1000,
                          'closed' : (request?.workingStatus === '' && request?.status === 1000) || (!request?.workingStatus && request?.status === 1000) || (request?.workingStatus === 'new' && request?.status === 1000) || (request?.workingStatus === 'open' && request?.status === 1000)}">
                          <!-- use case: conversation assigned -->
                          <span class="open-conv"
                            *ngIf="(request?.workingStatus === 'open' || !request?.workingStatus || request?.workingStatus === 'new' ) && request?.status !== 1000">
                            {{'Open' | translate}}
                          </span>
                          <span class="pending"
                            *ngIf="request?.workingStatus === 'pending' && request?.status !== 1000">
                            {{'Pending' | translate}}
                          </span>
                          <span class="resolved"
                            *ngIf="(request?.workingStatus === '' && request?.status === 1000) || (!request?.workingStatus && request?.status === 1000) || (request?.workingStatus === 'new' && request?.status === 1000) || (request?.workingStatus === 'open' && request?.status === 1000)">
                            {{'Resolved' | translate}}
                          </span>
                          <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-working-status" style="cursor: pointer;"
                          [ngClass]="{'dropdown-menu-working-status-chat': CHAT_PANEL_MODE === true}">
                          <li [ngClass]="{'disable-dropdown-menu-btn' : disableReopeRequest }"
                            (click)="hasSelectedOpen('updatedWorkingStatus', request)"
                            class="conversation-open-assigned" *ngIf="!request?.subject"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{'ConversationBeingProcessed' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <a style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">stop</i>
                              <span style="font-weight:500; position: relative; top: 1px;">
                                {{'Open' | translate}}
                              </span>
                            </a>
                          </li>
                          <li [ngClass]="{'disable-dropdown-menu-btn' : disableReopeRequest }"
                            (click)="hasSelectedOpen('updatedWorkingStatus', request)" class="ticket-open-assigned"
                            *ngIf="request?.subject" class="ticket-open-assigned" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{'TicketBeingProcessed' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <a style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">stop</i>
                              <span style="font-weight:500; position: relative; top: 1px;">
                                {{'Open' | translate}}
                              </span>
                            </a>
                          </li>

                          <li [ngClass]="{'disable-dropdown-menu-btn' : disableReopeRequest }"
                            (click)="hasSelectedPending('updatedWorkingStatus', request)" class="pending"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'WaitingForReplyFromTheRequester' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <a style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">stop</i>
                              <span style="font-weight:500; position: relative; top: 1px;">
                                {{'Pending' | translate}}
                              </span>
                            </a>
                          </li>
                          <li
                            [ngClass]="{'disable-dropdown-menu-btn' : request?.status == 1000 || DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true }"
                            (click)="hasSelectedSolved('updatedWorkingStatus')" class="conversation-resolved"
                            *ngIf="!request?.subject" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'ClosesTheCurrentConversation' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <a style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px; ">stop</i>
                              <span style="font-weight:500; position: relative; top: 1px;">
                                {{'VisitorsPage.Resolve' | translate}} </span>
                            </a>
                          </li>
                          <li
                            [ngClass]="{'disable-dropdown-menu-btn' : request?.status == 1000 || DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true }"
                            (click)="hasSelectedSolved('updatedWorkingStatus')" class="ticket-resolved"
                            *ngIf="request?.subject" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'ClosesTheCurrentTicket' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <a style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px; color: #999">stop</i>
                              <span style="font-weight:500; position: relative; top: 1px;">
                                {{'VisitorsPage.Resolve' | translate}}</span>
                            </a>
                          </li>
                        </ul>
                      </div>

                      <!-- ---------------------------------------------------------------------- -->
                      <!-- Resolve and Reopen btn in sidebar -->
                      <!-- ---------------------------------------------------------------------- -->
                      <div class="resolve-reopen-btns-in-right-sidebar-wpr">
                        <!--  Resolve - use case Conversation -->
                        <div class="resolve-btns-in-right-sidebar-wpr" *ngIf="request?.status !== 1000">
                          <div *ngIf="!request?.subject" class="resolve-btn-in-right-sidebar-wpr"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip=" {{ 'ClosesTheCurrentConversation' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <button #resolveChatBtn (click)="archiveRequest(request?.request_id)"
                              class="btn btn-primary sideber-header-btn pull-right" role="button"
                              [disabled]="request?.status == 1000 || DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true">
                              <i class="material-icons" style="vertical-align: middle; padding-bottom: 2px;">archive</i>
                              <span style="vertical-align: middle"> {{ 'VisitorsPage.Resolve' | translate }}</span>
                            </button>
                          </div>

                          <!-- Resolve - use case Ticket -->
                          <div *ngIf="request?.subject" class="resolve-btn-in-right-sidebar-wpr"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip=" {{ 'ClosesTheCurrentTicket' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <button #resolveChatBtn (click)="archiveRequest(request?.request_id)"
                              class="btn btn-primary sideber-header-btn pull-right" role="button"
                              [disabled]="request?.status == 1000 || DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true">
                              <i class="material-icons" style="vertical-align: middle; padding-bottom: 2px;">archive</i>
                              <span style="vertical-align: middle"> {{ 'VisitorsPage.Resolve' | translate }}</span>
                            </button>
                          </div>
                        </div>

                        <div class="reopen-btns-in-right-sidebar-wpr"
                          *ngIf="CHAT_PANEL_MODE === false && request?.status === 1000">
                          <!--  Reopen - use case Conversation -->
                          <div *ngIf="!request?.subject" class="reopen-btn-in-right-sidebar-wpr"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip=" {{ 'ReopenTheCurrentConversation' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <button #reopenChatBtn (click)="reopenArchivedRequest(request, request?.request_id)"
                              class="btn btn-primary sideber-header-btn pull-right" role="button"
                              [disabled]="DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true">
                              <i class="material-icons"
                                style="vertical-align: middle; top:-2px !important; padding-bottom: 2px; transform: rotate(180deg)">archive</i>
                              <span style="vertical-align: middle"> {{ 'Reopen' | translate }} </span>
                            </button>
                          </div>

                          <!--  Reopen - use case Ticket -->
                          <div *ngIf="request?.subject" class="reopen-btn-in-right-sidebar-wpr"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip=" {{ 'ReopenTheCurrentTicket' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='above' matTooltipHideDelay="100">
                            <button #reopenChatBtn (click)="reopenArchivedRequest(request, request?.request_id)"
                              class="btn btn-primary sideber-header-btn pull-right" role="button"
                              [disabled]="DISABLE_BTN_AGENT_NO_IN_PARTICIPANTS === true">
                              <i class="material-icons"
                                style="vertical-align: middle; top:-2px !important; padding-bottom: 2px; transform: rotate(180deg)">archive</i>
                              <span style="vertical-align: middle"> {{ 'Reopen' | translate }} </span>
                            </button>
                          </div>
                        </div>
                      </div>


                      <div class="request-icons-in-right-sidebar" *ngIf="CHAT_PANEL_MODE === false">
                        <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                        <svg *ngIf="request?.status == 200 && IS_CURRENT_USER_JOINED === true && !request?.subject"
                          class="header-conv-svg-icon" height="24" width="24" viewBox="0 0 58.1 53.9"
                          xml:space="preserve" matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'RequestMsgsPage.ConversationAssignedToYou' | translate }}"
                          #tooltip="matTooltip" matTooltipPosition='above' matTooltipHideDelay="100">
                          <style type="text/css">
                            .st0-served-by-cu {
                              fill: none;
                              stroke: #4DAF4F;
                              stroke-width: 2;
                              stroke-miterlimit: 10;
                            }

                            .st1-served-by-cu {
                              fill: #4DAF4F;
                            }
                          </style>
                          <path class="st0-served-by-cu" d="M29.8,3.7c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                              c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.6,3.7,29.8,3.7z" />
                          <g id="XMLID_146_">
                            <path id="XMLID_158_" class="st1-served-by-cu" d="M25.8,36.5l-8.4-7.4c-1.1-0.9-1.1-2.4,0-3.3c1.1-0.9,2.8-0.9,3.8,0l4.6,4.1l12.6-10.9
                              c1.1-0.9,2.8-0.9,3.8,0c1,0.9,1,2.4,0,3.3L25.8,36.5z" />
                          </g>
                        </svg>



                        <img *ngIf="request?.status == 200 && IS_CURRENT_USER_JOINED === true && request?.subject"
                          class="header-conv-svg-icon" src="assets/img/request_icons/status200_joined_internal.svg"
                          matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'RequestMsgsPage.TicketAssignedToYou' | translate }}" #tooltip="matTooltip"
                          matTooltipPosition='above' matTooltipHideDelay="100" style="width: 24px;height: 24px;">

                        <!-- ------------------------------------------------------------------------------------ -->
                        <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                        <!-- ------------------------------------------------------------------------------------ -->
                        <svg
                          *ngIf="request?.status == 200 && !IS_CURRENT_USER_JOINED && !request?.subject && request?.preflight === false"
                          class="header-conv-svg-icon" height="24" width="24" viewBox="0 0 58.1 53.9"
                          xml:space="preserve" matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'RequestMsgsPage.RequestServedBy' | translate }}" #tooltip="matTooltip"
                          matTooltipPosition='above' matTooltipHideDelay="100">
                          <style type="text/css">
                            .st0-served {
                              fill: none;
                              stroke: #05BDD4;
                              stroke-width: 2;
                              stroke-miterlimit: 10;
                            }

                            .st1-served {
                              fill: #05BDD4;
                            }
                          </style>
                          <g>
                            <path class="st0-served" d="M30.5,3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3,30.5,3z" />
                            <g>
                              <circle class="st1-served" cx="17.5" cy="26.7" r="3" />
                              <circle class="st1-served" cx="30.5" cy="26.7" r="3" />
                              <circle class="st1-served" cx="43.5" cy="26.7" r="3" />
                            </g>
                          </g>
                        </svg>

                        <!-- --------------------------------------------------------------------------------------- -->
                        <!-- IF IS AN INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                        <!-- --------------------------------------------------------------------------------------- -->
                        <!-- <svg *ngIf="request?.status == 200 && !IS_CURRENT_USER_JOINED && request?.subject"
                          class="header-conv-svg-icon" height="24" width="24" version="1.1" id="Livello_1"
                          xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                          viewBox="0 0 58.1 53.9" xml:space="preserve" 
                          matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'RequestMsgsPage.InternalRequestServedBy' | translate }}" 
                          #tooltip="matTooltip"
                          matTooltipPosition='below' 
                          matTooltipHideDelay="100">
                          <style type="text/css">
                            .served__Internal_st0 {
                              fill: none;
                              stroke: #05BDD4;
                              stroke-width: 2;
                              stroke-miterlimit: 10;
                            }

                            .served__Internal_st1 {
                              fill: #05BDD4;
                            }
                          </style>
                          <path class="served__Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                              C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                          <path class="served__Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                              c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                              C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                              c0.5,0,0.9-0.5,0.9-1.1V22z" />
                        </svg> -->

                        <img
                          *ngIf="request?.status == 200 && !IS_CURRENT_USER_JOINED && request?.subject && request?.preflight === false"
                          src="assets/img/request_icons/status200_no_joined_internal.svg" class="header-conv-svg-icon"
                          matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'RequestMsgsPage.InternalRequestServedBy' | translate }}" #tooltip="matTooltip"
                          matTooltipPosition='above' matTooltipHideDelay="100" style="width: 24px;height: 24px;">

                        <img *ngIf="request?.status == 200 && request?.preflight === true"
                          src="assets/img/request_icons/status200_preflight.svg" class="header-conv-svg-icon"
                          matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'RequestMsgsPage.ConversationAssignedPreflight' | translate }}"
                          #tooltip="matTooltip" matTooltipPosition='above' matTooltipHideDelay="100"
                          style="width: 24px;height: 24px;">
                      </div>



                      <!-- ---------------------------------------- -->
                      <!-- @ Priority WRAPPER style="flex: 1;; text-align: right;" -->
                      <!-- ---------------------------------------- -->
                      <div *ngIf="request?.priority !== 'medium'" class="priority_wpr">
                        <!-- ---------------------------------------- -->
                        <!-- Priority High -->
                        <!-- ---------------------------------------- -->
                        <span *ngIf="request?.priority === 'high'" matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{'Priority' | translate}}: {{'high' | translate}}" #tooltip="matTooltip"
                          matTooltipPosition='above' matTooltipHideDelay="100">
                          <img style="width: 15px;height: 15px; vertical-align: top;"
                            src="assets/img/priority_icons/high_v2.svg" class="img-fluid">

                        </span>
                        <!-- ---------------------------------------- -->
                        <!-- Priority Urgent -->
                        <!-- ---------------------------------------- -->
                        <span *ngIf="request?.priority === 'urgent'" matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{'Priority' | translate}}: {{'urgent' | translate}}" #tooltip="matTooltip"
                          matTooltipPosition='above' matTooltipHideDelay="100">
                          <img style="width: 15px;height: 15px; vertical-align: top;"
                            src="assets/img/priority_icons/urgent_v2.svg" class="img-fluid">

                        </span>
                        <!-- ---------------------------------------- -->
                        <!-- Priority Low -->
                        <!-- ---------------------------------------- -->
                        <span *ngIf="request?.priority === 'low'" matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{'Priority' | translate}}: {{'low' | translate}}" #tooltip="matTooltip"
                          matTooltipPosition='above' matTooltipHideDelay="100">
                          <img style="width: 15px;height: 15px; vertical-align: top;"
                            src="assets/img/priority_icons/low_v2.svg" class="img-fluid">

                        </span>
                      </div>
                    </div>
                    <!-- ---------------------------------------------------------------------- -->

                    <div class="sidebar-tab-wpr">
                      <!-- <mat-tab-group mat-align-tabs="center" [color]="rgb(5, 102, 255)">
                        <mat-tab label="Profile">Content 1</mat-tab>
                        <mat-tab label="Ticket">Content 2</mat-tab>
                        <mat-tab label="Notes ({{ notesArray?.length }})">Content 3</mat-tab>
                        <mat-tab label="Conversations">Content 4</mat-tab>
                        <mat-tab label="Attributes">Content 5</mat-tab>
                      </mat-tab-group> -->

                      <div class="more-options-dropdown-wpr">

                        <div width="57" offset="0" class="sidebar-tabs"
                          [ngClass]="{
                            'selectTab0': tab0 === true && tab1 === false && tab2 === false && tab3 === false && tab4 === false, 
                            'selectTab1': tab1 === true && tab0 === false && tab2 === false && tab3 === false && tab4 === false,
                            'selectTab2': tab2 === true && tab0 === false && tab1 === false && tab3 === false && tab4 === false,
                            'selectTab3': tab0 === false && tab1 === false && tab2 === false && tab3 === true && tab4 === false, 
                            'selectTab4': tab0 === false && tab1 === false && tab2 === false && tab3 === false && tab4 === true }">
                          <!-- ------------------------------------- -->
                          <!-- Arrow left -->
                          <!-- ------------------------------------- -->
                          <div class="sidebar-tab-arrow-left-wpr" [ngClass]="{'active-arrow': otherTabs === true}"
                            (click)="hasSelectMainTabs()">
                            <svg xmlns="http://www.w3.org/2000/svg" height="22" viewBox="0 0 24 24" width="22"
                              class="sidebar-tab-arrow-right"
                              style="min-width: 22px; min-height: 22px; transform: rotate(180deg);">
                              <path d="M0 0h24v24H0z" fill="none"></path>
                              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                            </svg>
                          </div>
                          <!-- ------------------------------------- -->
                          <!-- Main tabs -->
                          <!-- ------------------------------------- -->
                          <div *ngIf="mainTabs" class="sidebar-tab"
                            [ngClass]="{'sidebar-select-tab': tab0 === true && tab1 === false && tab2 === false && tab3 === false && tab4 === false}"
                            (click)="hasSelectedTab0()">
                            {{ 'UserProfile.Profile' | translate }}
                          </div>
                          <div *ngIf="mainTabs" class="sidebar-tab"
                            [ngClass]="{'sidebar-select-tab': tab0 === false && tab1 === true && tab2 === false && tab3 === false && tab4 === false}"
                            (click)="hasSelectedTab1()">
                            Ticket
                          </div>
                          <div *ngIf="mainTabs" class="sidebar-tab"
                            [ngClass]="{'sidebar-select-tab': tab0 === false && tab1 === false && tab2 === true && tab3 === false && tab4 === false}"
                            (click)="hasSelectedTab2()">
                            {{'Notes.Notes' | translate}} ({{ notesArray?.length }})
                          </div>
                          <!-- ------------------------------------- -->
                          <!-- Other tabs -->
                          <!-- ------------------------------------- -->
                          <div *ngIf="otherTabs" class="sidebar-tab"
                            [ngClass]="{'sidebar-select-tab': tab0 === false && tab1 === false && tab2 === false && tab3 === true && tab4 === false}"
                            (click)="hasSelectedTab3()">
                            {{'Conversations' | translate}}
                          </div>
                          <div *ngIf="otherTabs" class="sidebar-tab"
                            [ngClass]="{'sidebar-select-tab': tab0 === false && tab2 === false && tab1 === false && tab3 === false && tab4 === true}"
                            (click)="hasSelectedTab4()">
                            {{'Attributes' | translate }}
                          </div>
                          <!-- ------------------------------------- -->
                          <!-- Arrow right -->
                          <!-- ------------------------------------- -->
                          <div class="sidebar-tab-arrow-right-wpr" [ngClass]="{'active-arrow': mainTabs === true}"
                            (click)="hasSelectedMoreTabs()">
                            <svg xmlns="http://www.w3.org/2000/svg" height="22" viewBox="0 0 24 24" width="22"
                              class="sidebar-tab-arrow-right" style="min-width: 22px; min-height: 22px;">
                              <path d="M0 0h24v24H0z" fill="none"></path>
                              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                            </svg>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <appdashboard-contact-info *ngIf="tab0" [contact_details]="contact_details"
                  (onClickTagConversation)="onClickTagConversation()"
                  (contactEmailChanged)="onChangeContactEmail($event)">
                </appdashboard-contact-info>
                <div *ngIf="tab0" class="ul-wpr tab0-card1B"
                  [ngClass]="{'tab0-card1B-ticket': request?.subject, 'ul-wpr-chat': CHAT_PANEL_MODE === true }"
                  [ngStyle]="{ 'height': tagContainerElementHeight }">


                  <ul class="request-info-list">

                    <!-- ------------------------------------- -->
                    <!-- Project name only for chat-->
                    <!-- ------------------------------------- -->
                    <li class="project" *ngIf="CHAT_PANEL_MODE === true">
                      <div class="contact-row">
                        <span>
                          <svg class="project-icon" fill="none" height="22" viewBox="0 0 24 24" width="22"
                            xmlns="http://www.w3.org/2000/svg" style="min-width: 22px; min-height: 22px;"
                            matTooltipClass="custom-mat-tooltip" matTooltip="{{ 'Project' | translate }}"
                            #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100">
                            <path class="project-name-icon"
                              d="M22.002 12C22.002 6.477 17.524 2 12 2 6.476 1.999 2 6.477 2 12.001c0 5.186 3.947 9.45 9.001 9.952V20.11c-.778-.612-1.478-1.905-1.939-3.61h1.94V15H8.737a18.969 18.969 0 0 1-.135-5h6.794c.068.64.105 1.31.105 2h1.5c0-.684-.033-1.353-.095-2h3.358c.154.64.237 1.31.237 2h1.5ZM4.786 16.5h2.722l.102.396c.317 1.17.748 2.195 1.27 3.015a8.532 8.532 0 0 1-4.094-3.41ZM3.736 10h3.358a20.847 20.847 0 0 0-.095 2c0 1.043.075 2.051.217 3H4.043a8.483 8.483 0 0 1-.544-3c0-.682.08-1.347.232-1.983L3.736 10Zm5.122-5.902.023-.008C8.16 5.222 7.611 6.748 7.298 8.5H4.25c.905-2 2.56-3.587 4.608-4.402Zm3.026-.594L12 3.5l.126.006c1.262.126 2.48 2.125 3.045 4.995H8.83c.568-2.878 1.79-4.88 3.055-4.996Zm3.343.76-.107-.174.291.121a8.533 8.533 0 0 1 4.339 4.29h-3.048c-.298-1.665-.806-3.125-1.475-4.237Z M12 19a1 1 0 0 0 1 1h3v2h-.5a.5.5 0 1 0 0 1h4a.5.5 0 0 0 0-1H19v-2h3a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1v5Z"
                              fill="none"></path>
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 10px;">
                          <input *ngIf="!showSpinner" name="project" type="text" data-id="project"
                            class="form-control input-md" style="width: 240px;cursor: default;" title="{{project_name}}"
                            value="{{project_name}}" disabled>
                        </div>
                      </div>
                    </li>


                    <!-- ------------------------------------- -->
                    <!-- Browser & Operating sistem -->
                    <!-- ------------------------------------- -->
                    <li class="browser" *ngIf="request?.channel?.name !== CHANNELS_NAME.VOICE_VXML && request?.channel?.name !== CHANNELS_NAME.VOICE_TWILIO">
                      <div class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="22px"
                            viewBox="0 0 24 24" width="22px" fill="none" style="min-width: 22px; min-height: 22px;"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'Browser' | translate }}, {{ 'OperatingSystem' | translate }}"
                            #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100">
                            <g>
                              <rect fill="none" height="24" width="24" y="0" />
                            </g>
                            <g>
                              <g>
                                <path
                                  d="M20,3H4C2.9,3,2,3.9,2,5v11c0,1.1,0.9,2,2,2h3l-1,1v2h12v-2l-1-1h3c1.1,0,2-0.9,2-2V5C22,3.9,21.1,3,20,3z M20,16H4V5h16 V16z" />
                              </g>
                            </g>
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="browser" type="text" data-id="browser"
                            class="form-control input-md" title="{{ request?.ua_browser }}, {{ request?.ua_os }}"
                            disabled style="width: 240px;cursor: default;"
                            value="{{ request?.ua_browser }}, {{ request?.ua_os }}">

                        </div>
                      </div>
                    </li>

                    <!-- ------------------------------------- -->
                    <!-- Ip Address -->
                    <!-- ------------------------------------- -->
                    <li class="ip-address" *ngIf="request?.channel?.name !== CHANNELS_NAME.VOICE_VXML && request?.channel?.name !== CHANNELS_NAME.VOICE_TWILIO">
                      <div class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                            fill="none" style="min-width: 22px; min-height: 22px;" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{'IPAddress' | translate}}" #tooltip="matTooltip" matTooltipPosition='right'
                            matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="ip-address" type="text" data-id="ip-address"
                            class="form-control input-md" title="ip-address" disabled
                            style="width: 240px;cursor: default;" value="{{ ipAddress }}">

                        </div>
                      </div>
                    </li>

                    <!-- ------------------------------------- -->
                    <!-- Channel VOICE - Called Number -->
                    <!-- ------------------------------------- -->
                    <li class="dnis" *ngIf="request?.channel?.name === CHANNELS_NAME.VOICE_VXML || request?.channel?.name === CHANNELS_NAME.VOICE_TWILIO">
                      <div class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                            fill="none" style="min-width: 22px; min-height: 22px;" matTooltipClass="custom-mat-tooltip"
                            matTooltip="Called Number" #tooltip="matTooltip" matTooltipPosition='right'
                            matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M20 15.5c-1.25 0-2.45-.2-3.57-.57-.1-.03-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.58l2.2-2.21c.28-.27.36-.66.25-1.01C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1zM5.03 5h1.5c.07.88.22 1.75.46 2.59L5.79 8.8c-.41-1.21-.67-2.48-.76-3.8zM19 18.97c-1.32-.09-2.6-.35-3.8-.76l1.2-1.2c.85.24 1.72.39 2.6.45v1.51zM12 3v10l3-3h6V3h-9zm7 5h-5V5h5v3z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="dnis" type="text" data-id="dnis"
                            class="form-control input-md" title="{{ dialedNumberIdentificationService}}" disabled
                            style="width: 240px;cursor: default;" value="{{ dialedNumberIdentificationService }}">

                        </div>
                      </div>
                    </li>

                    <!-- ------------------------------------- -->
                    <!-- Channel VOICE - Duration -->
                    <!-- ------------------------------------- -->
                    <li class="duration" *ngIf="(request?.channel?.name === CHANNELS_NAME.VOICE_VXML || request?.channel?.name === CHANNELS_NAME.VOICE_TWILIO) && requestDuration">
                      <div class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="22px"
                            viewBox="0 0 24 24" width="22px" fill="none" style="min-width: 22px; min-height: 22px;"
                            matTooltipClass="custom-mat-tooltip" matTooltip="Duration" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">
                            <g>
                              <rect fill="none" height="24" width="24" />
                            </g>
                            <g>
                              <g>
                                <g>
                                  <path
                                    d="M15,1H9v2h6V1z M11,14h2V8h-2V14z M19.03,7.39l1.42-1.42c-0.43-0.51-0.9-0.99-1.41-1.41l-1.42,1.42 C16.07,4.74,14.12,4,12,4c-4.97,0-9,4.03-9,9s4.02,9,9,9s9-4.03,9-9C21,10.88,20.26,8.93,19.03,7.39z M12,20c-3.87,0-7-3.13-7-7 s3.13-7,7-7s7,3.13,7,7S15.87,20,12,20z" />
                                </g>
                              </g>
                            </g>
                          </svg>

                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="duration" type="text" data-id="duration"
                            class="form-control input-md" title="{{ requestDuration }}" disabled
                            style="width: 240px;cursor: default;" value="{{ requestDuration }}">

                          <!-- <div *ngIf="requestDuration === 'N/A' ">
                              <span class="material-icons-outlined">
                                question_mark
                                </span>
                            </div> -->

                        </div>
                      </div>
                    </li>


                    <!-- ------------------------------------- -->
                    <!-- Language -->
                    <!-- ------------------------------------- -->
                    <li class="language" *ngIf="request?.language">
                      <div class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" height="22px" width="22px" viewBox="0 0 24 24"
                            style="min-width: 22px; min-height: 22px;" fill="none" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'Language' | translate }}" #tooltip="matTooltip" matTooltipPosition='right'
                            matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2s.07-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="language" type="text" data-id="language"
                            class="form-control input-md" title="{{ request?.language }}" disabled
                            value="{{ request?.language }}" style="cursor: default;text-transform: capitalize;">
                        </div>
                      </div>
                    </li>

                    <!-- ------------------------------------- -->
                    <!-- Deparment -->
                    <!-- ------------------------------------- -->
                    <li class="deparment"
                      *ngIf="request?.department && request?.department?.name !== 'Default Department'">
                      <div class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" height="22px" width="22px" viewBox="0 0 24 24"
                            style="min-width: 22px; min-height: 22px;" fill="none" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'Department' | translate }}" #tooltip="matTooltip" matTooltipPosition='right'
                            matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M6.5 10h-2v7h2v-7zm6 0h-2v7h2v-7zm8.5 9H2v2h19v-2zm-2.5-9h-2v7h2v-7zm-7-6.74L16.71 6H6.29l5.21-2.74m0-2.26L2 6v2h19V6l-9.5-5z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="deparment" type="text" data-id="deparment"
                            class="form-control input-md" title="{{request?.department?.name}}" disabled
                            value="{{request?.department?.name}}" style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>

                    <!-- ------------------------------------- -->
                    <!-- Viewed-pages -->
                    <!-- ------------------------------------- -->
                    <li class="viewed-pages" *ngIf="viewedPages && viewedPages?.length > 0">
                      <div id="contact-row-source-pages" class="contact-row input-row">
                        <span>
                          <!-- <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                            style="min-width: 22px; min-height: 22px;" fill="none" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'SourceWebPage' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-.61.08-1.21.21-1.78L8.99 15v1c0 1.1.9 2 2 2v1.93C7.06 19.43 4 16.07 4 12zm13.89 5.4c-.26-.81-1-1.4-1.9-1.4h-1v-3c0-.55-.45-1-1-1h-6v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41C17.92 5.77 20 8.65 20 12c0 2.08-.81 3.98-2.11 5.4z" />
                          </svg> -->

                          <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                            style="min-width: 22px; min-height: 22px;" fill="none" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{'ViewedPages' | translate}}" #tooltip="matTooltip" matTooltipPosition='right'
                            matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 14H3V5h18v12zm-2-9H8v2h11V8zm0 4H8v2h11v-2zM7 8H5v2h2V8zm0 4H5v2h2v-2z" />
                          </svg>
                        </span>

                        <div class="form-group" style="margin-top: 9px;" (click)="toggleViewedPages()"
                          [ngStyle]="{'width':CHAT_PANEL_MODE === true ? 'unset' : '100%' }">
                          <input id="source-page-input" name="sourcepage" type="text" data-id="sourcepage"
                            class="form-control input-md" disabled value="{{'ViewedPages' | translate}}"
                            style="cursor: pointer;" [ngStyle]="{'width':CHAT_PANEL_MODE === true ? '220px' : '100%' }">
                        </div>

                        <div class="action-btns-arrow" (click)="toggleViewedPages()">
                          <button type="button" data-id="toggle-viewed-pages"
                            [ngStyle]="{'margin-right':CHAT_PANEL_MODE === true ? '0px' : '-11px' }">
                            <svg id="viewed-page-arrow-down" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                              viewBox="0 0 24 24" width="24px"
                              style="min-width: 24px; min-height: 24px;position: relative;right: 3px;top: -2px;">
                              <path d="M24 24H0V0h24v24z" fill="none" opacity=".87" />
                              <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z" />
                            </svg>
                          </button>
                        </div>
                      </div>
                    </li>

                    <li *ngIf="showViewedPages" class="viewed-pages-list">
                      <ul>
                        <li *ngFor="let page of viewedPages" class="viewed-pages-wpr" style="padding-left: 8px;">
                          <a style="font-weight: 400;" class="viewed-pages-anchor" title="{{page?.viewedPageTitle}}"
                            href="{{page?.viewedPageLink}}" target="_blank">
                            <div class="viewed-pages-dot"> </div>
                            <span class="viewed-pages-title">
                              {{page?.viewedPageTitle}}
                            </span>
                            <div class="viewed-pages-url">
                              {{page?.viewedPageLink}}
                            </div>
                          </a>
                        </li>
                      </ul>
                    </li>

                    <!-- ---------------------------------------- -->
                    <!-- Request Channel telegram  -->
                    <!-- ---------------------------------------- -->
                    <li class="telegram-channel" *ngIf="request?.channel?.name === CHANNELS_NAME.TELEGRAM">
                      <div id="contact-row-telegram-channel" class="contact-row">
                        <span>

                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" height="20px" width="20px"
                            style="min-width: 20px; min-height: 20px;margin-right: 13px;" fill="none"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'MessageChannel' | translate }}: Telegram" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">

                            <path
                              d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="telegram-channel" type="text" data-id="telegram-channel"
                            class="form-control input-md" title="Telegram" disabled
                            value="Telegram ({{telegramPhoneNumber}})" style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>

                    <!-- ---------------------------------------- -->
                    <!-- Request Channel SMS  -->
                    <!-- ---------------------------------------- -->
                    <li class="sms-channel" *ngIf="request?.channel?.name === CHANNELS_NAME.SMS_TWILIO">
                      <div id="contact-row-sms-channel" class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="20px" width="20px"
                            style="min-width: 20px; min-height: 20px;margin-right: 13px;" fill="none"
                            matTooltipClass="custom-mat-tooltip" matTooltip="{{ 'MessageChannel' | translate }}: SMS"
                            #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100">
                            <path
                              d="M256 448c141.4 0 256-93.1 256-208S397.4 32 256 32S0 125.1 0 240c0 45.1 17.7 86.8 47.7 120.9c-1.9 24.5-11.4 46.3-21.4 62.9c-5.5 9.2-11.1 16.6-15.2 21.6c-2.1 2.5-3.7 4.4-4.9 5.7c-.6 .6-1 1.1-1.3 1.4l-.3 .3c0 0 0 0 0 0c0 0 0 0 0 0s0 0 0 0s0 0 0 0c-4.6 4.6-5.9 11.4-3.4 17.4c2.5 6 8.3 9.9 14.8 9.9c28.7 0 57.6-8.9 81.6-19.3c22.9-10 42.4-21.9 54.3-30.6c31.8 11.5 67 17.9 104.1 17.9zM96 212.8c0-20.3 16.5-36.8 36.8-36.8l19.2 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-19.2 0c-2.7 0-4.8 2.2-4.8 4.8c0 1.6 .8 3.1 2.2 4l29.4 19.6c10.3 6.8 16.4 18.3 16.4 30.7c0 20.3-16.5 36.8-36.8 36.8L112 304c-8.8 0-16-7.2-16-16s7.2-16 16-16l27.2 0c2.7 0 4.8-2.2 4.8-4.8c0-1.6-.8-3.1-2.2-4l-29.4-19.6C102.2 236.7 96 225.2 96 212.8zM372.8 176l19.2 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-19.2 0c-2.7 0-4.8 2.2-4.8 4.8c0 1.6 .8 3.1 2.2 4l29.4 19.6c10.2 6.8 16.4 18.3 16.4 30.7c0 20.3-16.5 36.8-36.8 36.8L352 304c-8.8 0-16-7.2-16-16s7.2-16 16-16l27.2 0c2.7 0 4.8-2.2 4.8-4.8c0-1.6-.8-3.1-2.2-4l-29.4-19.6c-10.2-6.8-16.4-18.3-16.4-30.7c0-20.3 16.5-36.8 36.8-36.8zm-152 6.4L256 229.3l35.2-46.9c4.1-5.5 11.3-7.8 17.9-5.6s10.9 8.3 10.9 15.2l0 96c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-48-19.2 25.6c-3 4-7.8 6.4-12.8 6.4s-9.8-2.4-12.8-6.4L224 240l0 48c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-96c0-6.9 4.4-13 10.9-15.2s13.7 .1 17.9 5.6z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="sms-channel" type="text" data-id="sms-channel"
                            class="form-control input-md" title="SMS" disabled value="SMS"
                            style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>

                    <!-- ---------------------------------------- -->
                    <!-- Request Channel voice  -->
                    <!-- ---------------------------------------- -->
                    <li class="voice-channel" *ngIf="request?.channel?.name === CHANNELS_NAME.VOICE_VXML || request?.channel?.name === CHANNELS_NAME.VOICE_TWILIO">
                      <div id="contact-row-voice-channel" class="contact-row">
                        <span>

                          <!-- <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" height="20px" width="20px"
                            style="min-width: 20px; min-height: 20px;margin-right: 13px;" fill="none"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'MessageChannel' | translate }}: Telegram" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">

                            <path
                              d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z" />
                          </svg> -->
                          <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
                            fill="none" style="min-width: 20px; min-height: 20px;margin-right: 13px;"
                            matTooltipClass="custom-mat-tooltip" matTooltip="{{ 'MessageChannel' | translate }}: Voice"
                            #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path d="M7 18h2V6H7v12zm4 4h2V2h-2v20zm-8-8h2v-4H3v4zm12 4h2V6h-2v12zm4-8v4h2v-4h-2z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="voice-channel" type="text" data-id="voice-channel"
                            class="form-control input-md" title="voice" disabled value="Voice"
                            style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>

                    <!-- ---------------------------------------- -->
                    <!-- Request Channel whatsapp   -->
                    <!-- ---------------------------------------- -->
                    <li class="whatsapp-channel" *ngIf="request?.channel?.name === CHANNELS_NAME.WHATSAPP">
                      <div id="contact-row-whatsapp-channel" class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="22px" width="22px"
                            style="min-width: 22px; min-height: 22px; margin-left: -1px;margin-right: 13px;"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'MessageChannel' | translate }}: WhatsApp" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">

                            <path
                              d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" />
                          </svg>
                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="whatsapp-channel" type="text" data-id="whatsapp-channel"
                            class="form-control input-md" title="WhatsApp" disabled
                            value="WhatsApp ({{whatsAppPhoneNumber}})" style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>

                    <!-- ---------------------------------------- -->
                    <!-- Request Channel messenger  -->
                    <!-- ---------------------------------------- -->
                    <li class="messenger-channel" *ngIf="request?.channel?.name === CHANNELS_NAME.MESSANGER">
                      <div id="contact-row-messenger-channel" class="contact-row">
                        <span>

                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="20px" width="20px"
                            style="min-width: 20px; min-height: 20px; margin-right: 14px;" fill="none"
                            matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'MessageChannel' | translate }}: Facebook Messenger" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">
                            <path
                              d="M256.55 8C116.52 8 8 110.34 8 248.57c0 72.3 29.71 134.78 78.07 177.94 8.35 7.51 6.63 11.86 8.05 58.23A19.92 19.92 0 0 0 122 502.31c52.91-23.3 53.59-25.14 62.56-22.7C337.85 521.8 504 423.7 504 248.57 504 110.34 396.59 8 256.55 8zm149.24 185.13l-73 115.57a37.37 37.37 0 0 1-53.91 9.93l-58.08-43.47a15 15 0 0 0-18 0l-78.37 59.44c-10.46 7.93-24.16-4.6-17.11-15.67l73-115.57a37.36 37.36 0 0 1 53.91-9.93l58.06 43.46a15 15 0 0 0 18 0l78.41-59.38c10.44-7.98 24.14 4.54 17.09 15.62z" />
                          </svg>

                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="messenger-channel" type="text" data-id="messenger-channel"
                            class="form-control input-md" title="Facebook Messenger" disabled value="Facebook Messenger"
                            style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>


                    <!-- ---------------------------------------- -->
                    <!-- Request Channel email    -->
                    <!-- ---------------------------------------- -->
                    <li class="email-channel" *ngIf="request?.channel?.name === CHANNELS_NAME.EMAIL">
                      <div id="contact-row-email-channel" class="contact-row">
                        <span>
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18px" width="18px"
                            style="min-width: 18px; min-height: 18px; margin-right: 15px; margin-left: 1px;" fill="none"
                            matTooltipClass="custom-mat-tooltip" matTooltip="{{ 'MessageChannel' | translate }}: Email"
                            #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100">

                            <path
                              d="M256 64C150 64 64 150 64 256s86 192 192 192c17.7 0 32 14.3 32 32s-14.3 32-32 32C114.6 512 0 397.4 0 256S114.6 0 256 0S512 114.6 512 256v32c0 53-43 96-96 96c-29.3 0-55.6-13.2-73.2-33.9C320 371.1 289.5 384 256 384c-70.7 0-128-57.3-128-128s57.3-128 128-128c27.9 0 53.7 8.9 74.7 24.1c5.7-5 13.1-8.1 21.3-8.1c17.7 0 32 14.3 32 32v80 32c0 17.7 14.3 32 32 32s32-14.3 32-32V256c0-106-86-192-192-192zm64 192a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z" />
                          </svg>

                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="email-channel" type="text" data-id="email-channel"
                            class="form-control input-md" title="Email" disabled value="Email"
                            style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>

                    <!-- ---------------------------------------- -->
                    <!-- Request Channel Form -->
                    <!-- ---------------------------------------- -->
                    <li class="form-channel" *ngIf="request?.channel?.name === CHANNELS_NAME.FORM">
                      <div id="contact-row-form-channel" class="contact-row">
                        <span>

                          <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                            style="min-width: 22px; min-height: 22px; margin-left: -1px;margin-right: 13px; "
                            fill="none" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'MessageChannel' | translate }}: Form" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M11 7h6v2h-6zm0 4h6v2h-6zm0 4h6v2h-6zM7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7zM20.1 3H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9zM19 19H5V5h14v14z" />
                          </svg>

                        </span>
                        <div class="form-group" style="margin-top: 9px;">
                          <input *ngIf="!showSpinner" name="form-channel" type="text" data-id="form-channel"
                            class="form-control input-md" title="Form" disabled value="Form"
                            style="cursor: default;width: 240px;">
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>

                <!-- ------------------------------------- -->
                <!-- Rating - Apps - Prechat accordion -->
                <!-- ------------------------------------- -->
                <div *ngIf="tab0" class="tab0-card2">
                  <div class="tab0-card2-content-wpr"
                    [ngClass]="{'tab0-card2-content-wpr-chat': CHAT_PANEL_MODE === true}">
                    <ng-container *ngIf="displayChatRatings">
                      <div class="tab0-card2-content" [ngClass]="{'tab0-card2-content-chat': CHAT_PANEL_MODE === true}">
                        <header class="tab0-card2-header">
                          <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="22px"
                            viewBox="0 0 24 24" fill="none" style="min-width: 22px; min-height: 22px;"
                            class="rating-icon" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.Rating' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">
                            <g>
                              <path d="M0,0h24v24H0V0z" fill="none" />
                            </g>
                            <g>
                              <g>
                                <path
                                  d="M20,2H4C2.9,2,2,2.9,2,4v18l4-4h14c1.1,0,2-0.9,2-2V4C22,2.9,21.1,2,20,2z M20,16H5.17L4,17.17V4h16V16z" />
                                <polygon points="12,15 13.57,11.57 17,10 13.57,8.43 12,5 10.43,8.43 7,10 10.43,11.57" />
                              </g>
                            </g>
                          </svg>
                          <div>
                            <div class="rating-group" *ngIf="request">

                              <span class="material-icons"
                                [ngClass]="{'yellow-star': request?.rating === 1 || request?.rating === 2 || request?.rating === 3 || request?.rating === 4 || request?.rating === 5}">
                                star
                              </span>
                              <span class="material-icons"
                                [ngClass]="{'yellow-star': request?.rating === 2 || request?.rating === 3 || request?.rating === 4 || request?.rating === 5}">
                                star
                              </span>
                              <span class="material-icons"
                                [ngClass]="{'yellow-star': request?.rating === 3 || request?.rating === 4 || request?.rating === 5}">
                                star
                              </span>
                              <span class="material-icons"
                                [ngClass]="{'yellow-star': request?.rating === 4 || request?.rating === 5}">
                                star
                              </span>
                              <span class="material-icons" [ngClass]="{'yellow-star': request?.rating === 5 }">
                                star
                              </span>
                            </div>
                            <span tabindex="0" class="rating-message" *ngIf="request">
                              <span *ngIf="!request.rating_message">
                                {{'NoCustomerReviewMessage' | translate}}
                              </span>
                              <span *ngIf="request.rating_message">
                                {{request?.rating_message}}
                              </span>
                            </span>
                          </div>
                        </header>
                      </div>
                    </ng-container>
                    <!--  -->
                    <ng-container *ngIf="!displayChatRatings">
                      <div class="tab0-card2-content" [ngClass]="{'tab0-card2-content-chat': CHAT_PANEL_MODE === true}">
                        <header class="tab0-card2-header ">
                          <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="22px"
                            viewBox="0 0 24 24" fill="none" style="min-width: 22px; min-height: 22px;"
                            class="rating-icon" matTooltipClass="custom-mat-tooltip"
                            matTooltip="{{ 'RequestMsgsPage.Rating' | translate }}" #tooltip="matTooltip"
                            matTooltipPosition='right' matTooltipHideDelay="100">
                            <g>
                              <path d="M0,0h24v24H0V0z" fill="none" />
                            </g>
                            <g>
                              <g>
                                <path
                                  d="M20,2H4C2.9,2,2,2.9,2,4v18l4-4h14c1.1,0,2-0.9,2-2V4C22,2.9,21.1,2,20,2z M20,16H5.17L4,17.17V4h16V16z" />
                                <polygon points="12,15 13.57,11.57 17,10 13.57,8.43 12,5 10.43,8.43 7,10 10.43,11.57" />
                              </g>
                            </g>
                          </svg>
                          <div>
                            <div class="rating-group">
                              <span class="material-icons">
                                star
                              </span>
                              <span class="material-icons">
                                star
                              </span>
                              <span class="material-icons">
                                star
                              </span>
                              <span class="material-icons">
                                star
                              </span>
                              <span class="material-icons">
                                star
                              </span>

                            </div>
                            <button class="btn btn-get--feature-no-boxshadow pull-right" (click)="goToPricingFromChat()"
                              matTooltipClass="custom-mat-tooltip"
                              matTooltip=" {{'UpgradePlanToGetTheFeature' | translate}}" #tooltip="matTooltip"
                              matTooltipPosition='below' matTooltipHideDelay="100">
                              <span class="material-icons-outlined get--feature-upgrade-plan-icon">
                                upgrade
                              </span>
                              <span>
                                {{ 'Pricing.UpgradePlan' | translate }}
                              </span>
                            </button>

                          </div>
                        </header>
                      </div>
                    </ng-container>
                  </div>

                  <!-- ------------------------------------- -->
                  <!-- Apps -->
                  <!-- ------------------------------------- -->
                  <div *ngIf="tab0 && isVisibleAPP === true && displayAppsinSidebar" class="tab0-card3"
                    [ngClass]="{'tab0-card3-chat': CHAT_PANEL_MODE === true}">
                    <div class="tab0-card3-content-wpr"
                      [ngClass]="{'tab0-card3-content-wpr-chat': CHAT_PANEL_MODE === true}">
                      <div class="tab0-card3-content">
                        <button type="button" class="tab0-card3-btn" (click)="openAppsSidebar()">
                          <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                            fill="none" style="min-width: 22px; min-height: 22px;">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z" />
                          </svg>

                          <div class="tab0-card3-text">
                            <span>Apps</span>
                          </div>

                        </button>
                      </div>

                    </div>
                  </div>

                  <!--  ---------------------------------------------------------------- -->
                  <!--  @ Pre-chat form accordion -->
                  <!--  ---------------------------------------------------------------- -->
                  <div id="pre-chat-form-accordion" *ngIf="tab0 && request?.attributes?.preChatForm">
                    <div class="attributes-pre-chat-form-accordion-wpr"
                      [ngClass]="{'attributes-pre-chat-form-accordion-wpr-chat': CHAT_PANEL_MODE === true}">
                      <div class="attributes-pre-chat-form-accordion"
                        [ngClass]="{'attributes-pre-chat-form-accordion-chat': CHAT_PANEL_MODE === true}"
                        (click)="openAttributesPrechatFormAccordion()">

                        <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px"
                          viewBox="0 0 24 24" width="24px" fill="none">
                          <g>
                            <rect fill="none" height="24" width="24" />
                          </g>
                          <g>
                            <g>
                              <path
                                d="M20,3H4C2.9,3,2,3.9,2,5v14c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V5 C22,3.9,21.1,3,20,3z M20,19H4V5h16V19z"
                                fill-rule="evenodd" />
                              <polygon fill-rule="evenodd"
                                points="19.41,10.42 17.99,9 14.82,12.17 13.41,10.75 12,12.16 14.82,15" />
                              <rect fill-rule="evenodd" height="2" width="5" x="5" y="7" />
                              <rect fill-rule="evenodd" height="2" width="5" x="5" y="11" />
                              <rect fill-rule="evenodd" height="2" width="5" x="5" y="15" />
                            </g>
                          </g>
                        </svg>

                        <span class="pre-chat-accordion-title">
                          {{ "PreChatFormData" | translate }}
                        </span>
                      </div>

                      <div class="attributes-pre-chat-form-accordion-panel">
                        <div *ngFor="let attribute of preChatFormArray; let i = index">
                          <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                            <div class="row">
                              <div class="col-xs-10" style="padding-right: 1px;padding-bottom: 5px;">
                                <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes">
                                  {{attribute?.attributeName }}:
                                </div>
                                <!-- attribute_cutted_text -->
                                <div aria-expanded="false" [id]="attribute?.attributeName +'_value'" class="attribute">
                                  {{attribute?.attributeValue }}
                                </div>
                              </div>

                              <div class="col-xs-2 copy-icon-wpr"
                                (click)="copyToClipboardPreChatFormValue(attribute?.attributeValue, attribute?.attributeName +'_tooltip')">
                                <div [id]="attribute?.attributeName +'_tooltip'" class="has-copied-tooltip">
                                  {{ 'Copied' | translate }}
                                </div>
                                <span class="material-icons-outlined copy-icon">
                                  content_copy
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> <!-- ./ end pre-chat form accordion -->

                  <!--  ------------------------------------------------------------------------------------- -->
                  <!--  @ Chatbot attributes accordion  Not used (see in ts this.getBotConversationAttribute) -->
                  <!--  ------------------------------------------------------------------------------------- -->
                  <ng-container *ngIf="HIDE_CHATBOT_ATTRIBUTES === false">
                    <div id="chatbot-attributes-accordion"
                      *ngIf="tab0 && botConversationArray && botConversationArray.length > 0">
                      <div class="chatbot-conv-accordion-wpr"
                        [ngClass]="{'chatbot-conv-accordion-wpr-chat': CHAT_PANEL_MODE === true}">

                        <div class="chatbot-conv-accordion"
                          [ngClass]="{'chatbot-conv-accordion-chat': CHAT_PANEL_MODE === true}"
                          (click)="openChatbotAttributesAccordion(isOpenChatbotAttributesAccordion = !isOpenChatbotAttributesAccordion)">


                          <!-- <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24" fill="none">
                            <path
                              d="M482 1016v-60h298v-54H632V606h148v-68q0-124-87-213.5T482 235q-124 0-213 89.5T180 538v68h148v296H180q-24 0-42-18t-18-42V538q0-74.733 28.5-140.881Q177 330.97 226 281.485T341.204 203.5q66.205-28.5 141-28.5Q557 175 622.5 203.5 688 232 736.052 281.485q48.051 49.485 76 115.634Q840 463.267 840 538v418q0 24-18 42t-42 18H482ZM180 842h88V666h-88v176Zm512 0h88V666h-88v176Zm88 0h-88 88Zm-512 0h-88 88Z" />
                            </svg> -->
                          <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 48 48"
                            style="enable-background:new 0 0 48 48;" xml:space="preserve" fill="none" height="24"
                            width="24">
                            <g>
                              <circle cx="16.8" cy="27.5" r="3.1" />
                              <path d="M24.9,8.6V6.8V5.1c1.2-0.5,1.8-1.9,1.3-3.1c-0.5-1.2-1.9-1.8-3.1-1.3c-1.2,0.5-1.8,1.9-1.3,3.1c0.2,0.6,0.7,1,1.3,1.3v1.7
                            v1.8c-10.4,0.5-18.5,9.4-18,19.8c0.5,10.4,9.4,18.5,19.8,18c10.4-0.5,18.5-9.4,18-19.8C42.4,16.8,34.6,9,24.9,8.6z M24,37.2
                            c-8.9,0-16-4.4-16-9.7s7.2-9.7,16-9.7c8.9,0,16,4.4,16,9.7v0C40,32.8,32.9,37.2,24,37.2z" />
                              <path
                                d="M31.2,24.4c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1v0c1.7,0,3.1-1.4,3.1-3.1C34.3,25.8,32.9,24.4,31.2,24.4z" />
                            </g>
                          </svg>

                          <span class="chatbot-attributes-accordion-title">
                            {{ "ChatbotAttributes" | translate }}
                          </span>
                        </div>

                        <div class="chatbot-conv-accordion-panel">
                          <div *ngFor="let attribute of botConversationArray; let i = index">
                            <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                              <div class="row">
                                <div class="col-xs-12" style="padding-right: 1px;padding-bottom: 5px;">
                                  <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes">
                                    {{attribute?.attributeName }}:
                                  </div>
                                  <!-- attribute_cutted_text -->
                                  <div aria-expanded="false" [id]="attribute?.attributeName +'_value'" class="attribute"
                                    style="margin-right: 16px; word-break: break-all;">
                                    {{attribute?.attributeValue }}
                                  </div>
                                </div>


                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div> <!-- ./ end Conversation attributes accordion accordion -->
                  </ng-container>

                </div>
              </div>

              <div *ngIf="tab1" class="ul-wpr" [ngClass]="{'ul-wpr-chat': CHAT_PANEL_MODE === true}">

                <ul class="ticket-info-list">
                  <!-- ------------------------------------- -->
                  <!-- ticket id -->
                  <!-- ------------------------------------- -->
                  <li *ngIf="request?.ticket_id" class="ticket-id">
                    <div class="contact-row">
                      <span class="ticket-id-text" style="white-space: nowrap;">
                        {{ 'TicketId' | translate }}
                      </span>

                      <!-- <span>
                        <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                          fill="none" style="min-width: 22px; min-height: 22px;" matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'TicketId' | translate }}" #tooltip="matTooltip" matTooltipPosition='right'
                          matTooltipHideDelay="100">
                          <path d="M0 0h24v24H0V0z" fill="none" />
                          <path
                            d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                        </svg> -->
                      <!-- </span> -->
                      <div class="form-group" style="margin-top: 10px;">
                        <input *ngIf="!showSpinner" name="ticket_id" type="text" data-id="ticket_id"
                          class="form-control input-md" style="width: 240px;cursor: default;"
                          title="#{{ request?.ticket_id}}" value="#{{ request?.ticket_id}}" disabled>
                      </div>
                    </div>
                  </li>

                  <!-- ------------------------------------- -->
                  <!-- Ticket Subject -->
                  <!-- ------------------------------------- -->
                  <li class="ticket-subject" *ngIf="request?.subject">
                    <div class="contact-row">
                      <span>
                        <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px"
                          fill="none" style="min-width: 22px; min-height: 22px;">
                          <path d="M0 0h24v24H0V0z" fill="none" />
                          <path d="M21 11.01L3 11v2h18zM3 16h12v2H3zM21 6H3v2.01L21 8z"
                            matTooltipClass="custom-mat-tooltip" matTooltip="{{ 'Subject' | translate }}"
                            #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100" />
                        </svg>
                      </span>
                      <div class="form-group" style="margin-top: 2px;">
                        <input type="text" name="ticket-subject" data-id="ticket-subject" class="form-control input-md"
                          [(ngModel)]="ticketSubject" maxlength="255" (blur)="saveEditInPlaceSubject()"
                          (keydown.enter)='saveEditInPlaceSubject()' autocomplete="off" style="padding-bottom: 2px;"
                          required>
                      </div>
                      <div class="action-btns">
                        <button type="button" data-id="email" (click)="removeTicket()">
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                            style="min-width: 20px; min-height: 20px;">
                            <path
                              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z">
                            </path>
                            <path d="M0 0h24v24H0z" fill="none"></path>
                          </svg>
                        </button>
                      </div>
                    </div>
                    <div *ngIf="ticketSubject?.length === 0"
                      style="color: #f44336; position: relative;  top: -8px; font-size: 12px;font-weight: 400;margin-left: 34px;">
                      {{'FieldRequired' | translate}}
                    </div>
                  </li>
                </ul>


                <!-- ----------------------------------------------------------------------------- -->
                <!-- Priority -->
                <!-- ----------------------------------------------------------------------------- -->
                <div class="row ticket--panel" [ngClass]="{'ticket--panel-chat': CHAT_PANEL_MODE === true}">
                  <div class="col-sm-12">
                    <p class="ticket--panel-row-header">

                      <span style="vertical-align: middle">
                        {{ 'Priority' | translate }}
                      </span>
                    </p>
                  </div>

                  <div class="col-sm-12" style="margin-bottom: 8px;">

                    <ng-select class="ticket-priority" [items]="priority" bindLabel="name" bindValue="name"
                      [clearable]="false" [hideSelected]="true" [(ngModel)]="selectedPriority"
                      (change)="onChangeSelectedPriority(selectedPriority)">
                      <ng-template ng-label-tmp let-item="item">
                        <img style="width: 15px;height: 15px;" height="15" width="15" [src]="item.avatar" />
                        {{item.name | translate}}
                      </ng-template>
                      <ng-template ng-option-tmp let-item="item" let-index="index">
                        <img style="width: 15px;height: 15px;" height="15" width="15" [src]="item.avatar" />
                        {{item.name | translate }}
                      </ng-template>
                    </ng-select>
                  </div>
                </div>


                <!-- ----------------------------------------------------------------------------- -->
                <!-- Followers -->
                <!-- ----------------------------------------------------------------------------- -->
                <div class="row ticket--panel">
                  <div class="col-sm-12">
                    <div class="ticket--panel-row-header">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        <span class="followers-label" [ngClass]="{'followers-label-chat':CHAT_PANEL_MODE === true}">
                         {{'Followers' | translate}}
                        </span>
                        <span matTooltipClass="custom-mat-tooltip"
                          matTooltip="{{ 'AddTeammatesAsFollowers' | translate }}" #tooltip="matTooltip"
                          matTooltipPosition='right' matTooltipHideDelay="100">
                          <i class="material-icons">
                            help_outline
                          </i>
                        </span>
                      </span>


                      <!-- <button *ngIf="CURRENT_USER_IS_A_FOLLOWER === false" (click)="follow()" class="follow-btn">
                          {{'Follow' | translte}}
                        </button>


                        <button *ngIf="CURRENT_USER_IS_A_FOLLOWER === true" (click)="unfollow()" class="follow-btn">
                          {{'Unfollow' | translte}}
                        </button> -->


                    </div>
                  </div>

                  <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">
                    <div class="followers-container" [ngClass]="{'followers-container-chat':CHAT_PANEL_MODE === true}">

                      <div class="followers">
                        <!-- (change)="getValues($event)" -->
                        <ng-select class="ticket-followers" [items]="projectTeammates" 
                          bindLabel="label"
                          [multiple]="true" placeholder="Search teammate" 
                          [(ngModel)]="selectedFollowers"
                          (add)="addFollower($event)" 
                          (remove)="removeFollower($event)" 
                          [hideSelected]="true"
                          (clear)="removeAllFollowers($event)">
                        </ng-select>

                        <div *ngIf="request?.channel?.name === CHANNELS_NAME.CHAT21" class="convert-to-offline-btn-wpr"
                          style="margin-top:14px">

                          <span *ngIf="request?.smartAssignment === true" class="convert-to-offline-btn"
                            (click)="smartAssignmentOff()">
                            {{'ConvertToOffline' | translate}}
                            <span matTooltipClass="custom-mat-tooltip"
                              matTooltip="{{'SmartReassignmentForThisConversationWillBeDisabled' | translate}}"
                              #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100">
                              <i class="material-icons">
                                help_outline
                              </i>
                            </span>
                          </span>

                          <span *ngIf="request?.smartAssignment === false" class="convert-to-offline-btn"
                            (click)="smartAssignmentOn()">
                            {{'ConvertToOnline' | translate}}
                            <span matTooltipClass="custom-mat-tooltip"
                              matTooltip="{{'SmartReassignmentForThisConversationWillBeEnabled' | translate}}"
                              #tooltip="matTooltip" matTooltipPosition='right' matTooltipHideDelay="100">
                              <i class="material-icons"
                                style=" font-size:16px; color:#7695a5;vertical-align: middle; cursor:pointer;position: relative;top: -2px;">
                                help_outline
                              </i>
                            </span>
                          </span>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- ------------------------------------------ -->
                <!-- @ Conversation Tags (new) -->
                <!-- ------------------------------------------ -->
                <div *ngIf="isVisibleLBS === true" class="tag-content-wpr"
                  [ngClass]="{'tag-content-wpr-chat': CHAT_PANEL_MODE === true}">
                  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"
                    style="min-width: 22px; min-height: 22px;" matTooltipClass="custom-mat-tooltip"
                    matTooltip="{{ 'Tags.Tags' | translate }}" #tooltip="matTooltip" matTooltipPosition='right'
                    matTooltipHideDelay="100">
                    <path d="M0 0h22v22H0z" fill="none"></path>
                    <path
                      d="M19.626 10.615l-8.25-8.25a1.822 1.822 0 00-1.293-.532H3.667a1.839 1.839 0 00-1.834 1.834v6.416c0 .505.202.963.541 1.302l8.25 8.25c.33.33.788.532 1.293.532.504 0 .962-.202 1.292-.541l6.417-6.417c.339-.33.54-.788.54-1.292 0-.505-.21-.972-.54-1.302zM5.042 6.417c-.761 0-1.375-.614-1.375-1.375s.614-1.375 1.375-1.375c.76 0 1.375.614 1.375 1.375 0 .76-.614 1.375-1.375 1.375z">
                    </path>
                  </svg>

                  <form style="min-height: 52px;" [ngStyle]="{'height':convTagContainerElementHeight }">
                    <div class="tags--container-wpr">
                      <div class="tags--container">
                        <div *ngIf="request?.tags?.length === 0" aria-label="tag" class="no-conv-tags-wpr">
                          <p weight="400" class="no-conv-tags"> {{'NoTAGAssignedYet' | translate}}</p>
                        </div>

                        <div class="tag" *ngFor="let tag of request?.tags" role="button">

                          <!-- --------------------------------------------------------------------------------------------------------------------------------------- -->
                          <!-- Revove tag (note: the request to remove tag in is not called if the current user has agent role and is not among the participants) -->
                          <!-- --------------------------------------------------------------------------------------------------------------------------------------- -->
                          <div (click)="removeTag(tag)">
                            <div class="icon-container" style="display: inline-block;">
                              <svg style="width: 13px; height: auto;position:absolute;margin-top: 6px;"
                                aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag"
                                class="svg-inline--fa-tag-icon fa-tag fa-w-16" role="img"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">

                                <path [ngStyle]="{'fill':tag.color}" class="tag_icon_in_ws_msgs"
                                  d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z">
                                </path>
                              </svg>
                              <span class="tag-delete">
                                <i class="material-icons delete_icon" style="font-size: 16px;"> close
                                </i>
                              </span>
                            </div>
                            {{ tag.tag}}
                          </div>

                        </div>
                      </div>
                      <div class="ng-select-tags-wpr" [ngStyle]="{'width':CHAT_PANEL_MODE === true ? 'auto' : 'auto' }">

                        <ng-select style="margin-right: 13px;" class="convs-tags" id="select-tag" #ngSelect
                          (change)="addTag()" [items]="tagsList" bindLabel="tag" bindValue="_id" [clearable]="false"
                          [clearSearchOnAdd]="true" [hideSelected]="true" placeholder="{{ typeALabelAndPressEnter}}"
                          [(ngModel)]="tag" addTagText="Create New" [addTag]="createNewTag"
                          (keyup.enter)="ngSelect.close()" notFoundText="No tags found. Type to create a tag"
                          [disabled]="DISABLE_ADD_NOTE_AND_TAGS === true">

                          <ng-template ng-label-tmp let-item="item">
                            <i [style.color]="item.color" class="fa fa-tag"
                              style="font-size: 18px;position: relative;top: 2px;margin-right: 5px;"></i>

                            {{item.tag}}
                          </ng-template>
                          <ng-template ng-option-tmp let-item="item" let-index="index">
                            <i [style.color]="item.color" class="fa fa-tag"
                              style="font-size: 18px;position: relative;top: 2px;margin-right: 5px;"></i>
                            {{item.tag}}
                          </ng-template>
                        </ng-select>
                      </div>

                    </div>
                  </form>

                </div> <!-- ./Conversation tag -->
                <div class="link-to-tags-page" *ngIf="CURRENT_USER_ROLE !== 'agent' && CHAT_PANEL_MODE === false"
                  (click)="goToTags()" class="manage_tags">
                  {{ 'Tags.ManageTags' | translate}}
                </div>
              </div>

              <div *ngIf="tab2">
                <div class="note--container" [ngClass]="{'note--container-chat': CHAT_PANEL_MODE === true}">
                  <div class="note--panel" [ngClass]="{'note--panel-chat': CHAT_PANEL_MODE === true}">
                    <div class="ws_msgs_note__textarea">
                      <textarea [(ngModel)]="new_note" placeholder="{{ 'Notes.AddANote' | translate  }}" rows="2"
                        style="width: 100%;">
                      </textarea>



                      <!--  ------------------------------------------------------------------------------------------------------------ -->
                      <!--  Btn Add Notes (note: is disabled if the current user has agent role and is not among the participants) -->
                      <!--  ------------------------------------------------------------------------------------------------------------ -->
                      <button type="button" class="btn btn-xs btn-primary ws_msgs_small_btn" #cont
                        style="margin-bottom: 0px;" (click)="addNote()"
                        [disabled]="!new_note || new_note?.length === 0 || DISABLE_ADD_NOTE_AND_TAGS === true">


                        <span *ngIf="showSpinnerInAddNoteBtn !== true">
                          <i class="material-icons" style="font-size: 15px;">add_circle</i>
                        </span>

                        <span *ngIf="showSpinnerInAddNoteBtn === true">
                          <i class="fa fa-spinner fa-spin" style="font-size: 15px;"></i>
                        </span>

                        {{ 'Notes.AddNote' | translate }}
                      </button>
                    </div>

                    <div *ngIf="notesArray?.length > 0" class="ws_request_notes__container" style="margin-top: 6px;">


                      <!--  ------------------------------------------------------ -->
                      <!--  @ Notes' cards -->
                      <!--  ------------------------------------------------------ -->
                      <div *ngFor="let note of notesArray;" class="ws_request_note">
                        <div class="ws_request_note__content">
                          {{ note?.text }}
                        </div>
                        <!-- HH:mm:ss -->
                        <div class="ws_request_note__footer">
                          {{ 'Created' | translate}} {{ note.createdAt| date: 'd/M/y'}} {{ 'By' | translate}}
                          {{ note?.createdBy_user?.firstname}} {{ note?.createdBy_user?.lastname}}
                        </div>



                        <!-- ------------------------------------------------------------ -->
                        <!-- @ Remove note btn (click)="presentModalDeleteNote(note._id)" -->
                        <!-- ------------------------------------------------------------ -->
                        <button *ngIf="currentUserID === note.createdBy " (click)="deleteNote(note._id)" type="button"
                          class="note__delete">
                          <i class="material-icons delete_icon" style="font-size:16px">close</i>
                        </button>
                      </div>

                    </div>

                  </div>
                </div>

              </div>

              <!-- ---------------------------------------- -->
              <!-- Tab 3 Contact conversations-->
              <!-- ---------------------------------------- -->
              <div *ngIf="tab3">

                <div class="contact--conversations-wpr"
                  [ngClass]="{'contact--conversations-wpr-chat': CHAT_PANEL_MODE === true}">
                  <div class="card card--no-border contact--conversations-card">
                    <div class="card-content table-responsive" style="padding:0px !important">
                      <table class="table table-hover">

                        <tbody>
                          <!-- ===== IF THERE ISN'T CONTACT REQUEST ===== -->
                          <tr *ngIf="contact_requests && contact_requests?.length === 0">
                            <td colspan="2" style="text-align: center; padding-top: 16px;">
                              <p class="contact--conversations-no-requests">
                                {{ 'HistoryPage.NoRequests' | translate }}
                              </p>
                            </td>
                          </tr>

                          <tr *ngFor="let request of contact_requests">

                            <td class="contact--conversations" (click)='goToRequestMsgs(request?.request_id)'
                              style="cursor:pointer">

                              <!-- ------------------------------------- -->
                              <!-- IF IS A CLOSED REQUEST -->
                              <!-- ------------------------------------- -->
                              <span *ngIf="request?.status === 1000 && !request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.RequestResolved' | translate }}" #tooltip="matTooltip"
                                matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">

                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .st0-chat-closed {
                                      fill: none;
                                      stroke: #999999;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .st1-chat-closed {
                                      fill: #999999;
                                    }
                                  </style>
                                  <path class="st0-chat-closed" d="M30.1,2.6c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C8.9,41.4,7.9,47.2,5.1,50c0,0,8.6-1.2,14.4-4.7
                                          c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.9,2.6,30.1,2.6z" />
                                  <path class="st1-chat-closed" d="M30.4,13.8c-6.3,0-11.4,5-11.4,11.2h-3.8l4.9,4.9l0.1,0.2l5.1-5h-3.8c0-4.8,4-8.7,8.9-8.7s8.9,3.9,8.9,8.7
                                          s-4,8.7-8.9,8.7c-2.5,0-4.7-1-6.3-2.6L22.3,33c2.1,2,4.9,3.3,8.1,3.3c6.3,0,11.4-5,11.4-11.2S36.7,13.8,30.4,13.8z M29.1,20v6.2
                                          l5.4,3.2l0.9-1.5L31,25.3V20H29.1z" />
                                </svg>
                              </span>

                              <!-- ------------------------------------- -->
                              <!-- IF IS AN INTERNAL CLOSED REQUEST -->
                              <!-- ------------------------------------- -->
                              <span *ngIf="request?.status === 1000 && request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.InternalRequestResolved' | translate }}"
                                #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">



                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .closed_Internal_st0 {
                                      fill: none;
                                      stroke: #999999;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .closed_Internal_st1 {
                                      fill: #999999;
                                    }
                                  </style>
                                  <path class="closed_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                      C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                  <path class="closed_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                      c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                      C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                      c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                </svg>
                              </span>

                              <!-- ------------------------------------- -->
                              <!-- IF IS AN UNSERVED REQUEST -->
                              <!-- ------------------------------------- -->
                              <span *ngIf="request?.status === 100 && !request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.RequestUnserved' | translate }}" #tooltip="matTooltip"
                                matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">

                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .st0-unserved {
                                      fill: none;
                                      stroke: #ED4537;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .st1-unserved {
                                      fill: #ED4537;
                                    }
                                  </style>
                                  <path class="st0-unserved" d="M30.5,3.3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                          c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3.3,30.5,3.3z" />
                                  <g>
                                    <path class="st1-unserved"
                                      d="M30.6,38.9c-1.7,0-3.1-1.4-3.1-3c0-1.7,1.4-3,3.1-3c1.7,0,3.1,1.4,3.1,3C33.6,37.6,32.3,38.9,30.6,38.9z" />
                                    <path class="st1-unserved" d="M34.8,18l-1.5,10c-0.2,1.5-1.6,2.5-3.1,2.3c-1.2-0.2-2.1-1.1-2.3-2.2l-1.6-10c-0.4-2.3,1.2-4.5,3.6-4.9
                                            c2.4-0.4,4.6,1.2,5,3.5C34.9,17.1,34.9,17.6,34.8,18z" />
                                  </g>
                                </svg>
                              </span>

                              <!-- ------------------------------------- -->
                              <!-- IF IS AN INTERNAL UNSERVED REQUEST  -->
                              <!-- ------------------------------------- -->
                              <span *ngIf="request?.status === 100 && request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.InternalRequestUnserved' | translate }}"
                                #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">

                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .unserved_Internal_st0 {
                                      fill: none;
                                      stroke: #ED4537;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .unserved_Internal_st1 {
                                      fill: #ED4537;
                                    }
                                  </style>
                                  <path class="unserved_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                        C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                  <path class="unserved_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                        c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                        C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                        c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                </svg>
                              </span>

                              <!-- // SERVED REQUESTS AND CURRENT USER IS A PARTICIPANT -->
                              <span
                                *ngIf="request?.status === 200 && request?.currentUserIsJoined  && !request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.ConversationAssignedToYou' | translate }}"
                                #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">

                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .st0-served-by-cu {
                                      fill: none;
                                      stroke: #4DAF4F;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .st1-served-by-cu {
                                      fill: #4DAF4F;
                                    }
                                  </style>
                                  <path class="st0-served-by-cu" d="M29.8,3.7c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                          c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.6,3.7,29.8,3.7z" />
                                  <g id="XMLID_146_">
                                    <path id="XMLID_158_" class="st1-served-by-cu" d="M25.8,36.5l-8.4-7.4c-1.1-0.9-1.1-2.4,0-3.3c1.1-0.9,2.8-0.9,3.8,0l4.6,4.1l12.6-10.9
                                            c1.1-0.9,2.8-0.9,3.8,0c1,0.9,1,2.4,0,3.3L25.8,36.5z" />
                                  </g>
                                </svg>
                              </span>

                              <!-- IF IS A INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                              <span *ngIf="request?.status === 200 && request?.currentUserIsJoined  && request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.TicketAssignedToYou' | translate }}"
                                #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">

                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .served_bycu_Internal_st0 {
                                      fill: none;
                                      stroke: #4DAF4F;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .served_bycu_Internal_st1 {
                                      fill: #4DAF4F;
                                    }
                                  </style>
                                  <path class="served_bycu_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                  C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                  <path class="served_bycu_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                  c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                  C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                  c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                </svg>
                              </span>

                              <!-- // SERVED REQUESTS AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER-->
                              <span
                                *ngIf="request?.status === 200 && !request?.currentUserIsJoined && !request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.RequestServedBy' | translate }}" #tooltip="matTooltip"
                                matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">

                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .st0-served {
                                      fill: none;
                                      stroke: #05BDD4;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .st1-served {
                                      fill: #05BDD4;
                                    }
                                  </style>
                                  <g>
                                    <path class="st0-served" d="M30.5,3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                                            c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3,30.5,3z" />
                                    <g>
                                      <circle class="st1-served" cx="17.5" cy="26.7" r="3" />
                                      <circle class="st1-served" cx="30.5" cy="26.7" r="3" />
                                      <circle class="st1-served" cx="43.5" cy="26.7" r="3" />
                                    </g>
                                  </g>
                                </svg>
                              </span>

                              <!-- IF IS AN INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                              <span *ngIf="request?.status === 200 && !request?.currentUserIsJoined && request?.subject"
                                matTooltipClass="custom-mat-tooltip"
                                matTooltip="{{ 'RequestMsgsPage.InternalRequestServedBy' | translate }}"
                                #tooltip="matTooltip" matTooltipPosition='below' matTooltipHideDelay="100"
                                [matTooltipDisabled]="CHAT_PANEL_MODE">

                                <svg viewBox="0 0 58.1 53.9" style="width: 30px; vertical-align: middle;"
                                  xml:space="preserve">
                                  <style type="text/css">
                                    .served__Internal_st0 {
                                      fill: none;
                                      stroke: #05BDD4;
                                      stroke-width: 2;
                                      stroke-miterlimit: 10;
                                    }

                                    .served__Internal_st1 {
                                      fill: #05BDD4;
                                    }
                                  </style>
                                  <path class="served__Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
                                  C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                                  <path class="served__Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
                                  c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
                                  C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
                                  c0.5,0,0.9-0.5,0.9-1.1V22z" />
                                </svg>
                              </span>
                            </td>

                            <!-- ------------------------------------------------------------- -->
                            <!-- REQUEST FIRST TEXT style="cursor:pointer"  -->
                            <!-- ------------------------------------------------------------- -->
                            <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                              <p class="contact--conversations-first_text"
                                [innerHTML]="getRequestText(request?.first_text)">
                              </p>

                              <span class="contact--conversations-request-sent-to">
                                {{ 'SentThe' | translate}} {{ request?.createdAt | date: 'dd/MM/yyyy' }}
                                <span *ngIf="request?.department?.name && CHAT_PANEL_MODE === false">
                                  <span>{{ 'ToTheDepartment' | translate}} </span>
                                  <span style="text-transform: uppercase"> {{ request?.department?.name }}
                                  </span>
                                </span>
                              </span>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div> <!-- ./ card-content table-responsive -->

                    <div *ngIf="displaysFooterPagination === true" class="card-footer" style="text-align:center">
                      <div class="stats">

                        <div style="width: 120px; margin: 0 auto; margin-top: 10px ">
                          <div class="input-group">

                            <!-- -------====== BTN DECREASE PAGE  ======------ -->
                            <span class="input-group-btn" style="padding-right:0px;  padding-left: 0px;">
                              <button [disabled]="pageNo + 1 === 1" class="btn btn-primary" type="button"
                                (click)="decreasePageNumber()" style="padding: 6px 8px">
                                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                              </button>
                            </span>

                            <!-- -------====== DISPLAY No PAGE / No TOTAL PAGES   ======------ -->
                            <span class="input-group-btn" style="padding-right:0px;">
                              <button class="btn btn-primary" type="button" style="padding: 6px 8px">
                                {{ pageNo + 1 }} / {{ totalPagesNo_roundToUp }}
                              </button>
                            </span>

                            <!-- -------====== BTN INCREASE PAGE  ======------ -->
                            <span class="input-group-btn" style="padding-right:0px">
                              <button [disabled]="pageNo + 1 === totalPagesNo_roundToUp || totalPagesNo_roundToUp === 0"
                                class="btn btn-primary" type="button" (click)="increasePageNumber()"
                                style="padding: 6px 8px">
                                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                              </button>
                            </span>

                          </div>
                        </div>

                      </div>
                    </div>


                  </div>
                </div>

              </div>
              <!-- ------------------------------------------------------------------ -->
              <!-- Attribute acccordion & JWT Attribute acccordion -->
              <!-- ------------------------------------------------------------------ -->
              <div *ngIf="tab4">
                <!-- ------------------------------------------------------ -->
                <!-- @ Attributes accordion fake -->
                <!-- ------------------------------------------------------ -->
                <div id="attributes-accordion" *ngIf="!request?.attributes">
                  <div class="attributes-accordion-wpr"
                    [ngClass]="{'attributes-accordion-wpr-chat': CHAT_PANEL_MODE === true}">
                    <div class="attributes-accordion"
                      [ngClass]="{'attributes-accordion-chat': CHAT_PANEL_MODE === true }"
                      (click)="openAttributesAccordion()">
                      <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px" fill="none"
                        style="min-width: 22px; min-height: 22px; position: relative;
                            top: 4px;">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path
                          d="M6.21 13.97l1.2 2.07c.08.13.23.18.37.13l1.49-.6c.31.24.64.44 1.01.59l.22 1.59c.03.14.15.25.3.25h2.4c.15 0 .27-.11.3-.26l.22-1.59c.36-.15.7-.35 1.01-.59l1.49.6c.14.05.29 0 .37-.13l1.2-2.07c.08-.13.04-.29-.07-.39l-1.27-.99c.03-.19.04-.39.04-.58 0-.2-.02-.39-.04-.59l1.27-.99c.11-.09.15-.26.07-.39l-1.2-2.07c-.08-.13-.23-.18-.37-.13l-1.49.6c-.31-.24-.64-.44-1.01-.59l-.22-1.59c-.03-.14-.15-.25-.3-.25h-2.4c-.15 0-.27.11-.3.26l-.22 1.59c-.36.15-.71.34-1.01.58l-1.49-.6c-.14-.05-.29 0-.37.13l-1.2 2.07c-.08.13-.04.29.07.39l1.27.99c-.03.2-.05.39-.05.59 0 .2.02.39.04.59l-1.27.99c-.11.1-.14.26-.06.39zM12 10.29c.94 0 1.71.77 1.71 1.71s-.77 1.71-1.71 1.71-1.71-.77-1.71-1.71.77-1.71 1.71-1.71zM19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm0 16H5V5h14v14z" />
                      </svg>

                      <span class="attribute-accordion-name">
                        {{ "Attributes" | translate }}
                      </span>
                    </div>

                    <div class="attributes-panel">
                      <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                        <div class="row">

                          <div class="attributes-accordion-no-data-wpr">
                            No data available
                          </div>

                          <div *ngIf="attribute?.attributeValueL + 180 > rightSidebarWidth" class="col-xs-2"
                            style="text-align: right;">
                            <i [id]="attribute?.attributeName +'_arrow_icon'" class="material-icons rotate"
                              style="cursor: pointer; color: #039be5; font-size:18px;"
                              (click)="toggleShowAllString(attribute?.attributeName +'_value', attribute?.attributeName +'_arrow_icon', 'isActive_' + i)">
                              keyboard_arrow_down
                            </i>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div> <!-- ./ end fake attributes accordion -->

                <!-- ------------------------------------------------------ -->
                <!-- @ Attributes accordion  -->
                <!-- ------------------------------------------------------ -->
                <div id="attributes-accordion" *ngIf="request?.attributes">
                  <div class="attributes-accordion-wpr"
                    [ngClass]="{'attributes-accordion-wpr-chat': CHAT_PANEL_MODE === true}">
                    <div class="attributes-accordion"
                      [ngClass]="{'attributes-accordion-chat': CHAT_PANEL_MODE === true }"
                      (click)="openAttributesAccordion()">
                      <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 0 24 24" width="22px" fill="none"
                        style="min-width: 22px; min-height: 22px; position: relative;
                            top: 4px;">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path
                          d="M6.21 13.97l1.2 2.07c.08.13.23.18.37.13l1.49-.6c.31.24.64.44 1.01.59l.22 1.59c.03.14.15.25.3.25h2.4c.15 0 .27-.11.3-.26l.22-1.59c.36-.15.7-.35 1.01-.59l1.49.6c.14.05.29 0 .37-.13l1.2-2.07c.08-.13.04-.29-.07-.39l-1.27-.99c.03-.19.04-.39.04-.58 0-.2-.02-.39-.04-.59l1.27-.99c.11-.09.15-.26.07-.39l-1.2-2.07c-.08-.13-.23-.18-.37-.13l-1.49.6c-.31-.24-.64-.44-1.01-.59l-.22-1.59c-.03-.14-.15-.25-.3-.25h-2.4c-.15 0-.27.11-.3.26l-.22 1.59c-.36.15-.71.34-1.01.58l-1.49-.6c-.14-.05-.29 0-.37.13l-1.2 2.07c-.08.13-.04.29.07.39l1.27.99c-.03.2-.05.39-.05.59 0 .2.02.39.04.59l-1.27.99c-.11.1-.14.26-.06.39zM12 10.29c.94 0 1.71.77 1.71 1.71s-.77 1.71-1.71 1.71-1.71-.77-1.71-1.71.77-1.71 1.71-1.71zM19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm0 16H5V5h14v14z" />
                      </svg>

                      <span class="attribute-accordion-name">
                        {{"Attributes" | translate }}
                      </span>
                    </div>
                    <!-- ------------------------------------------------------ -->
                    <!-- new attributes panel -->
                    <!-- ------------------------------------------------------ -->
                    <div class="attributes-panel">
                      <div *ngFor="let attribute of attributesArray; let i = index">
                        <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                          <div class="row">
                            <div class="col-xs-10" style="padding-right: 1px;padding-bottom: 5px;">
                              <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes">
                                {{attribute?.attributeName }}:
                              </div>

                              <div aria-expanded="false" [id]="attribute?.attributeName +'_value'"
                                class="attribute attribute_cutted_text">
                                {{attribute?.attributeValue }}
                              </div>

                            </div>

                            <div *ngIf="attribute?.attributeValueL + 180 > rightSidebarWidth" class="col-xs-2"
                              style="text-align: right;">
                              <i [id]="attribute?.attributeName +'_arrow_icon'" class="material-icons rotate"
                                style="cursor: pointer; color: #039be5; font-size:18px;"
                                (click)="toggleShowAllString(attribute?.attributeName +'_value', attribute?.attributeName +'_arrow_icon', 'isActive_' + i)">
                                keyboard_arrow_down
                              </i>

                            </div>
                          </div>


                        </div>
                      </div>

                    </div>
                  </div>
                </div> <!-- ./ end new attributes accordion -->

                <!-- ------------------------------------------------------ -->
                <!-- @ Attributes decoded JWT accordion -->
                <!-- ------------------------------------------------------ -->
                <!--  -->
                <div id="decoded-jwt-accordion" *ngIf="request?.attributes?.decoded_jwt && REQUESTER_IS_VERIFIED">
                  <div class="attributes-jwt-decoded-accordion-wpr"
                    [ngClass]="{'attributes-jwt-decoded-accordion-wpr-chat': CHAT_PANEL_MODE === true}">
                    <div class="attributes-decoded-jwt-accordion"
                      [ngClass]="{'attributes-decoded-jwt-accordion-chat': CHAT_PANEL_MODE === true }"
                      (click)="openAttributesDecodedJWTAccordion()">
                      <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="22px"
                        viewBox="0 0 24 24" width="22px" fill="none" style="min-width: 22px; min-height: 22px;position: relative;
                            top: 4px;">
                        <g>
                          <path d="M0,0h24v24H0V0z" fill="none" />
                        </g>
                        <g>
                          <path
                            d="M12,2L4,5v6.09c0,5.05,3.41,9.76,8,10.91c4.59-1.15,8-5.86,8-10.91V5L12,2z M18,11.09c0,4-2.55,7.7-6,8.83 c-3.45-1.13-6-4.82-6-8.83V6.31l6-2.12l6,2.12V11.09z M8.82,10.59L7.4,12l3.54,3.54l5.66-5.66l-1.41-1.41l-4.24,4.24L8.82,10.59z" />
                        </g>
                      </svg>
                      <span class="decoded-jwt-accordion-title">
                        {{ "decodedJWT" | translate }}
                      </span>
                    </div>
                    <!-- ------------------------------------------------------ -->
                    <!-- @ Attributes decoded JWT panel -->
                    <!-- ------------------------------------------------------ -->

                    <div class="attributes-decoded-jwt-panel">
                      <div *ngFor="let attribute of  attributesDecodedJWTArrayMerged; let i = index">
                        <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                          <div class="row">
                            <div class="col-xs-10" style="padding-right: 1px;padding-bottom: 5px;">
                              <div *ngIf="attribute?.decodedJWTType && attribute?.index === '0'"
                                class="ws_requets_msgs__attribute" style="text-transform: uppercase;font-weight: 600;
                              font-size: 11px;"> Attributes </div>
                              <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes"
                                [ngClass]="{'decoded-jwt-attributes': attribute?.decodedJWTType}">
                                {{attribute?.attributeName }}:
                              </div>

                              <div aria-expanded="false" [id]="attribute?.attributeName +'_value'" class="attribute"
                                [ngClass]="{'attribute_cutted_text': !attribute?.decodedJWTType}">
                                {{attribute?.attributeValue }}
                              </div>

                            </div>
                            <!-- [id]="attribute?.attributeName +'_arrow_icon'" -->
                            <!-- [ngClass]="{'down' : attributeFullText === true}" -->
                            <!-- white-space: nowrap;width: 1%; -->
                            <div *ngIf="attribute?.attributeValueL + 180 > rightSidebarWidth" class="col-xs-2"
                              style="text-align: right;">
                              <i [id]="attribute?.attributeName +'_arrow_icon'" class="material-icons rotate"
                                style="cursor: pointer; color: #039be5; font-size:18px;"
                                (click)="toggleShowAllString(attribute?.attributeName +'_value', attribute?.attributeName +'_arrow_icon', 'isActive_' + i)">
                                keyboard_arrow_down
                              </i>

                            </div>
                          </div>


                          <!--   <div class="debug_div">
                                L : {{attribute?.attributeValueL}} <br>
                                L + 180 : {{attribute?.attributeValueL + 180}} <br>
                                SB WIDTH : {{rightSidebarWidth}} 
                              </div> -->

                        </div>
                      </div>
                    </div>
                  </div>
                </div> <!-- ./ end attributes decoded JWT accordion-->
              </div>
            </div>


            <!-- --- new ---- -->



            <!-- ------------------------------------------------------- -->
            <!-- NEW - EVENTS -->
            <!-- ------------------------------------------------------- -->
            <!-- <div class="row" style="margin-top:5px; cursor: pointer;" (click)='goToEvents()' >
                  <div class="col-sm-12">
                    <p style="color: crimson;">
                      <i class="material-icons"
                        style="vertical-align: middle; color: crimson;font-size:16px">perm_contact_calendar</i>
                      <span style="position: relative;top: 1px;">
                        <span
                          style="font-size: 12px; color: crimson; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                         EVENTS TEST
                        </span>
           
                      </span>
                    </p>
                  </div>
                </div> -->


            <!-- --------------------------------------------------------------------- -->
            <!-- Go to request details - dispalyed only if CHAT_PANEL_MODE === true -->
            <!-- --------------------------------------------------------------------- -->
            <!-- <div class="row" style="margin-top:5px" *ngIf="CHAT_PANEL_MODE === true">
                      <div class="col-sm-12">
                        <p class="" style="">
                          <i (click)="goToRequestInNewTab()" class="material-icons"
                            style="vertical-align: middle; color: #394f5a;font-size:16px; cursor: pointer;">open_in_new</i>
                          <span style="position: relative;top: 0px;">
                            <span
                              style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                              <a style="cursor: pointer;" (click)="goToRequestInNewTab()"> {{ 'GoToRequest' | translate }}
                              </a>
                            </span>

                          </span>
                        </p>
                      </div>
                    </div> -->

          </div>
        </div>

        <div id="right-col" class="right-col" *ngIf="!REQUEST_EXIST"
          [ngClass]="{'col-sm-5' : CHAT_PANEL_MODE === false, 'col-sm-12 no-padding' : CHAT_PANEL_MODE === true, 'chat-panel-mode-on-desktop' :CHAT_PANEL_MODE === true && !isMobile, 'chat-right-col': CHAT_PANEL_MODE === true}">
          <!-- card  -->
          <div class="right-card" style="padding-top:0px; padding-bottom:5px;margin-bottom: 10px;"
            [ngClass]="{'right-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'right-card-normal-mode' : CHAT_PANEL_MODE === false}">

            <div class="request--removed">
              {{'ConverationRemoved' | translate }}
            </div>

          </div>
        </div>

      </div>
    </div>

  </div>
</div>




<!-- ---------------------------------------------------------------------------------------- -->
<!--  USERS - BOTS - DEPTS LIST MODAL - FULL WIDTH MODAL -->
<!-- ---------------------------------------------------------------------------------------- -->
<div id="assign-reassign-modal" class="modal" tabindex="-1" role="dialog"
  [ngClass]="{'users-list-modal-margin-left-on-desktop': CHAT_PANEL_MODE === false}"
  [ngStyle]="{'display': displayUsersListModal , 'height': users_list_modal_height}"
  style="background-color: rgba(90,90,90,0.5);">

  <div class="modal-dialog modal-lg users-list-modal"
    [ngClass]="{'users-list-modal-dashboard-mode' : CHAT_PANEL_MODE === false, 'users-list-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
    role="document" style="width: 100%; height: 100vh; margin:0; padding: 0;">
    <div class="modal-content assign-reassign-modal-content"
      style="height: auto; min-height: 100%; border-radius: 0; border:none;">

      <div class="modal-header assign-reassign-modal-header"
        [ngClass]="{'modal-header-chat-panel-mode' : CHAT_PANEL_MODE === true}">
        <button type="button" class="close---round-btn" aria-label="Close" (click)="closeSelectUsersModal()">
          <span aria-hidden="true">&times;</span>
        </button>

        <h4 class="modal-title">
          <div class="title-wpr">
            <span *ngIf="actionInModal === 'reassign' && CHAT_PANEL_MODE === true">
              {{ "VisitorsPage.ReassignRequest" | translate }}
            </span>
            <span *ngIf="actionInModal === 'invite' && CHAT_PANEL_MODE === true">
              {{ "VisitorsPage.AddAgent" | translate }}
            </span>
          </div>
        </h4>
      </div>

      <div class="modal-body" [ngClass]="{'modal-body-chat-panel-mode' : CHAT_PANEL_MODE === true}"
        style="padding-right: 15px; padding-top:15px; padding-bottom:15px; max-width: 936px; margin:auto ">
        <div class="row">
          <!-- --------------------------------------------------------------------------------------------- -->
          <!-- modal subtitle -->
          <!-- --------------------------------------------------------------------------------------------- -->
          <div class="col-md-12" *ngIf="CHAT_PANEL_MODE === false">
            <span *ngIf="actionInModal === 'reassign'">
              <h4 style="font-weight:400" [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                <!-- {{ "VisitorsPage.SelectTheUserToWhom" | translate }} -->
                {{ "VisitorsPage.ReassignRequest" | translate }}
              </h4>
            </span>

            <span *ngIf="actionInModal === 'invite'">
              <h4 style="font-weight:400" [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                <!-- {{ "VisitorsPage.InviteAnotherUserToServe" | translate }} -->
                {{ "VisitorsPage.AddAgent" | translate }}
              </h4>
            </span>
          </div>



          <div class="col-md-12" [ngClass]="{'no-padding' : CHAT_PANEL_MODE === true}">
           
              <mat-tab-group  mat-align-tabs="center"  *ngIf="actionInModal === 'reassign'" [ngClass]="{'mat-tab-group-on-panel': CHAT_PANEL_MODE === true}">
                <mat-tab label="{{'HumanTeammates' | translate }} ( {{projectUsersList?.length}} )"> 
                  <!-- assign-reassign-modal-card-in-accordion -->
                  <div class="card assign-reassign-modal-card"
                  [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'card--no-border' : CHAT_PANEL_MODE === true}">

                  <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

                  <!-- table-responsive -->
                  <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive"
                    [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                    <table class="table table-hover assign-reassign-modal-table">
                      <thead>
                        <tr>
                          <!-- [ngClass]="{'sub-header-background' : CHAT_PANEL_MODE === true}" -->
                          <th colspan="2"  [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                            <span style="color: #566787">
                              {{ "UsersPage.User" | translate }}
                            </span>

                            <!-- --------------------------------------------------------------------------------------------------- -->
                            <!-- the table header if CHAT_PANEL_MODE === true (replace the label User abd the above modal subtitle) -->
                            <!-- --------------------------------------------------------------------------------------------------- -->
                            <span *ngIf="CHAT_PANEL_MODE === true" style="color: #566787">
                              <!-- <span *ngIf="actionInModal === 'reassign'">
                                <h4 style="font-weight:400"
                                  [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                  {{ "VisitorsPage.SelectTheUserToWhom" | translate }}
                                </h4>
                              </span> -->

                              <span *ngIf="actionInModal === 'invite'">
                                <h4 style="font-weight:400"
                                  [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                  {{ "VisitorsPage.InviteAnotherUserToServe" | translate }}
                                </h4>
                              </span>
                            </span>

                          </th>

                          <th *ngIf="CHAT_PANEL_MODE === false">
                            <span style="color: #566787">

                              {{ "Assignee" | translate }}

                            </span>
                          </th>

                          <th *ngIf="CHAT_PANEL_MODE === false">
                            <span style="color: #566787; white-space: nowrap;">
                              {{ "UserRole" | translate }}
                            </span>
                          </th>


                          <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                        </tr>
                      </thead>
                      <tbody>


                        <!-- ----------------------------------------------------------------------------- -->
                        <!-- Project users for -->
                        <!-- ----------------------------------------------------------------------------- -->
                        <tr *ngFor="let projectUser of projectUsersList" class="table-row">

                          <td style="width: 25px; cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">

                            <!-- --------------------------------------- -->
                            <!-- Usecase  Firebase -->
                            <!-- --------------------------------------- -->
                            <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                              [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{projectUser?.id_user?._id}}%2Fphoto.jpg?alt=media"
                              onerror="this.src='assets/img/no_image_user.png'" />

                            <!-- --------------------------------------- -->
                            <!-- Usecase  Native -->
                            <!-- --------------------------------------- -->
                            <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                              [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="{{baseUrl}}images?path=uploads%2Fusers%2F{{projectUser?.id_user?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                              onerror="this.src='assets/img/no_image_user.png'" />


                            <div class="ws_request_msgs__status-icon" [ngClass]="{
                                        'is-user-online' : projectUser?.user_available === true && (projectUser?.profileStatus === '' || !projectUser?.profileStatus), 
                                        'is-user-offline' : projectUser?.user_available === false && (projectUser?.profileStatus === '' || !projectUser?.profileStatus),
                                        'is-user-inactive': projectUser?.user_available === false && projectUser?.profileStatus === 'inactive',
                                        'ws_request_msgs__status-icon-chat-panel-mode' : CHAT_PANEL_MODE === true
                                      }">
                            </div>
                          </td>

                          <td style="cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                            <p class="assign-reassign-modal-text-col1">
                              {{ projectUser?.id_user?.firstname }} {{ projectUser?.id_user?.lastname }}


                              <!-- --------------------------------------------------- -->
                              <!-- user role in CHAT_PANEL_MODE x Project Users -->
                              <!-- --------------------------------------------------- -->
                              <span *ngIf="CHAT_PANEL_MODE === true" class="assign-reassign-modal-subtext-col1">
                                <span> ({{ projectUser?.role | translate}}) </span>
                              </span>
                            </p>
                            <span class="assign-reassign-modal-text-col2">
                              <span> {{ projectUser?.id_user?.email }} </span>
                            </span>

                            <!-- --------------------------------------------------- -->
                            <!-- icon 'done' in CHAT_PANEL_MODE x Project Users -->
                            <!-- --------------------------------------------------- -->
                            <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                              <div style="position: absolute; top: -33px; right: 0;"
                                *ngIf="projectUser?.is_joined_to_request === true">
                                <i class="material-icons assign-reassign-modal-assignee-icon">
                                  done
                                </i>
                              </div>
                            </div>
                          </td>

                          <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                            <div *ngIf="projectUser?.is_joined_to_request === true">
                              <i class="material-icons" style="margin-left: 14px;color: #73AF55;">
                                done
                              </i>
                            </div>
                          </td>

                          <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                            {{ projectUser?.role | translate}}
                          </td>


                          <!-- ------------------------------------------------------ -->
                          <!-- column displayed on the over -->
                          <!-- ------------------------------------------------------ -->
                          <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer;"
                            (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">

                            <div class="assign-request">
                              <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                <span *ngIf="actionInModal === 'reassign'">
                                  {{ 'VisitorsPage.ReassignTo' | translate}}
                                </span>
                                <span *ngIf="actionInModal === 'invite'">
                                  <!-- {{ 'VisitorsPage.AssignTo' | translate}} -->
                                  {{ 'Add' | translate}}

                                </span>
                              </p>
                              <span
                                style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px; text-transform: lowercase;">
                                {{ projectUser?.id_user?.email }}
                              </span>
                            </div>
                          </td>
                        </tr>

                      </tbody>
                    </table>

                  </div>
                </div>

                </mat-tab>
                <mat-tab label="{{'Chatbots' | translate}}  ( {{bots?.length}} )">
                  <!-- assign-reassign-modal-card-in-accordion -->
                  <div class="card  assign-reassign-modal-card"
                    [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'card--no-border' : CHAT_PANEL_MODE === true}">

                    <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

                    <!-- table-responsive -->
                    <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive"
                      [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                      <table class="table table-hover assign-reassign-modal-table">
                        <thead>
                          <tr>
                            <!-- [ngClass]="{'sub-header-background' : CHAT_PANEL_MODE === true}" -->
                            <th colspan="2" [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                              <span style="color: #566787">
                                {{ "UserProfile.Name" | translate }}
                              </span>

                              <!-- --------------------------------------------------------------------------------------------------- -->
                              <!-- the table header if CHAT_PANEL_MODE === true (replace the label User abd the above modal subtitle) -->
                              <!-- --------------------------------------------------------------------------------------------------- -->
                              <span *ngIf="CHAT_PANEL_MODE === true" style="color: #566787">
                                <span *ngIf="actionInModal === 'reassign'">
                                  <h4 style="font-weight:400"
                                    [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                    {{ "VisitorsPage.SelectTheUserToWhom" | translate }}
                                  </h4>
                                </span>

                                <span *ngIf="actionInModal === 'invite'">
                                  <h4 style="font-weight:400"
                                    [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                    {{ "VisitorsPage.InviteAnotherUserToServe" | translate }}
                                  </h4>
                                </span>
                              </span>

                            </th>

                            <th *ngIf="CHAT_PANEL_MODE === false">
                              <span style="color: #566787">

                                {{ "Assignee" | translate }}

                              </span>
                            </th>

                            <th *ngIf="CHAT_PANEL_MODE === false">
                              <span style="color: #566787; white-space: nowrap;">
                                <!-- {{ "UserRole" | translate }} -->
                              </span>
                            </th>


                            <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                          </tr>
                        </thead>
                        <tbody>

                          <!-- ----------------------------------------------------------------------------- -->
                          <!-- Bots for -->
                          <!-- ----------------------------------------------------------------------------- -->

                          <tr *ngFor="let bot of bots" class="table-row">

                            <td style="width: 25px; cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">

                              <!-- --------------------------------------- -->
                              <!-- Usecase Firebase (bot) -->
                              <!-- --------------------------------------- -->
                              <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                                [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{bot?._id}}%2Fphoto.jpg?alt=media"
                                onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />

                              <!-- --------------------------------------- -->
                              <!-- Usecase Native (bot) -->
                              <!-- --------------------------------------- -->
                              <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                                [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                src="{{baseUrl}}images?path=uploads%2Fusers%2F{{bot?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                                onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />


                              <span *ngIf="bot.type === 'internal'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/tiledesk_logo_no_text.png" />
                              </span>

                              <span *ngIf="bot.type === 'external'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/external_bot_logo.png" />
                              </span>

                              <span *ngIf="bot.type === 'dialogflow'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/Dialogflow_logo_no_text.png" />
                              </span>

                              <span *ngIf="bot.type === 'rasa'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/rasa_bot_logo.png" />
                              </span>


                              <!-- <span *ngIf="bot.type === 'tilebot'">
                                  <img class="ws-request-msgs-bot-type-logo"
                                    [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                    src="assets/img/tilebot_logo_small.png" />
                                </span> -->

                              <span *ngIf="bot.type === 'tilebot'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  [src]="botLogo" />
                              </span>


                              <!-- <span *ngIf="bot.type === 'tiledesk-ai'">
                                <img class="ws-request-msgs-bot-type-logo"
                                  [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                                  src="assets/img/tiledesk-ai-logo.png" />
                              </span> -->
                            </td>

                            <td style="cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">
                              <p class="assign-reassign-modal-text-col1">
                                {{ bot?.name }}

                                <!-- --------------------------------------------------- -->
                                <!-- string in CHAT_PANEL_MODE x Project Users -->
                                <!-- --------------------------------------------------- -->
                                <span *ngIf="CHAT_PANEL_MODE === true" class="assign-reassign-modal-subtext-col1">
                                  <!-- <span> (Bot) </span> -->
                                </span>
                              </p>
                              <!-- <span class="assign-reassign-modal-text-col2">
                                  {{ 'Type' | translate }}:
                                  <span style="text-transform: capitalize;font-weight: 400; ">
                                    <span *ngIf="bot.type !== 'internal'">
                                      {{ bot?.type }}
                                    </span>
                                    <span *ngIf="bot.type === 'internal'">
                                      Resolution
                                    </span>
                                  </span>
                                </span> -->

                              <!-- --------------------------------------------------- -->
                              <!-- icon 'done' in CHAT_PANEL_MODE x Bot -->
                              <!-- --------------------------------------------------- -->
                              <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                                <div style="position: absolute; top: -33px; right: 0;"
                                  *ngIf="bot?._id === bot_participant_id">
                                  <i class="material-icons assign-reassign-modal-assignee-icon">
                                    done
                                  </i>
                                </div>
                              </div>

                            </td>

                            <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                              (click)="selectBot(bot?._id, bot?.name)">
                              <div *ngIf="bot?._id === bot_participant_id">
                                <i class="material-icons" style="margin-left: 14px;color: #73AF55;">
                                  done
                                </i>
                              </div>
                            </td>

                            <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                              (click)="selectBot(bot?._id, bot?.name)">
                              <!-- Bot -->
                            </td>


                            <!-- ------------------------------------------------------ -->
                            <!-- column displayed on the over -->
                            <!-- ------------------------------------------------------ -->
                            <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer"
                              (click)="selectBot(bot?._id, bot?.name)">
                              <div class="assign-request">
                                <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                  <span *ngIf="actionInModal === 'reassign'">
                                    {{ 'VisitorsPage.ReassignTo' | translate}}
                                  </span>
                                  <span *ngIf="actionInModal === 'invite'">
                                    {{ 'VisitorsPage.AssignTo' | translate}}
                                  </span>
                                </p>
                                <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                                  {{ bot?.name }} (bot)
                                </span>
                              </div>
                            </td>
                          </tr>


                        </tbody>
                      </table>

                    </div>
                  </div>
                
                </mat-tab>
                <mat-tab label="{{'Departments' | translate}} ( {{departments?.length }} )"> 
                  <div class="col-md-12" [ngClass]="{'no-padding' : CHAT_PANEL_MODE === true}">
                    <!-- assign-reassign-modal-card-in-accordion -->
                    <div class="card assign-reassign-modal-card"
                      [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'card--no-border' : CHAT_PANEL_MODE === true}">
      
                      <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>
      
                      <div *ngIf="!showSpinner_inModalUserList" class="card-content"
                        [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">
      
                        <table class="table table-hover assign-reassign-modal-table">
                          <thead>
                            <tr>
                              <!-- [ngClass]="{'sub-header-background' : CHAT_PANEL_MODE === true}" -->
                              <th colspan="2" [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                <span style="color: #566787">
                                  {{ "Department" | translate }}
                                </span>
      
                                <!-- ------------------------------------------------------------------------------------------------ -->
                                <!-- the table header if CHAT_PANEL_MODE === true (replace Department abd the above modal subtitle) -->
                                <!-- ------------------------------------------------------------------------------------------------ -->
                                <!-- <span *ngIf="CHAT_PANEL_MODE === true">
                                  <h4 style="font-weight:400"
                                    [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                    {{ "VisitorsPage.SelectTheDeptsToWhom" | translate }}
                                  </h4>
                                </span> -->
                              </th>
      
                              <th *ngIf="CHAT_PANEL_MODE === false">
                                <span style="color: #566787">
                                  {{ "Assignee" | translate }}
                                </span>
                              </th>
      
                              <th *ngIf="CHAT_PANEL_MODE === false">
                                <span style="color: #566787">
                                  {{ "Agents" | translate }}
                                </span>
                              </th>
      
                              <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                            </tr>
                          </thead>
                          <tbody>

                            <tr *ngFor="let dept of departments" class="table-row">
                              
                                <td style="cursor:pointer; width:1%;" [ngClass]="{'top-alignment' : CHAT_PANEL_MODE === true}"
                                  (click)="selectDept(dept?.name, dept?._id)">
                                  <div class="dept---avatar-in-modal"
                                    [ngStyle]="{'background-color': dept?.dept_name_fillcolour, 'margin-top':  (CHAT_PANEL_MODE === true ) ? '5px' : '' }">
                                    {{ dept?.dept_name_initial }}
      
      
                                    <span class="default-dept-disabled-badge-in-modal"
                                      *ngIf="dept?.default === true && COUNT_OF_VISIBLE_DEPT > 0">
                                      <span class="tool_tip">
                                        <span class="material-icons">
                                          unpublished
                                        </span>
                                        <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                          <h4 style="font-weight:400"> Default Department {{ 'Disabled' | translate }}
                                          </h4>
      
                                          {{'TheDefaulDeptIsDisabledBecause_2' | translate}}
                                          <i></i>
                                        </span>
                                      </span>
                                    </span>
      
      
                                    <span class="default-dept-active-badge-in-modal"
                                      *ngIf="dept?.default === true && COUNT_OF_VISIBLE_DEPT === 0">
                                      <span class="tool_tip">
                                        <span class="material-icons">
                                          check_circle
                                        </span>
                                        <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                          <h4 style="font-weight:400"> Default Department {{ 'Enabled' | translate }}
                                          </h4>
                                          <!-- {{'TheDefaulDeptIsEnabledBecause' | translate}} -->
                                          {{'TheDefaulDeptIsEnabledBecause_2' | translate}}
                                          <i></i>
                                        </span>
                                      </span>
                                    </span>
      
                                    <!-- // visible / not visible -->
                                    <span class="dept-not-visible-badge-in-modal"
                                      *ngIf="dept?.default !== true  && dept?.status === 0">
                                      <span class="tool_tip">
                                        <span class="material-icons" style="height: 13px;width: 15px;">
                                          visibility_off
      
                                        </span>
                                        <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                          <h4 style="font-weight:400">
                                            {{dept?.name}} {{ 'IsSetToNotVisible' | translate}}
                                          </h4>
      
                                          <i></i>
                                        </span>
                                      </span>
                                    </span>
      
      
                                    <span class="dept-visible-badge-in-modal"
                                      *ngIf="dept?.default !== true && dept?.status === 1">
                                      <span class="tool_tip">
                                        <span class="material-icons" style="height: 13px;width: 15px;">
                                          visibility
                                        </span>
                                        <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                          <h4 style="font-weight:400"> {{dept?.name}}
                                            {{ 'IsSetToVisible' | translate }}
                                          </h4>
      
                                          <i></i>
                                        </span>
                                      </span>
                                    </span>
                                  </div>
                                </td>
      
                                <td style="cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">
                                  <p style="margin-bottom: 0px;"
                                    [ngStyle]="{'line-height':  (CHAT_PANEL_MODE === true ) ? '14px' : '' }">
      
                                    <span class="dept---name" style="display: block;"
                                      [ngClass]="{'dept---name-in-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                      {{ dept?.name }}
                                    </span>
      
                                    <span class="dept---routing-wpr">
                                      <span style="font-weight:300;">
                                        Routing:
                                      </span>
                                      {{ dept?.routing }}
                                    </span>
      
      
                                    <span *ngIf="CHAT_PANEL_MODE === true">
                                      <span *ngIf="dept?.hasGroupName && !dept?.groupHasBeenTrashed">
                                        <span class="group-label">
                                          {{ 'DepartmentsPage.Group' | translate }}
                                        </span>
                                        <span [ngClass]="{'group-name' : CHAT_PANEL_MODE === true}">
                                          {{ dept?.hasGroupName}}
                                        </span>
                                      </span>
                                      <span *ngIf="dept?.hasGroupName && dept?.groupHasBeenTrashed === true">
                                        <span style="vertical-align: middle;"> {{ dept?.hasGroupName }} </span>
                                        <i class="material-icons"
                                          style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                        <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                          {{ 'DepartmentsPage.TheGroupHasBeenTrashed' | translate }}
                                        </span>
                                      </span>
      
                                      <span *ngIf="!dept?.hasGroupName" class="group-name">
                                        {{ 'DepartmentsPage.AllUsers' | translate }}
                                      </span>
      
                                      <span *ngIf="dept?.id_bot" style="display: block;">
                                        <span class="bot-label">
                                          Bot:
                                        </span>
      
                                        <span *ngIf="dept?.hasBot === true" class="bot-name">
                                          {{ dept?.hasBotName }}
                                        </span>
                                        <span *ngIf="dept?.hasBot === false" class="no-bot">
                                          no bot
                                        </span>
                                        <span *ngIf="dept.bot_only == true"
                                          style="font-size: 12px; color: #7695a5; font-weight: 400">
                                          {{ 'DepartmentsPage.OnlyBot' | translate }}
                                        </span>
                                        <span *ngIf="dept.botHasBeenTrashed == true">
                                          <i class="material-icons"
                                            style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                          <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                            {{ 'BotsPage.TheBotHasBeenTrashed' | translate }}
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </p>
                                  <!-- --------------------------------------------------- -->
                                  <!-- icon 'done' in CHAT_PANEL_MODE x DEPTS -->
                                  <!-- --------------------------------------------------- -->
                                  <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                                    <div style="position: absolute; top: -43px; right: 0;"
                                      *ngIf="request?.department?._id === dept?._id">
                                      <i class="material-icons assign-reassign-modal-assignee-icon">
                                        done
                                      </i>
                                    </div>
                                  </div>
                                </td>
      
                                <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                                  (click)="selectDept(dept?.name, dept?._id)">
                                  <div *ngIf="request?.department?._id === dept?._id">
                                    <i class="material-icons" style="margin-left: 14px; color: #73AF55;">
                                      done
                                    </i>
                                  </div>
                                </td>
      
      
                                <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                                  (click)="selectDept(dept?.name, dept?._id)">
                                  <span *ngIf="dept?.hasGroupName && !dept?.groupHasBeenTrashed">
                                    <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                      {{ 'DepartmentsPage.Group' | translate }}
                                    </span>
                                    {{ dept?.hasGroupName}}
                                  </span>
                                  <span *ngIf="dept?.hasGroupName && dept?.groupHasBeenTrashed === true">
      
                                    <span style="vertical-align: middle;"> {{ dept?.hasGroupName }} </span>
                                    <i class="material-icons"
                                      style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                    <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                      {{ 'DepartmentsPage.TheGroupHasBeenTrashed' | translate }}
                                    </span>
                                  </span>
      
                                  <span *ngIf="!dept?.hasGroupName" style="font-size:13px">
                                    {{ 'DepartmentsPage.AllUsers' | translate }}
                                  </span>
      
                                  <span *ngIf="dept?.id_bot" style="display: block;">
                                    <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                      Bot:
                                      <!-- {{ 'DepartmentsPage.ActivatedBot' | translate }} -->
                                    </span>
      
                                    <span *ngIf="dept?.hasBot === true" style="font-size:13px; font-weight:400">
                                      {{ dept?.hasBotName }}
                                    </span>
                                    <span *ngIf="dept?.hasBot === false"
                                      style="font-size:13px; font-weight:400;color: #bdbdbd;font-style: italic;">
                                      {{ 'DepartmentsPage.NoBotActivated' | translate }}
                                    </span>
                                    <span *ngIf="dept.bot_only == true"
                                      style="font-size: 12px; color: #7695a5; font-weight: 400">
                                      {{ 'DepartmentsPage.OnlyBot' | translate }}
                                    </span>
                                    <span *ngIf="dept.botHasBeenTrashed == true">
                                      <i class="material-icons"
                                        style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                      <span style="color: #ff5252; vertical-align: middle; font-size:12px;">{{
                                        'BotsPage.TheBotHasBeenTrashed' | translate }}
                                      </span>
                                    </span>
                                  </span>
      
                                </td>
      
                                <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer"
                                  (click)="selectDept(dept?.name, dept?._id)">
                                  <div class="assign-request">
                                    <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                      {{ 'ReassignToDept' | translate}}
                                    </p>
                                    <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                                      {{ dept?.name }}
                                    </span>
                                  </div>
                                </td>
                            
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                
                
                </mat-tab>
              </mat-tab-group>
            

            <!-- <mat-accordion *ngIf="actionInModal === 'reassign'">
              <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                   {{'HumanTeammates' | translate }} ( {{projectUsersList?.length}} )
                  </mat-panel-title>
                  <!- - <mat-panel-description>
                    1 Currently I am {{panelOpenState ? 'open' : 'closed'}}
                  </mat-panel-description> - ->
                </mat-expansion-panel-header>
                Here content
              </mat-expansion-panel>

              <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{'Chatbots' | translate}}  ( {{bots?.length}} )
                  </mat-panel-title>
                  <!- - <mat-panel-description>
                    2 Currently I am {{panelOpenState ? 'open' : 'closed'}}
                  </mat-panel-description> - ->
                </mat-expansion-panel-header>
                Here content
              </mat-expansion-panel>

              <mat-expansion-panel  (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{'Departments' | translate}}  ( {{departments?.length }} )
                  </mat-panel-title>
                  <!- - <mat-panel-description>
                    2 Currently I am {{panelOpenState ? 'open' : 'closed'}}
                  </mat-panel-description> - ->
                  Here content
                </mat-expansion-panel-header> -->
                
              
                  <!-- -------------------------------------- -->
                  <!-- modal subtitle -->
                  <!-- -------------------------------------- -->
                  <!-- <div class="col-md-12" *ngIf="CHAT_PANEL_MODE === false">
                    <span>
                      <h4 style="font-weight:400">
                        {{ "VisitorsPage.SelectTheDeptsToWhom" | translate }}
                      </h4>
                    </span>
                  </div> -->
                  
                
              <!-- </mat-expansion-panel>
            </mat-accordion> -->

            <!-- --------------------------------------------------------------- -->
            <!-- Project user -->
            <!-- --------------------------------------------------------------- -->
            <div *ngIf="actionInModal === 'invite'" class="card assign-reassign-modal-card" style="margin-top:5px; margin-bottom:5px"
              [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'card--no-border' : CHAT_PANEL_MODE === true}">

              <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

              <!-- table-responsive -->
              <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive"
                [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                <table class="table table-hover assign-reassign-modal-table">
                  <thead>
                    <tr>

                      <th colspan="2" [ngClass]="{'sub-header-background' : CHAT_PANEL_MODE === true}">
                        <span style="color: #566787"
                          [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                          {{ "UsersPage.User" | translate }}
                        </span>

                        <!-- --------------------------------------------------------------------------------------------------- -->
                        <!-- the table header if CHAT_PANEL_MODE === true (replace the label User abd the above modal subtitle) -->
                        <!-- --------------------------------------------------------------------------------------------------- -->
                        <span *ngIf="CHAT_PANEL_MODE === true" style="color: #566787">
                          <span *ngIf="actionInModal === 'reassign'">
                            <h4 style="font-weight:400"
                              [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                              {{ "VisitorsPage.SelectTheUserToWhom" | translate }}
                            </h4>
                          </span>

                          <span *ngIf="actionInModal === 'invite'">
                            <h4 style="font-weight:400"
                              [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                              {{ "VisitorsPage.InviteAnotherUserToServe" | translate }}
                            </h4>
                          </span>
                        </span>

                      </th>

                      <th *ngIf="CHAT_PANEL_MODE === false">
                        <span style="color: #566787">

                          {{ "Assignee" | translate }}

                        </span>
                      </th>

                      <th *ngIf="CHAT_PANEL_MODE === false">
                        <span style="color: #566787; white-space: nowrap;">
                          {{ "UserRole" | translate }}
                        </span>
                      </th>


                      <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                    </tr>
                  </thead>
                  <tbody>


                    <!-- ----------------------------------------------------------------------------- -->
                    <!-- Project users for -->
                    <!-- ----------------------------------------------------------------------------- -->
                    <tr *ngFor="let projectUser of projectUsersList;" class="table-row">

                      <td style="width: 25px; cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">

                        <!-- --------------------------------------- -->
                        <!-- Usecase  Firebase -->
                        <!-- --------------------------------------- -->
                        <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                          [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                          src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{projectUser?.id_user?._id}}%2Fphoto.jpg?alt=media"
                          onerror="this.src='assets/img/no_image_user.png'" />

                        <!-- --------------------------------------- -->
                        <!-- Usecase  Native -->
                        <!-- --------------------------------------- -->
                        <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                          [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                          src="{{baseUrl}}images?path=uploads%2Fusers%2F{{projectUser?.id_user?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                          onerror="this.src='assets/img/no_image_user.png'" />


                        <div class="ws_request_msgs__status-icon" [ngClass]="{
                                      'is-user-online' : projectUser?.user_available === true && (projectUser?.profileStatus === '' || !projectUser?.profileStatus), 
                                      'is-user-offline' : projectUser?.user_available === false && (projectUser?.profileStatus === '' || !projectUser?.profileStatus),
                                      'is-user-inactive': projectUser?.user_available === false && projectUser?.profileStatus === 'inactive',
                                      'ws_request_msgs__status-icon-chat-panel-mode' : CHAT_PANEL_MODE === true
                                     }">
                        </div>
                      </td>

                      <td style="cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <p class="assign-reassign-modal-text-col1">
                          {{ projectUser?.id_user?.firstname }} {{ projectUser?.id_user?.lastname }}


                          <!-- --------------------------------------------------- -->
                          <!-- user role in CHAT_PANEL_MODE x Project Users -->
                          <!-- --------------------------------------------------- -->
                          <span *ngIf="CHAT_PANEL_MODE === true" class="assign-reassign-modal-subtext-col1">
                            <span> ({{ projectUser?.role | translate}}) </span>
                          </span>
                        </p>
                        <span class="assign-reassign-modal-text-col2">
                          <span> {{ projectUser?.id_user?.email }} </span>
                        </span>

                        <!-- --------------------------------------------------- -->
                        <!-- icon 'done' in CHAT_PANEL_MODE x Project Users -->
                        <!-- --------------------------------------------------- -->
                        <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                          <div style="position: absolute; top: -33px; right: 0;"
                            *ngIf="projectUser?.is_joined_to_request === true">
                            <i class="material-icons assign-reassign-modal-assignee-icon">
                              done
                            </i>
                          </div>
                        </div>
                      </td>

                      <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <div *ngIf="projectUser?.is_joined_to_request === true">
                          <i class="material-icons" style="margin-left: 14px;color: #73AF55;">
                            done
                          </i>
                        </div>
                      </td>

                      <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        {{ projectUser?.role | translate}}
                      </td>


                      <!-- ------------------------------------------------------ -->
                      <!-- column displayed on the over -->
                      <!-- ------------------------------------------------------ -->
                      <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer;"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">

                        <div class="assign-request">
                          <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                            <span *ngIf="actionInModal === 'reassign'">
                              {{ 'VisitorsPage.ReassignTo' | translate}}
                            </span>
                            <span *ngIf="actionInModal === 'invite'">
                              <!-- {{ 'VisitorsPage.AssignTo' | translate}} -->
                              {{ 'Add' | translate}}

                            </span>
                          </p>
                          <span
                            style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px; text-transform: lowercase;">
                            {{ projectUser?.id_user?.email }}
                          </span>
                        </div>
                      </td>
                    </tr>

                  </tbody>
                </table>

              </div>
            </div>

            <!-- ---------------------------------------------------------------------------------------------------- -->

            <!-- --------------------------------------------------------------- -->
            <!-- Chatbot -->
            <!-- --------------------------------------------------------------- -->
            <div  *ngIf="actionInModal === '_reassign'" class="card assign-reassign-modal-card"
              style="margin-top:5px; margin-bottom:5px"
              [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'card--no-border' : CHAT_PANEL_MODE === true}">

              <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

             
              <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive"
                [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                <table class="table table-hover assign-reassign-modal-table">
                  <thead>
                    <tr>

                      <th colspan="2" [ngClass]="{'sub-header-background' : CHAT_PANEL_MODE === true}">
                        <span style="color: #566787"
                          [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                          {{ "UsersPage.User" | translate }}
                        </span>

                        <!-- --------------------------------------------------------------------------------------------------- -->
                        <!-- the table header if CHAT_PANEL_MODE === true (replace the label User abd the above modal subtitle) -->
                        <!-- --------------------------------------------------------------------------------------------------- -->
                        <span *ngIf="CHAT_PANEL_MODE === true" style="color: #566787">
                          <span *ngIf="actionInModal === 'reassign'">
                            <h4 style="font-weight:400"
                              [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                              {{ "VisitorsPage.SelectTheUserToWhom" | translate }}
                            </h4>
                          </span>

                          <span *ngIf="actionInModal === 'invite'">
                            <h4 style="font-weight:400"
                              [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                              {{ "VisitorsPage.InviteAnotherUserToServe" | translate }}
                            </h4>
                          </span>
                        </span>

                      </th>

                      <th *ngIf="CHAT_PANEL_MODE === false">
                        <span style="color: #566787">

                          {{ "Assignee" | translate }}

                        </span>
                      </th>

                      <th *ngIf="CHAT_PANEL_MODE === false">
                        <span style="color: #566787; white-space: nowrap;">
                          {{ "UserRole" | translate }}
                        </span>
                      </th>


                      <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                    </tr>
                  </thead>
                  <tbody>





                    <!-- ----------------------------------------------------------------------------- -->
                    <!-- Bots for -->
                    <!-- ----------------------------------------------------------------------------- -->
                    <ng-container *ngIf="actionInModal === 'reassign'">
                      <tr *ngFor="let bot of bots;" class="table-row">

                        <td style="width: 25px; cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">

                          <!-- --------------------------------------- -->
                          <!-- Usecase Firebase (bot) -->
                          <!-- --------------------------------------- -->
                          <img *ngIf="UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                            [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{bot?._id}}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />

                          <!-- --------------------------------------- -->
                          <!-- Usecase Native (bot) -->
                          <!-- --------------------------------------- -->
                          <img *ngIf="!UPLOAD_ENGINE_IS_FIREBASE" class="ws_requets_msgs__user-img-in-modal"
                            [ngClass]="{'ws_requets_msgs__user-img-in-modal-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                            src="{{baseUrl}}images?path=uploads%2Fusers%2F{{bot?._id}}%2Fimages%2Fthumbnails_200_200-photo.jpg"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />


                          <span *ngIf="bot.type === 'internal'">
                            <img class="ws-request-msgs-bot-type-logo"
                              [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="assets/img/tiledesk_logo_no_text.png" />
                          </span>

                          <span *ngIf="bot.type === 'external'">
                            <img class="ws-request-msgs-bot-type-logo"
                              [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="assets/img/external_bot_logo.png" />
                          </span>

                          <span *ngIf="bot.type === 'dialogflow'">
                            <img class="ws-request-msgs-bot-type-logo"
                              [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="assets/img/Dialogflow_logo_no_text.png" />
                          </span>

                          <span *ngIf="bot.type === 'rasa'">
                            <img class="ws-request-msgs-bot-type-logo"
                              [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              src="assets/img/rasa_bot_logo.png" />
                          </span>


                          <!-- <span *ngIf="bot.type === 'tilebot'">
                        <img class="ws-request-msgs-bot-type-logo"
                          [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                          src="assets/img/tilebot_logo_small.png" />
                      </span> -->

                          <span *ngIf="bot.type === 'tilebot'">
                            <img class="ws-request-msgs-bot-type-logo"
                              [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                              [src]="botLogo" />
                          </span>


                          <!-- <span *ngIf="bot.type === 'tiledesk-ai'">
                        <img class="ws-request-msgs-bot-type-logo"
                          [ngClass]="{'ws-request-msgs-bot-type-logo-chat-panel-mode' : CHAT_PANEL_MODE === true}"
                          src="assets/img/tiledesk-ai-logo.png" />
                      </span> -->
                        </td>

                        <td style="cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">
                          <p class="assign-reassign-modal-text-col1">
                            {{ bot?.name }}

                            <!-- --------------------------------------------------- -->
                            <!-- string in CHAT_PANEL_MODE x Project Users -->
                            <!-- --------------------------------------------------- -->
                            <span *ngIf="CHAT_PANEL_MODE === true" class="assign-reassign-modal-subtext-col1">
                              <span> (Bot) </span>
                            </span>
                          </p>
                          <!-- <span class="assign-reassign-modal-text-col2">
                        {{ 'Type' | translate }}:
                        <span style="text-transform: capitalize;font-weight: 400; ">
                          <span *ngIf="bot.type !== 'internal'">
                            {{ bot?.type }}
                          </span>
                          <span *ngIf="bot.type === 'internal'">
                            Resolution
                          </span>
                        </span>
                      </span> -->

                          <!-- --------------------------------------------------- -->
                          <!-- icon 'done' in CHAT_PANEL_MODE x Bot -->
                          <!-- --------------------------------------------------- -->
                          <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                            <div style="position: absolute; top: -33px; right: 0;"
                              *ngIf="bot?._id === bot_participant_id">
                              <i class="material-icons assign-reassign-modal-assignee-icon">
                                done
                              </i>
                            </div>
                          </div>

                        </td>

                        <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                          (click)="selectBot(bot?._id, bot?.name)">
                          <div *ngIf="bot?._id === bot_participant_id">
                            <i class="material-icons" style="margin-left: 14px;color: #73AF55;">
                              done
                            </i>
                          </div>
                        </td>

                        <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                          (click)="selectBot(bot?._id, bot?.name)">
                          Bot
                        </td>


                        <!-- ------------------------------------------------------ -->
                        <!-- column displayed on the over -->
                        <!-- ------------------------------------------------------ -->
                        <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer"
                          (click)="selectBot(bot?._id, bot?.name)">
                          <div class="assign-request">
                            <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                              <span *ngIf="actionInModal === 'reassign'">
                                {{ 'VisitorsPage.ReassignTo' | translate}}
                              </span>
                              <span *ngIf="actionInModal === 'invite'">
                                {{ 'VisitorsPage.AssignTo' | translate}}
                              </span>
                            </p>
                            <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                              {{ bot?.name }} (bot)
                            </span>
                          </div>
                        </td>
                      </tr>
                    </ng-container>

                  </tbody>
                </table>

              </div>
            </div>



            <!-- ---------------------------------------------------------------------------------------------------- -->

          </div>




          <!-- ------------------------------------------------------------------------------ -->
          <!-- Reassign to a dept -->
          <!-- ------------------------------------------------------------------------------ -->
          <section *ngIf="actionInModal === '_reassign' && departments?.length > 1">

            <!-- -------------------------------------- -->
            <!-- modal subtitle -->
            <!-- -------------------------------------- -->
            <div class="col-md-12" *ngIf="CHAT_PANEL_MODE === false">
              <span>
                <h4 style="font-weight:400">
                  {{ "VisitorsPage.SelectTheDeptsToWhom" | translate }}
                </h4>
              </span>
            </div>
            <div class="col-md-12" [ngClass]="{'no-padding' : CHAT_PANEL_MODE === true}">

              <div class="card assign-reassign-modal-card" style="margin-top:5px; margin-bottom:5px"
                [ngClass]="{'modal-card-chat-panel-mode' : CHAT_PANEL_MODE === true, 'card--no-border' : CHAT_PANEL_MODE === true}">

                <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

                <div *ngIf="!showSpinner_inModalUserList" class="card-content"
                  [ngClass]="{'card-content-chat-panel-mode' : CHAT_PANEL_MODE === true}">

                  <table class="table table-hover assign-reassign-modal-table">
                    <thead>
                      <tr>
                        <th colspan="2" [ngClass]="{'sub-header-background' : CHAT_PANEL_MODE === true}">
                          <span style="color: #566787"
                            [ngClass]="{'hidden-if-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                            {{ "Department" | translate }}
                          </span>

                          <!-- ------------------------------------------------------------------------------------------------ -->
                          <!-- the table header if CHAT_PANEL_MODE === true (replace Department abd the above modal subtitle) -->
                          <!-- ------------------------------------------------------------------------------------------------ -->
                          <span *ngIf="CHAT_PANEL_MODE === true">
                            <h4 style="font-weight:400"
                              [ngClass]="{'modal-subtitle-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                              {{ "VisitorsPage.SelectTheDeptsToWhom" | translate }}
                            </h4>
                          </span>
                        </th>

                        <th *ngIf="CHAT_PANEL_MODE === false">
                          <span style="color: #566787">
                            {{ "Assignee" | translate }}
                          </span>
                        </th>

                        <th *ngIf="CHAT_PANEL_MODE === false">
                          <span style="color: #566787">
                            {{ "Agents" | translate }}
                          </span>
                        </th>

                        <th *ngIf="!isMobile && CHAT_PANEL_MODE === false"></th>
                      </tr>
                    </thead>
                    <tbody>

                      <tr *ngFor="let dept of departments;" class="table-row">
                        <ng-container>
                          <td style="cursor:pointer; width:1%;" [ngClass]="{'top-alignment' : CHAT_PANEL_MODE === true}"
                            (click)="selectDept(dept?.name, dept?._id)">
                            <div class="dept---avatar-in-modal"
                              [ngStyle]="{'background-color': dept?.dept_name_fillcolour, 'margin-top':  (CHAT_PANEL_MODE === true ) ? '5px' : '' }">
                              {{ dept?.dept_name_initial }}


                              <span class="default-dept-disabled-badge-in-modal"
                                *ngIf="dept?.default === true && COUNT_OF_VISIBLE_DEPT > 0">
                                <span class="tool_tip">
                                  <span class="material-icons">
                                    unpublished
                                  </span>
                                  <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                    <h4 style="font-weight:400"> Default Department {{ 'Disabled' | translate }}
                                    </h4>

                                    {{'TheDefaulDeptIsDisabledBecause_2' | translate}}
                                    <i></i>
                                  </span>
                                </span>
                              </span>


                              <span class="default-dept-active-badge-in-modal"
                                *ngIf="dept?.default === true && COUNT_OF_VISIBLE_DEPT === 0">
                                <span class="tool_tip">
                                  <span class="material-icons">
                                    check_circle
                                  </span>
                                  <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                    <h4 style="font-weight:400"> Default Department {{ 'Enabled' | translate }}
                                    </h4>
                                    <!-- {{'TheDefaulDeptIsEnabledBecause' | translate}} -->
                                    {{'TheDefaulDeptIsEnabledBecause_2' | translate}}
                                    <i></i>
                                  </span>
                                </span>
                              </span>

                              <!-- // visible / not visible -->
                              <span class="dept-not-visible-badge-in-modal"
                                *ngIf="dept?.default !== true  && dept?.status === 0">
                                <span class="tool_tip">
                                  <span class="material-icons" style="height: 13px;width: 15px;">
                                    visibility_off

                                  </span>
                                  <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                    <h4 style="font-weight:400">
                                      {{dept?.name}} {{ 'IsSetToNotVisible' | translate}}
                                    </h4>

                                    <i></i>
                                  </span>
                                </span>
                              </span>


                              <span class="dept-visible-badge-in-modal"
                                *ngIf="dept?.default !== true && dept?.status === 1">
                                <span class="tool_tip">
                                  <span class="material-icons" style="height: 13px;width: 15px;">
                                    visibility
                                  </span>
                                  <span class="right" style="white-space: normal;padding: 5px;font-weight: 200;">
                                    <h4 style="font-weight:400"> {{dept?.name}}
                                      {{ 'IsSetToVisible' | translate }}
                                    </h4>

                                    <i></i>
                                  </span>
                                </span>
                              </span>
                            </div>
                          </td>

                          <td style="cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">
                            <p style="margin-bottom: 0px;"
                              [ngStyle]="{'line-height':  (CHAT_PANEL_MODE === true ) ? '14px' : '' }">

                              <span class="dept---name" style="display: block;"
                                [ngClass]="{'dept---name-in-chat-panel-mode' : CHAT_PANEL_MODE === true}">
                                {{ dept?.name }}
                              </span>

                              <span class="dept---routing-wpr">
                                <span style="font-weight:300;">
                                  Routing:
                                </span>
                                {{ dept?.routing }}
                              </span>


                              <span *ngIf="CHAT_PANEL_MODE === true">
                                <span *ngIf="dept?.hasGroupName && !dept?.groupHasBeenTrashed">
                                  <span class="group-label">
                                    {{ 'DepartmentsPage.Group' | translate }}
                                  </span>
                                  <span [ngClass]="{'group-name' : CHAT_PANEL_MODE === true}">
                                    {{ dept?.hasGroupName}}
                                  </span>
                                </span>
                                <span *ngIf="dept?.hasGroupName && dept?.groupHasBeenTrashed === true">
                                  <span style="vertical-align: middle;"> {{ dept?.hasGroupName }} </span>
                                  <i class="material-icons"
                                    style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                  <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                    {{ 'DepartmentsPage.TheGroupHasBeenTrashed' | translate }}
                                  </span>
                                </span>

                                <span *ngIf="!dept?.hasGroupName" class="group-name">
                                  {{ 'DepartmentsPage.AllUsers' | translate }}
                                </span>

                                <span *ngIf="dept?.id_bot" style="display: block;">
                                  <span class="bot-label">
                                    Bot:
                                  </span>

                                  <span *ngIf="dept?.hasBot === true" class="bot-name">
                                    {{ dept?.hasBotName }}
                                  </span>
                                  <span *ngIf="dept?.hasBot === false" class="no-bot">
                                    no bot
                                  </span>
                                  <span *ngIf="dept.bot_only == true"
                                    style="font-size: 12px; color: #7695a5; font-weight: 400">
                                    {{ 'DepartmentsPage.OnlyBot' | translate }}
                                  </span>
                                  <span *ngIf="dept.botHasBeenTrashed == true">
                                    <i class="material-icons"
                                      style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                    <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                      {{ 'BotsPage.TheBotHasBeenTrashed' | translate }}
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <!-- --------------------------------------------------- -->
                            <!-- icon 'done' in CHAT_PANEL_MODE x DEPTS -->
                            <!-- --------------------------------------------------- -->
                            <div class="done-wpr" style="position: relative;" *ngIf="CHAT_PANEL_MODE === true">
                              <div style="position: absolute; top: -43px; right: 0;"
                                *ngIf="request?.department?._id === dept?._id">
                                <i class="material-icons assign-reassign-modal-assignee-icon">
                                  done
                                </i>
                              </div>
                            </div>
                          </td>

                          <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                            (click)="selectDept(dept?.name, dept?._id)">
                            <div *ngIf="request?.department?._id === dept?._id">
                              <i class="material-icons" style="margin-left: 14px; color: #73AF55;">
                                done
                              </i>
                            </div>
                          </td>


                          <td *ngIf="CHAT_PANEL_MODE === false" style="cursor:pointer"
                            (click)="selectDept(dept?.name, dept?._id)">
                            <span *ngIf="dept?.hasGroupName && !dept?.groupHasBeenTrashed">
                              <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                {{ 'DepartmentsPage.Group' | translate }}
                              </span>
                              {{ dept?.hasGroupName}}
                            </span>
                            <span *ngIf="dept?.hasGroupName && dept?.groupHasBeenTrashed === true">

                              <span style="vertical-align: middle;"> {{ dept?.hasGroupName }} </span>
                              <i class="material-icons"
                                style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                              <span style="color: #ff5252; vertical-align: middle; font-size:12px;">
                                {{ 'DepartmentsPage.TheGroupHasBeenTrashed' | translate }}
                              </span>
                            </span>

                            <span *ngIf="!dept?.hasGroupName" style="font-size:13px">
                              {{ 'DepartmentsPage.AllUsers' | translate }}
                            </span>

                            <span *ngIf="dept?.id_bot" style="display: block;">
                              <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                Bot:
                                <!-- {{ 'DepartmentsPage.ActivatedBot' | translate }} -->
                              </span>

                              <span *ngIf="dept?.hasBot === true" style="font-size:13px; font-weight:400">
                                {{ dept?.hasBotName }}
                              </span>
                              <span *ngIf="dept?.hasBot === false"
                                style="font-size:13px; font-weight:400;color: #bdbdbd;font-style: italic;">
                                {{ 'DepartmentsPage.NoBotActivated' | translate }}
                              </span>
                              <span *ngIf="dept.bot_only == true"
                                style="font-size: 12px; color: #7695a5; font-weight: 400">
                                {{ 'DepartmentsPage.OnlyBot' | translate }}
                              </span>
                              <span *ngIf="dept.botHasBeenTrashed == true">
                                <i class="material-icons"
                                  style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                <span style="color: #ff5252; vertical-align: middle; font-size:12px;">{{
                                  'BotsPage.TheBotHasBeenTrashed' | translate }}
                                </span>
                              </span>
                            </span>

                          </td>

                          <td *ngIf="!isMobile && CHAT_PANEL_MODE === false" style="cursor:pointer"
                            (click)="selectDept(dept?.name, dept?._id)">
                            <div class="assign-request">
                              <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                {{ 'ReassignToDept' | translate}}
                              </p>
                              <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                                {{ dept?.name }}
                              </span>
                            </div>
                          </td>
                        </ng-container>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <!-- ----------------------------- depts ------------------------------------------------- -->
        </div>

      </div> <!-- /. modal-body -->

      <!-- <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="onCloseUsersListModalHandler()" style="padding:12px 16px;">
            {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div> -->
    </div> <!-- /.modal-content -->
  </div> <!-- /.modal-dialog -->
</div>
<!-- ./ USERS - BOTS - DEPTS LIST MODAL - FULL WIDTH MODAL -->

<!-- ---------------------------------- -->
<!-- LEAVE CHAT MODAL  -->
<!-- ---------------------------------- -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayLeaveChatModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- background-color:#ff5252; -->
      <div class="modal-header" style="padding-bottom:15px">
        <button type="button" class="close" aria-label="Close" (click)="closeLeaveChatModal()">
          <!-- color: #fff -->
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" style="color: #f44336">
          <i class="material-icons" style="vertical-align: middle">info</i>
          <span style="vertical-align: middle; padding-left:8px">
            {{ "VisitorsPage.LeaveChat" | translate }}
          </span>
        </h4>
      </div>
      <div class="modal-body">
        <p style="font-weight:400; text-align: left; margin-top: 10px; color: #566787">

          {{ "VisitorsPage.AreYouSureLeftTheChat" | translate }} <br>
        </p>

      </div>
      <div class="modal-footer" style="margin-top: 0px;">
        <button class="btn btn-white" (click)="closeLeaveChatModal()" style="padding:12px 16px;">

          <!-- {{ "VisitorsPage.Cancel" | translate }} -->
          {{ "Cancel" | translate }}
        </button>
        <button style="margin-top:0px" class="btn btn-danger" (click)="leaveChat()" style="padding:12px 16px;">
          <!-- Archivia Richiesta -->
          {{ "VisitorsPage.LeaveChat" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- -------------------------------------------------- -->
<!--  INFO MODAL: LEAVING CHAT IN PROGRESS  -->
<!-- -------------------------------------------------- -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayLeavingChatInfoModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="closeLeavingChatInfoModal()">
          <span aria-hidden="true">&times;</span>
        </button>

        <h4 class="modal-title">
          {{ "VisitorsPage.LeaveChat" | translate }}

        </h4>
      </div>

      <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px">

        <span *ngIf="SHOW_CIRCULAR_SPINNER">
          <div class="loader" style="top:25%;">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10" />
            </svg>

          </div>
          <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
            {{ "Processing" | translate }}
          </p>
        </span>

        <span *ngIf="!SHOW_CIRCULAR_SPINNER && !LEAVE_CHAT_ERROR ">

          <div style="text-align: center">
            <i class="material-icons" style="color:#70b665">done</i>
            <p style="color:#70b665; font-weight: 500">
              {{ "VisitorsPage.Completed" | translate }}
            </p>

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.ChatLeft" | translate }}
          </p>
        </span>

        <!-- IF THERE IS AN ERROR -->
        <span *ngIf="!SHOW_CIRCULAR_SPINNER && LEAVE_CHAT_ERROR">

          <div style="text-align: center ">
            <i class="material-icons" style="color:#ff5252">report_problem</i>
            <p style="color:#ff5252; font-weight: 500">
              <!-- {{ "VisitorsPage.Error" | translate }} -->
              {{ "Error" | translate }}
            </p>

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.AnErrorHasOccurredLeavingTheChat" | translate }}
          </p>
        </span>
      </div>

      <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-primary" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="closeLeavingChatInfoModal()"
          style="padding:12px 16px;">
          {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div>

    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>

<!-- ----------------------------------------------------------------------------- -->
<!-- @ Trancript modal  -->
<!-- ----------------------------------------------------------------------------- -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayModalTranscript}"
  style="background-color: rgba(90,90,90,0.9);">
  <div class="modal-dialog" role="document">
    <div class="modal-content transcript-modal-content" style="border-top-left-radius:6px; border-top-right-radius:6px">
      <div class="modal-header transcript-modal-header" style=" border-bottom:none!important; position: relative;">

        <!-- <button type="button" class="close" aria-label="Close" (click)="closeModalTranscript()"
          style="position: absolute; right: 14px;top: 16px;">
          <span aria-hidden="true">
           
            <svg class="tide-icon" width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M13.357 11.993l10.256 10.295c0.39 0.391 0.39 1.024 0 1.415-0.194 0.195-0.449 0.292-0.704 0.292s-0.51-0.097-0.705-0.292l-10.257-10.295-10.256 10.295c-0.194 0.195-0.449 0.292-0.704 0.292s-0.51-0.097-0.705-0.292c-0.39-0.391-0.39-1.024 0-1.415l10.256-10.295-10.256-10.294c-0.39-0.391-0.39-1.024 0-1.415s1.020-0.391 1.409 0l10.256 10.294 10.256-10.294c0.39-0.391 1.020-0.391 1.41 0 0.389 0.391 0.389 1.024 0 1.415l-10.256 10.294z">
              </path>
            </svg>
          </span>
        </button> -->

        <button type="button" style="position: absolute; right: 12px;" class="close---round-btn" aria-label="Close"
          (click)="closeModalTranscript()">
          <span aria-hidden="true">&times;</span>
        </button>

        <h2 class="modal-title custom__modal__title">
          <span style="vertical-align: middle;">
            Transcript
          </span>
        </h2>

      </div>
      <hr *ngIf="CHAT_PANEL_MODE === false" class="transcript-custom-hr">
      <div class="modal-body transcript-modal-body">

        <div class="transcript-options-wpr">
          <div class="transcript-option-wpr" (click)="sendTranscriptByEmail()">
            <div class="transcript-option-icon">
              <span class="material-icons send-by-email">
                send
              </span>
            </div>
            <div class="transcript-option-text">
              {{ 'SendByEmail' | translate }}
            </div>
          </div>

          <div class="transcript-option-wpr" (click)="openTranscriptAsHtml()">
            <div class="transcript-option-icon">
              <span class="material-icons">
                launch
              </span>
            </div>
            <div class="transcript-option-text">
              {{'ViewAsHTML' | translate}}
            </div>
          </div>

          <div class="transcript-option-wpr" (click)="downloadTranscriptAsPDF()">
            <div class="transcript-option-icon">
              <span class="material-icons">
                file_download
              </span>
            </div>
            <div class="transcript-option-text">
              {{'DownloadAsPDF' | translate}}
            </div>
          </div>

          <div class="transcript-option-wpr" (click)="downloadTranscriptAsCSV()">
            <div class="transcript-option-icon">
              <span class="material-icons">
                file_download
              </span>
            </div>
            <div class="transcript-option-text">
              {{'DownloadAsCSV' | translate}}
            </div>
          </div>


        </div>
      </div>

      <div class="modal-footer transcript__modal__footer">
        <div style="text-align: center; margin-bottom: 15px;">

          <button style="padding-left: 24px; padding-right: 24px;" type="button" class="btn btn-white"
            (click)="closeModalTranscript()">
            {{ "Cancel" | translate }}
          </button>

          <!-- <button style="padding-left: 24px; padding-right: 24px;" type="button" class="btn btn-primary"
            (click)="downloadTranscript()" [disabled]="!transcriptDwnldPreference">
            {{ "download" | translate }}
          </button> -->

        </div>
      </div>
    </div>
  </div>
</div>


<!-- ----- -->



<!-- [ngStyle]="{'height':apps_sidebar_height }" -->
<div *ngIf="OPEN_APPS_RIGHT_SIDEBAR === true" class="view-side">
  <appdashboard-ws-sidebar-apps [ngClass]="{'min-height-in-panel-mode': CHAT_PANEL_MODE === true}"
    (valueChange)='handleCloseAppsRightSidebar($event)' [request]="request" [apps_sidebar_height]="apps_sidebar_height">
  </appdashboard-ws-sidebar-apps>
</div>

<div *ngIf="OPEN_MAP_RIGHT_SIDEBAR === true" class="view-side">
  <appdashboard-map-request [ngStyle]="{'height': conv_detail_map_sidebar_height }"
    [wsRequestsServed]="wsRequestsServed" [wsRequestsUnserved]="wsRequestsUnserved" [calling_page]="calling_page"
    (closeMapsView)='handleCloseMapRightSidebar($event)'>
  </appdashboard-map-request>
</div>