<!doctype html>

<html style="overflow-y: hidden">

<head>

  <script src="https://js.stripe.com/v3"></script>

  <base href='/'>
  <meta charset="UTF-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <title></title>

  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
  <meta name="viewport" content="width=device-width" />
  <meta name="msapplication-starturl" content="/">

  <!--     Fonts and icons     -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,300|Material+Icons' rel='stylesheet'Ã¬ type='text/css'> -->
  <link href='https://fonts.googleapis.com/css?family=Google+Sans:400,500' rel='stylesheet' type='text/css'>

  <!-- the new one start -------- -->
  <!-- <script type="application/javascript">

    const projectId = "61ae2f221c081a001a045961";
    window.tiledeskSettings =
    {
      projectid: projectId,
      autoStart: true,
      preChatForm: false,

    };

    (function (d, s, id) {
      var w = window; var d = document; var i = function () { i.c(arguments); };
      i.q = []; i.c = function (args) { i.q.push(args); }; w.Tiledesk = i;
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s);
      js.id = id; js.async = true; js.src = "https://console.native.tiledesk.com/widget/launch.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'tiledesk-jssdk'));

    // window.tiledesk.angularcomponent.component.g.preChatForm = false

    function tiledesk_widget_autologin() {
      console.log('widget tiledesk_widget_autologin window', window)
      // setTimeout(() => {
        if (window && window.tiledesk) {
          // window.tiledesk.logout();
          // window.Tiledesk('logout');
          console.log('widget tiledesk_widget_autologin logout')
          // setTimeout(() => {
            tiledesk_widget_login();
            console.log('widget tiledesk_widget_autologin tiledesk_widget_login')
          // }, 500);

        }
      // }, 1000);
    }

    function tiledesk_widget_logout() {
      window.tiledesk.logout();
      console.log('widget tiledesk_widget_logout')
      // window.Tiledesk('logout');
      // window.tiledesk.signInAnonymous()
      window.Tiledesk('signInAnonymous');
      // if (window && window.tiledesk) {

      //   console.log('tiledeskSettings LOGOUT ')
      // } else {
      //   console.log('tiledeskSettings NO LOGOUT ')
      // }
      // window.tiledesk.signInAnonymous()
      //.then(response =>  console.log('signinnnnn', response)).catch(e => console.log('errorrrrrr', e))
    }

    function tiledesk_widget_login() {
      console.log('widget tiledesk_widget_login')

      // window.Tiledesk('setParameter', {key: 'autoStart', value: false})
      // window.Tiledesk('setParameter', {key: 'preChatForm', value: false})

      window.tiledesk.angularcomponent.component.g.autoStart = false;
      // console.log('tiledeskSettings autoStart ', window.tiledesk.angularcomponent.component.g.autoStart)


      window.Tiledesk('logout');
      // window.tiledesk.hide()
      // window.tiledesk.logout();
      // window.tiledesk.reinit();
      console.log('tiledeskSettings 1', window.tiledeskSettings)

      // setTimeout(() => {
      customAuth((token) => {
        console.log("customAuth token ", token);
        if (token) {
          console.log("customAuth HERE Y ", token);
          // window.tiledesk.signInWithCustomToken(token);
          window.Tiledesk('signInWithCustomToken', token);
        }
        else {
          console.log("No user found.");
        }
      });
      // }, 1000);
    }

    window.Tiledesk('onAuthStateChanged', function (event_data) {
      console.log("onAuthStateChanged FIRED ", event_data);
      if (event_data.detail.isLogged) {
        console.log("isLogged!!!!", event_data);
        window.Tiledesk('show')
        // window.tiledesk.show()
      }

    });

    // window.Tiledesk('onLoadParams',(event_data) => {
    //     console.log("Initialized!");
    //     customAuth((token) => {
    //         if (token) {
    //             window.tiledesk.signInWithCustomToken(token);
    //         }
    //         else {
    //             console.log("No user found.");
    //         }
    //     });
    // });

    function customAuth(callback) {
      console.log('Calling customAuth ')
      console.log('tiledeskSettings 2 (customAuth)', window.tiledeskSettings)
      const storedUser = localStorage.getItem('user');
      console.log('tiledeskSettings 2 (customAuth) - storedUser', storedUser)
      let user = null;
      if (storedUser) {
        user = JSON.parse(storedUser);
      }
      if (!user) {
        callback(null);
        return;
      }
      const td_userId = user._id;
      console.log('tiledeskSettings 2 (customAuth) - td_userId', td_userId)
      const URL = 'https://tiledesk-custom-jwt-authentication.tiledesk.repl.co/tiledeskauth';
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open("POST", URL, true);
      xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      xmlhttp.onreadystatechange = function () {
        if (callback && xmlhttp.readyState == 4 && xmlhttp.status == 200 && xmlhttp.responseText) {
          console.log('tiledeskSettings 2 (customAuth) - xmlhttp.readyState', xmlhttp.readyState)
          console.log('tiledeskSettings 2 (customAuth) - xmlhttp.status', xmlhttp.status)
          callback(xmlhttp.responseText);
        }
      };
      const remote_support_project_userId = projectId + "_" + td_userId;
      const td_firstname = user.firstname;
      const td_lastname = user.lastname;
      const td_email = user.email;

      // xmlhttp.send("id=" + remote_support_project_userId + "&firstname=" + td_firstname + "&lastname=" + td_lastname);
      xmlhttp.send("id=" + remote_support_project_userId + "&firstname=" + td_firstname + "&lastname=" + td_lastname + "&email=" + td_email);
    }
  </script> -->
  <!-- The new one /end ------------ -->





  <!-- <script type="application/javascript">
  window.tiledeskSettings= 
  {
      projectid: "6066e60cc3dade4e7389d182",
      autoStart: false
  };
  (function(d, s, id) { 
      var w=window; var d=document; var i=function(){i.c(arguments);};
      i.q=[]; i.c=function(args){i.q.push(args);}; w.Tiledesk=i;
      var js, fjs=d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js=d.createElement(s);
      js.id=id; js.async=true; js.src="https://tiledesk-widget-pre.s3-eu-west-1.amazonaws.com/native-mqtt/widget/5.0.17-beta.1/launch.js";
      fjs.parentNode.insertBefore(js, fjs);
  }(document,'script','tiledesk-jssdk'));
  
  window.Tiledesk('onAuthStateChanged', function(event_data) {
    console.log("AUTHENTICATED!", event_data);
     if(event_data.detail.isLogged){
        console.log("isLogged!!!!", event_data);
        window.Tiledesk('show')
          
      }
  });
  
  window.Tiledesk('onInit', function(event_data) {
     console.log("onInit > FIRED!"); 
  });
  
  window.Tiledesk('onLoadParams', function(event_data) {
    console.log("onLoadParams > FIRED!");
      window.tiledesk.signInWithCustomToken('JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiJkYTY5N2E1Zi02NmQyLTRiOTItYjAxNi02MjE3OThlNjNiOGEiLCJmaXJzdG5hbWUiOiJHdWVzdCIsImlkIjoiZGE2OTdhNWYtNjZkMi00YjkyLWIwMTYtNjIxNzk4ZTYzYjhhIiwiZnVsbE5hbWUiOiJHdWVzdCAiLCJpYXQiOjE2Mjk3OTg2OTQsImF1ZCI6Imh0dHBzOi8vdGlsZWRlc2suY29tIiwiaXNzIjoiaHR0cHM6Ly90aWxlZGVzay5jb20iLCJzdWIiOiJndWVzdCIsImp0aSI6IjdkZjlkMTQ5LTc4N2QtNDVmMy04NzIyLWQyNDRlODIwNzQzYSJ9.En91-AgdKCQVw7dJdiwftdSMwWq5dKZthVZQMG7swBM'); 
  });
</script> -->


</head>

<body>



  <appdashboard-root>
    <div class="loader">
      <svg class="circular" viewBox="25 25 50 50">
        <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
      </svg>
    </div>
  </appdashboard-root>

</body>


</html>